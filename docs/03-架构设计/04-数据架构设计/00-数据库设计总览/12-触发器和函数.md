---
æ–‡æ¡£ç±»å‹: æ¶æ„æ–‡æ¡£
éœ€æ±‚ç¼–å·: DOC-2025-11-001
åˆ›å»ºæ—¥æœŸ: 2025-11-15
åˆ›å»ºè€…: claude-sonnet-4-5 (claude-sonnet-4-5-20250929)
æœ€åæ›´æ–°: 2025-11-26
æ›´æ–°è€…: claude-sonnet-4-5 (claude-sonnet-4-5-20250929)
çŠ¶æ€: å·²æ‰¹å‡†
---

# AIæ ‡ä¹¦æ™ºèƒ½åˆ›ä½œå¹³å° - æ•°æ®åº“è®¾è®¡ - ğŸ”„ è§¦å‘å™¨å’Œå‡½æ•°

### æ›´æ–°æ—¶é—´æˆ³è§¦å‘å™¨

```sql
-- åˆ›å»ºæ›´æ–°æ—¶é—´æˆ³å‡½æ•°
CREATE OR REPLACE FUNCTION update_updated_at_column()
RETURNS TRIGGER AS $$
BEGIN
    NEW.updated_at = CURRENT_TIMESTAMP;
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

-- ä¸ºæ‰€æœ‰åŒ…å«updated_atå­—æ®µçš„è¡¨æ·»åŠ è§¦å‘å™¨
DO $$
DECLARE
    t text;
BEGIN
    FOR t IN
        SELECT tablename FROM pg_tables
        WHERE schemaname = 'public'
        AND tablename IN (
            'users', 'organizations', 'roles', 'projects', 'bidding_documents',
            'project_requirements', 'bid_documents', 'document_sections',
            'document_versions', 'document_comments', 'templates',
            'template_sections', 'company_profiles', 'products_services',
            'project_cases', 'personnel', 'certifications', 'historical_bids',
            'ai_tasks', 'ai_prompts', 'collaboration_sessions',
            'approval_workflows', 'approval_tasks'
        )
    LOOP
        EXECUTE format('
            CREATE TRIGGER update_%I_updated_at
            BEFORE UPDATE ON %I
            FOR EACH ROW
            EXECUTE FUNCTION update_updated_at_column();
        ', t, t);
    END LOOP;
END;
$$ LANGUAGE plpgsql;
```

### è½¯åˆ é™¤æŸ¥è¯¢è§†å›¾

```sql
-- åˆ›å»ºæ´»è·ƒç”¨æˆ·è§†å›¾
CREATE OR REPLACE VIEW active_users AS
SELECT * FROM users WHERE deleted_at IS NULL;

-- åˆ›å»ºæ´»è·ƒé¡¹ç›®è§†å›¾
CREATE OR REPLACE VIEW active_projects AS
SELECT * FROM projects WHERE deleted_at IS NULL;

-- åˆ›å»ºæ´»è·ƒæ–‡æ¡£è§†å›¾
CREATE OR REPLACE VIEW active_bid_documents AS
SELECT * FROM bid_documents WHERE deleted_at IS NULL;
```
