---
æ–‡æ¡£ç±»å‹: æ¶æ„æ–‡æ¡£
éœ€æ±‚ç¼–å·: DOC-2025-11-001
åˆ›å»ºæ—¥æœŸ: 2025-11-15
åˆ›å»ºè€…: claude-sonnet-4-5 (claude-sonnet-4-5-20250929)
æœ€åæ›´æ–°: 2025-11-26
æ›´æ–°è€…: claude-sonnet-4-5 (claude-sonnet-4-5-20250929)
çŠ¶æ€: å·²æ‰¹å‡†
---

# AIæ ‡ä¹¦æ™ºèƒ½åˆ›ä½œå¹³å° - æ•°æ®åº“è®¾è®¡ - ğŸ‘¥ ç”¨æˆ·ä¸æƒé™åŸŸ

### 1. users (ç”¨æˆ·è¡¨)

```sql
CREATE TABLE users (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    email VARCHAR(255) UNIQUE NOT NULL,
    username VARCHAR(100) UNIQUE NOT NULL,
    full_name VARCHAR(200),
    hashed_password VARCHAR(255) NOT NULL,
    phone VARCHAR(20),
    avatar_url TEXT,
    status VARCHAR(20) DEFAULT 'active' CHECK (status IN ('active', 'inactive', 'suspended')),
    email_verified BOOLEAN DEFAULT FALSE,
    phone_verified BOOLEAN DEFAULT FALSE,
    last_login_at TIMESTAMP WITH TIME ZONE,
    last_login_ip INET,
    login_count INTEGER DEFAULT 0,
    organization_id UUID,
    settings JSONB DEFAULT '{}'::jsonb,
    metadata JSONB DEFAULT '{}'::jsonb,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    deleted_at TIMESTAMP WITH TIME ZONE
);

-- ç´¢å¼•
CREATE INDEX idx_users_email ON users(email) WHERE deleted_at IS NULL;
CREATE INDEX idx_users_username ON users(username) WHERE deleted_at IS NULL;
CREATE INDEX idx_users_organization_id ON users(organization_id) WHERE deleted_at IS NULL;
CREATE INDEX idx_users_status ON users(status) WHERE deleted_at IS NULL;
CREATE INDEX idx_users_created_at ON users(created_at DESC);

-- æ³¨é‡Š
COMMENT ON TABLE users IS 'ç”¨æˆ·è¡¨';
COMMENT ON COLUMN users.id IS 'ç”¨æˆ·ID';
COMMENT ON COLUMN users.email IS 'é‚®ç®±';
COMMENT ON COLUMN users.username IS 'ç”¨æˆ·å';
COMMENT ON COLUMN users.full_name IS 'å…¨å';
COMMENT ON COLUMN users.hashed_password IS 'åŠ å¯†åçš„å¯†ç ';
COMMENT ON COLUMN users.status IS 'ç”¨æˆ·çŠ¶æ€: active-æ´»è·ƒ, inactive-æœªæ¿€æ´», suspended-å·²æš‚åœ';
COMMENT ON COLUMN users.settings IS 'ç”¨æˆ·è®¾ç½®(JSON)';
COMMENT ON COLUMN users.metadata IS 'å…ƒæ•°æ®(JSON)';
```

### 2. organizations (ç»„ç»‡è¡¨)

```sql
CREATE TABLE organizations (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    name VARCHAR(200) NOT NULL,
    short_name VARCHAR(100),
    organization_type VARCHAR(50) DEFAULT 'company' CHECK (organization_type IN ('company', 'government', 'institution', 'individual')),
    tax_id VARCHAR(50),
    legal_person VARCHAR(100),
    contact_phone VARCHAR(20),
    contact_email VARCHAR(255),
    address TEXT,
    province VARCHAR(50),
    city VARCHAR(50),
    district VARCHAR(50),
    logo_url TEXT,
    website TEXT,
    industry VARCHAR(100),
    scale VARCHAR(50),
    established_date DATE,
    status VARCHAR(20) DEFAULT 'active' CHECK (status IN ('active', 'inactive', 'suspended')),
    settings JSONB DEFAULT '{}'::jsonb,
    metadata JSONB DEFAULT '{}'::jsonb,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    deleted_at TIMESTAMP WITH TIME ZONE
);

-- ç´¢å¼•
CREATE INDEX idx_organizations_name ON organizations USING gin(name gin_trgm_ops);
CREATE INDEX idx_organizations_tax_id ON organizations(tax_id) WHERE deleted_at IS NULL;
CREATE INDEX idx_organizations_status ON organizations(status) WHERE deleted_at IS NULL;

-- æ³¨é‡Š
COMMENT ON TABLE organizations IS 'ç»„ç»‡/ä¼ä¸šè¡¨';
COMMENT ON COLUMN organizations.organization_type IS 'ç»„ç»‡ç±»å‹: company-å…¬å¸, government-æ”¿åºœ, institution-äº‹ä¸šå•ä½, individual-ä¸ªäºº';
COMMENT ON COLUMN organizations.scale IS 'ä¼ä¸šè§„æ¨¡: small-å°å‹, medium-ä¸­å‹, large-å¤§å‹, xlarge-è¶…å¤§å‹';
```

### 3. roles (è§’è‰²è¡¨)

```sql
CREATE TABLE roles (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    name VARCHAR(100) NOT NULL,
    code VARCHAR(50) UNIQUE NOT NULL,
    description TEXT,
    organization_id UUID,
    is_system BOOLEAN DEFAULT FALSE,
    level INTEGER DEFAULT 0,
    permissions TEXT[] DEFAULT ARRAY[]::TEXT[],
    metadata JSONB DEFAULT '{}'::jsonb,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    deleted_at TIMESTAMP WITH TIME ZONE,
    FOREIGN KEY (organization_id) REFERENCES organizations(id) ON DELETE CASCADE
);

-- ç´¢å¼•
CREATE INDEX idx_roles_code ON roles(code) WHERE deleted_at IS NULL;
CREATE INDEX idx_roles_organization_id ON roles(organization_id) WHERE deleted_at IS NULL;
CREATE INDEX idx_roles_is_system ON roles(is_system);

-- æ³¨é‡Š
COMMENT ON TABLE roles IS 'è§’è‰²è¡¨';
COMMENT ON COLUMN roles.code IS 'è§’è‰²ä»£ç ';
COMMENT ON COLUMN roles.is_system IS 'æ˜¯å¦ç³»ç»Ÿè§’è‰²';
COMMENT ON COLUMN roles.level IS 'è§’è‰²çº§åˆ«';
COMMENT ON COLUMN roles.permissions IS 'æƒé™ä»£ç æ•°ç»„';
```

### 4. permissions (æƒé™è¡¨)

```sql
CREATE TABLE permissions (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    name VARCHAR(100) NOT NULL,
    code VARCHAR(50) UNIQUE NOT NULL,
    description TEXT,
    resource VARCHAR(100) NOT NULL,
    action VARCHAR(50) NOT NULL,
    category VARCHAR(50),
    is_system BOOLEAN DEFAULT FALSE,
    metadata JSONB DEFAULT '{}'::jsonb,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);

-- ç´¢å¼•
CREATE INDEX idx_permissions_code ON permissions(code);
CREATE INDEX idx_permissions_resource ON permissions(resource);
CREATE INDEX idx_permissions_category ON permissions(category);

-- æ³¨é‡Š
COMMENT ON TABLE permissions IS 'æƒé™è¡¨';
COMMENT ON COLUMN permissions.resource IS 'èµ„æºåç§°';
COMMENT ON COLUMN permissions.action IS 'æ“ä½œ: create, read, update, delete, execute';
COMMENT ON COLUMN permissions.category IS 'æƒé™åˆ†ç±»';
```

### 5. user_roles (ç”¨æˆ·è§’è‰²å…³è”è¡¨)

```sql
CREATE TABLE user_roles (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    user_id UUID NOT NULL,
    role_id UUID NOT NULL,
    granted_by UUID,
    granted_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    expires_at TIMESTAMP WITH TIME ZONE,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (role_id) REFERENCES roles(id) ON DELETE CASCADE,
    FOREIGN KEY (granted_by) REFERENCES users(id) ON DELETE SET NULL,
    UNIQUE (user_id, role_id)
);

-- ç´¢å¼•
CREATE INDEX idx_user_roles_user_id ON user_roles(user_id);
CREATE INDEX idx_user_roles_role_id ON user_roles(role_id);

-- æ³¨é‡Š
COMMENT ON TABLE user_roles IS 'ç”¨æˆ·è§’è‰²å…³è”è¡¨';
```

### 6. role_permissions (è§’è‰²æƒé™å…³è”è¡¨)

```sql
CREATE TABLE role_permissions (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    role_id UUID NOT NULL,
    permission_id UUID NOT NULL,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (role_id) REFERENCES roles(id) ON DELETE CASCADE,
    FOREIGN KEY (permission_id) REFERENCES permissions(id) ON DELETE CASCADE,
    UNIQUE (role_id, permission_id)
);

-- ç´¢å¼•
CREATE INDEX idx_role_permissions_role_id ON role_permissions(role_id);
CREATE INDEX idx_role_permissions_permission_id ON role_permissions(permission_id);

-- æ³¨é‡Š
COMMENT ON TABLE role_permissions IS 'è§’è‰²æƒé™å…³è”è¡¨';
```
