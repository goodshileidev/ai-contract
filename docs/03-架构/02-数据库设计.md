# AIÊ†á‰π¶Êô∫ËÉΩÂàõ‰ΩúÂπ≥Âè∞ - Êï∞ÊçÆÂ∫ìËÆæËÆ°

## üìã Êï∞ÊçÆÂ∫ìÊ¶ÇËßà

### Êï∞ÊçÆÂ∫ìÈÄâÂûã

```yaml
‰∏ªÊï∞ÊçÆÂ∫ì:
  Á±ªÂûã: PostgreSQL 14+
  ÁõÆÁöÑ: ÂÖ≥Á≥ªÂûãÊï∞ÊçÆÂ≠òÂÇ®
  ÁâπÊÄß: ACID„ÄÅJSONB„ÄÅÂÖ®ÊñáÊêúÁ¥¢„ÄÅÊó∂Â∫èÊï∞ÊçÆ

ÂêëÈáèÊï∞ÊçÆÂ∫ì:
  Á±ªÂûã: Pinecone / Chroma
  ÁõÆÁöÑ: ÂêëÈáèÂµåÂÖ•Â≠òÂÇ®ÂíåÁõ∏‰ººÂ∫¶ÊêúÁ¥¢

ÂõæÊï∞ÊçÆÂ∫ì:
  Á±ªÂûã: Neo4j
  ÁõÆÁöÑ: Áü•ËØÜÂõæË∞±Â≠òÂÇ®

ÁºìÂ≠òÊï∞ÊçÆÂ∫ì:
  Á±ªÂûã: Redis 7+
  ÁõÆÁöÑ: ÁºìÂ≠ò„ÄÅ‰ºöËØùÂ≠òÂÇ®„ÄÅÊ∂àÊÅØÈòüÂàó

ÊêúÁ¥¢ÂºïÊìé:
  Á±ªÂûã: Elasticsearch 8+
  ÁõÆÁöÑ: ÂÖ®ÊñáÊêúÁ¥¢„ÄÅÊó•ÂøóÂàÜÊûê
```

### Êï∞ÊçÆÂ∫ìÊû∂ÊûÑ

```
PostgreSQLÊï∞ÊçÆÂ∫ì:
‚îú‚îÄ‚îÄ public schema (ÂÖ¨ÂÖ±Ê®°Âºè)
‚îÇ   ‚îú‚îÄ‚îÄ Áî®Êà∑‰∏éÊùÉÈôêÂüü (9Âº†Ë°®)
‚îÇ   ‚îú‚îÄ‚îÄ È°πÁõÆÂüü (6Âº†Ë°®)
‚îÇ   ‚îú‚îÄ‚îÄ Ê†á‰π¶Âüü (8Âº†Ë°®)
‚îÇ   ‚îú‚îÄ‚îÄ Ê®°ÊùøÂüü (5Âº†Ë°®)
‚îÇ   ‚îú‚îÄ‚îÄ ‰ºÅ‰∏öËÉΩÂäõÂüü (7Âº†Ë°®)
‚îÇ   ‚îú‚îÄ‚îÄ AIÊúçÂä°Âüü (5Âº†Ë°®)
‚îÇ   ‚îú‚îÄ‚îÄ Âçè‰ΩúÂüü (4Âº†Ë°®)
‚îÇ   ‚îú‚îÄ‚îÄ ÂÆ°ÊâπÂüü (4Âº†Ë°®)
‚îÇ   ‚îî‚îÄ‚îÄ ÂÆ°ËÆ°‰∏éÊó•ÂøóÂüü (3Âº†Ë°®)
‚îÇ
‚îî‚îÄ‚îÄ extensions
    ‚îú‚îÄ‚îÄ uuid-ossp (UUIDÁîüÊàê)
    ‚îú‚îÄ‚îÄ pg_trgm (Ê®°Á≥äÊêúÁ¥¢)
    ‚îî‚îÄ‚îÄ timescaledb (Êó∂Â∫èÊï∞ÊçÆ)
```

## üóÑÔ∏è Êï∞ÊçÆË°®ËÆæËÆ°

### ËÆæËÆ°ÂéüÂàô

1. **ÂëΩÂêçËßÑËåÉ**:
   - Ë°®Âêç: Â∞èÂÜô+‰∏ãÂàíÁ∫ø (snake_case)
   - Â≠óÊÆµÂêç: Â∞èÂÜô+‰∏ãÂàíÁ∫ø (snake_case)
   - Á¥¢ÂºïÂêç: idx_{table}_{columns}
   - Â§ñÈîÆÂêç: fk_{table}_{ref_table}

2. **ÈÄöÁî®Â≠óÊÆµ**:
   - `id`: UUID‰∏ªÈîÆ
   - `created_at`: ÂàõÂª∫Êó∂Èó¥
   - `updated_at`: Êõ¥Êñ∞Êó∂Èó¥
   - `deleted_at`: ËΩØÂà†Èô§Êó∂Èó¥ (ÂèØÈÄâ)
   - `created_by`: ÂàõÂª∫‰∫∫ID
   - `updated_by`: Êõ¥Êñ∞‰∫∫ID

3. **Êï∞ÊçÆÁ±ªÂûã**:
   - ID: UUID
   - Êó∂Èó¥: TIMESTAMP WITH TIME ZONE
   - ÈáëÈ¢ù: DECIMAL(15, 2)
   - JSON: JSONB
   - ÊñáÊú¨: TEXT

### Êï∞ÊçÆÂ∫ìÂàùÂßãÂåñ

```sql
-- ============================================================================
-- AIÊ†á‰π¶Êô∫ËÉΩÂàõ‰ΩúÂπ≥Âè∞ - Êï∞ÊçÆÂ∫ìÂàùÂßãÂåñËÑöÊú¨
-- ÁâàÊú¨: 1.0
-- ÂàõÂª∫Êó∂Èó¥: 2025-11-14
-- ============================================================================

-- ÂàõÂª∫Êï∞ÊçÆÂ∫ì
CREATE DATABASE aibidcomposer
    WITH
    ENCODING = 'UTF8'
    LC_COLLATE = 'zh_CN.UTF-8'
    LC_CTYPE = 'zh_CN.UTF-8'
    TEMPLATE = template0;

\c aibidcomposer;

-- ÂêØÁî®Êâ©Â±ï
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";      -- UUIDÁîüÊàê
CREATE EXTENSION IF NOT EXISTS "pg_trgm";        -- Ê®°Á≥äÊêúÁ¥¢
CREATE EXTENSION IF NOT EXISTS "btree_gin";      -- GINÁ¥¢Âºï
CREATE EXTENSION IF NOT EXISTS "timescaledb";    -- Êó∂Â∫èÊï∞ÊçÆ

-- ËÆæÁΩÆÊó∂Âå∫
SET TIME ZONE 'Asia/Shanghai';
```

## üë• Áî®Êà∑‰∏éÊùÉÈôêÂüü

### 1. users (Áî®Êà∑Ë°®)

```sql
CREATE TABLE users (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    email VARCHAR(255) UNIQUE NOT NULL,
    username VARCHAR(100) UNIQUE NOT NULL,
    full_name VARCHAR(200),
    hashed_password VARCHAR(255) NOT NULL,
    phone VARCHAR(20),
    avatar_url TEXT,
    status VARCHAR(20) DEFAULT 'active' CHECK (status IN ('active', 'inactive', 'suspended')),
    email_verified BOOLEAN DEFAULT FALSE,
    phone_verified BOOLEAN DEFAULT FALSE,
    last_login_at TIMESTAMP WITH TIME ZONE,
    last_login_ip INET,
    login_count INTEGER DEFAULT 0,
    organization_id UUID,
    settings JSONB DEFAULT '{}'::jsonb,
    metadata JSONB DEFAULT '{}'::jsonb,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    deleted_at TIMESTAMP WITH TIME ZONE
);

-- Á¥¢Âºï
CREATE INDEX idx_users_email ON users(email) WHERE deleted_at IS NULL;
CREATE INDEX idx_users_username ON users(username) WHERE deleted_at IS NULL;
CREATE INDEX idx_users_organization_id ON users(organization_id) WHERE deleted_at IS NULL;
CREATE INDEX idx_users_status ON users(status) WHERE deleted_at IS NULL;
CREATE INDEX idx_users_created_at ON users(created_at DESC);

-- Ê≥®Èáä
COMMENT ON TABLE users IS 'Áî®Êà∑Ë°®';
COMMENT ON COLUMN users.id IS 'Áî®Êà∑ID';
COMMENT ON COLUMN users.email IS 'ÈÇÆÁÆ±';
COMMENT ON COLUMN users.username IS 'Áî®Êà∑Âêç';
COMMENT ON COLUMN users.full_name IS 'ÂÖ®Âêç';
COMMENT ON COLUMN users.hashed_password IS 'Âä†ÂØÜÂêéÁöÑÂØÜÁ†Å';
COMMENT ON COLUMN users.status IS 'Áî®Êà∑Áä∂ÊÄÅ: active-Ê¥ªË∑É, inactive-Êú™ÊøÄÊ¥ª, suspended-Â∑≤ÊöÇÂÅú';
COMMENT ON COLUMN users.settings IS 'Áî®Êà∑ËÆæÁΩÆ(JSON)';
COMMENT ON COLUMN users.metadata IS 'ÂÖÉÊï∞ÊçÆ(JSON)';
```

### 2. organizations (ÁªÑÁªáË°®)

```sql
CREATE TABLE organizations (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    name VARCHAR(200) NOT NULL,
    short_name VARCHAR(100),
    organization_type VARCHAR(50) DEFAULT 'company' CHECK (organization_type IN ('company', 'government', 'institution', 'individual')),
    tax_id VARCHAR(50),
    legal_person VARCHAR(100),
    contact_phone VARCHAR(20),
    contact_email VARCHAR(255),
    address TEXT,
    province VARCHAR(50),
    city VARCHAR(50),
    district VARCHAR(50),
    logo_url TEXT,
    website TEXT,
    industry VARCHAR(100),
    scale VARCHAR(50),
    established_date DATE,
    status VARCHAR(20) DEFAULT 'active' CHECK (status IN ('active', 'inactive', 'suspended')),
    settings JSONB DEFAULT '{}'::jsonb,
    metadata JSONB DEFAULT '{}'::jsonb,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    deleted_at TIMESTAMP WITH TIME ZONE
);

-- Á¥¢Âºï
CREATE INDEX idx_organizations_name ON organizations USING gin(name gin_trgm_ops);
CREATE INDEX idx_organizations_tax_id ON organizations(tax_id) WHERE deleted_at IS NULL;
CREATE INDEX idx_organizations_status ON organizations(status) WHERE deleted_at IS NULL;

-- Ê≥®Èáä
COMMENT ON TABLE organizations IS 'ÁªÑÁªá/‰ºÅ‰∏öË°®';
COMMENT ON COLUMN organizations.organization_type IS 'ÁªÑÁªáÁ±ªÂûã: company-ÂÖ¨Âè∏, government-ÊîøÂ∫ú, institution-‰∫ã‰∏öÂçï‰Ωç, individual-‰∏™‰∫∫';
COMMENT ON COLUMN organizations.scale IS '‰ºÅ‰∏öËßÑÊ®°: small-Â∞èÂûã, medium-‰∏≠Âûã, large-Â§ßÂûã, xlarge-Ë∂ÖÂ§ßÂûã';
```

### 3. roles (ËßíËâ≤Ë°®)

```sql
CREATE TABLE roles (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    name VARCHAR(100) NOT NULL,
    code VARCHAR(50) UNIQUE NOT NULL,
    description TEXT,
    organization_id UUID,
    is_system BOOLEAN DEFAULT FALSE,
    level INTEGER DEFAULT 0,
    permissions TEXT[] DEFAULT ARRAY[]::TEXT[],
    metadata JSONB DEFAULT '{}'::jsonb,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    deleted_at TIMESTAMP WITH TIME ZONE,
    FOREIGN KEY (organization_id) REFERENCES organizations(id) ON DELETE CASCADE
);

-- Á¥¢Âºï
CREATE INDEX idx_roles_code ON roles(code) WHERE deleted_at IS NULL;
CREATE INDEX idx_roles_organization_id ON roles(organization_id) WHERE deleted_at IS NULL;
CREATE INDEX idx_roles_is_system ON roles(is_system);

-- Ê≥®Èáä
COMMENT ON TABLE roles IS 'ËßíËâ≤Ë°®';
COMMENT ON COLUMN roles.code IS 'ËßíËâ≤‰ª£Á†Å';
COMMENT ON COLUMN roles.is_system IS 'ÊòØÂê¶Á≥ªÁªüËßíËâ≤';
COMMENT ON COLUMN roles.level IS 'ËßíËâ≤Á∫ßÂà´';
COMMENT ON COLUMN roles.permissions IS 'ÊùÉÈôê‰ª£Á†ÅÊï∞ÁªÑ';
```

### 4. permissions (ÊùÉÈôêË°®)

```sql
CREATE TABLE permissions (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    name VARCHAR(100) NOT NULL,
    code VARCHAR(50) UNIQUE NOT NULL,
    description TEXT,
    resource VARCHAR(100) NOT NULL,
    action VARCHAR(50) NOT NULL,
    category VARCHAR(50),
    is_system BOOLEAN DEFAULT FALSE,
    metadata JSONB DEFAULT '{}'::jsonb,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);

-- Á¥¢Âºï
CREATE INDEX idx_permissions_code ON permissions(code);
CREATE INDEX idx_permissions_resource ON permissions(resource);
CREATE INDEX idx_permissions_category ON permissions(category);

-- Ê≥®Èáä
COMMENT ON TABLE permissions IS 'ÊùÉÈôêË°®';
COMMENT ON COLUMN permissions.resource IS 'ËµÑÊ∫êÂêçÁß∞';
COMMENT ON COLUMN permissions.action IS 'Êìç‰Ωú: create, read, update, delete, execute';
COMMENT ON COLUMN permissions.category IS 'ÊùÉÈôêÂàÜÁ±ª';
```

### 5. user_roles (Áî®Êà∑ËßíËâ≤ÂÖ≥ËÅîË°®)

```sql
CREATE TABLE user_roles (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    user_id UUID NOT NULL,
    role_id UUID NOT NULL,
    granted_by UUID,
    granted_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    expires_at TIMESTAMP WITH TIME ZONE,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (role_id) REFERENCES roles(id) ON DELETE CASCADE,
    FOREIGN KEY (granted_by) REFERENCES users(id) ON DELETE SET NULL,
    UNIQUE (user_id, role_id)
);

-- Á¥¢Âºï
CREATE INDEX idx_user_roles_user_id ON user_roles(user_id);
CREATE INDEX idx_user_roles_role_id ON user_roles(role_id);

-- Ê≥®Èáä
COMMENT ON TABLE user_roles IS 'Áî®Êà∑ËßíËâ≤ÂÖ≥ËÅîË°®';
```

### 6. role_permissions (ËßíËâ≤ÊùÉÈôêÂÖ≥ËÅîË°®)

```sql
CREATE TABLE role_permissions (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    role_id UUID NOT NULL,
    permission_id UUID NOT NULL,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (role_id) REFERENCES roles(id) ON DELETE CASCADE,
    FOREIGN KEY (permission_id) REFERENCES permissions(id) ON DELETE CASCADE,
    UNIQUE (role_id, permission_id)
);

-- Á¥¢Âºï
CREATE INDEX idx_role_permissions_role_id ON role_permissions(role_id);
CREATE INDEX idx_role_permissions_permission_id ON role_permissions(permission_id);

-- Ê≥®Èáä
COMMENT ON TABLE role_permissions IS 'ËßíËâ≤ÊùÉÈôêÂÖ≥ËÅîË°®';
```

## üìÅ È°πÁõÆÂüü

### 7. projects (È°πÁõÆË°®)

```sql
CREATE TABLE projects (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    name VARCHAR(200) NOT NULL,
    code VARCHAR(50) UNIQUE NOT NULL,
    description TEXT,
    organization_id UUID NOT NULL,
    bidding_type VARCHAR(50) CHECK (bidding_type IN ('government', 'enterprise', 'international', 'other')),
    industry VARCHAR(100),
    budget_amount DECIMAL(15, 2),
    currency VARCHAR(10) DEFAULT 'CNY',
    start_date DATE,
    end_date DATE,
    submission_deadline TIMESTAMP WITH TIME ZONE,
    status VARCHAR(20) DEFAULT 'draft' CHECK (status IN ('draft', 'in_progress', 'review', 'submitted', 'won', 'lost', 'archived')),
    priority VARCHAR(20) DEFAULT 'medium' CHECK (priority IN ('low', 'medium', 'high', 'urgent')),
    win_probability INTEGER CHECK (win_probability >= 0 AND win_probability <= 100),
    tags TEXT[] DEFAULT ARRAY[]::TEXT[],
    settings JSONB DEFAULT '{}'::jsonb,
    metadata JSONB DEFAULT '{}'::jsonb,
    created_by UUID NOT NULL,
    updated_by UUID,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    deleted_at TIMESTAMP WITH TIME ZONE,
    FOREIGN KEY (organization_id) REFERENCES organizations(id) ON DELETE CASCADE,
    FOREIGN KEY (created_by) REFERENCES users(id) ON DELETE RESTRICT,
    FOREIGN KEY (updated_by) REFERENCES users(id) ON DELETE SET NULL
);

-- Á¥¢Âºï
CREATE INDEX idx_projects_organization_id ON projects(organization_id) WHERE deleted_at IS NULL;
CREATE INDEX idx_projects_status ON projects(status) WHERE deleted_at IS NULL;
CREATE INDEX idx_projects_created_by ON projects(created_by);
CREATE INDEX idx_projects_submission_deadline ON projects(submission_deadline) WHERE deleted_at IS NULL;
CREATE INDEX idx_projects_tags ON projects USING gin(tags);
CREATE INDEX idx_projects_created_at ON projects(created_at DESC);

-- Ê≥®Èáä
COMMENT ON TABLE projects IS 'È°πÁõÆË°®';
COMMENT ON COLUMN projects.bidding_type IS 'ÊãõÊ†áÁ±ªÂûã';
COMMENT ON COLUMN projects.status IS 'È°πÁõÆÁä∂ÊÄÅ';
COMMENT ON COLUMN projects.priority IS '‰ºòÂÖàÁ∫ß';
COMMENT ON COLUMN projects.win_probability IS '‰∏≠Ê†áÊ¶ÇÁéá(0-100)';
```

### 8. project_members (È°πÁõÆÊàêÂëòË°®)

```sql
CREATE TABLE project_members (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    project_id UUID NOT NULL,
    user_id UUID NOT NULL,
    role VARCHAR(50) DEFAULT 'member' CHECK (role IN ('owner', 'manager', 'member', 'viewer')),
    permissions TEXT[] DEFAULT ARRAY[]::TEXT[],
    joined_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    created_by UUID,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (project_id) REFERENCES projects(id) ON DELETE CASCADE,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (created_by) REFERENCES users(id) ON DELETE SET NULL,
    UNIQUE (project_id, user_id)
);

-- Á¥¢Âºï
CREATE INDEX idx_project_members_project_id ON project_members(project_id);
CREATE INDEX idx_project_members_user_id ON project_members(user_id);
CREATE INDEX idx_project_members_role ON project_members(role);

-- Ê≥®Èáä
COMMENT ON TABLE project_members IS 'È°πÁõÆÊàêÂëòË°®';
COMMENT ON COLUMN project_members.role IS 'È°πÁõÆËßíËâ≤: owner-ÊâÄÊúâËÄÖ, manager-ÁÆ°ÁêÜÂëò, member-ÊàêÂëò, viewer-Êü•ÁúãËÄÖ';
```

### 9. bidding_documents (ÊãõÊ†áÊñá‰ª∂Ë°®)

```sql
CREATE TABLE bidding_documents (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    project_id UUID NOT NULL,
    file_name VARCHAR(255) NOT NULL,
    file_path TEXT NOT NULL,
    file_size BIGINT NOT NULL,
    file_type VARCHAR(50) NOT NULL,
    mime_type VARCHAR(100),
    storage_key VARCHAR(500) NOT NULL,
    parsed_status VARCHAR(20) DEFAULT 'pending' CHECK (parsed_status IN ('pending', 'processing', 'success', 'failed')),
    parsed_content JSONB,
    parsed_at TIMESTAMP WITH TIME ZONE,
    parse_error TEXT,
    document_hash VARCHAR(64),
    uploaded_by UUID NOT NULL,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    deleted_at TIMESTAMP WITH TIME ZONE,
    FOREIGN KEY (project_id) REFERENCES projects(id) ON DELETE CASCADE,
    FOREIGN KEY (uploaded_by) REFERENCES users(id) ON DELETE RESTRICT
);

-- Á¥¢Âºï
CREATE INDEX idx_bidding_documents_project_id ON bidding_documents(project_id) WHERE deleted_at IS NULL;
CREATE INDEX idx_bidding_documents_parsed_status ON bidding_documents(parsed_status);
CREATE INDEX idx_bidding_documents_document_hash ON bidding_documents(document_hash);
CREATE INDEX idx_bidding_documents_created_at ON bidding_documents(created_at DESC);

-- Ê≥®Èáä
COMMENT ON TABLE bidding_documents IS 'ÊãõÊ†áÊñá‰ª∂Ë°®';
COMMENT ON COLUMN bidding_documents.parsed_status IS 'Ëß£ÊûêÁä∂ÊÄÅ';
COMMENT ON COLUMN bidding_documents.parsed_content IS 'Ëß£ÊûêÂêéÁöÑÂÜÖÂÆπ(JSON)';
COMMENT ON COLUMN bidding_documents.document_hash IS 'Êñá‰ª∂ÂìàÂ∏å(Áî®‰∫éÂéªÈáç)';
```

### 10. project_requirements (È°πÁõÆÈúÄÊ±ÇË°®)

```sql
CREATE TABLE project_requirements (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    project_id UUID NOT NULL,
    requirement_type VARCHAR(50) CHECK (requirement_type IN ('technical', 'business', 'compliance', 'resource', 'other')),
    category VARCHAR(100),
    title VARCHAR(200) NOT NULL,
    description TEXT,
    priority VARCHAR(20) DEFAULT 'medium' CHECK (priority IN ('low', 'medium', 'high', 'critical')),
    is_mandatory BOOLEAN DEFAULT TRUE,
    score_weight DECIMAL(5, 2),
    match_status VARCHAR(20) DEFAULT 'pending' CHECK (match_status IN ('pending', 'matched', 'partial', 'unmatched')),
    match_score DECIMAL(5, 2),
    match_details JSONB,
    source VARCHAR(50),
    source_page INTEGER,
    extracted_by VARCHAR(20) DEFAULT 'ai' CHECK (extracted_by IN ('ai', 'manual')),
    metadata JSONB DEFAULT '{}'::jsonb,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (project_id) REFERENCES projects(id) ON DELETE CASCADE
);

-- Á¥¢Âºï
CREATE INDEX idx_project_requirements_project_id ON project_requirements(project_id);
CREATE INDEX idx_project_requirements_type ON project_requirements(requirement_type);
CREATE INDEX idx_project_requirements_match_status ON project_requirements(match_status);

-- Ê≥®Èáä
COMMENT ON TABLE project_requirements IS 'È°πÁõÆÈúÄÊ±ÇË°®';
COMMENT ON COLUMN project_requirements.match_status IS 'ÂåπÈÖçÁä∂ÊÄÅ';
COMMENT ON COLUMN project_requirements.match_score IS 'ÂåπÈÖçÂàÜÊï∞(0-100)';
```

## üìÑ Ê†á‰π¶Âüü

### 11. bid_documents (Ê†á‰π¶ÊñáÊ°£Ë°®)

```sql
CREATE TABLE bid_documents (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    project_id UUID NOT NULL,
    template_id UUID,
    title VARCHAR(200) NOT NULL,
    version VARCHAR(20) DEFAULT '1.0',
    document_type VARCHAR(50) DEFAULT 'main' CHECK (document_type IN ('main', 'technical', 'commercial', 'qualification', 'other')),
    status VARCHAR(20) DEFAULT 'draft' CHECK (status IN ('draft', 'editing', 'review', 'approved', 'submitted', 'archived')),
    content_type VARCHAR(20) DEFAULT 'structured' CHECK (content_type IN ('structured', 'freeform', 'mixed')),
    content JSONB,
    plain_content TEXT,
    toc JSONB,
    word_count INTEGER DEFAULT 0,
    page_count INTEGER DEFAULT 0,
    last_edited_by UUID,
    last_edited_at TIMESTAMP WITH TIME ZONE,
    locked_by UUID,
    locked_at TIMESTAMP WITH TIME ZONE,
    metadata JSONB DEFAULT '{}'::jsonb,
    created_by UUID NOT NULL,
    updated_by UUID,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    deleted_at TIMESTAMP WITH TIME ZONE,
    FOREIGN KEY (project_id) REFERENCES projects(id) ON DELETE CASCADE,
    FOREIGN KEY (template_id) REFERENCES templates(id) ON DELETE SET NULL,
    FOREIGN KEY (created_by) REFERENCES users(id) ON DELETE RESTRICT,
    FOREIGN KEY (updated_by) REFERENCES users(id) ON DELETE SET NULL,
    FOREIGN KEY (last_edited_by) REFERENCES users(id) ON DELETE SET NULL,
    FOREIGN KEY (locked_by) REFERENCES users(id) ON DELETE SET NULL
);

-- Á¥¢Âºï
CREATE INDEX idx_bid_documents_project_id ON bid_documents(project_id) WHERE deleted_at IS NULL;
CREATE INDEX idx_bid_documents_template_id ON bid_documents(template_id) WHERE deleted_at IS NULL;
CREATE INDEX idx_bid_documents_status ON bid_documents(status) WHERE deleted_at IS NULL;
CREATE INDEX idx_bid_documents_created_by ON bid_documents(created_by);
CREATE INDEX idx_bid_documents_locked_by ON bid_documents(locked_by) WHERE locked_by IS NOT NULL;
CREATE INDEX idx_bid_documents_updated_at ON bid_documents(updated_at DESC);

-- ÂÖ®ÊñáÊêúÁ¥¢Á¥¢Âºï
CREATE INDEX idx_bid_documents_plain_content_fts ON bid_documents USING gin(to_tsvector('chinese', plain_content));

-- Ê≥®Èáä
COMMENT ON TABLE bid_documents IS 'Ê†á‰π¶ÊñáÊ°£Ë°®';
COMMENT ON COLUMN bid_documents.content IS 'ÁªìÊûÑÂåñÂÜÖÂÆπ(JSON)';
COMMENT ON COLUMN bid_documents.plain_content IS 'Á∫ØÊñáÊú¨ÂÜÖÂÆπ(Áî®‰∫éÊêúÁ¥¢)';
COMMENT ON COLUMN bid_documents.toc IS 'ÁõÆÂΩïÁªìÊûÑ(JSON)';
```

### 12. document_sections (ÊñáÊ°£Á´†ËäÇË°®)

```sql
CREATE TABLE document_sections (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    document_id UUID NOT NULL,
    parent_id UUID,
    title VARCHAR(200) NOT NULL,
    section_number VARCHAR(50),
    level INTEGER DEFAULT 1,
    content TEXT,
    content_type VARCHAR(20) DEFAULT 'text' CHECK (content_type IN ('text', 'table', 'image', 'chart', 'list', 'mixed')),
    order_index INTEGER NOT NULL,
    word_count INTEGER DEFAULT 0,
    is_required BOOLEAN DEFAULT FALSE,
    is_generated BOOLEAN DEFAULT FALSE,
    generated_by VARCHAR(50),
    generation_prompt TEXT,
    metadata JSONB DEFAULT '{}'::jsonb,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (document_id) REFERENCES bid_documents(id) ON DELETE CASCADE,
    FOREIGN KEY (parent_id) REFERENCES document_sections(id) ON DELETE CASCADE
);

-- Á¥¢Âºï
CREATE INDEX idx_document_sections_document_id ON document_sections(document_id);
CREATE INDEX idx_document_sections_parent_id ON document_sections(parent_id);
CREATE INDEX idx_document_sections_order_index ON document_sections(document_id, order_index);

-- Ê≥®Èáä
COMMENT ON TABLE document_sections IS 'ÊñáÊ°£Á´†ËäÇË°®';
COMMENT ON COLUMN document_sections.level IS 'Á´†ËäÇÂ±ÇÁ∫ß';
COMMENT ON COLUMN document_sections.is_generated IS 'ÊòØÂê¶AIÁîüÊàê';
```

### 13. document_versions (ÊñáÊ°£ÁâàÊú¨Ë°®)

```sql
CREATE TABLE document_versions (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    document_id UUID NOT NULL,
    version VARCHAR(20) NOT NULL,
    version_number INTEGER NOT NULL,
    title VARCHAR(200) NOT NULL,
    content JSONB NOT NULL,
    plain_content TEXT,
    change_summary TEXT,
    change_type VARCHAR(20) DEFAULT 'minor' CHECK (change_type IN ('major', 'minor', 'patch', 'draft')),
    word_count INTEGER DEFAULT 0,
    created_by UUID NOT NULL,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (document_id) REFERENCES bid_documents(id) ON DELETE CASCADE,
    FOREIGN KEY (created_by) REFERENCES users(id) ON DELETE RESTRICT,
    UNIQUE (document_id, version_number)
);

-- Á¥¢Âºï
CREATE INDEX idx_document_versions_document_id ON document_versions(document_id);
CREATE INDEX idx_document_versions_version_number ON document_versions(document_id, version_number DESC);
CREATE INDEX idx_document_versions_created_at ON document_versions(created_at DESC);

-- Ê≥®Èáä
COMMENT ON TABLE document_versions IS 'ÊñáÊ°£ÁâàÊú¨Ë°®';
COMMENT ON COLUMN document_versions.version_number IS 'ÁâàÊú¨Âè∑(ÈÄíÂ¢û)';
COMMENT ON COLUMN document_versions.change_type IS 'ÂèòÊõ¥Á±ªÂûã';
```

### 14. document_comments (ÊñáÊ°£ËØÑËÆ∫Ë°®)

```sql
CREATE TABLE document_comments (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    document_id UUID NOT NULL,
    section_id UUID,
    parent_id UUID,
    content TEXT NOT NULL,
    comment_type VARCHAR(20) DEFAULT 'comment' CHECK (comment_type IN ('comment', 'suggestion', 'issue', 'approval')),
    status VARCHAR(20) DEFAULT 'open' CHECK (status IN ('open', 'resolved', 'archived')),
    selection_start INTEGER,
    selection_end INTEGER,
    position_data JSONB,
    is_resolved BOOLEAN DEFAULT FALSE,
    resolved_by UUID,
    resolved_at TIMESTAMP WITH TIME ZONE,
    created_by UUID NOT NULL,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    deleted_at TIMESTAMP WITH TIME ZONE,
    FOREIGN KEY (document_id) REFERENCES bid_documents(id) ON DELETE CASCADE,
    FOREIGN KEY (section_id) REFERENCES document_sections(id) ON DELETE CASCADE,
    FOREIGN KEY (parent_id) REFERENCES document_comments(id) ON DELETE CASCADE,
    FOREIGN KEY (created_by) REFERENCES users(id) ON DELETE RESTRICT,
    FOREIGN KEY (resolved_by) REFERENCES users(id) ON DELETE SET NULL
);

-- Á¥¢Âºï
CREATE INDEX idx_document_comments_document_id ON document_comments(document_id) WHERE deleted_at IS NULL;
CREATE INDEX idx_document_comments_section_id ON document_comments(section_id) WHERE deleted_at IS NULL;
CREATE INDEX idx_document_comments_parent_id ON document_comments(parent_id) WHERE deleted_at IS NULL;
CREATE INDEX idx_document_comments_status ON document_comments(status) WHERE deleted_at IS NULL;
CREATE INDEX idx_document_comments_created_at ON document_comments(created_at DESC);

-- Ê≥®Èáä
COMMENT ON TABLE document_comments IS 'ÊñáÊ°£ËØÑËÆ∫Ë°®';
COMMENT ON COLUMN document_comments.comment_type IS 'ËØÑËÆ∫Á±ªÂûã';
COMMENT ON COLUMN document_comments.position_data IS '‰ΩçÁΩÆÊï∞ÊçÆ(JSON)';
```

## üìã Ê®°ÊùøÂüü

### 15. templates (Ê®°ÊùøË°®)

```sql
CREATE TABLE templates (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    name VARCHAR(200) NOT NULL,
    code VARCHAR(50) UNIQUE NOT NULL,
    description TEXT,
    category VARCHAR(100),
    industry VARCHAR(100),
    template_type VARCHAR(50) DEFAULT 'standard' CHECK (template_type IN ('standard', 'industry', 'custom')),
    scope VARCHAR(20) DEFAULT 'public' CHECK (scope IN ('public', 'organization', 'private')),
    organization_id UUID,
    version VARCHAR(20) DEFAULT '1.0',
    language VARCHAR(10) DEFAULT 'zh-CN',
    content JSONB NOT NULL,
    structure JSONB,
    variables JSONB DEFAULT '[]'::jsonb,
    placeholders JSONB DEFAULT '[]'::jsonb,
    tags TEXT[] DEFAULT ARRAY[]::TEXT[],
    is_active BOOLEAN DEFAULT TRUE,
    usage_count INTEGER DEFAULT 0,
    rating DECIMAL(3, 2) DEFAULT 0,
    rating_count INTEGER DEFAULT 0,
    thumbnail_url TEXT,
    preview_url TEXT,
    metadata JSONB DEFAULT '{}'::jsonb,
    created_by UUID NOT NULL,
    updated_by UUID,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    deleted_at TIMESTAMP WITH TIME ZONE,
    FOREIGN KEY (organization_id) REFERENCES organizations(id) ON DELETE CASCADE,
    FOREIGN KEY (created_by) REFERENCES users(id) ON DELETE RESTRICT,
    FOREIGN KEY (updated_by) REFERENCES users(id) ON DELETE SET NULL
);

-- Á¥¢Âºï
CREATE INDEX idx_templates_code ON templates(code) WHERE deleted_at IS NULL;
CREATE INDEX idx_templates_category ON templates(category) WHERE deleted_at IS NULL;
CREATE INDEX idx_templates_industry ON templates(industry) WHERE deleted_at IS NULL;
CREATE INDEX idx_templates_scope ON templates(scope) WHERE deleted_at IS NULL;
CREATE INDEX idx_templates_organization_id ON templates(organization_id) WHERE deleted_at IS NULL;
CREATE INDEX idx_templates_tags ON templates USING gin(tags);
CREATE INDEX idx_templates_rating ON templates(rating DESC) WHERE is_active = TRUE;
CREATE INDEX idx_templates_usage_count ON templates(usage_count DESC);

-- Ê≥®Èáä
COMMENT ON TABLE templates IS 'Ê®°ÊùøË°®';
COMMENT ON COLUMN templates.scope IS '‰ΩúÁî®Âüü: public-ÂÖ¨ÂºÄ, organization-ÁªÑÁªá, private-ÁßÅÊúâ';
COMMENT ON COLUMN templates.variables IS 'Ê®°ÊùøÂèòÈáèÂÆö‰πâ(JSON)';
COMMENT ON COLUMN templates.placeholders IS 'Âç†‰ΩçÁ¨¶ÂÆö‰πâ(JSON)';
```

### 16. template_sections (Ê®°ÊùøÁ´†ËäÇË°®)

```sql
CREATE TABLE template_sections (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    template_id UUID NOT NULL,
    parent_id UUID,
    title VARCHAR(200) NOT NULL,
    section_number VARCHAR(50),
    level INTEGER DEFAULT 1,
    content_template TEXT,
    content_type VARCHAR(20) DEFAULT 'text',
    order_index INTEGER NOT NULL,
    is_required BOOLEAN DEFAULT FALSE,
    is_editable BOOLEAN DEFAULT TRUE,
    variables TEXT[] DEFAULT ARRAY[]::TEXT[],
    hints TEXT,
    metadata JSONB DEFAULT '{}'::jsonb,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (template_id) REFERENCES templates(id) ON DELETE CASCADE,
    FOREIGN KEY (parent_id) REFERENCES template_sections(id) ON DELETE CASCADE
);

-- Á¥¢Âºï
CREATE INDEX idx_template_sections_template_id ON template_sections(template_id);
CREATE INDEX idx_template_sections_parent_id ON template_sections(parent_id);
CREATE INDEX idx_template_sections_order_index ON template_sections(template_id, order_index);

-- Ê≥®Èáä
COMMENT ON TABLE template_sections IS 'Ê®°ÊùøÁ´†ËäÇË°®';
COMMENT ON COLUMN template_sections.content_template IS 'ÂÜÖÂÆπÊ®°Êùø(ÂåÖÂê´ÂèòÈáèÂç†‰ΩçÁ¨¶)';
COMMENT ON COLUMN template_sections.hints IS 'Â°´ÂÜôÊèêÁ§∫';
```

### 17. template_usage_logs (Ê®°Êùø‰ΩøÁî®Êó•ÂøóË°®)

```sql
CREATE TABLE template_usage_logs (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    template_id UUID NOT NULL,
    document_id UUID,
    project_id UUID,
    user_id UUID NOT NULL,
    organization_id UUID,
    used_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (template_id) REFERENCES templates(id) ON DELETE CASCADE,
    FOREIGN KEY (document_id) REFERENCES bid_documents(id) ON DELETE SET NULL,
    FOREIGN KEY (project_id) REFERENCES projects(id) ON DELETE SET NULL,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (organization_id) REFERENCES organizations(id) ON DELETE CASCADE
);

-- Á¥¢Âºï
CREATE INDEX idx_template_usage_logs_template_id ON template_usage_logs(template_id);
CREATE INDEX idx_template_usage_logs_user_id ON template_usage_logs(user_id);
CREATE INDEX idx_template_usage_logs_used_at ON template_usage_logs(used_at DESC);

-- Ê≥®Èáä
COMMENT ON TABLE template_usage_logs IS 'Ê®°Êùø‰ΩøÁî®Êó•ÂøóË°®';
```

## üè¢ ‰ºÅ‰∏öËÉΩÂäõÂüü

### 18. company_profiles (‰ºÅ‰∏öÊ°£Ê°àË°®)

```sql
CREATE TABLE company_profiles (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    organization_id UUID UNIQUE NOT NULL,
    brief_introduction TEXT,
    core_business TEXT,
    core_competencies TEXT[] DEFAULT ARRAY[]::TEXT[],
    competitive_advantages TEXT[] DEFAULT ARRAY[]::TEXT[],
    key_technologies TEXT[] DEFAULT ARRAY[]::TEXT[],
    major_clients TEXT[] DEFAULT ARRAY[]::TEXT[],
    annual_revenue DECIMAL(15, 2),
    employee_count INTEGER,
    rd_personnel_count INTEGER,
    patents_count INTEGER,
    certifications TEXT[] DEFAULT ARRAY[]::TEXT[],
    honors TEXT[] DEFAULT ARRAY[]::TEXT[],
    metadata JSONB DEFAULT '{}'::jsonb,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (organization_id) REFERENCES organizations(id) ON DELETE CASCADE
);

-- Á¥¢Âºï
CREATE INDEX idx_company_profiles_organization_id ON company_profiles(organization_id);
CREATE INDEX idx_company_profiles_core_competencies ON company_profiles USING gin(core_competencies);
CREATE INDEX idx_company_profiles_key_technologies ON company_profiles USING gin(key_technologies);

-- Ê≥®Èáä
COMMENT ON TABLE company_profiles IS '‰ºÅ‰∏öÊ°£Ê°àË°®';
```

### 19. products_services (‰∫ßÂìÅÊúçÂä°Ë°®)

```sql
CREATE TABLE products_services (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    organization_id UUID NOT NULL,
    name VARCHAR(200) NOT NULL,
    category VARCHAR(100),
    type VARCHAR(20) CHECK (type IN ('product', 'service', 'solution')),
    description TEXT,
    features TEXT[] DEFAULT ARRAY[]::TEXT[],
    specifications JSONB,
    advantages TEXT[] DEFAULT ARRAY[]::TEXT[],
    application_scenarios TEXT[] DEFAULT ARRAY[]::TEXT[],
    technology_stack TEXT[] DEFAULT ARRAY[]::TEXT[],
    price_range VARCHAR(100),
    is_active BOOLEAN DEFAULT TRUE,
    images TEXT[] DEFAULT ARRAY[]::TEXT[],
    documents TEXT[] DEFAULT ARRAY[]::TEXT[],
    tags TEXT[] DEFAULT ARRAY[]::TEXT[],
    metadata JSONB DEFAULT '{}'::jsonb,
    created_by UUID,
    updated_by UUID,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    deleted_at TIMESTAMP WITH TIME ZONE,
    FOREIGN KEY (organization_id) REFERENCES organizations(id) ON DELETE CASCADE,
    FOREIGN KEY (created_by) REFERENCES users(id) ON DELETE SET NULL,
    FOREIGN KEY (updated_by) REFERENCES users(id) ON DELETE SET NULL
);

-- Á¥¢Âºï
CREATE INDEX idx_products_services_organization_id ON products_services(organization_id) WHERE deleted_at IS NULL;
CREATE INDEX idx_products_services_category ON products_services(category) WHERE deleted_at IS NULL;
CREATE INDEX idx_products_services_type ON products_services(type) WHERE deleted_at IS NULL;
CREATE INDEX idx_products_services_tags ON products_services USING gin(tags);

-- Ê≥®Èáä
COMMENT ON TABLE products_services IS '‰∫ßÂìÅÊúçÂä°Ë°®';
```

### 20. project_cases (È°πÁõÆÊ°à‰æãË°®)

```sql
CREATE TABLE project_cases (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    organization_id UUID NOT NULL,
    project_name VARCHAR(200) NOT NULL,
    client_name VARCHAR(200),
    client_industry VARCHAR(100),
    project_category VARCHAR(100),
    project_type VARCHAR(50),
    contract_amount DECIMAL(15, 2),
    start_date DATE,
    end_date DATE,
    duration_months INTEGER,
    project_description TEXT,
    challenges TEXT,
    solutions TEXT,
    achievements TEXT[] DEFAULT ARRAY[]::TEXT[],
    technologies_used TEXT[] DEFAULT ARRAY[]::TEXT[],
    team_size INTEGER,
    project_role VARCHAR(100),
    customer_satisfaction DECIMAL(3, 2),
    is_reference BOOLEAN DEFAULT TRUE,
    is_public BOOLEAN DEFAULT FALSE,
    images TEXT[] DEFAULT ARRAY[]::TEXT[],
    documents TEXT[] DEFAULT ARRAY[]::TEXT[],
    tags TEXT[] DEFAULT ARRAY[]::TEXT[],
    metadata JSONB DEFAULT '{}'::jsonb,
    created_by UUID,
    updated_by UUID,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    deleted_at TIMESTAMP WITH TIME ZONE,
    FOREIGN KEY (organization_id) REFERENCES organizations(id) ON DELETE CASCADE,
    FOREIGN KEY (created_by) REFERENCES users(id) ON DELETE SET NULL,
    FOREIGN KEY (updated_by) REFERENCES users(id) ON DELETE SET NULL
);

-- Á¥¢Âºï
CREATE INDEX idx_project_cases_organization_id ON project_cases(organization_id) WHERE deleted_at IS NULL;
CREATE INDEX idx_project_cases_client_industry ON project_cases(client_industry) WHERE deleted_at IS NULL;
CREATE INDEX idx_project_cases_project_category ON project_cases(project_category) WHERE deleted_at IS NULL;
CREATE INDEX idx_project_cases_tags ON project_cases USING gin(tags);
CREATE INDEX idx_project_cases_technologies_used ON project_cases USING gin(technologies_used);
CREATE INDEX idx_project_cases_end_date ON project_cases(end_date DESC);

-- Ê≥®Èáä
COMMENT ON TABLE project_cases IS 'È°πÁõÆÊ°à‰æãË°®';
COMMENT ON COLUMN project_cases.is_reference IS 'ÊòØÂê¶ÂèØ‰Ωú‰∏∫ÂèÇËÄÉÊ°à‰æã';
COMMENT ON COLUMN project_cases.customer_satisfaction IS 'ÂÆ¢Êà∑Êª°ÊÑèÂ∫¶(0-5)';
```

### 21. personnel (‰∫∫ÂëòËµÑË¥®Ë°®)

```sql
CREATE TABLE personnel (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    organization_id UUID NOT NULL,
    name VARCHAR(100) NOT NULL,
    employee_id VARCHAR(50),
    position VARCHAR(100),
    department VARCHAR(100),
    education VARCHAR(50),
    major VARCHAR(100),
    years_of_experience INTEGER,
    specialties TEXT[] DEFAULT ARRAY[]::TEXT[],
    certifications TEXT[] DEFAULT ARRAY[]::TEXT[],
    project_experience_count INTEGER DEFAULT 0,
    skills JSONB DEFAULT '[]'::jsonb,
    is_available BOOLEAN DEFAULT TRUE,
    resume_url TEXT,
    metadata JSONB DEFAULT '{}'::jsonb,
    created_by UUID,
    updated_by UUID,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    deleted_at TIMESTAMP WITH TIME ZONE,
    FOREIGN KEY (organization_id) REFERENCES organizations(id) ON DELETE CASCADE,
    FOREIGN KEY (created_by) REFERENCES users(id) ON DELETE SET NULL,
    FOREIGN KEY (updated_by) REFERENCES users(id) ON DELETE SET NULL
);

-- Á¥¢Âºï
CREATE INDEX idx_personnel_organization_id ON personnel(organization_id) WHERE deleted_at IS NULL;
CREATE INDEX idx_personnel_position ON personnel(position) WHERE deleted_at IS NULL;
CREATE INDEX idx_personnel_specialties ON personnel USING gin(specialties);

-- Ê≥®Èáä
COMMENT ON TABLE personnel IS '‰∫∫ÂëòËµÑË¥®Ë°®';
COMMENT ON COLUMN personnel.skills IS 'ÊäÄËÉΩÂàóË°®(JSON)';
```

### 22. certifications (ËµÑË¥®ËØÅ‰π¶Ë°®)

```sql
CREATE TABLE certifications (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    organization_id UUID NOT NULL,
    certification_name VARCHAR(200) NOT NULL,
    certification_type VARCHAR(100),
    issuing_authority VARCHAR(200),
    certificate_number VARCHAR(100),
    issue_date DATE,
    expiry_date DATE,
    is_valid BOOLEAN DEFAULT TRUE,
    scope TEXT,
    level VARCHAR(50),
    certificate_url TEXT,
    metadata JSONB DEFAULT '{}'::jsonb,
    created_by UUID,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    deleted_at TIMESTAMP WITH TIME ZONE,
    FOREIGN KEY (organization_id) REFERENCES organizations(id) ON DELETE CASCADE,
    FOREIGN KEY (created_by) REFERENCES users(id) ON DELETE SET NULL
);

-- Á¥¢Âºï
CREATE INDEX idx_certifications_organization_id ON certifications(organization_id) WHERE deleted_at IS NULL;
CREATE INDEX idx_certifications_type ON certifications(certification_type) WHERE deleted_at IS NULL;
CREATE INDEX idx_certifications_expiry_date ON certifications(expiry_date) WHERE deleted_at IS NULL;

-- Ê≥®Èáä
COMMENT ON TABLE certifications IS 'ËµÑË¥®ËØÅ‰π¶Ë°®';
```

### 23. historical_bids (ÂéÜÂè≤Ê†á‰π¶Ë°®)

```sql
CREATE TABLE historical_bids (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    organization_id UUID NOT NULL,
    project_name VARCHAR(200) NOT NULL,
    client_name VARCHAR(200),
    bidding_date DATE,
    submission_date DATE,
    result VARCHAR(20) CHECK (result IN ('won', 'lost', 'pending', 'withdrawn')),
    contract_amount DECIMAL(15, 2),
    bid_amount DECIMAL(15, 2),
    win_rate DECIMAL(5, 2),
    industry VARCHAR(100),
    category VARCHAR(100),
    key_points TEXT[] DEFAULT ARRAY[]::TEXT[],
    success_factors TEXT,
    lessons_learned TEXT,
    document_id UUID,
    is_reusable BOOLEAN DEFAULT TRUE,
    tags TEXT[] DEFAULT ARRAY[]::TEXT[],
    metadata JSONB DEFAULT '{}'::jsonb,
    created_by UUID,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    deleted_at TIMESTAMP WITH TIME ZONE,
    FOREIGN KEY (organization_id) REFERENCES organizations(id) ON DELETE CASCADE,
    FOREIGN KEY (document_id) REFERENCES bid_documents(id) ON DELETE SET NULL,
    FOREIGN KEY (created_by) REFERENCES users(id) ON DELETE SET NULL
);

-- Á¥¢Âºï
CREATE INDEX idx_historical_bids_organization_id ON historical_bids(organization_id) WHERE deleted_at IS NULL;
CREATE INDEX idx_historical_bids_result ON historical_bids(result) WHERE deleted_at IS NULL;
CREATE INDEX idx_historical_bids_industry ON historical_bids(industry) WHERE deleted_at IS NULL;
CREATE INDEX idx_historical_bids_bidding_date ON historical_bids(bidding_date DESC);
CREATE INDEX idx_historical_bids_tags ON historical_bids USING gin(tags);

-- Ê≥®Èáä
COMMENT ON TABLE historical_bids IS 'ÂéÜÂè≤Ê†á‰π¶Ë°®';
COMMENT ON COLUMN historical_bids.win_rate IS '‰∏≠Ê†áÁéá(%)';
```

## ü§ñ AIÊúçÂä°Âüü

### 24. ai_tasks (AI‰ªªÂä°Ë°®)

```sql
CREATE TABLE ai_tasks (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    task_type VARCHAR(50) NOT NULL CHECK (task_type IN ('parse', 'analyze', 'match', 'generate', 'review', 'other')),
    task_name VARCHAR(200) NOT NULL,
    description TEXT,
    project_id UUID,
    document_id UUID,
    status VARCHAR(20) DEFAULT 'pending' CHECK (status IN ('pending', 'running', 'success', 'failed', 'cancelled')),
    priority INTEGER DEFAULT 0,
    input_data JSONB,
    output_data JSONB,
    error_message TEXT,
    model_name VARCHAR(100),
    model_version VARCHAR(50),
    prompt_template TEXT,
    prompt_tokens INTEGER,
    completion_tokens INTEGER,
    total_tokens INTEGER,
    cost DECIMAL(10, 4),
    started_at TIMESTAMP WITH TIME ZONE,
    completed_at TIMESTAMP WITH TIME ZONE,
    duration_seconds INTEGER,
    retry_count INTEGER DEFAULT 0,
    max_retries INTEGER DEFAULT 3,
    metadata JSONB DEFAULT '{}'::jsonb,
    created_by UUID NOT NULL,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (project_id) REFERENCES projects(id) ON DELETE CASCADE,
    FOREIGN KEY (document_id) REFERENCES bid_documents(id) ON DELETE CASCADE,
    FOREIGN KEY (created_by) REFERENCES users(id) ON DELETE RESTRICT
);

-- Á¥¢Âºï
CREATE INDEX idx_ai_tasks_task_type ON ai_tasks(task_type);
CREATE INDEX idx_ai_tasks_status ON ai_tasks(status);
CREATE INDEX idx_ai_tasks_project_id ON ai_tasks(project_id);
CREATE INDEX idx_ai_tasks_document_id ON ai_tasks(document_id);
CREATE INDEX idx_ai_tasks_created_by ON ai_tasks(created_by);
CREATE INDEX idx_ai_tasks_created_at ON ai_tasks(created_at DESC);

-- Ê≥®Èáä
COMMENT ON TABLE ai_tasks IS 'AI‰ªªÂä°Ë°®';
COMMENT ON COLUMN ai_tasks.task_type IS '‰ªªÂä°Á±ªÂûã: parse-Ëß£Êûê, analyze-ÂàÜÊûê, match-ÂåπÈÖç, generate-ÁîüÊàê, review-ÂÆ°Ê†∏';
```

### 25. ai_prompts (PromptÊ®°ÊùøË°®)

```sql
CREATE TABLE ai_prompts (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    name VARCHAR(200) NOT NULL,
    code VARCHAR(50) UNIQUE NOT NULL,
    category VARCHAR(100),
    description TEXT,
    prompt_template TEXT NOT NULL,
    system_prompt TEXT,
    variables JSONB DEFAULT '[]'::jsonb,
    model_name VARCHAR(100),
    model_params JSONB DEFAULT '{}'::jsonb,
    is_active BOOLEAN DEFAULT TRUE,
    version VARCHAR(20) DEFAULT '1.0',
    usage_count INTEGER DEFAULT 0,
    average_tokens INTEGER,
    average_cost DECIMAL(10, 4),
    tags TEXT[] DEFAULT ARRAY[]::TEXT[],
    metadata JSONB DEFAULT '{}'::jsonb,
    created_by UUID,
    updated_by UUID,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    deleted_at TIMESTAMP WITH TIME ZONE,
    FOREIGN KEY (created_by) REFERENCES users(id) ON DELETE SET NULL,
    FOREIGN KEY (updated_by) REFERENCES users(id) ON DELETE SET NULL
);

-- Á¥¢Âºï
CREATE INDEX idx_ai_prompts_code ON ai_prompts(code) WHERE deleted_at IS NULL;
CREATE INDEX idx_ai_prompts_category ON ai_prompts(category) WHERE deleted_at IS NULL;
CREATE INDEX idx_ai_prompts_is_active ON ai_prompts(is_active);
CREATE INDEX idx_ai_prompts_tags ON ai_prompts USING gin(tags);

-- Ê≥®Èáä
COMMENT ON TABLE ai_prompts IS 'AI PromptÊ®°ÊùøË°®';
COMMENT ON COLUMN ai_prompts.variables IS 'ÂèòÈáèÂàóË°®(JSON)';
COMMENT ON COLUMN ai_prompts.model_params IS 'Ê®°ÂûãÂèÇÊï∞(temperature, max_tokensÁ≠â)';
```

### 26. ai_usage_logs (AI‰ΩøÁî®Êó•ÂøóË°®)

```sql
CREATE TABLE ai_usage_logs (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    user_id UUID NOT NULL,
    organization_id UUID,
    task_id UUID,
    model_name VARCHAR(100) NOT NULL,
    operation_type VARCHAR(50),
    prompt_tokens INTEGER,
    completion_tokens INTEGER,
    total_tokens INTEGER,
    cost DECIMAL(10, 4),
    latency_ms INTEGER,
    status VARCHAR(20),
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (organization_id) REFERENCES organizations(id) ON DELETE CASCADE,
    FOREIGN KEY (task_id) REFERENCES ai_tasks(id) ON DELETE SET NULL
);

-- Á¥¢Âºï
CREATE INDEX idx_ai_usage_logs_user_id ON ai_usage_logs(user_id);
CREATE INDEX idx_ai_usage_logs_organization_id ON ai_usage_logs(organization_id);
CREATE INDEX idx_ai_usage_logs_created_at ON ai_usage_logs(created_at DESC);

-- ËΩ¨Êç¢‰∏∫Êó∂Â∫èË°® (‰ΩøÁî®TimescaleDB)
SELECT create_hypertable('ai_usage_logs', 'created_at', if_not_exists => TRUE);

-- Ê≥®Èáä
COMMENT ON TABLE ai_usage_logs IS 'AI‰ΩøÁî®Êó•ÂøóË°®(Êó∂Â∫èÊï∞ÊçÆ)';
```

## üë• Âçè‰ΩúÂüü

### 27. collaboration_sessions (Âçè‰Ωú‰ºöËØùË°®)

```sql
CREATE TABLE collaboration_sessions (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    document_id UUID NOT NULL,
    session_key VARCHAR(100) UNIQUE NOT NULL,
    active_users JSONB DEFAULT '[]'::jsonb,
    cursor_positions JSONB DEFAULT '{}'::jsonb,
    selections JSONB DEFAULT '{}'::jsonb,
    awareness_state JSONB DEFAULT '{}'::jsonb,
    is_active BOOLEAN DEFAULT TRUE,
    started_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    ended_at TIMESTAMP WITH TIME ZONE,
    last_activity_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (document_id) REFERENCES bid_documents(id) ON DELETE CASCADE
);

-- Á¥¢Âºï
CREATE INDEX idx_collaboration_sessions_document_id ON collaboration_sessions(document_id);
CREATE INDEX idx_collaboration_sessions_is_active ON collaboration_sessions(is_active);
CREATE INDEX idx_collaboration_sessions_last_activity_at ON collaboration_sessions(last_activity_at DESC);

-- Ê≥®Èáä
COMMENT ON TABLE collaboration_sessions IS 'Âçè‰Ωú‰ºöËØùË°®';
COMMENT ON COLUMN collaboration_sessions.awareness_state IS 'Áî®Êà∑ÊÑüÁü•Áä∂ÊÄÅ(Yjs Awareness)';
```

### 28. collaboration_events (Âçè‰Ωú‰∫ã‰ª∂Ë°®)

```sql
CREATE TABLE collaboration_events (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    session_id UUID NOT NULL,
    document_id UUID NOT NULL,
    user_id UUID NOT NULL,
    event_type VARCHAR(50) NOT NULL CHECK (event_type IN ('join', 'leave', 'edit', 'comment', 'cursor_move', 'selection', 'other')),
    event_data JSONB,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (session_id) REFERENCES collaboration_sessions(id) ON DELETE CASCADE,
    FOREIGN KEY (document_id) REFERENCES bid_documents(id) ON DELETE CASCADE,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);

-- Á¥¢Âºï
CREATE INDEX idx_collaboration_events_session_id ON collaboration_events(session_id);
CREATE INDEX idx_collaboration_events_document_id ON collaboration_events(document_id);
CREATE INDEX idx_collaboration_events_user_id ON collaboration_events(user_id);
CREATE INDEX idx_collaboration_events_created_at ON collaboration_events(created_at DESC);

-- ËΩ¨Êç¢‰∏∫Êó∂Â∫èË°®
SELECT create_hypertable('collaboration_events', 'created_at', if_not_exists => TRUE);

-- Ê≥®Èáä
COMMENT ON TABLE collaboration_events IS 'Âçè‰Ωú‰∫ã‰ª∂Ë°®(Êó∂Â∫èÊï∞ÊçÆ)';
```

## ‚úÖ ÂÆ°ÊâπÂüü

### 29. approval_workflows (ÂÆ°ÊâπÊµÅÁ®ãË°®)

```sql
CREATE TABLE approval_workflows (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    name VARCHAR(200) NOT NULL,
    code VARCHAR(50) UNIQUE NOT NULL,
    description TEXT,
    workflow_type VARCHAR(50) DEFAULT 'sequential' CHECK (workflow_type IN ('sequential', 'parallel', 'conditional', 'custom')),
    organization_id UUID,
    document_type VARCHAR(50),
    definition JSONB NOT NULL,
    is_active BOOLEAN DEFAULT TRUE,
    is_default BOOLEAN DEFAULT FALSE,
    metadata JSONB DEFAULT '{}'::jsonb,
    created_by UUID,
    updated_by UUID,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    deleted_at TIMESTAMP WITH TIME ZONE,
    FOREIGN KEY (organization_id) REFERENCES organizations(id) ON DELETE CASCADE,
    FOREIGN KEY (created_by) REFERENCES users(id) ON DELETE SET NULL,
    FOREIGN KEY (updated_by) REFERENCES users(id) ON DELETE SET NULL
);

-- Á¥¢Âºï
CREATE INDEX idx_approval_workflows_code ON approval_workflows(code) WHERE deleted_at IS NULL;
CREATE INDEX idx_approval_workflows_organization_id ON approval_workflows(organization_id) WHERE deleted_at IS NULL;
CREATE INDEX idx_approval_workflows_is_active ON approval_workflows(is_active);

-- Ê≥®Èáä
COMMENT ON TABLE approval_workflows IS 'ÂÆ°ÊâπÊµÅÁ®ãË°®';
COMMENT ON COLUMN approval_workflows.definition IS 'ÊµÅÁ®ãÂÆö‰πâ(JSON)';
```

### 30. approval_tasks (ÂÆ°Êâπ‰ªªÂä°Ë°®)

```sql
CREATE TABLE approval_tasks (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    workflow_id UUID NOT NULL,
    document_id UUID NOT NULL,
    task_name VARCHAR(200) NOT NULL,
    step_number INTEGER NOT NULL,
    assignee_id UUID NOT NULL,
    assignee_type VARCHAR(20) DEFAULT 'user' CHECK (assignee_type IN ('user', 'role')),
    status VARCHAR(20) DEFAULT 'pending' CHECK (status IN ('pending', 'approved', 'rejected', 'cancelled')),
    decision VARCHAR(20),
    comments TEXT,
    deadline TIMESTAMP WITH TIME ZONE,
    completed_at TIMESTAMP WITH TIME ZONE,
    metadata JSONB DEFAULT '{}'::jsonb,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (workflow_id) REFERENCES approval_workflows(id) ON DELETE CASCADE,
    FOREIGN KEY (document_id) REFERENCES bid_documents(id) ON DELETE CASCADE,
    FOREIGN KEY (assignee_id) REFERENCES users(id) ON DELETE CASCADE
);

-- Á¥¢Âºï
CREATE INDEX idx_approval_tasks_workflow_id ON approval_tasks(workflow_id);
CREATE INDEX idx_approval_tasks_document_id ON approval_tasks(document_id);
CREATE INDEX idx_approval_tasks_assignee_id ON approval_tasks(assignee_id);
CREATE INDEX idx_approval_tasks_status ON approval_tasks(status);
CREATE INDEX idx_approval_tasks_deadline ON approval_tasks(deadline) WHERE status = 'pending';

-- Ê≥®Èáä
COMMENT ON TABLE approval_tasks IS 'ÂÆ°Êâπ‰ªªÂä°Ë°®';
```

### 31. approval_logs (ÂÆ°ÊâπÊó•ÂøóË°®)

```sql
CREATE TABLE approval_logs (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    task_id UUID NOT NULL,
    document_id UUID NOT NULL,
    user_id UUID NOT NULL,
    action VARCHAR(50) NOT NULL CHECK (action IN ('submit', 'approve', 'reject', 'reassign', 'cancel', 'comment')),
    decision VARCHAR(20),
    comments TEXT,
    metadata JSONB DEFAULT '{}'::jsonb,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (task_id) REFERENCES approval_tasks(id) ON DELETE CASCADE,
    FOREIGN KEY (document_id) REFERENCES bid_documents(id) ON DELETE CASCADE,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);

-- Á¥¢Âºï
CREATE INDEX idx_approval_logs_task_id ON approval_logs(task_id);
CREATE INDEX idx_approval_logs_document_id ON approval_logs(document_id);
CREATE INDEX idx_approval_logs_user_id ON approval_logs(user_id);
CREATE INDEX idx_approval_logs_created_at ON approval_logs(created_at DESC);

-- Ê≥®Èáä
COMMENT ON TABLE approval_logs IS 'ÂÆ°ÊâπÊó•ÂøóË°®';
```

## üìä ÂÆ°ËÆ°‰∏éÊó•ÂøóÂüü

### 32. audit_logs (ÂÆ°ËÆ°Êó•ÂøóË°®)

```sql
CREATE TABLE audit_logs (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    user_id UUID,
    organization_id UUID,
    action VARCHAR(100) NOT NULL,
    resource_type VARCHAR(50) NOT NULL,
    resource_id UUID,
    resource_name VARCHAR(200),
    details JSONB,
    changes JSONB,
    ip_address INET,
    user_agent TEXT,
    status VARCHAR(20),
    error_message TEXT,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE SET NULL,
    FOREIGN KEY (organization_id) REFERENCES organizations(id) ON DELETE SET NULL
);

-- Á¥¢Âºï
CREATE INDEX idx_audit_logs_user_id ON audit_logs(user_id);
CREATE INDEX idx_audit_logs_organization_id ON audit_logs(organization_id);
CREATE INDEX idx_audit_logs_resource_type ON audit_logs(resource_type);
CREATE INDEX idx_audit_logs_resource_id ON audit_logs(resource_id);
CREATE INDEX idx_audit_logs_action ON audit_logs(action);
CREATE INDEX idx_audit_logs_created_at ON audit_logs(created_at DESC);

-- ËΩ¨Êç¢‰∏∫Êó∂Â∫èË°®
SELECT create_hypertable('audit_logs', 'created_at', if_not_exists => TRUE);

-- Ê≥®Èáä
COMMENT ON TABLE audit_logs IS 'ÂÆ°ËÆ°Êó•ÂøóË°®(Êó∂Â∫èÊï∞ÊçÆ)';
COMMENT ON COLUMN audit_logs.changes IS 'ÂèòÊõ¥ÂÜÖÂÆπ(before/after)';
```

### 33. system_logs (Á≥ªÁªüÊó•ÂøóË°®)

```sql
CREATE TABLE system_logs (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    log_level VARCHAR(20) NOT NULL CHECK (log_level IN ('DEBUG', 'INFO', 'WARNING', 'ERROR', 'CRITICAL')),
    service VARCHAR(50),
    module VARCHAR(100),
    message TEXT NOT NULL,
    details JSONB,
    trace_id VARCHAR(100),
    span_id VARCHAR(100),
    user_id UUID,
    ip_address INET,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE SET NULL
);

-- Á¥¢Âºï
CREATE INDEX idx_system_logs_log_level ON system_logs(log_level);
CREATE INDEX idx_system_logs_service ON system_logs(service);
CREATE INDEX idx_system_logs_trace_id ON system_logs(trace_id);
CREATE INDEX idx_system_logs_created_at ON system_logs(created_at DESC);

-- ËΩ¨Êç¢‰∏∫Êó∂Â∫èË°®
SELECT create_hypertable('system_logs', 'created_at', if_not_exists => TRUE);

-- Ê≥®Èáä
COMMENT ON TABLE system_logs IS 'Á≥ªÁªüÊó•ÂøóË°®(Êó∂Â∫èÊï∞ÊçÆ)';
```

## üîÑ Ëß¶ÂèëÂô®ÂíåÂáΩÊï∞

### Êõ¥Êñ∞Êó∂Èó¥Êà≥Ëß¶ÂèëÂô®

```sql
-- ÂàõÂª∫Êõ¥Êñ∞Êó∂Èó¥Êà≥ÂáΩÊï∞
CREATE OR REPLACE FUNCTION update_updated_at_column()
RETURNS TRIGGER AS $$
BEGIN
    NEW.updated_at = CURRENT_TIMESTAMP;
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

-- ‰∏∫ÊâÄÊúâÂåÖÂê´updated_atÂ≠óÊÆµÁöÑË°®Ê∑ªÂä†Ëß¶ÂèëÂô®
DO $$
DECLARE
    t text;
BEGIN
    FOR t IN
        SELECT tablename FROM pg_tables
        WHERE schemaname = 'public'
        AND tablename IN (
            'users', 'organizations', 'roles', 'projects', 'bidding_documents',
            'project_requirements', 'bid_documents', 'document_sections',
            'document_versions', 'document_comments', 'templates',
            'template_sections', 'company_profiles', 'products_services',
            'project_cases', 'personnel', 'certifications', 'historical_bids',
            'ai_tasks', 'ai_prompts', 'collaboration_sessions',
            'approval_workflows', 'approval_tasks'
        )
    LOOP
        EXECUTE format('
            CREATE TRIGGER update_%I_updated_at
            BEFORE UPDATE ON %I
            FOR EACH ROW
            EXECUTE FUNCTION update_updated_at_column();
        ', t, t);
    END LOOP;
END;
$$ LANGUAGE plpgsql;
```

### ËΩØÂà†Èô§Êü•ËØ¢ËßÜÂõæ

```sql
-- ÂàõÂª∫Ê¥ªË∑ÉÁî®Êà∑ËßÜÂõæ
CREATE OR REPLACE VIEW active_users AS
SELECT * FROM users WHERE deleted_at IS NULL;

-- ÂàõÂª∫Ê¥ªË∑ÉÈ°πÁõÆËßÜÂõæ
CREATE OR REPLACE VIEW active_projects AS
SELECT * FROM projects WHERE deleted_at IS NULL;

-- ÂàõÂª∫Ê¥ªË∑ÉÊñáÊ°£ËßÜÂõæ
CREATE OR REPLACE VIEW active_bid_documents AS
SELECT * FROM bid_documents WHERE deleted_at IS NULL;
```

## üìà ÊÄßËÉΩ‰ºòÂåñ

### ÂàÜÂå∫Ë°®ÈÖçÁΩÆ

```sql
-- ‰∏∫Â§ßË°®ÈÖçÁΩÆÂàÜÂå∫ (‰ª•audit_logs‰∏∫‰æã)
-- ÊåâÊúàÂàÜÂå∫
CREATE TABLE audit_logs_partitioned (
    LIKE audit_logs INCLUDING ALL
) PARTITION BY RANGE (created_at);

-- ÂàõÂª∫ÂàÜÂå∫
CREATE TABLE audit_logs_2025_01 PARTITION OF audit_logs_partitioned
    FOR VALUES FROM ('2025-01-01') TO ('2025-02-01');

CREATE TABLE audit_logs_2025_02 PARTITION OF audit_logs_partitioned
    FOR VALUES FROM ('2025-02-01') TO ('2025-03-01');

-- ÁªßÁª≠ÂàõÂª∫ÂÖ∂‰ªñÊúà‰ªΩÂàÜÂå∫...
```

### Áâ©ÂåñËßÜÂõæ

```sql
-- È°πÁõÆÁªüËÆ°Áâ©ÂåñËßÜÂõæ
CREATE MATERIALIZED VIEW project_statistics AS
SELECT
    organization_id,
    COUNT(*) as total_projects,
    COUNT(*) FILTER (WHERE status = 'won') as won_projects,
    COUNT(*) FILTER (WHERE status = 'lost') as lost_projects,
    AVG(budget_amount) as avg_budget,
    AVG(win_probability) as avg_win_probability
FROM projects
WHERE deleted_at IS NULL
GROUP BY organization_id;

CREATE UNIQUE INDEX ON project_statistics (organization_id);

-- Âà∑Êñ∞Áâ©ÂåñËßÜÂõæ(ÂÆöÊúüÊâßË°å)
REFRESH MATERIALIZED VIEW CONCURRENTLY project_statistics;
```

## üîê ÊùÉÈôêÈÖçÁΩÆ

```sql
-- ÂàõÂª∫Â∫îÁî®Áî®Êà∑
CREATE USER aibidcomposer_app WITH PASSWORD 'your_secure_password';

-- Êéà‰∫àÊùÉÈôê
GRANT CONNECT ON DATABASE aibidcomposer TO aibidcomposer_app;
GRANT USAGE ON SCHEMA public TO aibidcomposer_app;
GRANT SELECT, INSERT, UPDATE, DELETE ON ALL TABLES IN SCHEMA public TO aibidcomposer_app;
GRANT USAGE, SELECT ON ALL SEQUENCES IN SCHEMA public TO aibidcomposer_app;

-- ÈªòËÆ§ÊùÉÈôê(Êñ∞Âª∫Ë°®‰πüËá™Âä®ÊéàÊùÉ)
ALTER DEFAULT PRIVILEGES IN SCHEMA public
GRANT SELECT, INSERT, UPDATE, DELETE ON TABLES TO aibidcomposer_app;

ALTER DEFAULT PRIVILEGES IN SCHEMA public
GRANT USAGE, SELECT ON SEQUENCES TO aibidcomposer_app;
```

## üìù ÂàùÂßãÊï∞ÊçÆ

### ÂàùÂßãÊùÉÈôêÊï∞ÊçÆ

```sql
-- ÊèíÂÖ•Á≥ªÁªüÊùÉÈôê
INSERT INTO permissions (name, code, resource, action, category, is_system) VALUES
('Áî®Êà∑ÁÆ°ÁêÜ-Êü•Áúã', 'user:read', 'user', 'read', 'Áî®Êà∑ÁÆ°ÁêÜ', TRUE),
('Áî®Êà∑ÁÆ°ÁêÜ-ÂàõÂª∫', 'user:create', 'user', 'create', 'Áî®Êà∑ÁÆ°ÁêÜ', TRUE),
('Áî®Êà∑ÁÆ°ÁêÜ-ÁºñËæë', 'user:update', 'user', 'update', 'Áî®Êà∑ÁÆ°ÁêÜ', TRUE),
('Áî®Êà∑ÁÆ°ÁêÜ-Âà†Èô§', 'user:delete', 'user', 'delete', 'Áî®Êà∑ÁÆ°ÁêÜ', TRUE),
('È°πÁõÆÁÆ°ÁêÜ-Êü•Áúã', 'project:read', 'project', 'read', 'È°πÁõÆÁÆ°ÁêÜ', TRUE),
('È°πÁõÆÁÆ°ÁêÜ-ÂàõÂª∫', 'project:create', 'project', 'create', 'È°πÁõÆÁÆ°ÁêÜ', TRUE),
('È°πÁõÆÁÆ°ÁêÜ-ÁºñËæë', 'project:update', 'project', 'update', 'È°πÁõÆÁÆ°ÁêÜ', TRUE),
('È°πÁõÆÁÆ°ÁêÜ-Âà†Èô§', 'project:delete', 'project', 'delete', 'È°πÁõÆÁÆ°ÁêÜ', TRUE),
('ÊñáÊ°£ÁÆ°ÁêÜ-Êü•Áúã', 'document:read', 'document', 'read', 'ÊñáÊ°£ÁÆ°ÁêÜ', TRUE),
('ÊñáÊ°£ÁÆ°ÁêÜ-ÂàõÂª∫', 'document:create', 'document', 'create', 'ÊñáÊ°£ÁÆ°ÁêÜ', TRUE),
('ÊñáÊ°£ÁÆ°ÁêÜ-ÁºñËæë', 'document:update', 'document', 'update', 'ÊñáÊ°£ÁÆ°ÁêÜ', TRUE),
('ÊñáÊ°£ÁÆ°ÁêÜ-Âà†Èô§', 'document:delete', 'document', 'delete', 'ÊñáÊ°£ÁÆ°ÁêÜ', TRUE);

-- ÊèíÂÖ•Á≥ªÁªüËßíËâ≤
INSERT INTO roles (name, code, description, is_system, level, permissions) VALUES
('Ë∂ÖÁ∫ßÁÆ°ÁêÜÂëò', 'super_admin', 'Á≥ªÁªüË∂ÖÁ∫ßÁÆ°ÁêÜÂëòÔºåÊã•ÊúâÊâÄÊúâÊùÉÈôê', TRUE, 100, ARRAY['*']),
('ÁÆ°ÁêÜÂëò', 'admin', 'ÁªÑÁªáÁÆ°ÁêÜÂëò', TRUE, 80, ARRAY['user:*', 'project:*', 'document:*']),
('È°πÁõÆÁªèÁêÜ', 'project_manager', 'È°πÁõÆÁªèÁêÜ', TRUE, 60, ARRAY['project:*', 'document:*']),
('ÊôÆÈÄöÊàêÂëò', 'member', 'ÊôÆÈÄöÊàêÂëò', TRUE, 40, ARRAY['project:read', 'document:read', 'document:create', 'document:update']),
('ËÆøÂÆ¢', 'guest', 'ËÆøÂÆ¢', TRUE, 20, ARRAY['project:read', 'document:read']);
```

---

**ÊñáÊ°£ÁâàÊú¨**: v1.0
**ÂàõÂª∫Êó∂Èó¥**: 2025Âπ¥11Êúà14Êó•
**Êï∞ÊçÆÂ∫ìÁâàÊú¨**: PostgreSQL 14+
**ÊÄªË°®Êï∞**: 33Âº†Ë°®
**ÊÄªÁ¥¢ÂºïÊï∞**: 150+ ‰∏™Á¥¢Âºï
