---
doc_type: Design
req_id: ARCH-2025-11-003-01
created_at: 2025-11-30 00:25
author: gemini-pro
updated_at: 2025-11-30 00:25
updater: gemini-pro
status: Draft
---

# 01-关系型数据库设计

## 1. 概述

本文档详细描述AI标书智能创作平台的核心业务数据在PostgreSQL关系型数据库中的设计，包括主要数据表、字段定义、主外键关系、索引策略等。

## 2. 设计原则

*   **规范化**: 遵循第三范式，减少数据冗余，保证数据一致性。
*   **性能**: 合理设计索引，优化查询效率。
*   **可扩展性**: 预留扩展字段，支持未来业务变化。
*   **安全性**: 敏感数据（如密码哈希）加密存储，实施访问控制。
*   **审计**: 记录关键操作日志，支持数据追溯。

## 3. 核心数据表设计

### 3.1 用户与权限域

*   **用户表 (users)**
    *   **职责**: 存储用户基本信息和认证凭据。
    *   **字段**: `id`, `username`, `email`, `password_hash`, `company_id`, `role`, `status`, `created_at`, `updated_at`。
*   **组织表 (organizations)**
    *   **职责**: 存储企业/组织的基本信息。
    *   **字段**: `id`, `name`, `contact_person`, `contact_email`, `status`, `created_at`, `updated_at`。
*   **角色表 (roles)**
    *   **职责**: 定义系统中的角色，用于权限管理。
    *   **字段**: `id`, `name`, `description`, `created_at`, `updated_at`。
*   **权限表 (permissions)**
    *   **职责**: 定义系统中的具体权限点。
    *   **字段**: `id`, `name`, `description`, `created_at`, `updated_at`。
*   **用户角色映射表 (user_role_mapping)**
    *   **职责**: 关联用户和角色，实现多对多关系。
    *   **字段**: `user_id`, `role_id`, `created_at`。
*   **角色权限映射表 (role_permission_mapping)**
    *   **职责**: 关联角色和权限，定义角色所拥有的权限。
    *   **字段**: `role_id`, `permission_id`, `created_at`。

### 3.2 项目管理域

*   **项目表 (projects)**
    *   **职责**: 存储投标项目核心信息。
    *   **字段**: `id`, `name`, `description`, `tender_document_url`, `status`, `deadline`, `budget`, `created_by`, `company_id`, `created_at`, `updated_at`。
*   **项目成员表 (project_members)**
    *   **职责**: 关联项目和用户，定义项目成员及其角色。
    *   **字段**: `project_id`, `user_id`, `role_in_project`, `created_at`。

### 3.3 标书文档域

*   **标书文档表 (bid_documents)**
    *   **职责**: 存储标书文档的元数据和核心内容。
    *   **字段**: `id`, `project_id`, `template_id`, `title`, `content_jsonb`, `status`, `quality_score`, `ai_generated`, `created_by`, `created_at`, `updated_at`。
*   **文档章节表 (document_sections)**
    *   **职责**: 存储标书文档的章节结构和内容片段。
    *   **字段**: `id`, `document_id`, `parent_id`, `title`, `order`, `content_jsonb`, `created_at`, `updated_at`。
*   **文档版本表 (document_versions)**
    *   **职责**: 存储文档的历史版本，支持回溯。
    *   **字段**: `id`, `document_id`, `version_number`, `snapshot_content_jsonb`, `created_by`, `created_at`。
*   **文档评论表 (document_comments)**
    *   **职责**: 存储文档内的评论，用于协作。
    *   **字段**: `id`, `document_id`, `section_id`, `user_id`, `comment_text`, `status`, `created_at`, `updated_at`。

### 3.4 模板管理域

*   **模板表 (templates)**
    *   **职责**: 存储标书模板信息。
    *   **字段**: `id`, `name`, `description`, `category`, `industry`, `content_jsonb`, `variables_jsonb`, `is_public`, `created_by`, `company_id`, `version`, `created_at`, `updated_at`。

### 3.5 AI服务域

*   **AI任务表 (ai_tasks)**
    *   **职责**: 记录AI服务的调用任务和状态。
    *   **字段**: `id`, `task_type`, `status`, `input_data_jsonb`, `output_data_jsonb`, `error_message`, `created_at`, `updated_at`。
*   **Prompt模板表 (ai_prompts)**
    *   **职责**: 存储AI生成内容的Prompt模板。
    *   **字段**: `id`, `name`, `template_content`, `version`, `created_at`, `updated_at`。

### 3.6 审批域

*   **审批流程表 (approval_workflows)**
    *   **职责**: 存储审批流程的定义。
    *   **字段**: `id`, `name`, `description`, `workflow_definition_jsonb`, `created_by`, ``created_at`, `updated_at`。
*   **审批任务表 (approval_tasks)**
    *   **职责**: 存储具体的审批任务实例。
    *   **字段**: `id`, `workflow_id`, `document_id`, `current_approver`, `status`, `comments_jsonb`, `created_at`, `updated_at`。
*   **审批日志表 (approval_logs)**
    *   **职责**: 记录审批操作的历史。
    *   **字段**: `id`, `approval_task_id`, `approver_id`, `action`, `comment_text`, `created_at`。

## 4. 索引策略

为提高查询性能，将在以下字段上创建索引：

*   `users`: `username` (UNIQUE), `email` (UNIQUE), `company_id`
*   `projects`: `company_id`, `created_by`, `status`, `deadline`
*   `bid_documents`: `project_id`, `created_by`, `status`
*   `templates`: `company_id`, `category`, `is_public`
*   `enterprise_capabilities`: `company_id`, `type`
*   `ai_tasks`: `status`, `task_type`
*   `approval_tasks`: `workflow_id`, `status`, `current_approver`

## 5. 关系型数据库优化

*   **分区表**: 针对超大型表（如审计日志、历史版本）可考虑按时间或ID范围进行分区。
*   **连接池**: 使用HikariCP等高效连接池优化数据库连接管理。
*   **读写分离**: 对于读多写少的场景，可考虑主从复制实现读写分离。

## 6. 与其他数据存储的集成

*   **Elasticsearch**: 负责全文检索和向量检索。PostgreSQL中存储的文本内容，将异步同步到Elasticsearch进行索引。
*   **Neo4j**: 负责知识图谱的存储和关联分析。核心的知识实体和关系在Neo4j中维护，PostgreSQL中可能只存储少量元数据或引用ID。
*   **MinIO**: 用于存储非结构化文件（如招标文件、生成的PDF/Word），PostgreSQL中存储文件的URL或MinIO对象ID。

---
