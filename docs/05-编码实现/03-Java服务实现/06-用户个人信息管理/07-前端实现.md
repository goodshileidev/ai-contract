# Java Spring Boot 服务任务详细计划 - JAVA-001 Part3 - 1.5: 用户个人信息管理 - 1.5.2 前端

**验证清单**:
- [ ] 个人中心页面开发完成
- [ ] 资料编辑表单正常
- [ ] 头像上传功能正常
- [ ] 密码修改功能正常

#### 个人中心页面

```typescript
// frontend/src/pages/User/Profile/index.tsx
import React, { useEffect, useState } from 'react';
import { Card, Avatar, Descriptions, Button, message, Tabs, Badge } from 'antd';
import { UserOutlined, EditOutlined, SafetyOutlined, HistoryOutlined } from '@ant-design/icons';
import type { UserProfileResponse } from '@/services/user.service';
import { userService } from '@/services/user.service';
import EditProfileModal from './EditProfileModal';
import ChangePasswordModal from './ChangePasswordModal';
import LoginHistory from './LoginHistory';

/**
 * 个人中心页面
 * 需求编号: REQ-FRONT-002
 */
const UserProfile: React.FC = () => {
  const [loading, setLoading] = useState(false);
  const [profile, setProfile] = useState<UserProfileResponse | null>(null);
  const [editModalVisible, setEditModalVisible] = useState(false);
  const [passwordModalVisible, setPasswordModalVisible] = useState(false);

  useEffect(() => {
    loadProfile();
  }, []);

  const loadProfile = async () => {
    setLoading(true);
    try {
      const response = await userService.getProfile();
      setProfile(response.data);
    } catch (error: any) {
      message.error(error.message || '加载失败');
    } finally {
      setLoading(false);
    }
  };

  const handleAvatarUpload = async (file: File) => {
    try {
      const response = await userService.uploadAvatar(file);
      message.success('头像上传成功');
      setProfile({ ...profile!, avatarUrl: response.data.avatarUrl });
    } catch (error: any) {
      message.error(error.message || '头像上传失败');
    }
  };

  return (
    <div className="user-profile">
      <Card loading={loading}>
        <div style={{ display: 'flex', marginBottom: 24 }}>
          <Avatar
            size={100}
            src={profile?.avatarUrl}
            icon={<UserOutlined />}
            style={{ marginRight: 24 }}
          />
          <div style={{ flex: 1 }}>
            <h2>{profile?.fullName || profile?.username}</h2>
            <p>{profile?.email}</p>
            <div>
              <Badge
                status={profile?.status === 'ACTIVE' ? 'success' : 'default'}
                text={profile?.status === 'ACTIVE' ? '活跃' : '未激活'}
              />
              {profile?.emailVerified && (
                <Badge status="success" text="邮箱已验证" style={{ marginLeft: 16 }} />
              )}
              {profile?.phoneVerified && (
                <Badge status="success" text="手机已验证" style={{ marginLeft: 16 }} />
              )}
            </div>
            <div style={{ marginTop: 16 }}>
              <Button
                icon={<EditOutlined />}
                onClick={() => setEditModalVisible(true)}
                style={{ marginRight: 8 }}
              >
                编辑资料
              </Button>
              <Button
                icon={<SafetyOutlined />}
                onClick={() => setPasswordModalVisible(true)}
              >
                修改密码
              </Button>
            </div>
          </div>
        </div>

        <Tabs
          items={[
            {
              key: 'info',
              label: '基本信息',
              icon: <UserOutlined />,
              children: (
                <Descriptions column={2} bordered>
                  <Descriptions.Item label="用户名">{profile?.username}</Descriptions.Item>
                  <Descriptions.Item label="邮箱">{profile?.email}</Descriptions.Item>
                  <Descriptions.Item label="全名">{profile?.fullName || '-'}</Descriptions.Item>
                  <Descriptions.Item label="手机">{profile?.phone || '-'}</Descriptions.Item>
                  <Descriptions.Item label="组织">{profile?.organizationName || '-'}</Descriptions.Item>
                  <Descriptions.Item label="上次登录">{profile?.lastLoginAt || '-'}</Descriptions.Item>
                  <Descriptions.Item label="登录次数">{profile?.loginCount}</Descriptions.Item>
                  <Descriptions.Item label="注册时间">{profile?.createdAt}</Descriptions.Item>
                </Descriptions>
              ),
            },
            {
              key: 'security',
              label: '安全设置',
              icon: <SafetyOutlined />,
              children: (
                <div>
                  <p>邮箱验证: {profile?.emailVerified ? '已验证' : '未验证'}</p>
                  <p>手机验证: {profile?.phoneVerified ? '已验证' : '未验证'}</p>
                </div>
              ),
            },
            {
              key: 'history',
              label: '登录历史',
              icon: <HistoryOutlined />,
              children: <LoginHistory />,
            },
          ]}
        />
      </Card>

      <EditProfileModal
        visible={editModalVisible}
        profile={profile}
        onCancel={() => setEditModalVisible(false)}
        onSuccess={() => {
          setEditModalVisible(false);
          loadProfile();
        }}
      />

      <ChangePasswordModal
        visible={passwordModalVisible}
        onCancel={() => setPasswordModalVisible(false)}
        onSuccess={() => {
          setPasswordModalVisible(false);
          message.success('密码修改成功，请重新登录');
        }}
      />
    </div>
  );
};

export default UserProfile;
```

#### 编辑资料弹窗

```typescript
// frontend/src/pages/User/Profile/EditProfileModal.tsx
import React, { useEffect } from 'react';
import { Modal, message } from 'antd';
import { ProForm, ProFormText } from '@ant-design/pro-form';
import type { UserProfileResponse, UpdateProfileRequest } from '@/services/user.service';
import { userService } from '@/services/user.service';

interface EditProfileModalProps {
  visible: boolean;
  profile: UserProfileResponse | null;
  onCancel: () => void;
  onSuccess: () => void;
}

/**
 * 编辑资料弹窗
 * 需求编号: REQ-FRONT-002
 */
const EditProfileModal: React.FC<EditProfileModalProps> = ({
  visible,
  profile,
  onCancel,
  onSuccess,
}) => {
  const [form] = ProForm.useForm();

  useEffect(() => {
    if (visible && profile) {
      form.setFieldsValue({
        email: profile.email,
        fullName: profile.fullName,
        phone: profile.phone,
      });
    }
  }, [visible, profile, form]);

  const handleSubmit = async (values: UpdateProfileRequest) => {
    try {
      await userService.updateProfile(values);
      message.success('资料更新成功');
      onSuccess();
      return true;
    } catch (error: any) {
      message.error(error.message || '更新失败');
      return false;
    }
  };

  return (
    <Modal
      title="编辑个人资料"
      open={visible}
      onCancel={onCancel}
      footer={null}
      width={600}
    >
      <ProForm
        form={form}
        onFinish={handleSubmit}
      >
        <ProFormText
          name="email"
          label="邮箱"
          placeholder="请输入邮箱"
          rules={[
            { required: true, message: '请输入邮箱' },
            { type: 'email', message: '邮箱格式不正确' },
          ]}
        />

        <ProFormText
          name="fullName"
          label="全名"
          placeholder="请输入全名"
          rules={[
            { max: 200, message: '全名不能超过200个字符' },
          ]}
        />

        <ProFormText
          name="phone"
          label="手机号"
          placeholder="请输入手机号"
          rules={[
            { max: 20, message: '手机号不能超过20个字符' },
          ]}
        />
      </ProForm>
    </Modal>
  );
};

export default EditProfileModal;
```

#### 修改密码弹窗

```typescript
// frontend/src/pages/User/Profile/ChangePasswordModal.tsx
import React from 'react';
import { Modal, message } from 'antd';
import { ProForm, ProFormText } from '@ant-design/pro-form';
import type { ChangePasswordRequest } from '@/services/user.service';
import { userService } from '@/services/user.service';

interface ChangePasswordModalProps {
  visible: boolean;
  onCancel: () => void;
  onSuccess: () => void;
}

/**
 * 修改密码弹窗
 * 需求编号: REQ-FRONT-002
 */
const ChangePasswordModal: React.FC<ChangePasswordModalProps> = ({
  visible,
  onCancel,
  onSuccess,
}) => {
  const [form] = ProForm.useForm();

  const handleSubmit = async (values: ChangePasswordRequest) => {
    if (values.newPassword !== values.confirmPassword) {
      message.error('两次输入的密码不一致');
      return false;
    }

    try {
      await userService.changePassword(values);
      onSuccess();
      return true;
    } catch (error: any) {
      message.error(error.message || '密码修改失败');
      return false;
    }
  };

  return (
    <Modal
      title="修改密码"
      open={visible}
      onCancel={onCancel}
      footer={null}
      width={500}
    >
      <ProForm
        form={form}
        onFinish={handleSubmit}
      >
        <ProFormText.Password
          name="oldPassword"
          label="当前密码"
          placeholder="请输入当前密码"
          rules={[
            { required: true, message: '请输入当前密码' },
          ]}
        />

        <ProFormText.Password
          name="newPassword"
          label="新密码"
          placeholder="请输入新密码"
          rules={[
            { required: true, message: '请输入新密码' },
            { min: 8, message: '密码至少8个字符' },
          ]}
        />

        <ProFormText.Password
          name="confirmPassword"
          label="确认密码"
          placeholder="请再次输入新密码"
          rules={[
            { required: true, message: '请确认新密码' },
          ]}
        />
      </ProForm>
    </Modal>
  );
};

export default ChangePasswordModal;
```

#### API客户端扩展

```typescript
// frontend/src/services/user.service.ts (扩展)
export const userService = {
  // ... 前面的方法 ...

  /**
   * 获取当前用户个人资料
   */
  getProfile: (): Promise<ApiResponse<UserProfileResponse>> => {
    return axios.get('/api/v1/users/me/profile');
  },

  /**
   * 更新个人资料
   */
  updateProfile: (data: UpdateProfileRequest): Promise<ApiResponse<void>> => {
    return axios.put('/api/v1/users/me/profile', data);
  },

  /**
   * 修改密码
   */
  changePassword: (data: ChangePasswordRequest): Promise<ApiResponse<void>> => {
    return axios.put('/api/v1/users/me/password', data);
  },

  /**
   * 上传头像
   */
  uploadAvatar: (file: File): Promise<ApiResponse<{ avatarUrl: string }>> => {
    const formData = new FormData();
    formData.append('file', file);

    return axios.post('/api/v1/users/me/avatar', formData, {
      headers: {
        'Content-Type': 'multipart/form-data',
      },
    });
  },

  /**
   * 获取登录历史
   */
  getLoginHistory: (params: {
    page?: number;
    pageSize?: number;
  }): Promise<ApiResponse<PaginatedResponse<LoginHistoryResponse>>> => {
    return axios.get('/api/v1/users/me/login-history', { params });
  },
};
```
