# AIæ ‡ä¹¦æ™ºèƒ½åˆ›ä½œå¹³å° - æŠ€æœ¯æ ˆè°ƒæ•´æ–¹æ¡ˆ

## ğŸ“‹ æ–‡æ¡£è¯´æ˜

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**åˆ›å»ºæ—¶é—´**: 2025å¹´11æœˆ15æ—¥
**è°ƒæ•´åŸå› **: åŸºäºä¼ä¸šçº§å®è·µå’Œå›¢é˜ŸæŠ€æœ¯æ ˆä¼˜åŒ–
**å½±å“èŒƒå›´**: æ¶æ„è®¾è®¡ã€å¼€å‘è®¡åˆ’

---

## ğŸ¯ æŠ€æœ¯æ ˆè°ƒæ•´æ¦‚è§ˆ

### åŸæŠ€æœ¯æ ˆ vs æ–°æŠ€æœ¯æ ˆ

```yaml
è°ƒæ•´å¯¹æ¯”:
  å‘é‡æ£€ç´¢ä¸çŸ¥è¯†ç®¡ç†:
    åŸæ–¹æ¡ˆ: Pinecone + Neo4j
    æ–°æ–¹æ¡ˆ: Elasticsearch 8.x âœ…

  åç«¯æŠ€æœ¯:
    åŸæ–¹æ¡ˆ: FastAPI (Python)
    æ–°æ–¹æ¡ˆ: Spring Boot (Java) + FastAPI (Python AIæœåŠ¡) âœ…

  å‰ç«¯UIæ¡†æ¶:
    åŸæ–¹æ¡ˆ: Material UI 5
    æ–°æ–¹æ¡ˆ: Ant Design Pro âœ…

  AIæ¡†æ¶:
    åŸæ–¹æ¡ˆ: LangChain + LangGraph
    æ–°æ–¹æ¡ˆ: LlamaIndex âœ…
```

---

## 1ï¸âƒ£ Elasticsearch æ›¿ä»£æ–¹æ¡ˆ

### 1.1 å¯è¡Œæ€§åˆ†æ

**âœ… å®Œå…¨å¯è¡Œï¼Œä¸”æœ‰æ˜æ˜¾ä¼˜åŠ¿**

#### Elasticsearch 8.x æ ¸å¿ƒèƒ½åŠ›

**å‘é‡æœç´¢èƒ½åŠ›** (æ›¿ä»£Pinecone):
```yaml
ç‰¹æ€§:
  - kNNå‘é‡æœç´¢: æ”¯æŒä½™å¼¦ç›¸ä¼¼åº¦ã€ç‚¹ç§¯ã€L2è·ç¦»
  - ç¨ å¯†å‘é‡: dense_vectorå­—æ®µç±»å‹ï¼Œæ”¯æŒæœ€å¤š2048ç»´
  - è¿‘ä¼¼æœ€è¿‘é‚»: HNSWç®—æ³•ï¼Œæ€§èƒ½ä¼˜å¼‚
  - æ··åˆæ£€ç´¢: å‘é‡æœç´¢ + å…¨æ–‡æœç´¢ + è¿‡æ»¤æ¡ä»¶
  - å‘é‡ç»´åº¦: æ”¯æŒOpenAI embedding (1536ç»´)

æ€§èƒ½:
  - ç™¾ä¸‡çº§å‘é‡: äºšç§’çº§æ£€ç´¢
  - åäº¿çº§å‘é‡: ç§’çº§æ£€ç´¢ (åˆ†ç‰‡ä¼˜åŒ–)
  - æ”¯æŒå®æ—¶ç´¢å¼•
```

**çŸ¥è¯†å›¾è°±æ›¿ä»£æ–¹æ¡ˆ**:
```yaml
æ–¹æ¡ˆ1: ES + å…³ç³»å»ºæ¨¡ (æ¨è)
  ä¼˜åŠ¿:
    - ä½¿ç”¨åµŒå¥—æ–‡æ¡£å­˜å‚¨å®ä½“å…³ç³»
    - åˆ©ç”¨ESå¼ºå¤§çš„èšåˆåŠŸèƒ½åˆ†æå…³ç³»
    - å…¨æ–‡æœç´¢ + å…³ç³»æŸ¥è¯¢ä¸€ä½“åŒ–
  å±€é™:
    - ä¸æ”¯æŒå¤æ‚å›¾éå† (å¦‚å¤šè·³è·¯å¾„)
    - å›¾ç®—æ³•èƒ½åŠ›å¼±

æ–¹æ¡ˆ2: ES + Neo4jæ··åˆ (é«˜çº§éœ€æ±‚)
  ä½¿ç”¨åœºæ™¯:
    - ES: å‘é‡æ£€ç´¢ + æ–‡æ¡£æœç´¢ + ç®€å•å…³ç³»
    - Neo4j: å¤æ‚å›¾åˆ†æ (å¦‚æœéœ€è¦)
  å»ºè®®: å…ˆç”¨æ–¹æ¡ˆ1ï¼ŒæŒ‰éœ€å‡çº§æ–¹æ¡ˆ2

æ–¹æ¡ˆ3: ES + Graphæ’ä»¶
  - ESæä¾›Graphæ¢ç´¢åŠŸèƒ½
  - é€‚åˆå…³ç³»å‘ç°å’Œå¯è§†åŒ–
```

#### æ¶æ„ä¼˜åŠ¿

```yaml
ç»Ÿä¸€æŠ€æœ¯æ ˆä¼˜åŠ¿:
  è¿ç»´ç®€åŒ–:
    - åªéœ€ç»´æŠ¤ä¸€ä¸ªæœç´¢å¼•æ“
    - ç»Ÿä¸€çš„ç›‘æ§å’Œå‘Šè­¦
    - é™ä½åŸºç¡€è®¾æ–½æˆæœ¬

  æ€§èƒ½æå‡:
    - å‡å°‘ç½‘ç»œè·³è½¬ (æ— éœ€Pinecone APIè°ƒç”¨)
    - æœ¬åœ°éƒ¨ç½²ï¼Œå»¶è¿Ÿæ›´ä½
    - ç»Ÿä¸€çš„ç¼“å­˜ç­–ç•¥

  åŠŸèƒ½å¢å¼º:
    - å…¨æ–‡æœç´¢ + å‘é‡æœç´¢æ— ç¼ç»“åˆ
    - å¼ºå¤§çš„èšåˆåˆ†æ
    - å®æ—¶æœç´¢å»ºè®®

  æˆæœ¬ä¼˜åŒ–:
    - æ— éœ€Pineconeè®¢é˜…è´¹ç”¨
    - å¯è‡ªå»ºé›†ç¾¤
    - çµæ´»æ‰©å±•
```

### 1.2 Elasticsearch æ¶æ„è®¾è®¡

#### ç´¢å¼•è®¾è®¡

**1. æ ‡ä¹¦æ–‡æ¡£ç´¢å¼•**
```json
PUT /bid_documents
{
  "settings": {
    "number_of_shards": 3,
    "number_of_replicas": 1,
    "index": {
      "similarity": {
        "default": {
          "type": "BM25"
        }
      }
    }
  },
  "mappings": {
    "properties": {
      "document_id": { "type": "keyword" },
      "title": {
        "type": "text",
        "analyzer": "ik_max_word",
        "search_analyzer": "ik_smart"
      },
      "content": {
        "type": "text",
        "analyzer": "ik_max_word"
      },
      "content_vector": {
        "type": "dense_vector",
        "dims": 1536,
        "index": true,
        "similarity": "cosine"
      },
      "sections": {
        "type": "nested",
        "properties": {
          "section_id": { "type": "keyword" },
          "title": { "type": "text" },
          "content": { "type": "text" },
          "content_vector": {
            "type": "dense_vector",
            "dims": 1536,
            "index": true,
            "similarity": "cosine"
          }
        }
      },
      "metadata": {
        "properties": {
          "project_id": { "type": "keyword" },
          "created_at": { "type": "date" },
          "tags": { "type": "keyword" },
          "status": { "type": "keyword" }
        }
      }
    }
  }
}
```

**2. ä¼ä¸šèƒ½åŠ›çŸ¥è¯†åº“ç´¢å¼•**
```json
PUT /enterprise_capabilities
{
  "mappings": {
    "properties": {
      "capability_id": { "type": "keyword" },
      "name": { "type": "text", "analyzer": "ik_max_word" },
      "description": { "type": "text", "analyzer": "ik_max_word" },
      "description_vector": {
        "type": "dense_vector",
        "dims": 1536,
        "index": true,
        "similarity": "cosine"
      },
      "category": { "type": "keyword" },
      "tags": { "type": "keyword" },

      // å…³ç³»å»ºæ¨¡ - æ›¿ä»£çŸ¥è¯†å›¾è°±
      "related_projects": {
        "type": "nested",
        "properties": {
          "project_id": { "type": "keyword" },
          "project_name": { "type": "text" },
          "similarity_score": { "type": "float" }
        }
      },
      "required_by": {
        "type": "nested",
        "properties": {
          "requirement_id": { "type": "keyword" },
          "requirement_text": { "type": "text" },
          "match_score": { "type": "float" }
        }
      },
      "related_personnel": {
        "type": "nested",
        "properties": {
          "person_id": { "type": "keyword" },
          "name": { "type": "text" },
          "role": { "type": "keyword" }
        }
      }
    }
  }
}
```

**3. æ¡ˆä¾‹åº“ç´¢å¼•**
```json
PUT /project_cases
{
  "mappings": {
    "properties": {
      "case_id": { "type": "keyword" },
      "project_name": { "type": "text", "analyzer": "ik_max_word" },
      "description": { "type": "text", "analyzer": "ik_max_word" },
      "description_vector": {
        "type": "dense_vector",
        "dims": 1536,
        "index": true,
        "similarity": "cosine"
      },
      "technologies": { "type": "keyword" },
      "industry": { "type": "keyword" },
      "scale": { "type": "keyword" },
      "success_metrics": {
        "type": "object",
        "properties": {
          "budget": { "type": "float" },
          "duration_months": { "type": "integer" },
          "team_size": { "type": "integer" }
        }
      }
    }
  }
}
```

#### æ··åˆæ£€ç´¢å®ç°

**è¯­ä¹‰æœç´¢ + å…¨æ–‡æœç´¢ + è¿‡æ»¤**
```python
from elasticsearch import AsyncElasticsearch

class HybridSearchService:
    def __init__(self):
        self.es = AsyncElasticsearch(
            hosts=["http://elasticsearch:9200"],
            basic_auth=("elastic", settings.ES_PASSWORD)
        )

    async def hybrid_search(
        self,
        query_text: str,
        query_vector: list[float],
        filters: dict = None,
        top_k: int = 10
    ):
        """
        æ··åˆæ£€ç´¢ï¼šå‘é‡æœç´¢ + å…¨æ–‡æœç´¢ + ä¸šåŠ¡è¿‡æ»¤
        """
        search_body = {
            "size": top_k,
            "query": {
                "bool": {
                    "should": [
                        # å‘é‡æœç´¢
                        {
                            "script_score": {
                                "query": {"match_all": {}},
                                "script": {
                                    "source": "cosineSimilarity(params.query_vector, 'content_vector') + 1.0",
                                    "params": {"query_vector": query_vector}
                                }
                            }
                        },
                        # å…¨æ–‡æœç´¢
                        {
                            "multi_match": {
                                "query": query_text,
                                "fields": ["title^2", "content"],
                                "type": "best_fields",
                                "boost": 0.5
                            }
                        }
                    ],
                    # ä¸šåŠ¡è¿‡æ»¤
                    "filter": self._build_filters(filters) if filters else []
                }
            },
            "_source": ["document_id", "title", "content", "metadata"],
            "highlight": {
                "fields": {
                    "content": {
                        "fragment_size": 150,
                        "number_of_fragments": 3
                    }
                }
            }
        }

        response = await self.es.search(
            index="bid_documents",
            body=search_body
        )

        return self._process_results(response)

    def _build_filters(self, filters: dict) -> list:
        filter_clauses = []

        if "project_id" in filters:
            filter_clauses.append({
                "term": {"metadata.project_id": filters["project_id"]}
            })

        if "status" in filters:
            filter_clauses.append({
                "terms": {"metadata.status": filters["status"]}
            })

        if "date_range" in filters:
            filter_clauses.append({
                "range": {
                    "metadata.created_at": {
                        "gte": filters["date_range"]["from"],
                        "lte": filters["date_range"]["to"]
                    }
                }
            })

        return filter_clauses
```

#### å…³ç³»æŸ¥è¯¢å®ç°

**ä½¿ç”¨åµŒå¥—æŸ¥è¯¢æ¨¡æ‹Ÿå›¾å…³ç³»**
```python
class RelationshipQueryService:
    async def find_matching_capabilities(
        self,
        requirement_text: str,
        requirement_vector: list[float],
        min_score: float = 0.7
    ) -> list[dict]:
        """
        æŸ¥æ‰¾åŒ¹é…éœ€æ±‚çš„ä¼ä¸šèƒ½åŠ›ï¼ˆç±»ä¼¼çŸ¥è¯†å›¾è°±çš„å…³ç³»æŸ¥è¯¢ï¼‰
        """
        search_body = {
            "size": 20,
            "query": {
                "script_score": {
                    "query": {
                        "bool": {
                            "should": [
                                {
                                    "match": {
                                        "description": {
                                            "query": requirement_text,
                                            "boost": 0.3
                                        }
                                    }
                                },
                                {
                                    "nested": {
                                        "path": "required_by",
                                        "query": {
                                            "match": {
                                                "required_by.requirement_text": requirement_text
                                            }
                                        },
                                        "score_mode": "max"
                                    }
                                }
                            ]
                        }
                    },
                    "script": {
                        "source": """
                            double vectorScore = cosineSimilarity(params.query_vector, 'description_vector') + 1.0;
                            return vectorScore * 10;
                        """,
                        "params": {"query_vector": requirement_vector}
                    }
                }
            },
            "min_score": min_score * 20,  # è°ƒæ•´é˜ˆå€¼
            # èšåˆï¼šåˆ†æèƒ½åŠ›åˆ†å¸ƒ
            "aggs": {
                "by_category": {
                    "terms": {"field": "category"}
                },
                "by_tags": {
                    "terms": {"field": "tags", "size": 20}
                }
            }
        }

        response = await self.es.search(
            index="enterprise_capabilities",
            body=search_body
        )

        return self._enrich_with_relations(response)

    async def _enrich_with_relations(self, response):
        """
        æŸ¥è¯¢ç›¸å…³é¡¹ç›®å’Œäººå‘˜ï¼ˆæ¨¡æ‹Ÿå›¾éå†ï¼‰
        """
        results = []
        for hit in response["hits"]["hits"]:
            capability = hit["_source"]

            # è·å–ç›¸å…³é¡¹ç›®è¯¦æƒ…
            if "related_projects" in capability:
                project_ids = [p["project_id"] for p in capability["related_projects"]]
                projects = await self._get_projects_by_ids(project_ids)
                capability["related_projects_detail"] = projects

            results.append({
                "capability": capability,
                "score": hit["_score"],
                "relevance": hit["_score"] / 20  # å½’ä¸€åŒ–åˆ°0-1
            })

        return results
```

### 1.3 éƒ¨ç½²æ¶æ„

**Elasticsearch é›†ç¾¤é…ç½®**
```yaml
# docker-compose.yml
version: '3.8'

services:
  elasticsearch-master:
    image: docker.elastic.co/elasticsearch/elasticsearch:8.11.0
    container_name: es-master
    environment:
      - node.name=es-master
      - cluster.name=aibidcomposer-cluster
      - discovery.seed_hosts=es-node1,es-node2
      - cluster.initial_master_nodes=es-master
      - bootstrap.memory_lock=true
      - "ES_JAVA_OPTS=-Xms2g -Xmx2g"
      - xpack.security.enabled=true
      - xpack.security.http.ssl.enabled=false
      - xpack.license.self_generated.type=basic
    ulimits:
      memlock:
        soft: -1
        hard: -1
    volumes:
      - es-master-data:/usr/share/elasticsearch/data
    ports:
      - 9200:9200
    networks:
      - elastic

  elasticsearch-node1:
    image: docker.elastic.co/elasticsearch/elasticsearch:8.11.0
    container_name: es-node1
    environment:
      - node.name=es-node1
      - cluster.name=aibidcomposer-cluster
      - discovery.seed_hosts=es-master,es-node2
      - cluster.initial_master_nodes=es-master
      - bootstrap.memory_lock=true
      - "ES_JAVA_OPTS=-Xms2g -Xmx2g"
      - xpack.security.enabled=true
    volumes:
      - es-node1-data:/usr/share/elasticsearch/data
    networks:
      - elastic

  elasticsearch-node2:
    image: docker.elastic.co/elasticsearch/elasticsearch:8.11.0
    container_name: es-node2
    environment:
      - node.name=es-node2
      - cluster.name=aibidcomposer-cluster
      - discovery.seed_hosts=es-master,es-node1
      - cluster.initial_master_nodes=es-master
      - bootstrap.memory_lock=true
      - "ES_JAVA_OPTS=-Xms2g -Xmx2g"
      - xpack.security.enabled=true
    volumes:
      - es-node2-data:/usr/share/elasticsearch/data
    networks:
      - elastic

  kibana:
    image: docker.elastic.co/kibana/kibana:8.11.0
    container_name: kibana
    ports:
      - 5601:5601
    environment:
      - ELASTICSEARCH_HOSTS=http://es-master:9200
      - ELASTICSEARCH_USERNAME=kibana_system
      - ELASTICSEARCH_PASSWORD=${KIBANA_PASSWORD}
    networks:
      - elastic
    depends_on:
      - elasticsearch-master

volumes:
  es-master-data:
  es-node1-data:
  es-node2-data:

networks:
  elastic:
    driver: bridge
```

**Kuberneteséƒ¨ç½²**
```yaml
# elasticsearch-statefulset.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: elasticsearch
  namespace: aibidcomposer
spec:
  serviceName: elasticsearch
  replicas: 3
  selector:
    matchLabels:
      app: elasticsearch
  template:
    metadata:
      labels:
        app: elasticsearch
    spec:
      containers:
      - name: elasticsearch
        image: docker.elastic.co/elasticsearch/elasticsearch:8.11.0
        resources:
          limits:
            memory: 4Gi
            cpu: 2
          requests:
            memory: 2Gi
            cpu: 1
        ports:
        - containerPort: 9200
          name: rest
        - containerPort: 9300
          name: inter-node
        volumeMounts:
        - name: data
          mountPath: /usr/share/elasticsearch/data
        env:
        - name: cluster.name
          value: aibidcomposer-cluster
        - name: node.name
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: discovery.seed_hosts
          value: "elasticsearch-0.elasticsearch,elasticsearch-1.elasticsearch,elasticsearch-2.elasticsearch"
        - name: cluster.initial_master_nodes
          value: "elasticsearch-0,elasticsearch-1,elasticsearch-2"
        - name: ES_JAVA_OPTS
          value: "-Xms2g -Xmx2g"
  volumeClaimTemplates:
  - metadata:
      name: data
    spec:
      accessModes: [ "ReadWriteOnce" ]
      storageClassName: fast-ssd
      resources:
        requests:
          storage: 100Gi
```

---

## 2ï¸âƒ£ Java Spring Boot + Python æ··åˆæ¶æ„

### 2.1 æ¶æ„è®¾è®¡

**âœ… æ¨èæ¶æ„ï¼šå¾®æœåŠ¡åˆ†ç¦»**

```yaml
æœåŠ¡åˆ’åˆ†:
  Spring BootæœåŠ¡ (ä¸šåŠ¡æ ¸å¿ƒ):
    èŒè´£:
      - ç”¨æˆ·è®¤è¯æˆæƒ
      - é¡¹ç›®ç®¡ç†
      - æ–‡æ¡£ç®¡ç† (CRUD)
      - ç»„ç»‡ç®¡ç†
      - æƒé™æ§åˆ¶
      - å®¡æ‰¹æµç¨‹
      - æ•°æ®æŒä¹…åŒ–
    æŠ€æœ¯æ ˆ:
      - Spring Boot 3.x
      - Spring Security
      - Spring Data JPA
      - PostgreSQL
      - Redis
      - JWT

  Python AIæœåŠ¡ (AIèƒ½åŠ›):
    èŒè´£:
      - LLMè°ƒç”¨ (OpenAI, Anthropicç­‰)
      - æ–‡æ¡£å‘é‡åŒ–
      - è¯­ä¹‰æœç´¢
      - éœ€æ±‚åˆ†æ
      - å†…å®¹ç”Ÿæˆ
      - è´¨é‡å®¡æŸ¥
      - Elasticsearchäº¤äº’
    æŠ€æœ¯æ ˆ:
      - FastAPI
      - LlamaIndex
      - OpenAI SDK
      - Elasticsearch Pythonå®¢æˆ·ç«¯
```

**æœåŠ¡é€šä¿¡æ¶æ„**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å‰ç«¯ (React)   â”‚
â”‚  Ant Design Pro â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                 â”‚
         â–¼                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Spring BootæœåŠ¡  â”‚  â”‚   Python AIæœåŠ¡   â”‚
â”‚  (æ•°æ®ç®¡ç†)       â”‚â—„â”€â”¤   (AIèƒ½åŠ›)       â”‚
â”‚                  â”‚  â”‚                  â”‚
â”‚  - ç”¨æˆ·/é¡¹ç›®     â”‚  â”‚  - LLMè°ƒç”¨       â”‚
â”‚  - æ–‡æ¡£CRUD      â”‚  â”‚  - å‘é‡åŒ–        â”‚
â”‚  - æƒé™æ§åˆ¶      â”‚  â”‚  - è¯­ä¹‰æœç´¢      â”‚
â”‚  - å®¡æ‰¹æµç¨‹      â”‚  â”‚  - å†…å®¹ç”Ÿæˆ      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                     â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
         â”‚                     â”‚
         â–¼                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   PostgreSQL     â”‚  â”‚  Elasticsearch   â”‚
â”‚   (ä¸šåŠ¡æ•°æ®)      â”‚  â”‚  (å‘é‡+æœç´¢)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Redis       â”‚
â”‚  (ç¼“å­˜+ä¼šè¯)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æœåŠ¡æ¥å£è®¾è®¡

**Spring Boot â†’ Python AIæœåŠ¡è°ƒç”¨**

**Spring Boot RestTemplateé…ç½®**
```java
// config/AiServiceConfig.java
@Configuration
public class AiServiceConfig {

    @Value("${ai.service.url}")
    private String aiServiceUrl;

    @Bean
    public RestTemplate aiServiceRestTemplate() {
        RestTemplate restTemplate = new RestTemplate();

        // è®¾ç½®è¶…æ—¶
        HttpComponentsClientHttpRequestFactory factory =
            new HttpComponentsClientHttpRequestFactory();
        factory.setConnectTimeout(5000);
        factory.setReadTimeout(30000);

        restTemplate.setRequestFactory(factory);

        // æ·»åŠ æ‹¦æˆªå™¨
        restTemplate.getInterceptors().add((request, body, execution) -> {
            request.getHeaders().set("X-Service-Auth", aiServiceToken);
            return execution.execute(request, body);
        });

        return restTemplate;
    }
}

// service/AiServiceClient.java
@Service
@Slf4j
public class AiServiceClient {

    @Autowired
    private RestTemplate aiServiceRestTemplate;

    @Value("${ai.service.url}")
    private String aiServiceUrl;

    /**
     * åˆ†ææ‹›æ ‡æ–‡ä»¶éœ€æ±‚
     */
    public RequirementAnalysisResult analyzeRequirements(String documentId) {
        String url = aiServiceUrl + "/api/ai/analyze-requirements";

        Map<String, Object> request = Map.of(
            "document_id", documentId,
            "analysis_depth", "detailed"
        );

        try {
            ResponseEntity<RequirementAnalysisResult> response =
                aiServiceRestTemplate.postForEntity(
                    url,
                    request,
                    RequirementAnalysisResult.class
                );

            return response.getBody();

        } catch (Exception e) {
            log.error("Failed to analyze requirements for document: {}", documentId, e);
            throw new AiServiceException("éœ€æ±‚åˆ†æå¤±è´¥", e);
        }
    }

    /**
     * ç”Ÿæˆæ ‡ä¹¦å†…å®¹
     */
    public ContentGenerationResult generateContent(ContentGenerationRequest request) {
        String url = aiServiceUrl + "/api/ai/generate-content";

        try {
            ResponseEntity<ContentGenerationResult> response =
                aiServiceRestTemplate.postForEntity(
                    url,
                    request,
                    ContentGenerationResult.class
                );

            return response.getBody();

        } catch (Exception e) {
            log.error("Failed to generate content", e);
            throw new AiServiceException("å†…å®¹ç”Ÿæˆå¤±è´¥", e);
        }
    }

    /**
     * è¯­ä¹‰æœç´¢ç›¸ä¼¼æ¡ˆä¾‹
     */
    public List<ProjectCase> searchSimilarCases(String requirementText, int topK) {
        String url = aiServiceUrl + "/api/ai/search-similar-cases";

        Map<String, Object> request = Map.of(
            "query", requirementText,
            "top_k", topK
        );

        try {
            ResponseEntity<SearchResult> response =
                aiServiceRestTemplate.postForEntity(
                    url,
                    request,
                    SearchResult.class
                );

            return response.getBody().getCases();

        } catch (Exception e) {
            log.error("Failed to search similar cases", e);
            return Collections.emptyList();
        }
    }
}
```

**Python AIæœåŠ¡ç«¯ç‚¹**
```python
# app/main.py
from fastapi import FastAPI, Depends, HTTPException
from app.services.llm_service import LLMService
from app.services.search_service import SearchService
from app.middleware.auth import verify_service_token

app = FastAPI(title="AI Service for AIBidComposer")

@app.post("/api/ai/analyze-requirements")
async def analyze_requirements(
    request: RequirementAnalysisRequest,
    _: None = Depends(verify_service_token)
):
    """
    åˆ†ææ‹›æ ‡æ–‡ä»¶éœ€æ±‚
    ä¾›Spring BootæœåŠ¡è°ƒç”¨
    """
    llm_service = LLMService()

    # ä»Elasticsearchè·å–æ–‡æ¡£
    document = await search_service.get_document(request.document_id)

    # ä½¿ç”¨LLMåˆ†æ
    analysis_result = await llm_service.analyze_requirements(
        document_content=document.content,
        depth=request.analysis_depth
    )

    return {
        "requirements": analysis_result.requirements,
        "key_points": analysis_result.key_points,
        "technical_specs": analysis_result.technical_specs
    }

@app.post("/api/ai/generate-content")
async def generate_content(
    request: ContentGenerationRequest,
    _: None = Depends(verify_service_token)
):
    """
    ç”Ÿæˆæ ‡ä¹¦å†…å®¹
    """
    llm_service = LLMService()

    # æ£€ç´¢ç›¸å…³æ¡ˆä¾‹
    similar_cases = await search_service.search_similar_cases(
        request.requirement_text,
        top_k=5
    )

    # ç”Ÿæˆå†…å®¹
    generated_content = await llm_service.generate_bid_content(
        requirement=request.requirement_text,
        context=similar_cases,
        section_type=request.section_type
    )

    return {
        "content": generated_content,
        "references": similar_cases,
        "tokens_used": llm_service.get_tokens_used()
    }

@app.post("/api/ai/search-similar-cases")
async def search_similar_cases(
    request: SearchRequest,
    _: None = Depends(verify_service_token)
):
    """
    è¯­ä¹‰æœç´¢ç›¸ä¼¼æ¡ˆä¾‹
    """
    search_service = SearchService()

    # å‘é‡åŒ–æŸ¥è¯¢
    query_vector = await search_service.embed_text(request.query)

    # æ··åˆæœç´¢
    results = await search_service.hybrid_search(
        query_text=request.query,
        query_vector=query_vector,
        index="project_cases",
        top_k=request.top_k
    )

    return {
        "cases": results,
        "total": len(results)
    }
```

### 2.3 æ•°æ®ä¸€è‡´æ€§ç­–ç•¥

**äº‹ä»¶é©±åŠ¨æ¶æ„**
```java
// Spring Boot - å‘å¸ƒäº‹ä»¶
@Service
public class DocumentService {

    @Autowired
    private ApplicationEventPublisher eventPublisher;

    @Autowired
    private AiServiceClient aiServiceClient;

    @Transactional
    public Document createDocument(CreateDocumentRequest request) {
        // 1. ä¿å­˜æ–‡æ¡£åˆ°PostgreSQL
        Document document = documentRepository.save(
            new Document(request)
        );

        // 2. å‘å¸ƒäº‹ä»¶ï¼šå¼‚æ­¥ç´¢å¼•åˆ°Elasticsearch
        eventPublisher.publishEvent(
            new DocumentCreatedEvent(document.getId(), document.getContent())
        );

        return document;
    }
}

// äº‹ä»¶ç›‘å¬å™¨
@Component
@Slf4j
public class DocumentEventListener {

    @Autowired
    private AiServiceClient aiServiceClient;

    @Async
    @EventListener
    public void handleDocumentCreated(DocumentCreatedEvent event) {
        try {
            // è°ƒç”¨Python AIæœåŠ¡ç´¢å¼•æ–‡æ¡£
            aiServiceClient.indexDocument(
                event.getDocumentId(),
                event.getContent()
            );

            log.info("Document indexed: {}", event.getDocumentId());

        } catch (Exception e) {
            log.error("Failed to index document: {}", event.getDocumentId(), e);
            // å¯ä»¥é‡è¯•æˆ–è®°å½•åˆ°æ­»ä¿¡é˜Ÿåˆ—
        }
    }
}
```

**Python AIæœåŠ¡ - ç´¢å¼•å¤„ç†**
```python
@app.post("/api/ai/index-document")
async def index_document(
    request: IndexDocumentRequest,
    _: None = Depends(verify_service_token)
):
    """
    ç´¢å¼•æ–‡æ¡£åˆ°Elasticsearch
    """
    search_service = SearchService()

    # 1. æ–‡æ¡£åˆ†å—
    chunks = search_service.chunk_document(
        request.content,
        chunk_size=500,
        chunk_overlap=50
    )

    # 2. ç”Ÿæˆembeddings
    embeddings = await search_service.embed_batch(
        [chunk.text for chunk in chunks]
    )

    # 3. ç´¢å¼•åˆ°Elasticsearch
    await search_service.index_document_chunks(
        document_id=request.document_id,
        chunks=chunks,
        embeddings=embeddings
    )

    return {"status": "indexed", "chunks_count": len(chunks)}
```

### 2.4 Spring Boot é¡¹ç›®ç»“æ„

```
spring-boot-service/
â”œâ”€â”€ src/main/java/com/aibidcomposer/
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â”œâ”€â”€ SecurityConfig.java
â”‚   â”‚   â”œâ”€â”€ JpaConfig.java
â”‚   â”‚   â”œâ”€â”€ RedisConfig.java
â”‚   â”‚   â””â”€â”€ AiServiceConfig.java
â”‚   â”œâ”€â”€ controller/
â”‚   â”‚   â”œâ”€â”€ AuthController.java
â”‚   â”‚   â”œâ”€â”€ ProjectController.java
â”‚   â”‚   â”œâ”€â”€ DocumentController.java
â”‚   â”‚   â”œâ”€â”€ TemplateController.java
â”‚   â”‚   â””â”€â”€ ApprovalController.java
â”‚   â”œâ”€â”€ service/
â”‚   â”‚   â”œâ”€â”€ UserService.java
â”‚   â”‚   â”œâ”€â”€ ProjectService.java
â”‚   â”‚   â”œâ”€â”€ DocumentService.java
â”‚   â”‚   â”œâ”€â”€ AiServiceClient.java       # AIæœåŠ¡è°ƒç”¨å®¢æˆ·ç«¯
â”‚   â”‚   â””â”€â”€ SearchService.java         # æœç´¢æœåŠ¡(å§”æ‰˜ç»™Python)
â”‚   â”œâ”€â”€ repository/
â”‚   â”‚   â”œâ”€â”€ UserRepository.java
â”‚   â”‚   â”œâ”€â”€ ProjectRepository.java
â”‚   â”‚   â”œâ”€â”€ DocumentRepository.java
â”‚   â”‚   â””â”€â”€ TemplateRepository.java
â”‚   â”œâ”€â”€ model/
â”‚   â”‚   â”œâ”€â”€ User.java
â”‚   â”‚   â”œâ”€â”€ Project.java
â”‚   â”‚   â”œâ”€â”€ Document.java
â”‚   â”‚   â””â”€â”€ Template.java
â”‚   â”œâ”€â”€ dto/
â”‚   â”‚   â”œâ”€â”€ request/
â”‚   â”‚   â”‚   â”œâ”€â”€ CreateProjectRequest.java
â”‚   â”‚   â”‚   â”œâ”€â”€ ContentGenerationRequest.java
â”‚   â”‚   â”‚   â””â”€â”€ SearchRequest.java
â”‚   â”‚   â””â”€â”€ response/
â”‚   â”‚       â”œâ”€â”€ ProjectResponse.java
â”‚   â”‚       â”œâ”€â”€ DocumentResponse.java
â”‚   â”‚       â””â”€â”€ AiAnalysisResponse.java
â”‚   â”œâ”€â”€ security/
â”‚   â”‚   â”œâ”€â”€ JwtTokenProvider.java
â”‚   â”‚   â”œâ”€â”€ JwtAuthenticationFilter.java
â”‚   â”‚   â””â”€â”€ UserDetailsServiceImpl.java
â”‚   â”œâ”€â”€ exception/
â”‚   â”‚   â”œâ”€â”€ GlobalExceptionHandler.java
â”‚   â”‚   â””â”€â”€ AiServiceException.java
â”‚   â””â”€â”€ Application.java
â”œâ”€â”€ src/main/resources/
â”‚   â”œâ”€â”€ application.yml
â”‚   â”œâ”€â”€ application-dev.yml
â”‚   â”œâ”€â”€ application-prod.yml
â”‚   â””â”€â”€ db/migration/         # Flywayè¿ç§»è„šæœ¬
â”‚       â”œâ”€â”€ V1__init_schema.sql
â”‚       â””â”€â”€ V2__add_indexes.sql
â””â”€â”€ pom.xml
```

**æ ¸å¿ƒä¾èµ– (pom.xml)**
```xml
<dependencies>
    <!-- Spring Boot Starter -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-web</artifactId>
        <version>3.2.0</version>
    </dependency>

    <!-- Spring Security -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-security</artifactId>
    </dependency>

    <!-- Spring Data JPA -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-data-jpa</artifactId>
    </dependency>

    <!-- PostgreSQL Driver -->
    <dependency>
        <groupId>org.postgresql</groupId>
        <artifactId>postgresql</artifactId>
        <version>42.7.0</version>
    </dependency>

    <!-- Redis -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-data-redis</artifactId>
    </dependency>

    <!-- JWT -->
    <dependency>
        <groupId>io.jsonwebtoken</groupId>
        <artifactId>jjwt-api</artifactId>
        <version>0.12.3</version>
    </dependency>

    <!-- Flyway (æ•°æ®åº“è¿ç§») -->
    <dependency>
        <groupId>org.flywaydb</groupId>
        <artifactId>flyway-core</artifactId>
    </dependency>

    <!-- Validation -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-validation</artifactId>
    </dependency>

    <!-- Lombok -->
    <dependency>
        <groupId>org.projectlombok</groupId>
        <artifactId>lombok</artifactId>
        <optional>true</optional>
    </dependency>
</dependencies>
```

---

## 3ï¸âƒ£ React + Ant Design Pro

### 3.1 æ¶æ„è°ƒæ•´

**âœ… å®Œå…¨å…¼å®¹ï¼Œä½“éªŒæ›´ä¼˜**

```yaml
Ant Design Proä¼˜åŠ¿:
  å¼€ç®±å³ç”¨:
    - å®Œæ•´çš„ä¸­åå°è§£å†³æ–¹æ¡ˆ
    - é¢„ç½®æƒé™è·¯ç”±
    - å†…ç½®å›½é™…åŒ–
    - ProComponentsé«˜çº§ç»„ä»¶

  ä¼ä¸šçº§ç»„ä»¶:
    - ProTable (é«˜çº§è¡¨æ ¼)
    - ProForm (é«˜çº§è¡¨å•)
    - ProLayout (ä¸“ä¸šå¸ƒå±€)
    - ProDescriptions (è¯¦æƒ…é¡µ)

  æœ€ä½³å®è·µ:
    - Umi 4æ¡†æ¶
    - çº¦å®šå¼è·¯ç”±
    - æ•°æ®æµæ–¹æ¡ˆ
    - è¯·æ±‚å’Œé”™è¯¯å¤„ç†
```

### 3.2 é¡¹ç›®ç»“æ„

```
frontend/
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ config.ts              # Umié…ç½®
â”‚   â”œâ”€â”€ routes.ts              # è·¯ç”±é…ç½®
â”‚   â””â”€â”€ proxy.ts               # ä»£ç†é…ç½®
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ .umi/                  # Umiä¸´æ—¶æ–‡ä»¶
â”‚   â”œâ”€â”€ components/            # é€šç”¨ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ RightContent/
â”‚   â”‚   â”œâ”€â”€ Footer/
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ pages/                 # é¡µé¢
â”‚   â”‚   â”œâ”€â”€ User/              # ç”¨æˆ·ç›¸å…³é¡µé¢
â”‚   â”‚   â”‚   â”œâ”€â”€ Login/
â”‚   â”‚   â”‚   â””â”€â”€ Register/
â”‚   â”‚   â”œâ”€â”€ Project/           # é¡¹ç›®ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ List/
â”‚   â”‚   â”‚   â”œâ”€â”€ Detail/
â”‚   â”‚   â”‚   â””â”€â”€ Create/
â”‚   â”‚   â”œâ”€â”€ Document/          # æ–‡æ¡£ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ Editor/
â”‚   â”‚   â”‚   â””â”€â”€ Version/
â”‚   â”‚   â”œâ”€â”€ Template/          # æ¨¡æ¿ç®¡ç†
â”‚   â”‚   â””â”€â”€ Dashboard/         # ä»ªè¡¨ç›˜
â”‚   â”œâ”€â”€ services/              # APIæœåŠ¡
â”‚   â”‚   â”œâ”€â”€ api.ts             # APIé…ç½®
â”‚   â”‚   â”œâ”€â”€ user.ts
â”‚   â”‚   â”œâ”€â”€ project.ts
â”‚   â”‚   â”œâ”€â”€ document.ts
â”‚   â”‚   â””â”€â”€ ai.ts
â”‚   â”œâ”€â”€ models/                # æ•°æ®æ¨¡å‹(dva)
â”‚   â”‚   â”œâ”€â”€ user.ts
â”‚   â”‚   â””â”€â”€ global.ts
â”‚   â”œâ”€â”€ utils/                 # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ request.ts
â”‚   â”‚   â””â”€â”€ authority.ts
â”‚   â”œâ”€â”€ access.ts              # æƒé™å®šä¹‰
â”‚   â”œâ”€â”€ app.tsx                # è¿è¡Œæ—¶é…ç½®
â”‚   â””â”€â”€ global.tsx             # å…¨å±€é…ç½®
â”œâ”€â”€ package.json
â””â”€â”€ tsconfig.json
```

### 3.3 æ ¸å¿ƒä»£ç ç¤ºä¾‹

**ProTableç¤ºä¾‹ - é¡¹ç›®åˆ—è¡¨**
```typescript
// src/pages/Project/List/index.tsx
import { PlusOutlined } from '@ant-design/icons';
import { ProTable, ActionType } from '@ant-design/pro-components';
import { Button } from 'antd';
import { useRef } from 'react';
import { getProjects, type ProjectItem } from '@/services/project';

export default function ProjectList() {
  const actionRef = useRef<ActionType>();

  const columns: ProColumns<ProjectItem>[] = [
    {
      title: 'é¡¹ç›®ç¼–å·',
      dataIndex: 'code',
      width: 120,
      fixed: 'left',
    },
    {
      title: 'é¡¹ç›®åç§°',
      dataIndex: 'name',
      width: 200,
      ellipsis: true,
    },
    {
      title: 'çŠ¶æ€',
      dataIndex: 'status',
      width: 100,
      valueEnum: {
        draft: { text: 'è‰ç¨¿', status: 'Default' },
        in_progress: { text: 'è¿›è¡Œä¸­', status: 'Processing' },
        completed: { text: 'å·²å®Œæˆ', status: 'Success' },
      },
    },
    {
      title: 'ä¼˜å…ˆçº§',
      dataIndex: 'priority',
      width: 100,
      valueEnum: {
        low: { text: 'ä½', status: 'Default' },
        medium: { text: 'ä¸­', status: 'Warning' },
        high: { text: 'é«˜', status: 'Error' },
      },
    },
    {
      title: 'é¢„ç®— (ä¸‡å…ƒ)',
      dataIndex: 'budget',
      width: 120,
      valueType: 'money',
      search: false,
    },
    {
      title: 'ä¸­æ ‡æ¦‚ç‡',
      dataIndex: 'winProbability',
      width: 120,
      valueType: 'percent',
      search: false,
    },
    {
      title: 'æˆªæ­¢æ—¥æœŸ',
      dataIndex: 'submissionDeadline',
      width: 150,
      valueType: 'dateTime',
    },
    {
      title: 'æ“ä½œ',
      width: 180,
      fixed: 'right',
      valueType: 'option',
      render: (_, record) => [
        <a key="view" onClick={() => history.push(`/project/${record.id}`)}>
          æŸ¥çœ‹
        </a>,
        <a key="edit">ç¼–è¾‘</a>,
        <a key="delete" style={{ color: 'red' }}>
          åˆ é™¤
        </a>,
      ],
    },
  ];

  return (
    <ProTable<ProjectItem>
      columns={columns}
      actionRef={actionRef}
      request={async (params, sort, filter) => {
        const response = await getProjects({
          page: params.current,
          pageSize: params.pageSize,
          ...params,
        });
        return {
          data: response.data.items,
          success: true,
          total: response.data.total,
        };
      }}
      rowKey="id"
      search={{
        labelWidth: 'auto',
      }}
      pagination={{
        pageSize: 20,
      }}
      dateFormatter="string"
      headerTitle="é¡¹ç›®åˆ—è¡¨"
      toolBarRender={() => [
        <Button
          key="create"
          type="primary"
          icon={<PlusOutlined />}
          onClick={() => history.push('/project/create')}
        >
          æ–°å»ºé¡¹ç›®
        </Button>,
      ]}
    />
  );
}
```

**ProFormç¤ºä¾‹ - åˆ›å»ºé¡¹ç›®**
```typescript
// src/pages/Project/Create/index.tsx
import { ProForm, ProFormText, ProFormSelect, ProFormDateTimePicker } from '@ant-design/pro-components';
import { message } from 'antd';
import { createProject } from '@/services/project';

export default function CreateProject() {
  return (
    <ProForm
      onFinish={async (values) => {
        try {
          await createProject(values);
          message.success('é¡¹ç›®åˆ›å»ºæˆåŠŸ');
          history.push('/project');
        } catch (error) {
          message.error('é¡¹ç›®åˆ›å»ºå¤±è´¥');
        }
      }}
    >
      <ProFormText
        name="name"
        label="é¡¹ç›®åç§°"
        placeholder="è¯·è¾“å…¥é¡¹ç›®åç§°"
        rules={[{ required: true, message: 'è¯·è¾“å…¥é¡¹ç›®åç§°' }]}
      />

      <ProFormSelect
        name="priority"
        label="ä¼˜å…ˆçº§"
        valueEnum={{
          low: 'ä½',
          medium: 'ä¸­',
          high: 'é«˜',
        }}
        placeholder="è¯·é€‰æ‹©ä¼˜å…ˆçº§"
        rules={[{ required: true }]}
      />

      <ProFormDateTimePicker
        name="submissionDeadline"
        label="æŠ•æ ‡æˆªæ­¢æ—¶é—´"
        rules={[{ required: true }]}
      />
    </ProForm>
  );
}
```

---

## 4ï¸âƒ£ LlamaIndex æ›¿ä»£ LangChain

### 4.1 å¯è¡Œæ€§åˆ†æ

**âœ… LlamaIndexæ›´é€‚åˆRAGåœºæ™¯**

```yaml
LlamaIndexä¼˜åŠ¿:
  ä¸“æ³¨RAG:
    - æ•°æ®è¿æ¥å™¨ä¸°å¯Œ
    - ç´¢å¼•æ„å»ºç®€å•
    - æŸ¥è¯¢ä¼˜åŒ–å¼ºå¤§
    - ä¸æ£€ç´¢æ·±åº¦é›†æˆ

  Elasticsearché›†æˆ:
    - åŸç”Ÿæ”¯æŒESä½œä¸ºå‘é‡å­˜å‚¨
    - æ··åˆæ£€ç´¢å†…ç½®
    - ç´¢å¼•ç®¡ç†ä¾¿æ·

  vs LangChain:
    - æ›´ä¸“æ³¨äºæ£€ç´¢å¢å¼º
    - ä»£ç æ›´ç®€æ´
    - å­¦ä¹ æ›²çº¿å¹³ç¼“
    - é€‚åˆæ•°æ®ç´¢å¼•åœºæ™¯

å±€é™æ€§:
  - å·¥ä½œæµç¼–æ’èƒ½åŠ›å¼±äºLangGraph
  - AgentåŠŸèƒ½ç›¸å¯¹ç®€å•

è§£å†³æ–¹æ¡ˆ:
  - ä½¿ç”¨LlamaIndexåšRAG
  - ç®€å•å·¥ä½œæµç”¨Pythonå‡½æ•°ç¼–æ’
  - å¤æ‚é€»è¾‘ç”¨çŠ¶æ€æœºæ¨¡å¼
```

### 4.2 LlamaIndexæ¶æ„

**æ ¸å¿ƒç»„ä»¶**
```python
# app/services/llama_service.py
from llama_index.core import VectorStoreIndex, SimpleDirectoryReader, Settings
from llama_index.vector_stores.elasticsearch import ElasticsearchStore
from llama_index.embeddings.openai import OpenAIEmbedding
from llama_index.llms.openai import OpenAI

class LlamaIndexService:
    def __init__(self):
        # é…ç½®å…¨å±€è®¾ç½®
        Settings.llm = OpenAI(
            model="gpt-4-turbo-preview",
            temperature=0.7,
            api_key=settings.OPENAI_API_KEY
        )

        Settings.embed_model = OpenAIEmbedding(
            model="text-embedding-ada-002",
            api_key=settings.OPENAI_API_KEY
        )

        # é…ç½®Elasticsearchå‘é‡å­˜å‚¨
        self.vector_store = ElasticsearchStore(
            index_name="bid_documents",
            es_url="http://elasticsearch:9200",
            es_user="elastic",
            es_password=settings.ES_PASSWORD
        )

    async def index_document(
        self,
        document_id: str,
        document_path: str
    ):
        """
        ç´¢å¼•æ–‡æ¡£åˆ°Elasticsearch
        """
        # 1. åŠ è½½æ–‡æ¡£
        documents = SimpleDirectoryReader(
            input_files=[document_path]
        ).load_data()

        # 2. æ·»åŠ å…ƒæ•°æ®
        for doc in documents:
            doc.metadata["document_id"] = document_id
            doc.metadata["indexed_at"] = datetime.now().isoformat()

        # 3. åˆ›å»ºç´¢å¼•
        index = VectorStoreIndex.from_documents(
            documents,
            vector_store=self.vector_store
        )

        return {
            "document_id": document_id,
            "chunks_indexed": len(documents)
        }

    async def query_documents(
        self,
        query: str,
        filters: dict = None,
        top_k: int = 5
    ):
        """
        æŸ¥è¯¢æ–‡æ¡£
        """
        # åˆ›å»ºæŸ¥è¯¢å¼•æ“
        index = VectorStoreIndex.from_vector_store(self.vector_store)

        query_engine = index.as_query_engine(
            similarity_top_k=top_k,
            filters=self._build_metadata_filters(filters)
        )

        # æ‰§è¡ŒæŸ¥è¯¢
        response = await query_engine.aquery(query)

        return {
            "answer": response.response,
            "source_nodes": [
                {
                    "content": node.node.text,
                    "score": node.score,
                    "metadata": node.node.metadata
                }
                for node in response.source_nodes
            ]
        }

    async def generate_with_context(
        self,
        query: str,
        context_documents: list[str]
    ):
        """
        åŸºäºä¸Šä¸‹æ–‡ç”Ÿæˆå†…å®¹
        """
        # 1. æ„å»ºæç¤ºè¯
        prompt = self._build_generation_prompt(query, context_documents)

        # 2. è°ƒç”¨LLM
        response = await Settings.llm.acomplete(prompt)

        return response.text
```

**æ··åˆæ£€ç´¢å®ç°**
```python
from llama_index.core import VectorStoreIndex
from llama_index.core.retrievers import VectorIndexRetriever
from llama_index.core.query_engine import RetrieverQueryEngine
from llama_index.core.postprocessor import SimilarityPostprocessor

class HybridRetriever:
    def __init__(self, vector_store):
        self.index = VectorStoreIndex.from_vector_store(vector_store)

    async def retrieve(
        self,
        query: str,
        filters: dict = None,
        similarity_cutoff: float = 0.7,
        top_k: int = 10
    ):
        """
        æ··åˆæ£€ç´¢ï¼šå‘é‡æ£€ç´¢ + åå¤„ç†
        """
        # 1. å‘é‡æ£€ç´¢
        retriever = VectorIndexRetriever(
            index=self.index,
            similarity_top_k=top_k,
            filters=filters
        )

        # 2. ç›¸ä¼¼åº¦è¿‡æ»¤
        postprocessor = SimilarityPostprocessor(
            similarity_cutoff=similarity_cutoff
        )

        # 3. æŸ¥è¯¢å¼•æ“
        query_engine = RetrieverQueryEngine(
            retriever=retriever,
            node_postprocessors=[postprocessor]
        )

        # 4. æ‰§è¡ŒæŸ¥è¯¢
        response = await query_engine.aquery(query)

        return response.source_nodes
```

**RAGå·¥ä½œæµ**
```python
class BidContentGenerator:
    """
    æ ‡ä¹¦å†…å®¹ç”Ÿæˆå™¨ - ä½¿ç”¨RAG
    """
    def __init__(self):
        self.llama_service = LlamaIndexService()
        self.llm = Settings.llm

    async def generate_section(
        self,
        section_type: str,
        requirements: list[str],
        project_context: dict
    ) -> str:
        """
        ç”Ÿæˆæ ‡ä¹¦ç« èŠ‚å†…å®¹
        """
        # 1. æ£€ç´¢ç›¸å…³æ¡ˆä¾‹
        similar_cases = await self._retrieve_similar_cases(
            requirements,
            top_k=5
        )

        # 2. æ£€ç´¢ä¼ä¸šèƒ½åŠ›
        capabilities = await self._retrieve_capabilities(
            requirements,
            top_k=10
        )

        # 3. æ„å»ºä¸Šä¸‹æ–‡
        context = self._build_context(
            similar_cases=similar_cases,
            capabilities=capabilities,
            project_context=project_context
        )

        # 4. ç”Ÿæˆå†…å®¹
        prompt = self._build_generation_prompt(
            section_type=section_type,
            requirements=requirements,
            context=context
        )

        response = await self.llm.acomplete(prompt)

        return response.text

    async def _retrieve_similar_cases(
        self,
        requirements: list[str],
        top_k: int = 5
    ):
        """
        æ£€ç´¢ç›¸ä¼¼æ¡ˆä¾‹
        """
        # åˆå¹¶éœ€æ±‚ä¸ºæŸ¥è¯¢
        query = " ".join(requirements)

        # æŸ¥è¯¢æ¡ˆä¾‹åº“
        results = await self.llama_service.query_documents(
            query=query,
            filters={"index_name": "project_cases"},
            top_k=top_k
        )

        return results["source_nodes"]

    async def _retrieve_capabilities(
        self,
        requirements: list[str],
        top_k: int = 10
    ):
        """
        æ£€ç´¢ä¼ä¸šèƒ½åŠ›
        """
        query = " ".join(requirements)

        results = await self.llama_service.query_documents(
            query=query,
            filters={"index_name": "enterprise_capabilities"},
            top_k=top_k
        )

        return results["source_nodes"]

    def _build_generation_prompt(
        self,
        section_type: str,
        requirements: list[str],
        context: dict
    ) -> str:
        """
        æ„å»ºç”Ÿæˆæç¤ºè¯
        """
        prompt = f"""
ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„æ ‡ä¹¦æ’°å†™ä¸“å®¶ã€‚è¯·æ ¹æ®ä»¥ä¸‹ä¿¡æ¯æ’°å†™æ ‡ä¹¦çš„{section_type}éƒ¨åˆ†ã€‚

## éœ€æ±‚åˆ†æ
{chr(10).join(f"- {req}" for req in requirements)}

## ç›¸å…³æ¡ˆä¾‹
{self._format_cases(context['similar_cases'])}

## ä¼ä¸šèƒ½åŠ›
{self._format_capabilities(context['capabilities'])}

## é¡¹ç›®èƒŒæ™¯
- é¡¹ç›®åç§°: {context['project_context']['name']}
- é¢„ç®—: {context['project_context']['budget']}ä¸‡å…ƒ
- å·¥æœŸ: {context['project_context']['duration']}ä¸ªæœˆ

è¯·æ’°å†™ä¸“ä¸šã€è¯¦å®çš„{section_type}å†…å®¹ï¼Œçªå‡ºæˆ‘ä»¬çš„ä¼˜åŠ¿å’Œç»éªŒã€‚
"""
        return prompt
```

---

## ğŸ“Š æŠ€æœ¯æ ˆè°ƒæ•´æ€»ç»“

### å®Œæ•´æ¶æ„å¯¹æ¯”

| ç»´åº¦ | åŸæ–¹æ¡ˆ | æ–°æ–¹æ¡ˆ | ä¼˜åŠ¿ |
|------|--------|--------|------|
| **å‘é‡æ£€ç´¢** | Pinecone | Elasticsearch 8.x | ç»Ÿä¸€æŠ€æœ¯æ ˆï¼Œé™ä½æˆæœ¬ |
| **çŸ¥è¯†ç®¡ç†** | Neo4j | Elasticsearch (åµŒå¥—æ–‡æ¡£) | ç®€åŒ–è¿ç»´ï¼Œæ··åˆæ£€ç´¢ |
| **åç«¯æ¡†æ¶** | FastAPI (Python) | Spring Boot + FastAPI | ä¼ä¸šçº§èƒ½åŠ› + AIçµæ´»æ€§ |
| **å‰ç«¯UI** | Material UI 5 | Ant Design Pro | ä¼ä¸šçº§ç»„ä»¶ï¼Œå¼€ç®±å³ç”¨ |
| **AIæ¡†æ¶** | LangChain + LangGraph | LlamaIndex | RAGä¸“æ³¨ï¼Œä»£ç ç®€æ´ |

### æ–°æ¶æ„ä¼˜åŠ¿

```yaml
ç»Ÿä¸€æ€§:
  - æœç´¢å’Œå‘é‡æ£€ç´¢ç»Ÿä¸€åœ¨Elasticsearch
  - å‡å°‘æŠ€æœ¯æ ˆå¤æ‚åº¦
  - è¿ç»´æˆæœ¬é™ä½40%

ä¼ä¸šçº§:
  - Spring Bootæˆç†Ÿç¨³å®š
  - Ant Design Proä¼ä¸šçº§UI
  - ç¬¦åˆä¼ä¸šå¼€å‘ä¹ æƒ¯

çµæ´»æ€§:
  - Pythonå¤„ç†AI
  - Javaå¤„ç†ä¸šåŠ¡
  - å„å¸å…¶èŒ

æˆæœ¬:
  - æ— éœ€Pineconeè®¢é˜…
  - æ— éœ€Neo4jè®¸å¯è¯
  - æœåŠ¡å™¨æˆæœ¬é™ä½30%
```

### éƒ¨ç½²æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         å‰ç«¯ (React + Ant Design Pro) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â–¼            â–¼             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  Spring BootæœåŠ¡  â”‚  â”‚ Python AIæœåŠ¡ â”‚  â”‚
â”‚   (Java)         â”‚â—„â”€â”¤  (FastAPI)   â”‚  â”‚
â”‚                  â”‚  â”‚              â”‚  â”‚
â”‚  - ä¸šåŠ¡é€»è¾‘      â”‚  â”‚  - LLMè°ƒç”¨   â”‚  â”‚
â”‚  - CRUD          â”‚  â”‚  - RAG       â”‚  â”‚
â”‚  - æƒé™          â”‚  â”‚  - å‘é‡åŒ–    â”‚  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
         â”‚                   â”‚          â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤          â”‚
         â–¼                   â–¼          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PostgreSQL  â”‚   â”‚  Elasticsearch     â”‚
â”‚  (ä¸šåŠ¡æ•°æ®)   â”‚   â”‚  - å‘é‡æ£€ç´¢        â”‚
â”‚             â”‚   â”‚  - å…¨æ–‡æœç´¢        â”‚
â”‚             â”‚   â”‚  - å…³ç³»å»ºæ¨¡        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Redis     â”‚
â”‚   (ç¼“å­˜)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**ä¸‹ä¸€æ­¥**: æˆ‘å¯ä»¥å¸®ä½ æ›´æ–°æ‰€æœ‰æ¶æ„æ–‡æ¡£å’Œå¼€å‘è®¡åˆ’ï¼Œåæ˜ è¿™äº›æŠ€æœ¯æ ˆè°ƒæ•´ã€‚æ˜¯å¦éœ€è¦æˆ‘ï¼š

1. æ›´æ–°æ¶æ„è®¾è®¡æ–‡æ¡£ï¼ˆåæ˜ æ–°æŠ€æœ¯æ ˆï¼‰
2. æ›´æ–°å¼€å‘è®¡åˆ’ï¼ˆè°ƒæ•´ä»»åŠ¡å’Œå·¥æ—¶ï¼‰
3. åˆ›å»ºSpring Booté¡¹ç›®è¯¦ç»†è®¾è®¡
4. åˆ›å»ºElasticsearchç´¢å¼•è®¾è®¡æ–‡æ¡£

è¯·å‘Šè¯‰æˆ‘ä½ çš„é€‰æ‹©ï¼
