# AIæ ‡ä¹¦æ™ºèƒ½åˆ›ä½œå¹³å° - å¼€å‘ç¯å¢ƒé…ç½®æŒ‡å— - ğŸ”§ åç«¯å¼€å‘ç¯å¢ƒé…ç½®

### Pythonç¯å¢ƒæ­å»º
```bash
# åˆ›å»ºPythonè™šæ‹Ÿç¯å¢ƒ
python -m venv aibidcomposer-backend
source aibidcomposer-backend/bin/activate

# å‡çº§pip
pip install --upgrade pip

# å®‰è£…é¡¹ç›®ä¾èµ–
pip install -r requirements.txt

# å®‰è£…å¼€å‘å·¥å…·
pip install black isort flake8 mypy pytest pytest-cov pre-commit

# é…ç½®pre-commité’©å­
pre-commit install
```

### requirements.txt - Pythonä¾èµ–é…ç½®
```python
# Webæ¡†æ¶
fastapi==0.104.1
uvicorn[standard]==0.24.0.post1
python-multipart==0.0.6
pydantic==2.5.0
python-jose[cryptography]==3.3.0
passlib[bcrypt]==1.7.4

# æ•°æ®åº“
sqlalchemy==2.0.23
asyncpg==0.29.0
alembic==1.12.1
redis==5.0.1
psycopg2-binary==2.9.7
asyncpg-binary==0.29.0

# AIå’Œæœºå™¨å­¦ä¹ 
openai==1.3.7
langchain==0.1.0
sentence-transformers==2.2.2
pinecone-client==2.2.4
numpy==1.26.0
pandas==2.1.4
scikit-learn==1.3.2

# HTTPå®¢æˆ·ç«¯
httpx==0.25.2
requests==2.31.0
aiohttp==3.9.1

# æ•°æ®éªŒè¯
pydantic-settings==2.1.0
email-validator==2.0.0

# èº«ä»½è®¤è¯
python-jose[cryptography]==3.3.0
python-multipart==0.0.6
passlib[bcrypt]==1.7.4

# å¼‚æ­¥ä»»åŠ¡
celery==5.3.4
kombu==5.3.4
redis==5.0.1

# æ–‡æ¡£ç”Ÿæˆ
jinja2==3.1.2
python-docx==0.8.11
openpyxl==3.1.2

# æµ‹è¯•
pytest==7.4.3
pytest-asyncio==0.21.1
pytest-cov==4.1.0
httpx==0.25.2
pytest-mock==3.12.0

# å¼€å‘å·¥å…·
black==23.11.0
isort==5.12.0
flake8==6.1.0
mypy==1.7.1
pre-commit==3.6.0

# å®‰å…¨
cryptography==41.0.8
python-jose[cryptography]==3.3.0
bcrypt==4.1.2

# ç›‘æ§å’Œæ—¥å¿—
structlog==23.2.0
sentry-sdk[fastapi]==1.28.0
prometheus-client==0.19.0
```

### åº”ç”¨é…ç½®
```python
# .env - ç¯å¢ƒå˜é‡é…ç½®
# æ•°æ®åº“é…ç½®
DATABASE_URL=postgresql+asyncpg://aibidcomposer:password@localhost:5432/aibidcomposer
REDIS_URL=redis://localhost:6379/0

# AIæœåŠ¡é…ç½®
OPENAI_API_KEY=your-openai-api-key-here
OPENAI_MODEL=gpt-4
OPENAI_TEMPERATURE=0.7
OPENAI_MAX_TOKENS=2000

# æ™ºè°±AIé…ç½®
ZHIPUAI_API_KEY=your-zhipu-api-key-here
ZHIPUAI_MODEL=chatglm3-6b

# Pineconeé…ç½®
PINECONE_API_KEY=your-pinecone-api-key-here
PINECONE_ENVIRONMENT=us-west1-gcp
PINECONE_INDEX=aibidcomposer-index

# JWTé…ç½®
SECRET_KEY=your-secret-key-here
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=30
REFRESH_TOKEN_EXPIRE_DAYS=7

# åº”ç”¨é…ç½®
DEBUG=True
ENVIRONMENT=development
API_V1_STR=/api/v1
PROJECT_NAME=AIæ ‡ä¹¦æ™ºèƒ½åˆ›ä½œå¹³å°

# æ–‡ä»¶å­˜å‚¨é…ç½®
MINIO_ENDPOINT=localhost:9000
MINIO_ACCESS_KEY=minioadmin
MINIO_SECRET_KEY=minioadmin
MINIO_BUCKET_NAME=aibidcomposer-files

# é‚®ä»¶é…ç½®
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USERNAME=your-email@gmail.com
SMTP_PASSWORD=your-app-password
EMAILS_FROM_EMAIL=noreply@aibidcomposer.com
EMAILS_FROM_NAME=AIæ ‡ä¹¦æ™ºèƒ½åˆ›ä½œå¹³å°

# å®‰å…¨é…ç½®
CORS_ORIGINS=http://localhost:3000,http://localhost:8000
ALLOWED_HOSTS=localhost,127.0.0.1
ALLOWED_CREDENTIALS_FROM_ORIGINS=http://localhost:3000
```

### åº”ç”¨å¯åŠ¨é…ç½®
```python
# main.py - åº”ç”¨å…¥å£æ–‡ä»¶
from fastapi import FastAPI, Request
from fastapi.middleware.cors import CORSMiddleware
from fastapi.middleware.trustedhost import TrustedHostMiddleware
from fastapi.exceptions import RequestValidationError
from starlette.exceptions import HTTPException
from contextlib import asynccontextmanager

import os
import logging
import uvicorn

# å¯¼å…¥åº”ç”¨æ¨¡å—
from app.core.config import settings
from app.core.database import engine
from app.core.exceptions import setup_exception_handlers
from app.core.middleware import setup_middleware
from app.api.v1.api import api_router
from app.core.events import startup_event, shutdown_event

# é…ç½®æ—¥å¿—
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    handlers=[
        logging.FileHandler('logs/app.log'),
        logging.StreamHandler()
    ]
)

# åˆ›å»ºFastAPIåº”ç”¨
app = FastAPI(
    title=settings.PROJECT_NAME,
    description=settings.PROJECT_DESCRIPTION,
    version=settings.VERSION,
    debug=settings.DEBUG,
    openapi_url=f"{settings.API_V1_STR}/openapi.json"
)

# è®¾ç½®å¼‚å¸¸å¤„ç†
setup_exception_handlers(app)

# è®¾ç½®ä¸­é—´ä»¶
setup_middleware(app)

# è®¾ç½®CORS
app.add_middleware(
    CORSMiddleware,
    allow_origins=settings.CORS_ORIGINS,
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

# è®¾ç½®ä¿¡ä»»ä¸»æœº
app.add_middleware(
    TrustedHostMiddleware,
    allowed_hosts=settings.ALLOWED_HOSTS
)

# æ³¨å†ŒAPIè·¯ç”±
app.include_router(api_router, prefix=settings.API_V1_STR)

# æ³¨å†Œäº‹ä»¶å¤„ç†
app.add_event_handler("startup", startup_event)
app.add_event_handler("shutdown", shutdown_event)

# å¥åº·æ£€æŸ¥ç«¯ç‚¹
@app.get("/health")
async def health_check():
    return {
        "status": "healthy",
        "service": settings.PROJECT_NAME,
        "version": settings.VERSION,
        "environment": settings.ENVIRONMENT,
        "database": "connected" if await check_database() else "disconnected",
        "redis": "connected" if await check_redis() else "disconnected"
    }

# æ•°æ®åº“è¿æ¥æ£€æŸ¥
async def check_database():
    try:
        async with engine.begin() as conn:
            await conn.execute("SELECT 1")
        return True
    except Exception as e:
        logging.error(f"Database connection failed: {e}")
        return False

# Redisè¿æ¥æ£€æŸ¥
async def check_redis():
    try:
        import redis
        r = redis.Redis(
            host=settings.REDIS_HOST,
            port=settings.REDIS_PORT,
            db=settings.REDIS_DB,
            password=settings.REDIS_PASSWORD
        )
        await r.ping()
        return True
    except Exception as e:
        logging.error(f"Redis connection failed: {e}")
        return False

# ç”Ÿäº§ç¯å¢ƒå¯åŠ¨é…ç½®
if __name__ == "__main__":
    uvicorn.run(
        "app:main",
        host="0.0.0.0",
        port=8000,
        reload=settings.DEBUG,
        log_level="info",
        access_log=True,
        workers=4,
        limit_concurrency=1000,
        timeout_keep_alive=65,
        max_requests=1000,
        max_request_size=50 * 1024 * 1024,  # 50MB
    )
```
