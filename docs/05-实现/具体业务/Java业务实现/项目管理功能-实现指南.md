# Java Spring Boot - JAVA-002 Part1 (ç»„ç»‡ç®¡ç†: æ•°æ®+å‰ç«¯)

**æ–‡æ¡£ç±»å‹**: å®æ–½æ–‡æ¡£
**éœ€æ±‚ç¼–å·**: REQ-JAVA-002 (2.1.1-2.1.2)
**åˆ›å»ºæ—¥æœŸ**: 2025-11-27
**åˆ›å»ºè€…**: claude-sonnet-4-5
**æœ€åæ›´æ–°**: 2025-11-27
**æ›´æ–°è€…**: claude-sonnet-4-5
**çŠ¶æ€**: å¾…å¼€å§‹

---

## ä¿®æ”¹å†å²

| æ—¥æœŸ | ç‰ˆæœ¬ | ä¿®æ”¹è€… | ä¿®æ”¹å†…å®¹æ¦‚è¦ |
|------|------|--------|-------------|
| 2025-11-27 15:10 | 3.0 | claude-sonnet-4-5 | å°†è¶…é•¿JAVA-002æ–‡æ¡£(10051è¡Œ)æ‹†åˆ†æˆ5ä¸ªå­æ–‡æ¡£ |
| 2025-11-27 14:50 | 2.0 | claude-sonnet-4-5 | ä» task-plan-java-è¯¦ç»†.md æ‹†åˆ†å‡º JAVA-002 æ¨¡å— |
| 2025-11-26 | 1.0 | claude-sonnet-4-5 | åˆ›å»ºJavaæœåŠ¡è¯¦ç»†ä»»åŠ¡è®¡åˆ’ |

---

## ğŸ“‘ æ–‡æ¡£å¯¼èˆª

**è¿”å›ç´¢å¼•**: [JAVA-002-INDEX.md](./task-plan-java-è¯¦ç»†-JAVA-002-INDEX.md)
**å…¶ä»–éƒ¨åˆ†**: [Part2](./task-plan-java-è¯¦ç»†-JAVA-002-Part2.md) | [Part3](./task-plan-java-è¯¦ç»†-JAVA-002-Part3.md) | [Part4](./task-plan-java-è¯¦ç»†-JAVA-002-Part4.md) | [Part5](./task-plan-java-è¯¦ç»†-JAVA-002-Part5.md)

---

## JAVA-002: ç»„ç»‡å’Œé¡¹ç›®ç®¡ç†æ¨¡å—

**éœ€æ±‚ç¼–å·**: REQ-JAVA-002
**è´Ÿè´£äºº**: Java åç«¯å¼€å‘
**å¼€å§‹æ—¶é—´**: YYYY-MM-DD
**é¢„è®¡å®Œæˆ**: YYYY-MM-DD
**å®é™…å®Œæˆ**: -
**å½“å‰çŠ¶æ€**: â¸ï¸ å¾…å¼€å§‹
**å®Œæˆè¿›åº¦**: 0% (0/5 å­ä»»åŠ¡)
**é¢„ä¼°å·¥æ—¶**: 22äººå¤©

### æ¨¡å—æ¦‚è¿°

ç»„ç»‡å’Œé¡¹ç›®ç®¡ç†æ¨¡å—æ˜¯å¹³å°çš„æ ¸å¿ƒä¸šåŠ¡æ¨¡å—ï¼Œè´Ÿè´£ç®¡ç†ä¼ä¸šç»„ç»‡ç»“æ„ã€é¡¹ç›®ä¿¡æ¯å’Œæ‹›æ ‡é¡¹ç›®ã€‚æœ¬æ¨¡å—æä¾›å®Œæ•´çš„ç»„ç»‡å±‚çº§ç®¡ç†ã€é¡¹ç›®ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€é¡¹ç›®æˆå‘˜åä½œç­‰åŠŸèƒ½ã€‚

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
- ç»„ç»‡ç®¡ç†ï¼šç»„ç»‡åˆ›å»ºã€ç¼–è¾‘ã€æˆå‘˜ç®¡ç†ã€ç»„ç»‡è®¾ç½®
- é¡¹ç›®ç®¡ç†ï¼šé¡¹ç›®åˆ›å»ºã€çŠ¶æ€è·Ÿè¸ªã€é‡Œç¨‹ç¢‘ç®¡ç†ã€é¡¹ç›®å½’æ¡£
- æ‹›æ ‡é¡¹ç›®ç®¡ç†ï¼šæ‹›æ ‡æ–‡ä»¶å…³è”ã€æŠ•æ ‡è¿›åº¦è·Ÿè¸ªã€ä¸­æ ‡ç®¡ç†
- é¡¹ç›®åä½œï¼šæˆå‘˜æƒé™åˆ†é…ã€æ´»åŠ¨æ—¥å¿—ã€é€šçŸ¥æœºåˆ¶

**æŠ€æœ¯è¦ç‚¹**ï¼š
- ä½¿ç”¨ Spring Data JPA å®ç°æ•°æ®è®¿é—®
- ç»„ç»‡å±‚çº§ä½¿ç”¨è‡ªå…³è”è®¾è®¡ï¼ˆparent_idï¼‰
- é¡¹ç›®çŠ¶æ€æœºç®¡ç†ï¼ˆçŠ¶æ€æµè½¬æ§åˆ¶ï¼‰
- åŸºäºè§’è‰²çš„é¡¹ç›®æˆå‘˜æƒé™ï¼ˆproject_membersè¡¨ï¼‰
- è½¯åˆ é™¤è®¾è®¡ï¼ˆdeleted_atå­—æ®µï¼‰
- å®¡è®¡æ—¥å¿—è‡ªåŠ¨è®°å½•ï¼ˆcreated_at, updated_atè§¦å‘å™¨ï¼‰

**å­ä»»åŠ¡æ¸…å•**ï¼š
1. ç»„ç»‡ç®¡ç†åŠŸèƒ½ï¼ˆ5äººå¤©ï¼‰
2. é¡¹ç›®ç®¡ç†åŠŸèƒ½ï¼ˆ6äººå¤©ï¼‰
3. æ‹›æ ‡é¡¹ç›®ç®¡ç†ï¼ˆ5äººå¤©ï¼‰
4. é¡¹ç›®åä½œï¼ˆ3äººå¤©ï¼‰
5. æ•°æ®åº“è®¾è®¡ï¼ˆ3äººå¤©ï¼‰

---

---

### 2.2: é¡¹ç›®ç®¡ç†åŠŸèƒ½

**å·¥æ—¶ä¼°ç®—**: 6äººå¤©
**ä¼˜å…ˆçº§**: P1 - é«˜ä¼˜å…ˆçº§
**ä¾èµ–**: Task 2.1ï¼ˆç»„ç»‡ç®¡ç†åŠŸèƒ½ï¼‰
**å®Œæˆè¿›åº¦**: 0% (0/5 ç±»åˆ«)

#### åŠŸèƒ½æè¿°

é¡¹ç›®ç®¡ç†åŠŸèƒ½æä¾›æŠ•æ ‡é¡¹ç›®çš„å…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†èƒ½åŠ›ï¼ŒåŒ…æ‹¬é¡¹ç›®ä¿¡æ¯ç»´æŠ¤ã€é¡¹ç›®çŠ¶æ€è·Ÿè¸ªã€é‡Œç¨‹ç¢‘ç®¡ç†ã€é¡¹ç›®å½’æ¡£ç­‰ã€‚æ¯ä¸ªé¡¹ç›®éš¶å±äºä¸€ä¸ªç»„ç»‡ï¼Œæ”¯æŒé¡¹ç›®æˆå‘˜åä½œå’Œæƒé™æ§åˆ¶ã€‚

**æ ¸å¿ƒåŠŸèƒ½ç‚¹**ï¼š
- é¡¹ç›®ä¿¡æ¯CRUDï¼ˆåˆ›å»ºã€æŸ¥è¯¢ã€æ›´æ–°ã€åˆ é™¤ã€å½’æ¡£ï¼‰
- é¡¹ç›®çŠ¶æ€ç®¡ç†ï¼ˆè‰ç¨¿ã€è¿›è¡Œä¸­ã€å®¡æ ¸ã€å·²æäº¤ã€ä¸­æ ‡ã€è½æ ‡ã€å·²å½’æ¡£ï¼‰
- é¡¹ç›®æˆå‘˜ç®¡ç†ï¼ˆæ·»åŠ æˆå‘˜ã€ç§»é™¤æˆå‘˜ã€è§’è‰²åˆ†é…ï¼‰
- é¡¹ç›®é‡Œç¨‹ç¢‘ç®¡ç†ï¼ˆå…³é”®èŠ‚ç‚¹è·Ÿè¸ªï¼‰
- é¡¹ç›®ç»Ÿè®¡åˆ†æï¼ˆé¢„ç®—ã€ä¸­æ ‡ç‡ã€é¡¹ç›®æ•°é‡ç­‰ï¼‰

**ä¸šåŠ¡è§„åˆ™**ï¼š
- é¡¹ç›®å¿…é¡»å…³è”åˆ°ä¸€ä¸ªç»„ç»‡
- é¡¹ç›®ç¼–å·å…¨å±€å”¯ä¸€ï¼Œè‡ªåŠ¨ç”Ÿæˆ
- é¡¹ç›®çŠ¶æ€æœ‰æ˜ç¡®çš„æµè½¬è§„åˆ™ï¼ˆçŠ¶æ€æœºï¼‰
- åˆ é™¤é¡¹ç›®æ—¶æ£€æŸ¥æ˜¯å¦æœ‰å…³è”æ–‡æ¡£ï¼ˆè½¯åˆ é™¤ï¼‰
- é¡¹ç›®å½’æ¡£åä¸èƒ½å†ç¼–è¾‘

#### 2.2.1: æ•°æ®å®šä¹‰

**éªŒè¯æ¸…å•**:
- [ ] Project å®ä½“ç±»è®¾è®¡å®Œæˆ
- [ ] ProjectMember å®ä½“ç±»è®¾è®¡å®Œæˆ
- [ ] ProjectMilestone å®ä½“ç±»è®¾è®¡å®Œæˆ
- [ ] DTO ç±»è®¾è®¡å®Œæˆï¼ˆCreateProjectDTO, UpdateProjectDTO, ProjectResponseDTO, ProjectSimpleDTOï¼‰
- [ ] æšä¸¾ç±»è®¾è®¡å®Œæˆï¼ˆProjectStatus, ProjectPriority, MemberRoleï¼‰
- [ ] æ•°æ®è¡¨å­—æ®µç¬¦åˆæ•°æ®åº“è®¾è®¡æ–‡æ¡£
- [ ] å®ä½“å…³ç³»æ˜ å°„æ­£ç¡®
- [ ] è½¯åˆ é™¤å­—æ®µé…ç½®å®Œæˆ
- [ ] å®¡è®¡å­—æ®µé…ç½®å®Œæˆ

##### Project å®ä½“ç±»

```java
package com.aibidcomposer.entity;

import jakarta.persistence.*;
import lombok.*;
import org.hibernate.annotations.SQLDelete;
import org.hibernate.annotations.Where;
import org.springframework.data.annotation.CreatedDate;
import org.springframework.data.annotation.LastModifiedDate;
import org.springframework.data.jpa.domain.support.AuditingEntityListener;

import java.math.BigDecimal;
import java.time.LocalDate;
import java.time.LocalDateTime;
import java.util.HashSet;
import java.util.Set;
import java.util.UUID;

/**
 * é¡¹ç›®å®ä½“
 * éœ€æ±‚ç¼–å·: REQ-JAVA-002
 *
 * æŠ•æ ‡é¡¹ç›®ç®¡ç†ï¼ŒåŒ…æ‹¬é¡¹ç›®ä¿¡æ¯ã€çŠ¶æ€è·Ÿè¸ªã€æˆå‘˜ç®¡ç†
 * è½¯åˆ é™¤è®¾è®¡ï¼Œä½¿ç”¨ deleted_at å­—æ®µ
 */
@Entity
@Table(name = "projects")
@Getter
@Setter
@NoArgsConstructor
@AllArgsConstructor
@Builder
@EntityListeners(AuditingEntityListener.class)
@SQLDelete(sql = "UPDATE projects SET deleted_at = CURRENT_TIMESTAMP WHERE id = ?")
@Where(clause = "deleted_at IS NULL")
public class Project {

    @Id
    @GeneratedValue(strategy = GenerationType.UUID)
    @Column(name = "id", updatable = false, nullable = false)
    private UUID id;

    /**
     * é¡¹ç›®åç§°ï¼ˆå¿…å¡«ï¼Œæœ€å¤§200å­—ç¬¦ï¼‰
     */
    @Column(name = "name", nullable = false, length = 200)
    private String name;

    /**
     * é¡¹ç›®ç¼–å·ï¼ˆå”¯ä¸€ï¼Œæœ€å¤§50å­—ç¬¦ï¼‰
     * è‡ªåŠ¨ç”Ÿæˆï¼Œæ ¼å¼ï¼šPRJ-YYYYMMDD-åºå·
     */
    @Column(name = "code", unique = true, nullable = false, length = 50)
    private String code;

    /**
     * é¡¹ç›®æè¿°
     */
    @Column(name = "description", columnDefinition = "TEXT")
    private String description;

    /**
     * æ‰€å±ç»„ç»‡IDï¼ˆå¿…å¡«ï¼‰
     */
    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "organization_id", nullable = false)
    private Organization organization;

    /**
     * æ‹›æ ‡ç±»å‹
     * government - æ”¿åºœé‡‡è´­
     * enterprise - ä¼ä¸šé‡‡è´­
     * international - å›½é™…æ‹›æ ‡
     * other - å…¶ä»–
     */
    @Column(name = "bidding_type", length = 50)
    @Enumerated(EnumType.STRING)
    private BiddingType biddingType;

    /**
     * æ‰€å±è¡Œä¸š
     */
    @Column(name = "industry", length = 100)
    private String industry;

    /**
     * é¡¹ç›®é¢„ç®—é‡‘é¢
     */
    @Column(name = "budget_amount", precision = 15, scale = 2)
    private BigDecimal budgetAmount;

    /**
     * è´§å¸å•ä½ï¼ˆé»˜è®¤CNYï¼‰
     */
    @Column(name = "currency", length = 10)
    @Builder.Default
    private String currency = "CNY";

    /**
     * é¡¹ç›®å¼€å§‹æ—¥æœŸ
     */
    @Column(name = "start_date")
    private LocalDate startDate;

    /**
     * é¡¹ç›®ç»“æŸæ—¥æœŸ
     */
    @Column(name = "end_date")
    private LocalDate endDate;

    /**
     * æŠ•æ ‡æˆªæ­¢æ—¶é—´
     */
    @Column(name = "submission_deadline")
    private LocalDateTime submissionDeadline;

    /**
     * é¡¹ç›®çŠ¶æ€
     * draft - è‰ç¨¿
     * in_progress - è¿›è¡Œä¸­
     * review - å®¡æ ¸ä¸­
     * submitted - å·²æäº¤
     * won - ä¸­æ ‡
     * lost - è½æ ‡
     * archived - å·²å½’æ¡£
     */
    @Column(name = "status", length = 20, nullable = false)
    @Enumerated(EnumType.STRING)
    @Builder.Default
    private ProjectStatus status = ProjectStatus.DRAFT;

    /**
     * é¡¹ç›®ä¼˜å…ˆçº§
     * low - ä½
     * medium - ä¸­
     * high - é«˜
     * urgent - ç´§æ€¥
     */
    @Column(name = "priority", length = 20)
    @Enumerated(EnumType.STRING)
    @Builder.Default
    private ProjectPriority priority = ProjectPriority.MEDIUM;

    /**
     * ä¸­æ ‡æ¦‚ç‡ï¼ˆ0-100ï¼‰
     */
    @Column(name = "win_probability")
    private Integer winProbability;

    /**
     * é¡¹ç›®æ ‡ç­¾ï¼ˆæ•°ç»„ï¼‰
     */
    @Column(name = "tags", columnDefinition = "text[]")
    private String[] tags;

    /**
     * é¡¹ç›®è®¾ç½®ï¼ˆJSONBæ ¼å¼ï¼‰
     * å­˜å‚¨é¡¹ç›®é…ç½®å‚æ•°ç­‰
     */
    @Column(name = "settings", columnDefinition = "jsonb DEFAULT '{}'::jsonb")
    private String settings;

    /**
     * å…ƒæ•°æ®ï¼ˆJSONBæ ¼å¼ï¼‰
     * å­˜å‚¨æ‰©å±•ä¿¡æ¯
     */
    @Column(name = "metadata", columnDefinition = "jsonb DEFAULT '{}'::jsonb")
    private String metadata;

    /**
     * é¡¹ç›®æˆå‘˜åˆ—è¡¨
     */
    @OneToMany(mappedBy = "project", cascade = CascadeType.ALL, orphanRemoval = true)
    @Builder.Default
    private Set<ProjectMember> members = new HashSet<>();

    /**
     * é¡¹ç›®é‡Œç¨‹ç¢‘åˆ—è¡¨
     */
    @OneToMany(mappedBy = "project", cascade = CascadeType.ALL, orphanRemoval = true)
    @Builder.Default
    private Set<ProjectMilestone> milestones = new HashSet<>();

    /**
     * åˆ›å»ºäººID
     */
    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "created_by", nullable = false, updatable = false)
    private User createdBy;

    /**
     * æ›´æ–°äººID
     */
    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "updated_by")
    private User updatedBy;

    /**
     * åˆ›å»ºæ—¶é—´ï¼ˆè‡ªåŠ¨å¡«å……ï¼‰
     */
    @CreatedDate
    @Column(name = "created_at", nullable = false, updatable = false)
    private LocalDateTime createdAt;

    /**
     * æ›´æ–°æ—¶é—´ï¼ˆè‡ªåŠ¨æ›´æ–°ï¼‰
     */
    @LastModifiedDate
    @Column(name = "updated_at", nullable = false)
    private LocalDateTime updatedAt;

    /**
     * è½¯åˆ é™¤æ—¶é—´
     */
    @Column(name = "deleted_at")
    private LocalDateTime deletedAt;

    // ==================== ä¸šåŠ¡æ–¹æ³• ====================

    /**
     * æ·»åŠ é¡¹ç›®æˆå‘˜
     */
    public void addMember(ProjectMember member) {
        members.add(member);
        member.setProject(this);
    }

    /**
     * ç§»é™¤é¡¹ç›®æˆå‘˜
     */
    public void removeMember(ProjectMember member) {
        members.remove(member);
        member.setProject(null);
    }

    /**
     * æ·»åŠ é‡Œç¨‹ç¢‘
     */
    public void addMilestone(ProjectMilestone milestone) {
        milestones.add(milestone);
        milestone.setProject(this);
    }

    /**
     * ç§»é™¤é‡Œç¨‹ç¢‘
     */
    public void removeMilestone(ProjectMilestone milestone) {
        milestones.remove(milestone);
        milestone.setProject(null);
    }

    /**
     * æ£€æŸ¥é¡¹ç›®æ˜¯å¦å¯ç¼–è¾‘
     */
    public boolean isEditable() {
        return status != ProjectStatus.ARCHIVED && status != ProjectStatus.SUBMITTED;
    }

    /**
     * æ£€æŸ¥é¡¹ç›®çŠ¶æ€æ˜¯å¦å…è®¸æµè½¬åˆ°ç›®æ ‡çŠ¶æ€
     */
    public boolean canTransitionTo(ProjectStatus targetStatus) {
        if (this.status == targetStatus) {
            return false;
        }

        // çŠ¶æ€æµè½¬è§„åˆ™
        return switch (this.status) {
            case DRAFT -> targetStatus == ProjectStatus.IN_PROGRESS;
            case IN_PROGRESS -> targetStatus == ProjectStatus.REVIEW ||
                               targetStatus == ProjectStatus.DRAFT;
            case REVIEW -> targetStatus == ProjectStatus.SUBMITTED ||
                          targetStatus == ProjectStatus.IN_PROGRESS;
            case SUBMITTED -> targetStatus == ProjectStatus.WON ||
                             targetStatus == ProjectStatus.LOST;
            case WON, LOST -> targetStatus == ProjectStatus.ARCHIVED;
            case ARCHIVED -> false;
        };
    }

    /**
     * æ›´æ–°é¡¹ç›®çŠ¶æ€
     */
    public void updateStatus(ProjectStatus newStatus) {
        if (!canTransitionTo(newStatus)) {
            throw new IllegalStateException(
                String.format("æ— æ³•ä»çŠ¶æ€ %s æµè½¬åˆ° %s", this.status, newStatus)
            );
        }
        this.status = newStatus;
    }

    /**
     * è®¡ç®—é¡¹ç›®è¿›åº¦ç™¾åˆ†æ¯”ï¼ˆ0-100ï¼‰
     */
    public int calculateProgress() {
        if (milestones.isEmpty()) {
            return 0;
        }

        long completedCount = milestones.stream()
            .filter(ProjectMilestone::isCompleted)
            .count();

        return (int) ((completedCount * 100) / milestones.size());
    }
}

/**
 * æ‹›æ ‡ç±»å‹æšä¸¾
 */
enum BiddingType {
    GOVERNMENT,      // æ”¿åºœé‡‡è´­
    ENTERPRISE,      // ä¼ä¸šé‡‡è´­
    INTERNATIONAL,   // å›½é™…æ‹›æ ‡
    OTHER            // å…¶ä»–
}

/**
 * é¡¹ç›®çŠ¶æ€æšä¸¾
 */
enum ProjectStatus {
    DRAFT,          // è‰ç¨¿
    IN_PROGRESS,    // è¿›è¡Œä¸­
    REVIEW,         // å®¡æ ¸ä¸­
    SUBMITTED,      // å·²æäº¤
    WON,            // ä¸­æ ‡
    LOST,           // è½æ ‡
    ARCHIVED        // å·²å½’æ¡£
}

/**
 * é¡¹ç›®ä¼˜å…ˆçº§æšä¸¾
 */
enum ProjectPriority {
    LOW,            // ä½
    MEDIUM,         // ä¸­
    HIGH,           // é«˜
    URGENT          // ç´§æ€¥
}
```

##### ProjectMember å®ä½“ç±»

```java
package com.aibidcomposer.entity;

import jakarta.persistence.*;
import lombok.*;
import org.springframework.data.annotation.CreatedDate;
import org.springframework.data.jpa.domain.support.AuditingEntityListener;

import java.time.LocalDateTime;
import java.util.UUID;

/**
 * é¡¹ç›®æˆå‘˜å®ä½“
 * éœ€æ±‚ç¼–å·: REQ-JAVA-002
 *
 * ç®¡ç†é¡¹ç›®æˆå‘˜åŠå…¶è§’è‰²æƒé™
 */
@Entity
@Table(name = "project_members", uniqueConstraints = {
    @UniqueConstraint(columnNames = {"project_id", "user_id"})
})
@Getter
@Setter
@NoArgsConstructor
@AllArgsConstructor
@Builder
@EntityListeners(AuditingEntityListener.class)
public class ProjectMember {

    @Id
    @GeneratedValue(strategy = GenerationType.UUID)
    @Column(name = "id", updatable = false, nullable = false)
    private UUID id;

    /**
     * æ‰€å±é¡¹ç›®
     */
    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "project_id", nullable = false)
    private Project project;

    /**
     * ç”¨æˆ·
     */
    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "user_id", nullable = false)
    private User user;

    /**
     * é¡¹ç›®è§’è‰²
     * owner - é¡¹ç›®æ‰€æœ‰è€…
     * manager - é¡¹ç›®ç»ç†
     * member - æ™®é€šæˆå‘˜
     * viewer - åªè¯»æŸ¥çœ‹è€…
     */
    @Column(name = "role", length = 50, nullable = false)
    @Enumerated(EnumType.STRING)
    @Builder.Default
    private MemberRole role = MemberRole.MEMBER;

    /**
     * é¢å¤–æƒé™ï¼ˆæ•°ç»„ï¼‰
     * é™¤è§’è‰²é»˜è®¤æƒé™å¤–çš„é¢å¤–æƒé™
     */
    @Column(name = "permissions", columnDefinition = "text[]")
    private String[] permissions;

    /**
     * åŠ å…¥æ—¶é—´
     */
    @Column(name = "joined_at", nullable = false)
    private LocalDateTime joinedAt;

    /**
     * åˆ›å»ºäºº
     */
    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "created_by")
    private User createdBy;

    /**
     * åˆ›å»ºæ—¶é—´ï¼ˆè‡ªåŠ¨å¡«å……ï¼‰
     */
    @CreatedDate
    @Column(name = "created_at", nullable = false, updatable = false)
    private LocalDateTime createdAt;

    // ==================== ä¸šåŠ¡æ–¹æ³• ====================

    /**
     * æ£€æŸ¥æ˜¯å¦æœ‰æŒ‡å®šæƒé™
     */
    public boolean hasPermission(String permission) {
        // å…ˆæ£€æŸ¥è§’è‰²é»˜è®¤æƒé™
        if (role.hasPermission(permission)) {
            return true;
        }

        // å†æ£€æŸ¥é¢å¤–æƒé™
        if (permissions != null) {
            for (String perm : permissions) {
                if (perm.equals(permission) || perm.equals("*")) {
                    return true;
                }
            }
        }

        return false;
    }

    /**
     * æ£€æŸ¥æ˜¯å¦ä¸ºé¡¹ç›®æ‰€æœ‰è€…
     */
    public boolean isOwner() {
        return role == MemberRole.OWNER;
    }

    /**
     * æ£€æŸ¥æ˜¯å¦ä¸ºé¡¹ç›®ç®¡ç†å‘˜
     */
    public boolean isManager() {
        return role == MemberRole.MANAGER || role == MemberRole.OWNER;
    }
}

/**
 * é¡¹ç›®æˆå‘˜è§’è‰²æšä¸¾
 */
enum MemberRole {
    OWNER("é¡¹ç›®æ‰€æœ‰è€…", new String[]{"*"}),
    MANAGER("é¡¹ç›®ç»ç†", new String[]{
        "project:read", "project:update", "project:delete",
        "member:read", "member:create", "member:delete",
        "document:read", "document:create", "document:update", "document:delete"
    }),
    MEMBER("æ™®é€šæˆå‘˜", new String[]{
        "project:read",
        "member:read",
        "document:read", "document:create", "document:update"
    }),
    VIEWER("åªè¯»æŸ¥çœ‹è€…", new String[]{
        "project:read",
        "member:read",
        "document:read"
    });

    private final String displayName;
    private final String[] defaultPermissions;

    MemberRole(String displayName, String[] defaultPermissions) {
        this.displayName = displayName;
        this.defaultPermissions = defaultPermissions;
    }

    public String getDisplayName() {
        return displayName;
    }

    public String[] getDefaultPermissions() {
        return defaultPermissions;
    }

    /**
     * æ£€æŸ¥è§’è‰²æ˜¯å¦æœ‰æŒ‡å®šæƒé™
     */
    public boolean hasPermission(String permission) {
        for (String perm : defaultPermissions) {
            if (perm.equals(permission) || perm.equals("*")) {
                return true;
            }
        }
        return false;
    }
}
```

##### ProjectMilestone å®ä½“ç±»

```java
package com.aibidcomposer.entity;

import jakarta.persistence.*;
import lombok.*;
import org.springframework.data.annotation.CreatedDate;
import org.springframework.data.annotation.LastModifiedDate;
import org.springframework.data.jpa.domain.support.AuditingEntityListener;

import java.time.LocalDate;
import java.time.LocalDateTime;
import java.util.UUID;

/**
 * é¡¹ç›®é‡Œç¨‹ç¢‘å®ä½“
 * éœ€æ±‚ç¼–å·: REQ-JAVA-002
 *
 * ç®¡ç†é¡¹ç›®å…³é”®èŠ‚ç‚¹å’Œè¿›åº¦è·Ÿè¸ª
 */
@Entity
@Table(name = "project_milestones")
@Getter
@Setter
@NoArgsConstructor
@AllArgsConstructor
@Builder
@EntityListeners(AuditingEntityListener.class)
public class ProjectMilestone {

    @Id
    @GeneratedValue(strategy = GenerationType.UUID)
    @Column(name = "id", updatable = false, nullable = false)
    private UUID id;

    /**
     * æ‰€å±é¡¹ç›®
     */
    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "project_id", nullable = false)
    private Project project;

    /**
     * é‡Œç¨‹ç¢‘åç§°
     */
    @Column(name = "name", nullable = false, length = 200)
    private String name;

    /**
     * é‡Œç¨‹ç¢‘æè¿°
     */
    @Column(name = "description", columnDefinition = "TEXT")
    private String description;

    /**
     * è®¡åˆ’å¼€å§‹æ—¥æœŸ
     */
    @Column(name = "planned_start_date")
    private LocalDate plannedStartDate;

    /**
     * è®¡åˆ’å®Œæˆæ—¥æœŸ
     */
    @Column(name = "planned_end_date")
    private LocalDate plannedEndDate;

    /**
     * å®é™…å¼€å§‹æ—¥æœŸ
     */
    @Column(name = "actual_start_date")
    private LocalDate actualStartDate;

    /**
     * å®é™…å®Œæˆæ—¥æœŸ
     */
    @Column(name = "actual_end_date")
    private LocalDate actualEndDate;

    /**
     * é‡Œç¨‹ç¢‘çŠ¶æ€
     * pending - å¾…å¼€å§‹
     * in_progress - è¿›è¡Œä¸­
     * completed - å·²å®Œæˆ
     * overdue - å·²é€¾æœŸ
     */
    @Column(name = "status", length = 20, nullable = false)
    @Enumerated(EnumType.STRING)
    @Builder.Default
    private MilestoneStatus status = MilestoneStatus.PENDING;

    /**
     * æƒé‡ï¼ˆç”¨äºè®¡ç®—é¡¹ç›®è¿›åº¦ï¼Œæ€»å’Œä¸º100ï¼‰
     */
    @Column(name = "weight")
    @Builder.Default
    private Integer weight = 10;

    /**
     * æ’åºé¡ºåº
     */
    @Column(name = "order_index", nullable = false)
    private Integer orderIndex;

    /**
     * åˆ›å»ºæ—¶é—´ï¼ˆè‡ªåŠ¨å¡«å……ï¼‰
     */
    @CreatedDate
    @Column(name = "created_at", nullable = false, updatable = false)
    private LocalDateTime createdAt;

    /**
     * æ›´æ–°æ—¶é—´ï¼ˆè‡ªåŠ¨æ›´æ–°ï¼‰
     */
    @LastModifiedDate
    @Column(name = "updated_at", nullable = false)
    private LocalDateTime updatedAt;

    // ==================== ä¸šåŠ¡æ–¹æ³• ====================

    /**
     * æ£€æŸ¥é‡Œç¨‹ç¢‘æ˜¯å¦å·²å®Œæˆ
     */
    public boolean isCompleted() {
        return status == MilestoneStatus.COMPLETED;
    }

    /**
     * æ£€æŸ¥é‡Œç¨‹ç¢‘æ˜¯å¦é€¾æœŸ
     */
    public boolean isOverdue() {
        if (isCompleted()) {
            return false;
        }

        LocalDate today = LocalDate.now();
        return plannedEndDate != null && today.isAfter(plannedEndDate);
    }

    /**
     * æ ‡è®°ä¸ºå·²å®Œæˆ
     */
    public void markAsCompleted() {
        this.status = MilestoneStatus.COMPLETED;
        this.actualEndDate = LocalDate.now();
    }

    /**
     * å¼€å§‹é‡Œç¨‹ç¢‘
     */
    public void start() {
        this.status = MilestoneStatus.IN_PROGRESS;
        this.actualStartDate = LocalDate.now();
    }
}

/**
 * é‡Œç¨‹ç¢‘çŠ¶æ€æšä¸¾
 */
enum MilestoneStatus {
    PENDING,        // å¾…å¼€å§‹
    IN_PROGRESS,    // è¿›è¡Œä¸­
    COMPLETED,      // å·²å®Œæˆ
    OVERDUE         // å·²é€¾æœŸ
}
```

##### DTO ç±»å®šä¹‰

```java
package com.aibidcomposer.dto.project;

import jakarta.validation.constraints.*;
import lombok.Data;

import java.math.BigDecimal;
import java.time.LocalDate;
import java.time.LocalDateTime;
import java.util.UUID;

/**
 * åˆ›å»ºé¡¹ç›® DTO
 * éœ€æ±‚ç¼–å·: REQ-JAVA-002
 */
@Data
public class CreateProjectDTO {

    @NotBlank(message = "é¡¹ç›®åç§°ä¸èƒ½ä¸ºç©º")
    @Size(max = 200, message = "é¡¹ç›®åç§°æœ€å¤š200å­—ç¬¦")
    private String name;

    @Size(max = 2000, message = "é¡¹ç›®æè¿°æœ€å¤š2000å­—ç¬¦")
    private String description;

    @NotNull(message = "ç»„ç»‡IDä¸èƒ½ä¸ºç©º")
    private UUID organizationId;

    private String biddingType;  // GOVERNMENT, ENTERPRISE, INTERNATIONAL, OTHER

    @Size(max = 100, message = "è¡Œä¸šæœ€å¤š100å­—ç¬¦")
    private String industry;

    @DecimalMin(value = "0.0", message = "é¢„ç®—é‡‘é¢ä¸èƒ½ä¸ºè´Ÿæ•°")
    private BigDecimal budgetAmount;

    @Size(max = 10, message = "è´§å¸å•ä½æœ€å¤š10å­—ç¬¦")
    private String currency;

    private LocalDate startDate;

    private LocalDate endDate;

    private LocalDateTime submissionDeadline;

    private String priority;  // LOW, MEDIUM, HIGH, URGENT

    @Min(value = 0, message = "ä¸­æ ‡æ¦‚ç‡æœ€å°ä¸º0")
    @Max(value = 100, message = "ä¸­æ ‡æ¦‚ç‡æœ€å¤§ä¸º100")
    private Integer winProbability;

    private String[] tags;
}

/**
 * æ›´æ–°é¡¹ç›® DTO
 * éœ€æ±‚ç¼–å·: REQ-JAVA-002
 */
@Data
public class UpdateProjectDTO {

    @Size(max = 200, message = "é¡¹ç›®åç§°æœ€å¤š200å­—ç¬¦")
    private String name;

    @Size(max = 2000, message = "é¡¹ç›®æè¿°æœ€å¤š2000å­—ç¬¦")
    private String description;

    private String biddingType;

    @Size(max = 100, message = "è¡Œä¸šæœ€å¤š100å­—ç¬¦")
    private String industry;

    @DecimalMin(value = "0.0", message = "é¢„ç®—é‡‘é¢ä¸èƒ½ä¸ºè´Ÿæ•°")
    private BigDecimal budgetAmount;

    private LocalDate startDate;

    private LocalDate endDate;

    private LocalDateTime submissionDeadline;

    private String status;  // DRAFT, IN_PROGRESS, REVIEW, SUBMITTED, WON, LOST, ARCHIVED

    private String priority;

    @Min(value = 0, message = "ä¸­æ ‡æ¦‚ç‡æœ€å°ä¸º0")
    @Max(value = 100, message = "ä¸­æ ‡æ¦‚ç‡æœ€å¤§ä¸º100")
    private Integer winProbability;

    private String[] tags;
}

/**
 * é¡¹ç›®å“åº” DTO
 * éœ€æ±‚ç¼–å·: REQ-JAVA-002
 */
@Data
public class ProjectResponseDTO {

    private UUID id;
    private String name;
    private String code;
    private String description;

    // ç»„ç»‡ä¿¡æ¯
    private UUID organizationId;
    private String organizationName;

    private String biddingType;
    private String industry;
    private BigDecimal budgetAmount;
    private String currency;

    private LocalDate startDate;
    private LocalDate endDate;
    private LocalDateTime submissionDeadline;

    private String status;
    private String priority;
    private Integer winProbability;

    private String[] tags;

    // ç»Ÿè®¡ä¿¡æ¯
    private Integer memberCount;
    private Integer milestoneCount;
    private Integer documentCount;
    private Integer progress;  // 0-100

    // åˆ›å»ºå’Œæ›´æ–°ä¿¡æ¯
    private UUID createdBy;
    private String createdByName;
    private LocalDateTime createdAt;

    private UUID updatedBy;
    private String updatedByName;
    private LocalDateTime updatedAt;

    /**
     * ä»å®ä½“è½¬æ¢ä¸ºDTO
     */
    public static ProjectResponseDTO from(Project project) {
        ProjectResponseDTO dto = new ProjectResponseDTO();
        dto.setId(project.getId());
        dto.setName(project.getName());
        dto.setCode(project.getCode());
        dto.setDescription(project.getDescription());

        if (project.getOrganization() != null) {
            dto.setOrganizationId(project.getOrganization().getId());
            dto.setOrganizationName(project.getOrganization().getName());
        }

        dto.setBiddingType(project.getBiddingType() != null ?
            project.getBiddingType().name() : null);
        dto.setIndustry(project.getIndustry());
        dto.setBudgetAmount(project.getBudgetAmount());
        dto.setCurrency(project.getCurrency());

        dto.setStartDate(project.getStartDate());
        dto.setEndDate(project.getEndDate());
        dto.setSubmissionDeadline(project.getSubmissionDeadline());

        dto.setStatus(project.getStatus().name());
        dto.setPriority(project.getPriority() != null ?
            project.getPriority().name() : null);
        dto.setWinProbability(project.getWinProbability());

        dto.setTags(project.getTags());

        // ç»Ÿè®¡ä¿¡æ¯
        dto.setMemberCount(project.getMembers().size());
        dto.setMilestoneCount(project.getMilestones().size());
        dto.setProgress(project.calculateProgress());

        // åˆ›å»ºå’Œæ›´æ–°ä¿¡æ¯
        if (project.getCreatedBy() != null) {
            dto.setCreatedBy(project.getCreatedBy().getId());
            dto.setCreatedByName(project.getCreatedBy().getFullName());
        }
        dto.setCreatedAt(project.getCreatedAt());

        if (project.getUpdatedBy() != null) {
            dto.setUpdatedBy(project.getUpdatedBy().getId());
            dto.setUpdatedByName(project.getUpdatedBy().getFullName());
        }
        dto.setUpdatedAt(project.getUpdatedAt());

        return dto;
    }
}

/**
 * é¡¹ç›®ç®€è¦ä¿¡æ¯ DTOï¼ˆåˆ—è¡¨å±•ç¤ºï¼‰
 * éœ€æ±‚ç¼–å·: REQ-JAVA-002
 */
@Data
public class ProjectSimpleDTO {

    private UUID id;
    private String name;
    private String code;
    private String organizationName;
    private String status;
    private String priority;
    private Integer winProbability;
    private BigDecimal budgetAmount;
    private String currency;
    private LocalDateTime submissionDeadline;
    private Integer progress;
    private LocalDateTime createdAt;

    public static ProjectSimpleDTO from(Project project) {
        ProjectSimpleDTO dto = new ProjectSimpleDTO();
        dto.setId(project.getId());
        dto.setName(project.getName());
        dto.setCode(project.getCode());
        dto.setOrganizationName(project.getOrganization() != null ?
            project.getOrganization().getName() : null);
        dto.setStatus(project.getStatus().name());
        dto.setPriority(project.getPriority() != null ?
            project.getPriority().name() : null);
        dto.setWinProbability(project.getWinProbability());
        dto.setBudgetAmount(project.getBudgetAmount());
        dto.setCurrency(project.getCurrency());
        dto.setSubmissionDeadline(project.getSubmissionDeadline());
        dto.setProgress(project.calculateProgress());
        dto.setCreatedAt(project.getCreatedAt());
        return dto;
    }
}

/**
 * æ·»åŠ é¡¹ç›®æˆå‘˜ DTO
 * éœ€æ±‚ç¼–å·: REQ-JAVA-002
 */
@Data
public class AddProjectMemberDTO {

    @NotNull(message = "ç”¨æˆ·IDä¸èƒ½ä¸ºç©º")
    private UUID userId;

    @NotBlank(message = "è§’è‰²ä¸èƒ½ä¸ºç©º")
    private String role;  // OWNER, MANAGER, MEMBER, VIEWER

    private String[] permissions;  // é¢å¤–æƒé™
}

/**
 * é¡¹ç›®æˆå‘˜å“åº” DTO
 * éœ€æ±‚ç¼–å·: REQ-JAVA-002
 */
@Data
public class ProjectMemberResponseDTO {

    private UUID id;

    // ç”¨æˆ·ä¿¡æ¯
    private UUID userId;
    private String username;
    private String fullName;
    private String email;
    private String avatarUrl;

    // è§’è‰²å’Œæƒé™
    private String role;
    private String roleDisplayName;
    private String[] permissions;

    private LocalDateTime joinedAt;
    private LocalDateTime createdAt;

    public static ProjectMemberResponseDTO from(ProjectMember member) {
        ProjectMemberResponseDTO dto = new ProjectMemberResponseDTO();
        dto.setId(member.getId());

        if (member.getUser() != null) {
            dto.setUserId(member.getUser().getId());
            dto.setUsername(member.getUser().getUsername());
            dto.setFullName(member.getUser().getFullName());
            dto.setEmail(member.getUser().getEmail());
            dto.setAvatarUrl(member.getUser().getAvatarUrl());
        }

        dto.setRole(member.getRole().name());
        dto.setRoleDisplayName(member.getRole().getDisplayName());
        dto.setPermissions(member.getPermissions());

        dto.setJoinedAt(member.getJoinedAt());
        dto.setCreatedAt(member.getCreatedAt());

        return dto;
    }
}
```

#### 2.2.2: å‰ç«¯

**éªŒè¯æ¸…å•**:
- [ ] é¡¹ç›®åˆ—è¡¨é¡µé¢ç»„ä»¶å®Œæˆ
- [ ] é¡¹ç›®åˆ›å»º/ç¼–è¾‘è¡¨å•å®Œæˆ
- [ ] é¡¹ç›®è¯¦æƒ…é¡µé¢å®Œæˆ
- [ ] é¡¹ç›®æˆå‘˜ç®¡ç†ç»„ä»¶å®Œæˆ
- [ ] é¡¹ç›®é‡Œç¨‹ç¢‘ç®¡ç†ç»„ä»¶å®Œæˆ
- [ ] API Service é›†æˆå®Œæˆ
- [ ] çŠ¶æ€ç®¡ç†é…ç½®å®Œæˆ
- [ ] è·¯ç”±é…ç½®å®Œæˆ

##### é¡¹ç›®åˆ—è¡¨é¡µé¢ (`ProjectList.tsx`)

```typescript
// apps/frontend/src/pages/project/ProjectList.tsx
// éœ€æ±‚ç¼–å·: REQ-JAVA-002
// æŠ€æœ¯é€‰å‹: ProTable + TanStack Query
import React, { useRef } from 'react';
import { ProTable, type ProColumns, type ActionType } from '@ant-design/pro-table';
import { Button, Tag, Space, Popconfirm, message } from 'antd';
import { PlusOutlined, EditOutlined, DeleteOutlined, EyeOutlined } from '@ant-design/icons';
import { useNavigate } from '@umijs/max';
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import { projectService, type ProjectSimpleDTO, type ProjectQueryParams } from '@/services/project.service';
import dayjs from 'dayjs';

/**
 * é¡¹ç›®åˆ—è¡¨é¡µé¢
 * éœ€æ±‚ç¼–å·: REQ-JAVA-002
 */
const ProjectList: React.FC = () => {
  const navigate = useNavigate();
  const queryClient = useQueryClient();
  const actionRef = useRef<ActionType>();

  // åˆ é™¤é¡¹ç›® Mutation
  const deleteProjectMutation = useMutation({
    mutationFn: (id: string) => projectService.deleteProject(id),
    onSuccess: () => {
      message.success('é¡¹ç›®åˆ é™¤æˆåŠŸ');
      actionRef.current?.reload();
    },
    onError: (error: any) => {
      message.error(error.message || 'åˆ é™¤å¤±è´¥');
    },
  });

  // é¡¹ç›®çŠ¶æ€é¢œè‰²æ˜ å°„
  const statusColorMap: Record<string, string> = {
    DRAFT: 'default',
    IN_PROGRESS: 'processing',
    REVIEW: 'warning',
    SUBMITTED: 'success',
    WON: 'success',
    LOST: 'error',
    ARCHIVED: 'default',
  };

  // é¡¹ç›®çŠ¶æ€æ–‡æœ¬æ˜ å°„
  const statusTextMap: Record<string, string> = {
    DRAFT: 'è‰ç¨¿',
    IN_PROGRESS: 'è¿›è¡Œä¸­',
    REVIEW: 'å®¡æ ¸ä¸­',
    SUBMITTED: 'å·²æäº¤',
    WON: 'ä¸­æ ‡',
    LOST: 'è½æ ‡',
    ARCHIVED: 'å·²å½’æ¡£',
  };

  // ä¼˜å…ˆçº§é¢œè‰²æ˜ å°„
  const priorityColorMap: Record<string, string> = {
    LOW: 'default',
    MEDIUM: 'blue',
    HIGH: 'orange',
    URGENT: 'red',
  };

  // åˆ—å®šä¹‰
  const columns: ProColumns<ProjectSimpleDTO>[] = [
    {
      title: 'é¡¹ç›®ç¼–å·',
      dataIndex: 'code',
      width: 140,
      fixed: 'left',
      copyable: true,
    },
    {
      title: 'é¡¹ç›®åç§°',
      dataIndex: 'name',
      width: 200,
      fixed: 'left',
      ellipsis: true,
      render: (_, record) => (
        <a onClick={() => navigate(`/projects/${record.id}`)}>
          {record.name}
        </a>
      ),
    },
    {
      title: 'æ‰€å±ç»„ç»‡',
      dataIndex: 'organizationName',
      width: 150,
      ellipsis: true,
      hideInSearch: true,
    },
    {
      title: 'çŠ¶æ€',
      dataIndex: 'status',
      width: 100,
      valueType: 'select',
      valueEnum: {
        DRAFT: { text: 'è‰ç¨¿', status: 'Default' },
        IN_PROGRESS: { text: 'è¿›è¡Œä¸­', status: 'Processing' },
        REVIEW: { text: 'å®¡æ ¸ä¸­', status: 'Warning' },
        SUBMITTED: { text: 'å·²æäº¤', status: 'Success' },
        WON: { text: 'ä¸­æ ‡', status: 'Success' },
        LOST: { text: 'è½æ ‡', status: 'Error' },
        ARCHIVED: { text: 'å·²å½’æ¡£', status: 'Default' },
      },
      render: (_, record) => (
        <Tag color={statusColorMap[record.status]}>
          {statusTextMap[record.status]}
        </Tag>
      ),
    },
    {
      title: 'ä¼˜å…ˆçº§',
      dataIndex: 'priority',
      width: 100,
      valueType: 'select',
      valueEnum: {
        LOW: { text: 'ä½', status: 'Default' },
        MEDIUM: { text: 'ä¸­', status: 'Processing' },
        HIGH: { text: 'é«˜', status: 'Warning' },
        URGENT: { text: 'ç´§æ€¥', status: 'Error' },
      },
      render: (_, record) => (
        <Tag color={priorityColorMap[record.priority || 'MEDIUM']}>
          {record.priority || 'MEDIUM'}
        </Tag>
      ),
    },
    {
      title: 'é¢„ç®—é‡‘é¢',
      dataIndex: 'budgetAmount',
      width: 120,
      hideInSearch: true,
      render: (_, record) => (
        record.budgetAmount
          ? `${record.budgetAmount.toLocaleString()} ${record.currency || 'CNY'}`
          : '-'
      ),
    },
    {
      title: 'ä¸­æ ‡æ¦‚ç‡',
      dataIndex: 'winProbability',
      width: 100,
      hideInSearch: true,
      render: (_, record) => (
        record.winProbability != null
          ? `${record.winProbability}%`
          : '-'
      ),
    },
    {
      title: 'è¿›åº¦',
      dataIndex: 'progress',
      width: 100,
      hideInSearch: true,
      render: (_, record) => `${record.progress || 0}%`,
    },
    {
      title: 'æŠ•æ ‡æˆªæ­¢',
      dataIndex: 'submissionDeadline',
      width: 160,
      valueType: 'dateTime',
      hideInSearch: true,
      render: (_, record) => (
        record.submissionDeadline
          ? dayjs(record.submissionDeadline).format('YYYY-MM-DD HH:mm')
          : '-'
      ),
    },
    {
      title: 'åˆ›å»ºæ—¶é—´',
      dataIndex: 'createdAt',
      width: 160,
      valueType: 'dateTime',
      hideInSearch: true,
      render: (_, record) => dayjs(record.createdAt).format('YYYY-MM-DD HH:mm'),
    },
    {
      title: 'æ“ä½œ',
      width: 180,
      fixed: 'right',
      hideInSearch: true,
      render: (_, record) => (
        <Space size="small">
          <Button
            type="link"
            size="small"
            icon={<EyeOutlined />}
            onClick={() => navigate(`/projects/${record.id}`)}
          >
            æŸ¥çœ‹
          </Button>
          <Button
            type="link"
            size="small"
            icon={<EditOutlined />}
            onClick={() => navigate(`/projects/${record.id}/edit`)}
          >
            ç¼–è¾‘
          </Button>
          <Popconfirm
            title="ç¡®å®šåˆ é™¤è¿™ä¸ªé¡¹ç›®å—ï¼Ÿ"
            description="åˆ é™¤åå¯ä»¥ä»å›æ”¶ç«™æ¢å¤"
            onConfirm={() => deleteProjectMutation.mutate(record.id)}
            okText="ç¡®å®š"
            cancelText="å–æ¶ˆ"
          >
            <Button
              type="link"
              size="small"
              danger
              icon={<DeleteOutlined />}
              loading={deleteProjectMutation.isPending}
            >
              åˆ é™¤
            </Button>
          </Popconfirm>
        </Space>
      ),
    },
  ];

  return (
    <ProTable<ProjectSimpleDTO>
      columns={columns}
      actionRef={actionRef}
      request={async (params, sort, filter) => {
        const queryParams: ProjectQueryParams = {
          page: params.current || 1,
          pageSize: params.pageSize || 20,
          status: params.status,
          priority: params.priority,
          search: params.keyword,
        };

        const response = await projectService.getProjects(queryParams);

        return {
          data: response.items,
          success: true,
          total: response.total,
        };
      }}
      rowKey="id"
      search={{
        labelWidth: 'auto',
      }}
      pagination={{
        defaultPageSize: 20,
        showSizeChanger: true,
        showQuickJumper: true,
      }}
      dateFormatter="string"
      headerTitle="é¡¹ç›®åˆ—è¡¨"
      toolBarRender={() => [
        <Button
          key="create"
          type="primary"
          icon={<PlusOutlined />}
          onClick={() => navigate('/projects/create')}
        >
          æ–°å»ºé¡¹ç›®
        </Button>,
      ]}
      scroll={{ x: 1500 }}
    />
  );
};

export default ProjectList;
```

##### é¡¹ç›®è¡¨å•ç»„ä»¶ (`ProjectForm.tsx`)

```typescript
// apps/frontend/src/pages/project/ProjectForm.tsx
// éœ€æ±‚ç¼–å·: REQ-JAVA-002
// æŠ€æœ¯é€‰å‹: ProForm
import React, { useEffect } from 'react';
import {
  ProForm,
  ProFormText,
  ProFormTextArea,
  ProFormSelect,
  ProFormDatePicker,
  ProFormDateTimePicker,
  ProFormDigit,
} from '@ant-design/pro-form';
import { Card, message } from 'antd';
import { useNavigate, useParams } from '@umijs/max';
import { useMutation, useQuery } from '@tanstack/react-query';
import {
  projectService,
  type CreateProjectDTO,
  type UpdateProjectDTO,
} from '@/services/project.service';
import { organizationService } from '@/services/organization.service';

/**
 * é¡¹ç›®åˆ›å»º/ç¼–è¾‘è¡¨å•
 * éœ€æ±‚ç¼–å·: REQ-JAVA-002
 */
const ProjectForm: React.FC = () => {
  const navigate = useNavigate();
  const { id } = useParams<{ id: string }>();
  const isEdit = !!id;

  const [form] = ProForm.useForm();

  // è·å–é¡¹ç›®è¯¦æƒ…ï¼ˆç¼–è¾‘æ¨¡å¼ï¼‰
  const { data: project, isLoading: projectLoading } = useQuery({
    queryKey: ['project', id],
    queryFn: () => projectService.getProjectById(id!),
    enabled: isEdit,
  });

  // è·å–ç»„ç»‡åˆ—è¡¨
  const { data: organizations } = useQuery({
    queryKey: ['organizations', 'all'],
    queryFn: () => organizationService.getOrganizations({ page: 1, pageSize: 1000 }),
  });

  // åˆ›å»ºé¡¹ç›® Mutation
  const createMutation = useMutation({
    mutationFn: (data: CreateProjectDTO) => projectService.createProject(data),
    onSuccess: (response) => {
      message.success('é¡¹ç›®åˆ›å»ºæˆåŠŸ');
      navigate(`/projects/${response.id}`);
    },
    onError: (error: any) => {
      message.error(error.message || 'åˆ›å»ºå¤±è´¥');
    },
  });

  // æ›´æ–°é¡¹ç›® Mutation
  const updateMutation = useMutation({
    mutationFn: (data: UpdateProjectDTO) => projectService.updateProject(id!, data),
    onSuccess: () => {
      message.success('é¡¹ç›®æ›´æ–°æˆåŠŸ');
      navigate(`/projects/${id}`);
    },
    onError: (error: any) => {
      message.error(error.message || 'æ›´æ–°å¤±è´¥');
    },
  });

  // ç¼–è¾‘æ¨¡å¼ï¼šå›å¡«è¡¨å•æ•°æ®
  useEffect(() => {
    if (isEdit && project) {
      form.setFieldsValue({
        name: project.name,
        description: project.description,
        organizationId: project.organizationId,
        biddingType: project.biddingType,
        industry: project.industry,
        budgetAmount: project.budgetAmount,
        currency: project.currency,
        startDate: project.startDate,
        endDate: project.endDate,
        submissionDeadline: project.submissionDeadline,
        priority: project.priority,
        winProbability: project.winProbability,
        tags: project.tags,
      });
    }
  }, [project, form, isEdit]);

  return (
    <Card title={isEdit ? 'ç¼–è¾‘é¡¹ç›®' : 'æ–°å»ºé¡¹ç›®'} loading={projectLoading}>
      <ProForm
        form={form}
        onFinish={async (values) => {
          if (isEdit) {
            await updateMutation.mutateAsync(values as UpdateProjectDTO);
          } else {
            await createMutation.mutateAsync(values as CreateProjectDTO);
          }
          return true;
        }}
        submitter={{
          searchConfig: {
            resetText: 'å–æ¶ˆ',
            submitText: isEdit ? 'æ›´æ–°' : 'åˆ›å»º',
          },
          resetButtonProps: {
            onClick: () => navigate(-1),
          },
          submitButtonProps: {
            loading: createMutation.isPending || updateMutation.isPending,
          },
        }}
        layout="vertical"
      >
        <ProForm.Group>
          <ProFormText
            name="name"
            label="é¡¹ç›®åç§°"
            width="lg"
            placeholder="è¯·è¾“å…¥é¡¹ç›®åç§°"
            rules={[
              { required: true, message: 'è¯·è¾“å…¥é¡¹ç›®åç§°' },
              { max: 200, message: 'é¡¹ç›®åç§°æœ€å¤š200å­—ç¬¦' },
            ]}
          />

          <ProFormSelect
            name="organizationId"
            label="æ‰€å±ç»„ç»‡"
            width="md"
            showSearch
            placeholder="è¯·é€‰æ‹©ç»„ç»‡"
            rules={[{ required: true, message: 'è¯·é€‰æ‹©ç»„ç»‡' }]}
            options={organizations?.items.map((org) => ({
              label: org.name,
              value: org.id,
            }))}
            disabled={isEdit}  // ç¼–è¾‘æ—¶ä¸å…è®¸æ›´æ”¹ç»„ç»‡
          />
        </ProForm.Group>

        <ProFormTextArea
          name="description"
          label="é¡¹ç›®æè¿°"
          placeholder="è¯·è¾“å…¥é¡¹ç›®æè¿°"
          fieldProps={{
            rows: 4,
            maxLength: 2000,
            showCount: true,
          }}
        />

        <ProForm.Group>
          <ProFormSelect
            name="biddingType"
            label="æ‹›æ ‡ç±»å‹"
            width="md"
            placeholder="è¯·é€‰æ‹©æ‹›æ ‡ç±»å‹"
            options={[
              { label: 'æ”¿åºœé‡‡è´­', value: 'GOVERNMENT' },
              { label: 'ä¼ä¸šé‡‡è´­', value: 'ENTERPRISE' },
              { label: 'å›½é™…æ‹›æ ‡', value: 'INTERNATIONAL' },
              { label: 'å…¶ä»–', value: 'OTHER' },
            ]}
          />

          <ProFormText
            name="industry"
            label="æ‰€å±è¡Œä¸š"
            width="md"
            placeholder="è¯·è¾“å…¥è¡Œä¸š"
          />
        </ProForm.Group>

        <ProForm.Group>
          <ProFormDigit
            name="budgetAmount"
            label="é¡¹ç›®é¢„ç®—"
            width="md"
            placeholder="è¯·è¾“å…¥é¢„ç®—é‡‘é¢"
            fieldProps={{
              precision: 2,
              min: 0,
              addonAfter: (
                <ProFormSelect
                  name="currency"
                  noStyle
                  initialValue="CNY"
                  options={[
                    { label: 'CNY', value: 'CNY' },
                    { label: 'USD', value: 'USD' },
                    { label: 'EUR', value: 'EUR' },
                  ]}
                />
              ),
            }}
          />

          <ProFormSelect
            name="priority"
            label="ä¼˜å…ˆçº§"
            width="sm"
            initialValue="MEDIUM"
            options={[
              { label: 'ä½', value: 'LOW' },
              { label: 'ä¸­', value: 'MEDIUM' },
              { label: 'é«˜', value: 'HIGH' },
              { label: 'ç´§æ€¥', value: 'URGENT' },
            ]}
          />

          <ProFormDigit
            name="winProbability"
            label="ä¸­æ ‡æ¦‚ç‡ï¼ˆ%ï¼‰"
            width="sm"
            placeholder="0-100"
            fieldProps={{
              min: 0,
              max: 100,
              precision: 0,
            }}
          />
        </ProForm.Group>

        <ProForm.Group>
          <ProFormDatePicker
            name="startDate"
            label="å¼€å§‹æ—¥æœŸ"
            width="md"
          />

          <ProFormDatePicker
            name="endDate"
            label="ç»“æŸæ—¥æœŸ"
            width="md"
          />

          <ProFormDateTimePicker
            name="submissionDeadline"
            label="æŠ•æ ‡æˆªæ­¢æ—¶é—´"
            width="md"
          />
        </ProForm.Group>
      </ProForm>
    </Card>
  );
};

export default ProjectForm;
```

##### é¡¹ç›®è¯¦æƒ…é¡µé¢ (`ProjectDetail.tsx`)

```typescript
// apps/frontend/src/pages/project/ProjectDetail.tsx
// éœ€æ±‚ç¼–å·: REQ-JAVA-002
import React from 'react';
import { Card, Descriptions, Tag, Button, Space, Tabs, Spin, message } from 'antd';
import { EditOutlined, DeleteOutlined } from '@ant-design/icons';
import { useNavigate, useParams } from '@umijs/max';
import { useQuery, useMutation } from '@tanstack/react-query';
import { projectService } from '@/services/project.service';
import ProjectMemberList from './components/ProjectMemberList';
import ProjectMilestoneList from './components/ProjectMilestoneList';
import dayjs from 'dayjs';

/**
 * é¡¹ç›®è¯¦æƒ…é¡µé¢
 * éœ€æ±‚ç¼–å·: REQ-JAVA-002
 */
const ProjectDetail: React.FC = () => {
  const navigate = useNavigate();
  const { id } = useParams<{ id: string }>();

  // è·å–é¡¹ç›®è¯¦æƒ…
  const { data: project, isLoading } = useQuery({
    queryKey: ['project', id],
    queryFn: () => projectService.getProjectById(id!),
  });

  if (isLoading) {
    return <Spin size="large" style={{ display: 'block', margin: '100px auto' }} />;
  }

  if (!project) {
    return <div>é¡¹ç›®ä¸å­˜åœ¨</div>;
  }

  const statusColorMap: Record<string, string> = {
    DRAFT: 'default',
    IN_PROGRESS: 'processing',
    REVIEW: 'warning',
    SUBMITTED: 'success',
    WON: 'success',
    LOST: 'error',
    ARCHIVED: 'default',
  };

  return (
    <div>
      <Card
        title={project.name}
        extra={
          <Space>
            <Button
              type="primary"
              icon={<EditOutlined />}
              onClick={() => navigate(`/projects/${id}/edit`)}
            >
              ç¼–è¾‘
            </Button>
            <Button danger icon={<DeleteOutlined />}>
              åˆ é™¤
            </Button>
          </Space>
        }
      >
        <Descriptions column={3} bordered>
          <Descriptions.Item label="é¡¹ç›®ç¼–å·">{project.code}</Descriptions.Item>
          <Descriptions.Item label="çŠ¶æ€">
            <Tag color={statusColorMap[project.status]}>{project.status}</Tag>
          </Descriptions.Item>
          <Descriptions.Item label="ä¼˜å…ˆçº§">
            <Tag>{project.priority}</Tag>
          </Descriptions.Item>

          <Descriptions.Item label="æ‰€å±ç»„ç»‡" span={2}>
            {project.organizationName}
          </Descriptions.Item>
          <Descriptions.Item label="è¿›åº¦">
            {project.progress}%
          </Descriptions.Item>

          <Descriptions.Item label="æ‹›æ ‡ç±»å‹">
            {project.biddingType || '-'}
          </Descriptions.Item>
          <Descriptions.Item label="æ‰€å±è¡Œä¸š">
            {project.industry || '-'}
          </Descriptions.Item>
          <Descriptions.Item label="ä¸­æ ‡æ¦‚ç‡">
            {project.winProbability != null ? `${project.winProbability}%` : '-'}
          </Descriptions.Item>

          <Descriptions.Item label="é¡¹ç›®é¢„ç®—" span={3}>
            {project.budgetAmount
              ? `${project.budgetAmount.toLocaleString()} ${project.currency}`
              : '-'}
          </Descriptions.Item>

          <Descriptions.Item label="å¼€å§‹æ—¥æœŸ">
            {project.startDate ? dayjs(project.startDate).format('YYYY-MM-DD') : '-'}
          </Descriptions.Item>
          <Descriptions.Item label="ç»“æŸæ—¥æœŸ">
            {project.endDate ? dayjs(project.endDate).format('YYYY-MM-DD') : '-'}
          </Descriptions.Item>
          <Descriptions.Item label="æŠ•æ ‡æˆªæ­¢">
            {project.submissionDeadline
              ? dayjs(project.submissionDeadline).format('YYYY-MM-DD HH:mm')
              : '-'}
          </Descriptions.Item>

          <Descriptions.Item label="é¡¹ç›®æè¿°" span={3}>
            {project.description || '-'}
          </Descriptions.Item>

          <Descriptions.Item label="åˆ›å»ºäºº">
            {project.createdByName}
          </Descriptions.Item>
          <Descriptions.Item label="åˆ›å»ºæ—¶é—´">
            {dayjs(project.createdAt).format('YYYY-MM-DD HH:mm')}
          </Descriptions.Item>
          <Descriptions.Item label="æ›´æ–°æ—¶é—´">
            {dayjs(project.updatedAt).format('YYYY-MM-DD HH:mm')}
          </Descriptions.Item>
        </Descriptions>
      </Card>

      <Card style={{ marginTop: 16 }}>
        <Tabs
          items={[
            {
              key: 'members',
              label: `é¡¹ç›®æˆå‘˜ (${project.memberCount})`,
              children: <ProjectMemberList projectId={id!} />,
            },
            {
              key: 'milestones',
              label: `é‡Œç¨‹ç¢‘ (${project.milestoneCount})`,
              children: <ProjectMilestoneList projectId={id!} />,
            },
            {
              key: 'documents',
              label: `æ–‡æ¡£ (${project.documentCount})`,
              children: <div>æ–‡æ¡£åˆ—è¡¨ï¼ˆå¾…å®ç°ï¼‰</div>,
            },
          ]}
        />
      </Card>
    </div>
  );
};

export default ProjectDetail;
```

##### API Service (`project.service.ts`)

```typescript
// apps/frontend/src/services/project.service.ts
// éœ€æ±‚ç¼–å·: REQ-JAVA-002
import axios from 'axios';

const API_BASE_URL = process.env.REACT_APP_API_BASE_URL || 'http://localhost:8080';

/**
 * é¡¹ç›®æŸ¥è¯¢å‚æ•°
 */
export interface ProjectQueryParams {
  page?: number;
  pageSize?: number;
  status?: string;
  priority?: string;
  organizationId?: string;
  search?: string;
  sortBy?: string;
  sortOrder?: 'asc' | 'desc';
}

/**
 * é¡¹ç›®ç®€è¦ä¿¡æ¯ DTO
 */
export interface ProjectSimpleDTO {
  id: string;
  name: string;
  code: string;
  organizationName: string;
  status: string;
  priority: string;
  winProbability: number;
  budgetAmount: number;
  currency: string;
  submissionDeadline: string;
  progress: number;
  createdAt: string;
}

/**
 * é¡¹ç›®å“åº” DTO
 */
export interface ProjectResponseDTO {
  id: string;
  name: string;
  code: string;
  description: string;
  organizationId: string;
  organizationName: string;
  biddingType: string;
  industry: string;
  budgetAmount: number;
  currency: string;
  startDate: string;
  endDate: string;
  submissionDeadline: string;
  status: string;
  priority: string;
  winProbability: number;
  tags: string[];
  memberCount: number;
  milestoneCount: number;
  documentCount: number;
  progress: number;
  createdBy: string;
  createdByName: string;
  createdAt: string;
  updatedBy: string;
  updatedByName: string;
  updatedAt: string;
}

/**
 * åˆ›å»ºé¡¹ç›® DTO
 */
export interface CreateProjectDTO {
  name: string;
  description?: string;
  organizationId: string;
  biddingType?: string;
  industry?: string;
  budgetAmount?: number;
  currency?: string;
  startDate?: string;
  endDate?: string;
  submissionDeadline?: string;
  priority?: string;
  winProbability?: number;
  tags?: string[];
}

/**
 * æ›´æ–°é¡¹ç›® DTO
 */
export interface UpdateProjectDTO {
  name?: string;
  description?: string;
  biddingType?: string;
  industry?: string;
  budgetAmount?: number;
  startDate?: string;
  endDate?: string;
  submissionDeadline?: string;
  status?: string;
  priority?: string;
  winProbability?: number;
  tags?: string[];
}

/**
 * åˆ†é¡µå“åº”
 */
export interface PaginatedResponse<T> {
  items: T[];
  total: number;
  page: number;
  pageSize: number;
  totalPages: number;
}

/**
 * é¡¹ç›®æœåŠ¡
 */
export const projectService = {
  /**
   * è·å–é¡¹ç›®åˆ—è¡¨ï¼ˆåˆ†é¡µï¼‰
   */
  async getProjects(params: ProjectQueryParams): Promise<PaginatedResponse<ProjectSimpleDTO>> {
    const response = await axios.get(`${API_BASE_URL}/api/v1/projects`, { params });
    return response.data.data;
  },

  /**
   * æ ¹æ®IDè·å–é¡¹ç›®è¯¦æƒ…
   */
  async getProjectById(id: string): Promise<ProjectResponseDTO> {
    const response = await axios.get(`${API_BASE_URL}/api/v1/projects/${id}`);
    return response.data.data;
  },

  /**
   * åˆ›å»ºé¡¹ç›®
   */
  async createProject(data: CreateProjectDTO): Promise<ProjectResponseDTO> {
    const response = await axios.post(`${API_BASE_URL}/api/v1/projects`, data);
    return response.data.data;
  },

  /**
   * æ›´æ–°é¡¹ç›®
   */
  async updateProject(id: string, data: UpdateProjectDTO): Promise<ProjectResponseDTO> {
    const response = await axios.put(`${API_BASE_URL}/api/v1/projects/${id}`, data);
    return response.data.data;
  },

  /**
   * åˆ é™¤é¡¹ç›®ï¼ˆè½¯åˆ é™¤ï¼‰
   */
  async deleteProject(id: string): Promise<void> {
    await axios.delete(`${API_BASE_URL}/api/v1/projects/${id}`);
  },

  /**
   * æ›´æ–°é¡¹ç›®çŠ¶æ€
   */
  async updateProjectStatus(id: string, status: string): Promise<void> {
    await axios.patch(`${API_BASE_URL}/api/v1/projects/${id}/status`, { status });
  },
};
```

---

### 2.2.3: Javaåç«¯

**éªŒè¯æ¸…å•**:
- [ ] ProjectRepository æ¥å£è®¾è®¡å®Œæˆ
- [ ] ProjectService ä¸šåŠ¡é€»è¾‘å®ç°å®Œæˆ
- [ ] ProjectController REST API å®ç°å®Œæˆ
- [ ] é¡¹ç›®çŠ¶æ€æµè½¬éªŒè¯é€»è¾‘å®Œæˆ
- [ ] é¡¹ç›®æˆå‘˜ç®¡ç†é€»è¾‘å®Œæˆ
- [ ] å•å…ƒæµ‹è¯•ç¼–å†™å®Œæˆï¼ˆè¦†ç›–ç‡ >80%ï¼‰
- [ ] é›†æˆæµ‹è¯•ç¼–å†™å®Œæˆ
- [ ] API æ–‡æ¡£ç”Ÿæˆå®Œæˆ

#### ProjectRepository æ¥å£

```java
package com.aibidcomposer.repository;

import com.aibidcomposer.entity.Project;
import com.aibidcomposer.entity.ProjectStatus;
import org.springframework.data.domain.Page;
import org.springframework.data.domain.Pageable;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.JpaSpecificationExecutor;
import org.springframework.data.jpa.repository.Query;
import org.springframework.data.repository.query.Param;
import org.springframework.stereotype.Repository;

import java.time.LocalDateTime;
import java.util.List;
import java.util.Optional;
import java.util.UUID;

/**
 * é¡¹ç›®æ•°æ®è®¿é—®æ¥å£
 * éœ€æ±‚ç¼–å·: REQ-JAVA-002-2.2
 */
@Repository
public interface ProjectRepository extends JpaRepository<Project, UUID>,
        JpaSpecificationExecutor<Project> {

    /**
     * æ ¹æ®é¡¹ç›®ç¼–å·æŸ¥è¯¢é¡¹ç›®
     */
    Optional<Project> findByCodeAndDeletedAtIsNull(String code);

    /**
     * æ ¹æ®ç»„ç»‡IDæŸ¥è¯¢é¡¹ç›®åˆ—è¡¨ï¼ˆåˆ†é¡µï¼‰
     */
    Page<Project> findByOrganizationIdAndDeletedAtIsNull(
            UUID organizationId,
            Pageable pageable
    );

    /**
     * æ ¹æ®ç»„ç»‡IDå’ŒçŠ¶æ€æŸ¥è¯¢é¡¹ç›®åˆ—è¡¨
     */
    Page<Project> findByOrganizationIdAndStatusAndDeletedAtIsNull(
            UUID organizationId,
            ProjectStatus status,
            Pageable pageable
    );

    /**
     * æ ¹æ®åˆ›å»ºäººæŸ¥è¯¢é¡¹ç›®åˆ—è¡¨
     */
    Page<Project> findByCreatedByIdAndDeletedAtIsNull(
            UUID createdById,
            Pageable pageable
    );

    /**
     * æŸ¥è¯¢å³å°†åˆ°æœŸçš„é¡¹ç›®ï¼ˆæäº¤æˆªæ­¢æ—¶é—´åœ¨æŒ‡å®šå¤©æ•°å†…ï¼‰
     */
    @Query("SELECT p FROM Project p WHERE p.deletedAt IS NULL " +
           "AND p.submissionDeadline BETWEEN :now AND :deadline " +
           "AND p.status IN :statuses")
    List<Project> findUpcomingProjects(
            @Param("now") LocalDateTime now,
            @Param("deadline") LocalDateTime deadline,
            @Param("statuses") List<ProjectStatus> statuses
    );

    /**
     * ç»Ÿè®¡ç»„ç»‡çš„é¡¹ç›®æ•°é‡ï¼ˆæŒ‰çŠ¶æ€ï¼‰
     */
    @Query("SELECT p.status, COUNT(p) FROM Project p " +
           "WHERE p.organizationId = :organizationId AND p.deletedAt IS NULL " +
           "GROUP BY p.status")
    List<Object[]> countProjectsByStatus(@Param("organizationId") UUID organizationId);

    /**
     * æ£€æŸ¥é¡¹ç›®ç¼–å·æ˜¯å¦å­˜åœ¨
     */
    boolean existsByCodeAndDeletedAtIsNull(String code);

    /**
     * æŸ¥è¯¢ç»„ç»‡çš„æ‰€æœ‰é¡¹ç›®ï¼ˆç”¨äºç»Ÿè®¡åˆ†æï¼‰
     */
    @Query("SELECT p FROM Project p WHERE p.organizationId = :organizationId " +
           "AND p.deletedAt IS NULL ORDER BY p.createdAt DESC")
    List<Project> findAllByOrganization(@Param("organizationId") UUID organizationId);
}
```

#### ProjectService ä¸šåŠ¡é€»è¾‘

```java
package com.aibidcomposer.service;

import com.aibidcomposer.dto.project.*;
import com.aibidcomposer.entity.*;
import com.aibidcomposer.exception.BusinessException;
import com.aibidcomposer.exception.ResourceNotFoundException;
import com.aibidcomposer.repository.OrganizationRepository;
import com.aibidcomposer.repository.ProjectRepository;
import com.aibidcomposer.repository.UserRepository;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.data.domain.Page;
import org.springframework.data.domain.Pageable;
import org.springframework.data.jpa.domain.Specification;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;
import org.springframework.util.StringUtils;

import java.time.LocalDateTime;
import java.util.List;
import java.util.UUID;

/**
 * é¡¹ç›®ç®¡ç†æœåŠ¡
 * éœ€æ±‚ç¼–å·: REQ-JAVA-002-2.2
 */
@Service
@RequiredArgsConstructor
@Slf4j
@Transactional
public class ProjectService {

    private final ProjectRepository projectRepository;
    private final OrganizationRepository organizationRepository;
    private final UserRepository userRepository;

    /**
     * åˆ›å»ºé¡¹ç›®
     */
    public ProjectResponseDTO createProject(CreateProjectDTO dto, UUID currentUserId) {
        log.info("åˆ›å»ºé¡¹ç›®, organizationId: {}, name: {}", dto.getOrganizationId(), dto.getName());

        // éªŒè¯ç»„ç»‡æ˜¯å¦å­˜åœ¨
        Organization organization = organizationRepository.findById(dto.getOrganizationId())
                .orElseThrow(() -> new ResourceNotFoundException("ç»„ç»‡ä¸å­˜åœ¨"));

        // éªŒè¯å½“å‰ç”¨æˆ·æ˜¯å¦å±äºè¯¥ç»„ç»‡
        User currentUser = userRepository.findById(currentUserId)
                .orElseThrow(() -> new ResourceNotFoundException("ç”¨æˆ·ä¸å­˜åœ¨"));

        if (!currentUser.getOrganizationId().equals(dto.getOrganizationId())) {
            throw new BusinessException("æ— æƒåœ¨è¯¥ç»„ç»‡ä¸‹åˆ›å»ºé¡¹ç›®");
        }

        // ç”Ÿæˆé¡¹ç›®ç¼–å·ï¼ˆå¦‚æœæœªæä¾›ï¼‰
        String code = dto.getCode();
        if (!StringUtils.hasText(code)) {
            code = generateProjectCode(organization);
        }

        // æ£€æŸ¥é¡¹ç›®ç¼–å·æ˜¯å¦å·²å­˜åœ¨
        if (projectRepository.existsByCodeAndDeletedAtIsNull(code)) {
            throw new BusinessException("é¡¹ç›®ç¼–å·å·²å­˜åœ¨: " + code);
        }

        // åˆ›å»ºé¡¹ç›®å®ä½“
        Project project = Project.builder()
                .name(dto.getName())
                .code(code)
                .description(dto.getDescription())
                .organizationId(dto.getOrganizationId())
                .biddingType(dto.getBiddingType())
                .industry(dto.getIndustry())
                .budgetAmount(dto.getBudgetAmount())
                .currency(dto.getCurrency() != null ? dto.getCurrency() : "CNY")
                .startDate(dto.getStartDate())
                .endDate(dto.getEndDate())
                .submissionDeadline(dto.getSubmissionDeadline())
                .status(ProjectStatus.DRAFT)
                .priority(dto.getPriority() != null ? dto.getPriority() : ProjectPriority.MEDIUM)
                .winProbability(dto.getWinProbability())
                .tags(dto.getTags() != null ? dto.getTags() : new String[0])
                .settings(dto.getSettings() != null ? dto.getSettings() : "{}")
                .metadata(dto.getMetadata() != null ? dto.getMetadata() : "{}")
                .createdBy(currentUser)
                .updatedBy(currentUser)
                .build();

        // è‡ªåŠ¨æ·»åŠ åˆ›å»ºäººä¸ºé¡¹ç›®æ‰€æœ‰è€…
        ProjectMember owner = ProjectMember.builder()
                .project(project)
                .user(currentUser)
                .role(MemberRole.OWNER)
                .permissions(new String[0])
                .createdBy(currentUser)
                .build();
        project.addMember(owner);

        // ä¿å­˜é¡¹ç›®
        Project savedProject = projectRepository.save(project);

        log.info("é¡¹ç›®åˆ›å»ºæˆåŠŸ, id: {}, code: {}", savedProject.getId(), savedProject.getCode());

        return ProjectResponseDTO.from(savedProject);
    }

    /**
     * æ›´æ–°é¡¹ç›®
     */
    public ProjectResponseDTO updateProject(UUID projectId, UpdateProjectDTO dto, UUID currentUserId) {
        log.info("æ›´æ–°é¡¹ç›®, projectId: {}", projectId);

        // æŸ¥è¯¢é¡¹ç›®
        Project project = projectRepository.findById(projectId)
                .orElseThrow(() -> new ResourceNotFoundException("é¡¹ç›®ä¸å­˜åœ¨"));

        // æ£€æŸ¥é¡¹ç›®æ˜¯å¦å¯ç¼–è¾‘
        if (!project.isEditable()) {
            throw new BusinessException("é¡¹ç›®çŠ¶æ€ä¸º " + project.getStatus() + "ï¼Œä¸å…è®¸ç¼–è¾‘");
        }

        // éªŒè¯æƒé™ï¼šå¿…é¡»æ˜¯é¡¹ç›®æˆå‘˜ä¸”æœ‰ç¼–è¾‘æƒé™
        validateProjectPermission(project, currentUserId, "project:update");

        // è·å–å½“å‰ç”¨æˆ·
        User currentUser = userRepository.findById(currentUserId)
                .orElseThrow(() -> new ResourceNotFoundException("ç”¨æˆ·ä¸å­˜åœ¨"));

        // æ›´æ–°å­—æ®µ
        if (StringUtils.hasText(dto.getName())) {
            project.setName(dto.getName());
        }
        if (StringUtils.hasText(dto.getDescription())) {
            project.setDescription(dto.getDescription());
        }
        if (dto.getBiddingType() != null) {
            project.setBiddingType(dto.getBiddingType());
        }
        if (StringUtils.hasText(dto.getIndustry())) {
            project.setIndustry(dto.getIndustry());
        }
        if (dto.getBudgetAmount() != null) {
            project.setBudgetAmount(dto.getBudgetAmount());
        }
        if (dto.getStartDate() != null) {
            project.setStartDate(dto.getStartDate());
        }
        if (dto.getEndDate() != null) {
            project.setEndDate(dto.getEndDate());
        }
        if (dto.getSubmissionDeadline() != null) {
            project.setSubmissionDeadline(dto.getSubmissionDeadline());
        }
        if (dto.getStatus() != null) {
            updateProjectStatus(project, dto.getStatus());
        }
        if (dto.getPriority() != null) {
            project.setPriority(dto.getPriority());
        }
        if (dto.getWinProbability() != null) {
            project.setWinProbability(dto.getWinProbability());
        }
        if (dto.getTags() != null) {
            project.setTags(dto.getTags());
        }
        if (dto.getSettings() != null) {
            project.setSettings(dto.getSettings());
        }
        if (dto.getMetadata() != null) {
            project.setMetadata(dto.getMetadata());
        }

        project.setUpdatedBy(currentUser);

        Project updatedProject = projectRepository.save(project);

        log.info("é¡¹ç›®æ›´æ–°æˆåŠŸ, projectId: {}", projectId);

        return ProjectResponseDTO.from(updatedProject);
    }

    /**
     * æŸ¥è¯¢é¡¹ç›®è¯¦æƒ…
     */
    @Transactional(readOnly = true)
    public ProjectResponseDTO getProjectById(UUID projectId, UUID currentUserId) {
        Project project = projectRepository.findById(projectId)
                .orElseThrow(() -> new ResourceNotFoundException("é¡¹ç›®ä¸å­˜åœ¨"));

        // éªŒè¯æƒé™ï¼šå¿…é¡»æ˜¯é¡¹ç›®æˆå‘˜æˆ–ç»„ç»‡æˆå‘˜
        validateProjectAccess(project, currentUserId);

        return ProjectResponseDTO.from(project);
    }

    /**
     * æŸ¥è¯¢é¡¹ç›®åˆ—è¡¨ï¼ˆåˆ†é¡µï¼Œæ”¯æŒç­›é€‰ï¼‰
     */
    @Transactional(readOnly = true)
    public Page<ProjectSimpleDTO> getProjects(
            UUID organizationId,
            ProjectStatus status,
            ProjectPriority priority,
            String search,
            Pageable pageable,
            UUID currentUserId
    ) {
        // éªŒè¯ç”¨æˆ·æ˜¯å¦å±äºè¯¥ç»„ç»‡
        User currentUser = userRepository.findById(currentUserId)
                .orElseThrow(() -> new ResourceNotFoundException("ç”¨æˆ·ä¸å­˜åœ¨"));

        if (!currentUser.getOrganizationId().equals(organizationId)) {
            throw new BusinessException("æ— æƒæŸ¥çœ‹è¯¥ç»„ç»‡çš„é¡¹ç›®");
        }

        // æ„å»ºæŸ¥è¯¢æ¡ä»¶
        Specification<Project> spec = Specification.where(null);

        // ç»„ç»‡ID
        spec = spec.and((root, query, cb) ->
                cb.equal(root.get("organizationId"), organizationId));

        // è½¯åˆ é™¤è¿‡æ»¤
        spec = spec.and((root, query, cb) ->
                cb.isNull(root.get("deletedAt")));

        // çŠ¶æ€ç­›é€‰
        if (status != null) {
            spec = spec.and((root, query, cb) ->
                    cb.equal(root.get("status"), status));
        }

        // ä¼˜å…ˆçº§ç­›é€‰
        if (priority != null) {
            spec = spec.and((root, query, cb) ->
                    cb.equal(root.get("priority"), priority));
        }

        // å…³é”®è¯æœç´¢ï¼ˆé¡¹ç›®åç§°ã€ç¼–å·ï¼‰
        if (StringUtils.hasText(search)) {
            spec = spec.and((root, query, cb) ->
                    cb.or(
                            cb.like(root.get("name"), "%" + search + "%"),
                            cb.like(root.get("code"), "%" + search + "%")
                    ));
        }

        Page<Project> projectPage = projectRepository.findAll(spec, pageable);

        return projectPage.map(ProjectSimpleDTO::from);
    }

    /**
     * åˆ é™¤é¡¹ç›®ï¼ˆè½¯åˆ é™¤ï¼‰
     */
    public void deleteProject(UUID projectId, UUID currentUserId) {
        log.info("åˆ é™¤é¡¹ç›®, projectId: {}", projectId);

        Project project = projectRepository.findById(projectId)
                .orElseThrow(() -> new ResourceNotFoundException("é¡¹ç›®ä¸å­˜åœ¨"));

        // éªŒè¯æƒé™ï¼šå¿…é¡»æ˜¯é¡¹ç›®æ‰€æœ‰è€…
        validateProjectPermission(project, currentUserId, "project:delete");

        // æ£€æŸ¥é¡¹ç›®çŠ¶æ€ï¼ˆå·²å½’æ¡£çš„é¡¹ç›®ä¸èƒ½åˆ é™¤ï¼‰
        if (project.getStatus() == ProjectStatus.ARCHIVED) {
            throw new BusinessException("å·²å½’æ¡£çš„é¡¹ç›®ä¸èƒ½åˆ é™¤");
        }

        // è½¯åˆ é™¤
        projectRepository.delete(project);

        log.info("é¡¹ç›®åˆ é™¤æˆåŠŸ, projectId: {}", projectId);
    }

    /**
     * æ›´æ–°é¡¹ç›®çŠ¶æ€
     */
    public void updateProjectStatus(UUID projectId, ProjectStatus targetStatus, UUID currentUserId) {
        log.info("æ›´æ–°é¡¹ç›®çŠ¶æ€, projectId: {}, targetStatus: {}", projectId, targetStatus);

        Project project = projectRepository.findById(projectId)
                .orElseThrow(() -> new ResourceNotFoundException("é¡¹ç›®ä¸å­˜åœ¨"));

        validateProjectPermission(project, currentUserId, "project:update");

        updateProjectStatus(project, targetStatus);

        projectRepository.save(project);

        log.info("é¡¹ç›®çŠ¶æ€æ›´æ–°æˆåŠŸ, projectId: {}, status: {} -> {}",
                projectId, project.getStatus(), targetStatus);
    }

    /**


     * æ·»åŠ é¡¹ç›®æˆå‘˜
     */
    public ProjectMemberResponseDTO addProjectMember(
            UUID projectId,
            AddProjectMemberDTO dto,
            UUID currentUserId
    ) {
        log.info("æ·»åŠ é¡¹ç›®æˆå‘˜, projectId: {}, userId: {}", projectId, dto.getUserId());

        Project project = projectRepository.findById(projectId)
                .orElseThrow(() -> new ResourceNotFoundException("é¡¹ç›®ä¸å­˜åœ¨"));

        // éªŒè¯æƒé™ï¼šå¿…é¡»æœ‰æˆå‘˜ç®¡ç†æƒé™
        validateProjectPermission(project, currentUserId, "member:create");

        // éªŒè¯è¦æ·»åŠ çš„ç”¨æˆ·æ˜¯å¦å­˜åœ¨
        User user = userRepository.findById(dto.getUserId())
                .orElseThrow(() -> new ResourceNotFoundException("ç”¨æˆ·ä¸å­˜åœ¨"));

        // éªŒè¯ç”¨æˆ·æ˜¯å¦å±äºåŒä¸€ç»„ç»‡
        if (!user.getOrganizationId().equals(project.getOrganizationId())) {
            throw new BusinessException("ç”¨æˆ·ä¸å±äºè¯¥ç»„ç»‡");
        }

        // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²æ˜¯é¡¹ç›®æˆå‘˜
        boolean isMember = project.getMembers().stream()
                .anyMatch(m -> m.getUser().getId().equals(dto.getUserId()));

        if (isMember) {
            throw new BusinessException("ç”¨æˆ·å·²æ˜¯é¡¹ç›®æˆå‘˜");
        }

        // åˆ›å»ºé¡¹ç›®æˆå‘˜
        User currentUser = userRepository.findById(currentUserId)
                .orElseThrow(() -> new ResourceNotFoundException("å½“å‰ç”¨æˆ·ä¸å­˜åœ¨"));

        ProjectMember member = ProjectMember.builder()
                .project(project)
                .user(user)
                .role(dto.getRole() != null ? dto.getRole() : MemberRole.MEMBER)
                .permissions(dto.getPermissions() != null ? dto.getPermissions() : new String[0])
                .createdBy(currentUser)
                .build();

        project.addMember(member);

        projectRepository.save(project);

        log.info("é¡¹ç›®æˆå‘˜æ·»åŠ æˆåŠŸ, projectId: {}, userId: {}", projectId, dto.getUserId());

        return ProjectMemberResponseDTO.from(member);
    }

    /**
     * ç§»é™¤é¡¹ç›®æˆå‘˜
     */
    public void removeProjectMember(UUID projectId, UUID memberId, UUID currentUserId) {
        log.info("ç§»é™¤é¡¹ç›®æˆå‘˜, projectId: {}, memberId: {}", projectId, memberId);

        Project project = projectRepository.findById(projectId)
                .orElseThrow(() -> new ResourceNotFoundException("é¡¹ç›®ä¸å­˜åœ¨"));

        validateProjectPermission(project, currentUserId, "member:delete");

        // æŸ¥æ‰¾è¦ç§»é™¤çš„æˆå‘˜
        ProjectMember memberToRemove = project.getMembers().stream()
                .filter(m -> m.getUser().getId().equals(memberId))
                .findFirst()
                .orElseThrow(() -> new ResourceNotFoundException("é¡¹ç›®æˆå‘˜ä¸å­˜åœ¨"));

        // ä¸èƒ½ç§»é™¤é¡¹ç›®æ‰€æœ‰è€…
        if (memberToRemove.getRole() == MemberRole.OWNER) {
            throw new BusinessException("ä¸èƒ½ç§»é™¤é¡¹ç›®æ‰€æœ‰è€…");
        }

        project.removeMember(memberToRemove);

        projectRepository.save(project);

        log.info("é¡¹ç›®æˆå‘˜ç§»é™¤æˆåŠŸ, projectId: {}, memberId: {}", projectId, memberId);
    }

    // ==================== ç§æœ‰æ–¹æ³• ====================

    /**
     * ç”Ÿæˆé¡¹ç›®ç¼–å·
     */
    private String generateProjectCode(Organization organization) {
        String prefix = organization.getShortName() != null ?
                organization.getShortName().toUpperCase() : "PRJ";

        String timestamp = String.valueOf(System.currentTimeMillis());
        String suffix = timestamp.substring(timestamp.length() - 6);

        return String.format("%s-%s", prefix, suffix);
    }

    /**
     * æ›´æ–°é¡¹ç›®çŠ¶æ€ï¼ˆå†…éƒ¨æ–¹æ³•ï¼ŒåŒ…å«çŠ¶æ€æµè½¬éªŒè¯ï¼‰
     */
    private void updateProjectStatus(Project project, ProjectStatus targetStatus) {
        if (!project.canTransitionTo(targetStatus)) {
            throw new BusinessException(
                    String.format("é¡¹ç›®çŠ¶æ€ä¸èƒ½ä» %s æµè½¬åˆ° %s",
                            project.getStatus(), targetStatus)
            );
        }

        project.setStatus(targetStatus);
    }

    /**
     * éªŒè¯é¡¹ç›®è®¿é—®æƒé™ï¼ˆæ˜¯å¦å¯ä»¥æŸ¥çœ‹é¡¹ç›®ï¼‰
     */
    private void validateProjectAccess(Project project, UUID userId) {
        User user = userRepository.findById(userId)
                .orElseThrow(() -> new ResourceNotFoundException("ç”¨æˆ·ä¸å­˜åœ¨"));

        // æ£€æŸ¥æ˜¯å¦å±äºåŒä¸€ç»„ç»‡
        if (!user.getOrganizationId().equals(project.getOrganizationId())) {
            throw new BusinessException("æ— æƒè®¿é—®è¯¥é¡¹ç›®");
        }
    }

    /**
     * éªŒè¯é¡¹ç›®æ“ä½œæƒé™ï¼ˆæ˜¯å¦å¯ä»¥æ‰§è¡Œç‰¹å®šæ“ä½œï¼‰
     */
    private void validateProjectPermission(Project project, UUID userId, String permission) {
        // å…ˆæ£€æŸ¥æ˜¯å¦å¯ä»¥è®¿é—®é¡¹ç›®
        validateProjectAccess(project, userId);

        // æ£€æŸ¥æ˜¯å¦æ˜¯é¡¹ç›®æˆå‘˜
        ProjectMember member = project.getMembers().stream()
                .filter(m -> m.getUser().getId().equals(userId))
                .findFirst()
                .orElseThrow(() -> new BusinessException("ä¸æ˜¯é¡¹ç›®æˆå‘˜ï¼Œæ— æƒæ‰§è¡Œè¯¥æ“ä½œ"));

        // æ£€æŸ¥æƒé™
        if (!member.hasPermission(permission)) {
            throw new BusinessException("æƒé™ä¸è¶³ï¼Œæ— æ³•æ‰§è¡Œè¯¥æ“ä½œ");
        }
    }
}
```

#### ProjectController REST API

```java
package com.aibidcomposer.controller;

import com.aibidcomposer.dto.project.*;
import com.aibidcomposer.entity.ProjectPriority;
import com.aibidcomposer.entity.ProjectStatus;
import com.aibidcomposer.security.CurrentUser;
import com.aibidcomposer.security.UserPrincipal;
import com.aibidcomposer.service.ProjectService;
import io.swagger.v3.oas.annotations.Operation;
import io.swagger.v3.oas.annotations.Parameter;
import io.swagger.v3.oas.annotations.tags.Tag;
import jakarta.validation.Valid;
import lombok.RequiredArgsConstructor;
import org.springframework.data.domain.Page;
import org.springframework.data.domain.PageRequest;
import org.springframework.data.domain.Pageable;
import org.springframework.data.domain.Sort;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

import java.util.UUID;

/**
 * é¡¹ç›®ç®¡ç†æ§åˆ¶å™¨
 * éœ€æ±‚ç¼–å·: REQ-JAVA-002-2.2
 */
@RestController
@RequestMapping("/api/v1/projects")
@RequiredArgsConstructor
@Tag(name = "é¡¹ç›®ç®¡ç†", description = "é¡¹ç›®ç®¡ç†ç›¸å…³æ¥å£")
public class ProjectController {

    private final ProjectService projectService;

    @PostMapping
    @Operation(summary = "åˆ›å»ºé¡¹ç›®", description = "åˆ›å»ºæ–°çš„æŠ•æ ‡é¡¹ç›®")
    public ResponseEntity<ProjectResponseDTO> createProject(
            @Valid @RequestBody CreateProjectDTO dto,
            @CurrentUser UserPrincipal currentUser
    ) {
        ProjectResponseDTO response = projectService.createProject(dto, currentUser.getId());
        return ResponseEntity.ok(response);
    }

    @GetMapping
    @Operation(summary = "æŸ¥è¯¢é¡¹ç›®åˆ—è¡¨", description = "åˆ†é¡µæŸ¥è¯¢é¡¹ç›®åˆ—è¡¨ï¼Œæ”¯æŒç­›é€‰")
    public ResponseEntity<Page<ProjectSimpleDTO>> getProjects(
            @Parameter(description = "ç»„ç»‡ID") @RequestParam UUID organizationId,
            @Parameter(description = "é¡¹ç›®çŠ¶æ€") @RequestParam(required = false) ProjectStatus status,
            @Parameter(description = "ä¼˜å…ˆçº§") @RequestParam(required = false) ProjectPriority priority,
            @Parameter(description = "æœç´¢å…³é”®è¯") @RequestParam(required = false) String search,
            @Parameter(description = "é¡µç ï¼ˆä»1å¼€å§‹ï¼‰") @RequestParam(defaultValue = "1") int page,
            @Parameter(description = "æ¯é¡µæ•°é‡") @RequestParam(defaultValue = "20") int pageSize,
            @Parameter(description = "æ’åºå­—æ®µ") @RequestParam(defaultValue = "createdAt") String sortBy,
            @Parameter(description = "æ’åºæ–¹å‘") @RequestParam(defaultValue = "DESC") Sort.Direction sortDirection,
            @CurrentUser UserPrincipal currentUser
    ) {
        Pageable pageable = PageRequest.of(
                page - 1,
                pageSize,
                Sort.by(sortDirection, sortBy)
        );

        Page<ProjectSimpleDTO> projects = projectService.getProjects(
                organizationId,
                status,
                priority,
                search,
                pageable,
                currentUser.getId()
        );

        return ResponseEntity.ok(projects);
    }

    @GetMapping("/{id}")
    @Operation(summary = "æŸ¥è¯¢é¡¹ç›®è¯¦æƒ…", description = "æ ¹æ®IDæŸ¥è¯¢é¡¹ç›®è¯¦ç»†ä¿¡æ¯")
    public ResponseEntity<ProjectResponseDTO> getProjectById(
            @PathVariable UUID id,
            @CurrentUser UserPrincipal currentUser
    ) {
        ProjectResponseDTO response = projectService.getProjectById(id, currentUser.getId());
        return ResponseEntity.ok(response);
    }

    @PutMapping("/{id}")
    @Operation(summary = "æ›´æ–°é¡¹ç›®", description = "æ›´æ–°é¡¹ç›®ä¿¡æ¯")
    public ResponseEntity<ProjectResponseDTO> updateProject(
            @PathVariable UUID id,
            @Valid @RequestBody UpdateProjectDTO dto,
            @CurrentUser UserPrincipal currentUser
    ) {
        ProjectResponseDTO response = projectService.updateProject(id, dto, currentUser.getId());
        return ResponseEntity.ok(response);
    }

    @DeleteMapping("/{id}")
    @Operation(summary = "åˆ é™¤é¡¹ç›®", description = "è½¯åˆ é™¤é¡¹ç›®")
    public ResponseEntity<Void> deleteProject(
            @PathVariable UUID id,
            @CurrentUser UserPrincipal currentUser
    ) {
        projectService.deleteProject(id, currentUser.getId());
        return ResponseEntity.noContent().build();
    }

    @PatchMapping("/{id}/status")
    @Operation(summary = "æ›´æ–°é¡¹ç›®çŠ¶æ€", description = "æ›´æ–°é¡¹ç›®çŠ¶æ€")
    public ResponseEntity<Void> updateProjectStatus(
            @PathVariable UUID id,
            @RequestParam ProjectStatus status,
            @CurrentUser UserPrincipal currentUser
    ) {
        projectService.updateProjectStatus(id, status, currentUser.getId());
        return ResponseEntity.noContent().build();
    }

    @PostMapping("/{id}/members")
    @Operation(summary = "æ·»åŠ é¡¹ç›®æˆå‘˜", description = "å‘é¡¹ç›®æ·»åŠ æˆå‘˜")
    public ResponseEntity<ProjectMemberResponseDTO> addProjectMember(
            @PathVariable UUID id,
            @Valid @RequestBody AddProjectMemberDTO dto,
            @CurrentUser UserPrincipal currentUser
    ) {
        ProjectMemberResponseDTO response = projectService.addProjectMember(
                id, dto, currentUser.getId()
        );
        return ResponseEntity.ok(response);
    }

    @DeleteMapping("/{projectId}/members/{memberId}")
    @Operation(summary = "ç§»é™¤é¡¹ç›®æˆå‘˜", description = "ä»é¡¹ç›®ä¸­ç§»é™¤æˆå‘˜")
    public ResponseEntity<Void> removeProjectMember(
            @PathVariable UUID projectId,
            @PathVariable UUID memberId,
            @CurrentUser UserPrincipal currentUser
    ) {
        projectService.removeProjectMember(projectId, memberId, currentUser.getId());
        return ResponseEntity.noContent().build();
    }
}
```

#### å•å…ƒæµ‹è¯•

```java
package com.aibidcomposer.service;

import com.aibidcomposer.dto.project.CreateProjectDTO;
import com.aibidcomposer.dto.project.ProjectResponseDTO;
import com.aibidcomposer.dto.project.UpdateProjectDTO;
import com.aibidcomposer.entity.*;
import com.aibidcomposer.exception.BusinessException;
import com.aibidcomposer.exception.ResourceNotFoundException;
import com.aibidcomposer.repository.OrganizationRepository;
import com.aibidcomposer.repository.ProjectRepository;
import com.aibidcomposer.repository.UserRepository;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.DisplayName;
import org.junit.jupiter.api.Test;
import org.junit.jupiter.api.extension.ExtendWith;
import org.mockito.InjectMocks;
import org.mockito.Mock;
import org.mockito.junit.jupiter.MockitoExtension;

import java.math.BigDecimal;
import java.time.LocalDate;
import java.time.LocalDateTime;
import java.util.Optional;
import java.util.UUID;

import static org.assertj.core.api.Assertions.*;
import static org.mockito.ArgumentMatchers.any;
import static org.mockito.Mockito.*;

/**
 * ProjectService å•å…ƒæµ‹è¯•
 * éœ€æ±‚ç¼–å·: REQ-JAVA-002-2.2
 */
@ExtendWith(MockitoExtension.class)
@DisplayName("ProjectService å•å…ƒæµ‹è¯•")
class ProjectServiceTest {

    @Mock
    private ProjectRepository projectRepository;

    @Mock
    private OrganizationRepository organizationRepository;

    @Mock
    private UserRepository userRepository;

    @InjectMocks
    private ProjectService projectService;

    private UUID organizationId;
    private UUID userId;
    private Organization organization;
    private User user;
    private CreateProjectDTO createDTO;

    @BeforeEach
    void setUp() {
        organizationId = UUID.randomUUID();
        userId = UUID.randomUUID();

        // åˆ›å»ºæµ‹è¯•ç»„ç»‡
        organization = Organization.builder()
                .id(organizationId)
                .name("æµ‹è¯•å…¬å¸")
                .shortName("TEST")
                .build();

        // åˆ›å»ºæµ‹è¯•ç”¨æˆ·
        user = User.builder()
                .id(userId)
                .username("testuser")
                .email("test@example.com")
                .organizationId(organizationId)
                .build();

        // åˆ›å»ºæµ‹è¯•DTO
        createDTO = new CreateProjectDTO();
        createDTO.setName("æµ‹è¯•é¡¹ç›®");
        createDTO.setOrganizationId(organizationId);
        createDTO.setBiddingType(BiddingType.GOVERNMENT);
        createDTO.setBudgetAmount(new BigDecimal("1000000"));
        createDTO.setSubmissionDeadline(LocalDateTime.now().plusDays(30));
        createDTO.setPriority(ProjectPriority.HIGH);
    }

    @Test
    @DisplayName("åˆ›å»ºé¡¹ç›® - æˆåŠŸ")
    void testCreateProject_Success() {
        // Given
        when(organizationRepository.findById(organizationId))
                .thenReturn(Optional.of(organization));
        when(userRepository.findById(userId))
                .thenReturn(Optional.of(user));
        when(projectRepository.existsByCodeAndDeletedAtIsNull(anyString()))
                .thenReturn(false);
        when(projectRepository.save(any(Project.class)))
                .thenAnswer(invocation -> {
                    Project project = invocation.getArgument(0);
                    project.setId(UUID.randomUUID());
                    return project;
                });

        // When
        ProjectResponseDTO response = projectService.createProject(createDTO, userId);

        // Then
        assertThat(response).isNotNull();
        assertThat(response.getName()).isEqualTo("æµ‹è¯•é¡¹ç›®");
        assertThat(response.getStatus()).isEqualTo(ProjectStatus.DRAFT);
        assertThat(response.getOrganizationId()).isEqualTo(organizationId);

        verify(projectRepository, times(1)).save(any(Project.class));
    }

    @Test
    @DisplayName("åˆ›å»ºé¡¹ç›® - ç»„ç»‡ä¸å­˜åœ¨")
    void testCreateProject_OrganizationNotFound() {
        // Given
        when(organizationRepository.findById(organizationId))
                .thenReturn(Optional.empty());

        // When & Then
        assertThatThrownBy(() -> projectService.createProject(createDTO, userId))
                .isInstanceOf(ResourceNotFoundException.class)
                .hasMessageContaining("ç»„ç»‡ä¸å­˜åœ¨");

        verify(projectRepository, never()).save(any(Project.class));
    }

    @Test
    @DisplayName("åˆ›å»ºé¡¹ç›® - ç”¨æˆ·ä¸å±äºç»„ç»‡")
    void testCreateProject_UserNotInOrganization() {
        // Given
        User otherUser = User.builder()
                .id(userId)
                .organizationId(UUID.randomUUID()) // ä¸åŒçš„ç»„ç»‡ID
                .build();

        when(organizationRepository.findById(organizationId))
                .thenReturn(Optional.of(organization));
        when(userRepository.findById(userId))
                .thenReturn(Optional.of(otherUser));

        // When & Then
        assertThatThrownBy(() -> projectService.createProject(createDTO, userId))
                .isInstanceOf(BusinessException.class)
                .hasMessageContaining("æ— æƒåœ¨è¯¥ç»„ç»‡ä¸‹åˆ›å»ºé¡¹ç›®");
    }

    @Test
    @DisplayName("åˆ›å»ºé¡¹ç›® - é¡¹ç›®ç¼–å·å·²å­˜åœ¨")
    void testCreateProject_CodeAlreadyExists() {
        // Given
        createDTO.setCode("TEST-001");

        when(organizationRepository.findById(organizationId))
                .thenReturn(Optional.of(organization));
        when(userRepository.findById(userId))
                .thenReturn(Optional.of(user));
        when(projectRepository.existsByCodeAndDeletedAtIsNull("TEST-001"))
                .thenReturn(true);

        // When & Then
        assertThatThrownBy(() -> projectService.createProject(createDTO, userId))
                .isInstanceOf(BusinessException.class)
                .hasMessageContaining("é¡¹ç›®ç¼–å·å·²å­˜åœ¨");
    }

    @Test
    @DisplayName("æ›´æ–°é¡¹ç›®çŠ¶æ€ - æˆåŠŸ")
    void testUpdateProjectStatus_Success() {
        // Given
        UUID projectId = UUID.randomUUID();

        Project project = Project.builder()
                .id(projectId)
                .organizationId(organizationId)
                .status(ProjectStatus.DRAFT)
                .build();

        ProjectMember owner = ProjectMember.builder()
                .user(user)
                .role(MemberRole.OWNER)
                .build();
        project.addMember(owner);

        when(projectRepository.findById(projectId))
                .thenReturn(Optional.of(project));
        when(userRepository.findById(userId))
                .thenReturn(Optional.of(user));

        // When
        projectService.updateProjectStatus(projectId, ProjectStatus.IN_PROGRESS, userId);

        // Then
        assertThat(project.getStatus()).isEqualTo(ProjectStatus.IN_PROGRESS);
        verify(projectRepository, times(1)).save(project);
    }

    @Test
    @DisplayName("æ›´æ–°é¡¹ç›®çŠ¶æ€ - çŠ¶æ€æµè½¬ä¸åˆæ³•")
    void testUpdateProjectStatus_InvalidTransition() {
        // Given
        UUID projectId = UUID.randomUUID();

        Project project = Project.builder()
                .id(projectId)
                .organizationId(organizationId)
                .status(ProjectStatus.DRAFT)
                .build();

        ProjectMember owner = ProjectMember.builder()
                .user(user)
                .role(MemberRole.OWNER)
                .build();
        project.addMember(owner);

        when(projectRepository.findById(projectId))
                .thenReturn(Optional.of(project));
        when(userRepository.findById(userId))
                .thenReturn(Optional.of(user));

        // When & Then
        assertThatThrownBy(() ->
                projectService.updateProjectStatus(projectId, ProjectStatus.WON, userId))
                .isInstanceOf(BusinessException.class)
                .hasMessageContaining("é¡¹ç›®çŠ¶æ€ä¸èƒ½ä»");
    }

    @Test
    @DisplayName("æ›´æ–°é¡¹ç›®çŠ¶æ€ - æƒé™ä¸è¶³")
    void testUpdateProjectStatus_PermissionDenied() {
        // Given
        UUID projectId = UUID.randomUUID();

        Project project = Project.builder()
                .id(projectId)
                .organizationId(organizationId)
                .status(ProjectStatus.DRAFT)
                .build();

        ProjectMember viewer = ProjectMember.builder()
                .user(user)
                .role(MemberRole.VIEWER) // åªè¯»è§’è‰²
                .build();
        project.addMember(viewer);

        when(projectRepository.findById(projectId))
                .thenReturn(Optional.of(project));
        when(userRepository.findById(userId))
                .thenReturn(Optional.of(user));

        // When & Then
        assertThatThrownBy(() ->
                projectService.updateProjectStatus(projectId, ProjectStatus.IN_PROGRESS, userId))
                .isInstanceOf(BusinessException.class)
                .hasMessageContaining("æƒé™ä¸è¶³");
    }

    @Test
    @DisplayName("åˆ é™¤é¡¹ç›® - æˆåŠŸ")
    void testDeleteProject_Success() {
        // Given
        UUID projectId = UUID.randomUUID();

        Project project = Project.builder()
                .id(projectId)
                .organizationId(organizationId)
                .status(ProjectStatus.DRAFT)
                .build();

        ProjectMember owner = ProjectMember.builder()
                .user(user)
                .role(MemberRole.OWNER)
                .build();
        project.addMember(owner);

        when(projectRepository.findById(projectId))
                .thenReturn(Optional.of(project));
        when(userRepository.findById(userId))
                .thenReturn(Optional.of(user));

        // When
        projectService.deleteProject(projectId, userId);

        // Then
        verify(projectRepository, times(1)).delete(project);
    }

    @Test
    @DisplayName("åˆ é™¤é¡¹ç›® - å·²å½’æ¡£çš„é¡¹ç›®ä¸èƒ½åˆ é™¤")
    void testDeleteProject_ArchivedProjectCannotBeDeleted() {
        // Given
        UUID projectId = UUID.randomUUID();

        Project project = Project.builder()
                .id(projectId)
                .organizationId(organizationId)
                .status(ProjectStatus.ARCHIVED) // å·²å½’æ¡£
                .build();

        ProjectMember owner = ProjectMember.builder()
                .user(user)
                .role(MemberRole.OWNER)
                .build();
        project.addMember(owner);

        when(projectRepository.findById(projectId))
                .thenReturn(Optional.of(project));
        when(userRepository.findById(userId))
                .thenReturn(Optional.of(user));

        // When & Then
        assertThatThrownBy(() -> projectService.deleteProject(projectId, userId))
                .isInstanceOf(BusinessException.class)
                .hasMessageContaining("å·²å½’æ¡£çš„é¡¹ç›®ä¸èƒ½åˆ é™¤");
    }
}
```

#### 2.2.4 Pythonåç«¯

> **æœåŠ¡**: Python FastAPI (ç«¯å£ 8001)
> **èŒè´£**: AIæœåŠ¡éœ€è¦è®¿é—®é¡¹ç›®ä¿¡æ¯æ—¶ï¼Œé€šè¿‡HTTPè°ƒç”¨JavaæœåŠ¡çš„é¡¹ç›®ç®¡ç†API
> **æŠ€æœ¯æ ˆ**: FastAPI + httpx + Pydantic

##### éªŒè¯æ¸…å•

**éªŒè¯æ¸…å•**:
- [ ] JavaæœåŠ¡HTTPå®¢æˆ·ç«¯å®ç°å®Œæˆ
- [ ] JWT tokenä¼ é€’é€»è¾‘å®ç°å®Œæˆ
- [ ] é¡¹ç›®ä¿¡æ¯æŸ¥è¯¢é›†æˆå®Œæˆ
- [ ] é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶å®Œæˆ
- [ ] ç¯å¢ƒé…ç½®å’ŒæœåŠ¡å‘ç°å®Œæˆ
- [ ] é›†æˆæµ‹è¯•ç¼–å†™å®Œæˆ

##### æ ¸å¿ƒä»£ç å®ç°

**1. JavaæœåŠ¡HTTPå®¢æˆ·ç«¯**

```python
# app/clients/java_client.py
"""
Java Spring BootæœåŠ¡HTTPå®¢æˆ·ç«¯

è´Ÿè´£ä¸JavaæœåŠ¡é€šä¿¡ï¼Œè·å–é¡¹ç›®ã€ç»„ç»‡ç­‰ä¸šåŠ¡æ•°æ®
"""
import httpx
from typing import Optional, Dict, Any, List
from app.core.config import settings
from app.core.logging import logger
from app.schemas.project import ProjectDetailSchema, ProjectListSchema


class JavaServiceClient:
    """JavaæœåŠ¡å®¢æˆ·ç«¯"""

    def __init__(self):
        self.base_url = settings.JAVA_SERVICE_URL  # http://backend-java-service:8080
        self.timeout = httpx.Timeout(30.0, connect=5.0)

        # åˆ›å»ºæŒä¹…åŒ–HTTPå®¢æˆ·ç«¯ï¼ˆè¿æ¥æ± ï¼‰
        self.client = httpx.AsyncClient(
            base_url=self.base_url,
            timeout=self.timeout,
            limits=httpx.Limits(max_keepalive_connections=20, max_connections=100)
        )

    async def close(self):
        """å…³é—­HTTPå®¢æˆ·ç«¯"""
        await self.client.aclose()

    def _get_headers(self, token: str) -> Dict[str, str]:
        """
        æ„å»ºè¯·æ±‚å¤´

        Args:
            token: JWTè®¿é—®ä»¤ç‰Œ

        Returns:
            è¯·æ±‚å¤´å­—å…¸
        """
        return {
            "Authorization": f"Bearer {token}",
            "Content-Type": "application/json",
            "Accept": "application/json"
        }

    async def get_project_by_id(
        self,
        project_id: str,
        token: str
    ) -> Optional[ProjectDetailSchema]:
        """
        æ ¹æ®IDè·å–é¡¹ç›®è¯¦æƒ…

        Args:
            project_id: é¡¹ç›®ID
            token: JWTè®¿é—®ä»¤ç‰Œ

        Returns:
            é¡¹ç›®è¯¦æƒ…ï¼Œå¦‚æœä¸å­˜åœ¨è¿”å›None

        Raises:
            httpx.HTTPError: HTTPè¯·æ±‚é”™è¯¯
        """
        try:
            response = await self.client.get(
                f"/api/v1/projects/{project_id}",
                headers=self._get_headers(token)
            )

            if response.status_code == 404:
                logger.warning(f"é¡¹ç›®ä¸å­˜åœ¨: {project_id}")
                return None

            response.raise_for_status()

            data = response.json()
            if data.get("success"):
                return ProjectDetailSchema(**data["data"])
            else:
                logger.error(f"è·å–é¡¹ç›®å¤±è´¥: {data.get('error')}")
                return None

        except httpx.HTTPStatusError as e:
            logger.error(f"è·å–é¡¹ç›®HTTPé”™è¯¯: {e.response.status_code}, {e.response.text}")
            raise
        except httpx.RequestError as e:
            logger.error(f"è·å–é¡¹ç›®è¯·æ±‚é”™è¯¯: {str(e)}")
            raise
        except Exception as e:
            logger.error(f"è·å–é¡¹ç›®æœªçŸ¥é”™è¯¯: {str(e)}")
            raise

    async def get_projects(
        self,
        organization_id: str,
        token: str,
        status: Optional[str] = None,
        priority: Optional[str] = None,
        search: Optional[str] = None,
        page: int = 1,
        page_size: int = 20
    ) -> ProjectListSchema:
        """
        è·å–é¡¹ç›®åˆ—è¡¨

        Args:
            organization_id: ç»„ç»‡ID
            token: JWTè®¿é—®ä»¤ç‰Œ
            status: é¡¹ç›®çŠ¶æ€è¿‡æ»¤
            priority: ä¼˜å…ˆçº§è¿‡æ»¤
            search: æœç´¢å…³é”®è¯
            page: é¡µç 
            page_size: æ¯é¡µæ•°é‡

        Returns:
            é¡¹ç›®åˆ—è¡¨ï¼ˆåŒ…å«åˆ†é¡µä¿¡æ¯ï¼‰
        """
        params = {
            "organizationId": organization_id,
            "page": page,
            "pageSize": page_size
        }

        if status:
            params["status"] = status
        if priority:
            params["priority"] = priority
        if search:
            params["search"] = search

        try:
            response = await self.client.get(
                "/api/v1/projects",
                params=params,
                headers=self._get_headers(token)
            )

            response.raise_for_status()

            data = response.json()
            if data.get("success"):
                return ProjectListSchema(**data["data"])
            else:
                logger.error(f"è·å–é¡¹ç›®åˆ—è¡¨å¤±è´¥: {data.get('error')}")
                raise ValueError(f"è·å–é¡¹ç›®åˆ—è¡¨å¤±è´¥: {data.get('error')}")

        except httpx.HTTPError as e:
            logger.error(f"è·å–é¡¹ç›®åˆ—è¡¨é”™è¯¯: {str(e)}")
            raise

    async def get_organization_by_id(
        self,
        organization_id: str,
        token: str
    ) -> Optional[Dict[str, Any]]:
        """
        æ ¹æ®IDè·å–ç»„ç»‡ä¿¡æ¯

        Args:
            organization_id: ç»„ç»‡ID
            token: JWTè®¿é—®ä»¤ç‰Œ

        Returns:
            ç»„ç»‡ä¿¡æ¯ï¼Œå¦‚æœä¸å­˜åœ¨è¿”å›None
        """
        try:
            response = await self.client.get(
                f"/api/v1/organizations/{organization_id}",
                headers=self._get_headers(token)
            )

            if response.status_code == 404:
                return None

            response.raise_for_status()

            data = response.json()
            return data["data"] if data.get("success") else None

        except httpx.HTTPError as e:
            logger.error(f"è·å–ç»„ç»‡é”™è¯¯: {str(e)}")
            raise


# å…¨å±€å®¢æˆ·ç«¯å®ä¾‹
java_client = JavaServiceClient()


async def get_java_client() -> JavaServiceClient:
    """ä¾èµ–æ³¨å…¥ï¼šè·å–JavaæœåŠ¡å®¢æˆ·ç«¯"""
    return java_client
```

**2. Pydanticæ¨¡å‹å®šä¹‰**

```python
# app/schemas/project.py
"""é¡¹ç›®ç›¸å…³çš„Pydanticæ¨¡å‹"""
from typing import Optional, List
from pydantic import BaseModel, UUID4
from datetime import datetime
from enum import Enum


class ProjectStatus(str, Enum):
    """é¡¹ç›®çŠ¶æ€æšä¸¾"""
    DRAFT = "DRAFT"
    IN_PROGRESS = "IN_PROGRESS"
    REVIEW = "REVIEW"
    SUBMITTED = "SUBMITTED"
    WON = "WON"
    LOST = "LOST"
    ARCHIVED = "ARCHIVED"


class ProjectPriority(str, Enum):
    """é¡¹ç›®ä¼˜å…ˆçº§æšä¸¾"""
    LOW = "LOW"
    MEDIUM = "MEDIUM"
    HIGH = "HIGH"
    URGENT = "URGENT"


class ProjectSimpleSchema(BaseModel):
    """é¡¹ç›®ç®€å•ä¿¡æ¯æ¨¡å‹ï¼ˆåˆ—è¡¨è§†å›¾ï¼‰"""
    id: UUID4
    name: str
    code: str
    status: ProjectStatus
    priority: ProjectPriority
    budget_amount: Optional[float]
    submission_deadline: Optional[datetime]
    win_probability: Optional[int]
    created_at: datetime

    class Config:
        from_attributes = True


class ProjectDetailSchema(BaseModel):
    """é¡¹ç›®è¯¦ç»†ä¿¡æ¯æ¨¡å‹"""
    id: UUID4
    name: str
    code: str
    description: Optional[str]
    organization_id: UUID4
    bidding_type: Optional[str]
    industry: Optional[str]
    budget_amount: Optional[float]
    currency: str
    start_date: Optional[datetime]
    end_date: Optional[datetime]
    submission_deadline: Optional[datetime]
    status: ProjectStatus
    priority: ProjectPriority
    win_probability: Optional[int]
    tags: List[str]
    created_at: datetime
    updated_at: datetime

    class Config:
        from_attributes = True


class ProjectListSchema(BaseModel):
    """é¡¹ç›®åˆ—è¡¨å“åº”æ¨¡å‹ï¼ˆåŒ…å«åˆ†é¡µï¼‰"""
    items: List[ProjectSimpleSchema]
    total: int
    page: int
    page_size: int
    total_pages: int
```

**3. FastAPIç«¯ç‚¹é›†æˆç¤ºä¾‹**

```python
# app/api/v1/ai_endpoints.py
"""AIæœåŠ¡ç«¯ç‚¹ - é›†æˆJavaæœåŠ¡çš„é¡¹ç›®æ•°æ®"""
from fastapi import APIRouter, Depends, HTTPException, status
from typing import Optional
from app.clients.java_client import JavaServiceClient, get_java_client
from app.core.security import get_current_user_token
from app.schemas.ai_task import AITaskCreate, AITaskResponse

router = APIRouter(prefix="/ai", tags=["AIæœåŠ¡"])


@router.post("/analyze-requirements", response_model=AITaskResponse)
async def analyze_requirements(
    task_data: AITaskCreate,
    token: str = Depends(get_current_user_token),
    java_client: JavaServiceClient = Depends(get_java_client)
):
    """
    åˆ†ææ‹›æ ‡éœ€æ±‚ï¼ˆéœ€è¦è·å–é¡¹ç›®ä¿¡æ¯ï¼‰

    Args:
        task_data: AIä»»åŠ¡åˆ›å»ºæ•°æ®ï¼ˆåŒ…å«project_idï¼‰
        token: JWTä»¤ç‰Œ
        java_client: JavaæœåŠ¡å®¢æˆ·ç«¯

    Returns:
        AIä»»åŠ¡å“åº”
    """
    # 1. ä»JavaæœåŠ¡è·å–é¡¹ç›®ä¿¡æ¯
    project = await java_client.get_project_by_id(
        project_id=str(task_data.project_id),
        token=token
    )

    if not project:
        raise HTTPException(
            status_code=status.HTTP_404_NOT_FOUND,
            detail="é¡¹ç›®ä¸å­˜åœ¨"
        )

    # 2. ä½¿ç”¨é¡¹ç›®ä¿¡æ¯è¿›è¡ŒAIåˆ†æ
    # TODO: å®ç°AIåˆ†æé€»è¾‘
    analysis_result = await perform_requirement_analysis(
        project=project,
        bidding_document=task_data.input_data.get("bidding_document")
    )

    # 3. åˆ›å»ºAIä»»åŠ¡è®°å½•
    ai_task = await create_ai_task(
        task_type="analyze_requirements",
        project_id=task_data.project_id,
        input_data=task_data.input_data,
        output_data=analysis_result
    )

    return AITaskResponse.from_orm(ai_task)


@router.post("/generate-content", response_model=AITaskResponse)
async def generate_content(
    task_data: AITaskCreate,
    token: str = Depends(get_current_user_token),
    java_client: JavaServiceClient = Depends(get_java_client)
):
    """
    ç”Ÿæˆæ ‡ä¹¦å†…å®¹ï¼ˆéœ€è¦é¡¹ç›®èƒŒæ™¯ä¿¡æ¯ï¼‰

    Args:
        task_data: AIä»»åŠ¡åˆ›å»ºæ•°æ®
        token: JWTä»¤ç‰Œ
        java_client: JavaæœåŠ¡å®¢æˆ·ç«¯

    Returns:
        AIä»»åŠ¡å“åº”
    """
    # ä»JavaæœåŠ¡è·å–é¡¹ç›®è¯¦æƒ…
    project = await java_client.get_project_by_id(
        project_id=str(task_data.project_id),
        token=token
    )

    if not project:
        raise HTTPException(
            status_code=status.HTTP_404_NOT_FOUND,
            detail="é¡¹ç›®ä¸å­˜åœ¨"
        )

    # ä½¿ç”¨é¡¹ç›®ä¿¡æ¯ç”Ÿæˆå†…å®¹
    generated_content = await perform_content_generation(
        project=project,
        section_type=task_data.input_data.get("section_type"),
        requirements=task_data.input_data.get("requirements")
    )

    # åˆ›å»ºAIä»»åŠ¡è®°å½•
    ai_task = await create_ai_task(
        task_type="generate_content",
        project_id=task_data.project_id,
        input_data=task_data.input_data,
        output_data={"content": generated_content}
    )

    return AITaskResponse.from_orm(ai_task)
```

**4. JWTä»¤ç‰Œä¼ é€’å’ŒéªŒè¯**

```python
# app/core/security.py
"""å®‰å…¨ç›¸å…³å·¥å…· - JWTä»¤ç‰Œå¤„ç†"""
from fastapi import Depends, HTTPException, status
from fastapi.security import HTTPBearer, HTTPAuthorizationCredentials
from typing import Optional

security = HTTPBearer()


async def get_current_user_token(
    credentials: HTTPAuthorizationCredentials = Depends(security)
) -> str:
    """
    ä»è¯·æ±‚å¤´æå–JWTä»¤ç‰Œ

    Args:
        credentials: HTTP Bearerå‡­è¯

    Returns:
        JWTä»¤ç‰Œå­—ç¬¦ä¸²

    Raises:
        HTTPException: å¦‚æœä»¤ç‰Œæ— æ•ˆ
    """
    if not credentials:
        raise HTTPException(
            status_code=status.HTTP_401_UNAUTHORIZED,
            detail="ç¼ºå°‘è®¤è¯ä»¤ç‰Œ",
            headers={"WWW-Authenticate": "Bearer"},
        )

    token = credentials.credentials

    # PythonæœåŠ¡ä¸éªŒè¯JWTï¼ˆç”±JavaæœåŠ¡éªŒè¯ï¼‰
    # åªè´Ÿè´£ä¼ é€’tokenç»™JavaæœåŠ¡
    return token


async def get_current_user_id(token: str = Depends(get_current_user_token)) -> str:
    """
    ä»JWTä»¤ç‰Œä¸­æå–ç”¨æˆ·IDï¼ˆå¯é€‰ï¼šå¦‚æœPythonæœåŠ¡éœ€è¦è§£ætokenï¼‰

    æ³¨æ„ï¼šå¤§å¤šæ•°æƒ…å†µä¸‹ï¼ŒPythonæœåŠ¡ä¸éœ€è¦è§£æJWTï¼Œ
    åªéœ€è¦å°†tokenåŸæ ·ä¼ é€’ç»™JavaæœåŠ¡å³å¯ã€‚

    Args:
        token: JWTä»¤ç‰Œ

    Returns:
        ç”¨æˆ·ID
    """
    # ç®€å•å®ç°ï¼šä»token payloadæå–user_id
    # æ³¨æ„ï¼šè¿™é‡Œä¸éªŒè¯ç­¾åï¼Œåªæ˜¯è¯»å–payload
    try:
        import jwt
        payload = jwt.decode(token, options={"verify_signature": False})
        return payload.get("user_id")
    except Exception:
        raise HTTPException(
            status_code=status.HTTP_401_UNAUTHORIZED,
            detail="æ— æ•ˆçš„ä»¤ç‰Œæ ¼å¼"
        )
```

**5. ç¯å¢ƒé…ç½®**

```python
# app/core/config.py
"""åº”ç”¨é…ç½®"""
from pydantic_settings import BaseSettings
from typing import Optional


class Settings(BaseSettings):
    """åº”ç”¨è®¾ç½®"""

    # åº”ç”¨åŸºæœ¬é…ç½®
    APP_NAME: str = "AIBidComposer AI Service"
    VERSION: str = "1.0.0"
    ENVIRONMENT: str = "development"

    # JavaæœåŠ¡é…ç½®
    JAVA_SERVICE_URL: str = "http://backend-java-service:8080"
    JAVA_SERVICE_TIMEOUT: int = 30  # ç§’

    # Redisé…ç½®
    REDIS_URL: str = "redis://redis:6379/0"

    # Elasticsearché…ç½®
    ELASTICSEARCH_URL: str = "http://elasticsearch:9200"
    ELASTICSEARCH_USER: str = "elastic"
    ELASTICSEARCH_PASSWORD: str = "elastic"

    # AIæœåŠ¡é…ç½®
    OPENAI_API_KEY: str
    ANTHROPIC_API_KEY: Optional[str] = None

    # RabbitMQé…ç½®
    RABBITMQ_URL: str = "amqp://rabbitmq:rabbitmq@rabbitmq:5672/"

    class Config:
        env_file = ".env"
        case_sensitive = True


settings = Settings()
```

**6. é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶**

```python
# app/clients/retry_client.py
"""å¸¦é‡è¯•æœºåˆ¶çš„HTTPå®¢æˆ·ç«¯åŒ…è£…å™¨"""
import httpx
from tenacity import (
    retry,
    stop_after_attempt,
    wait_exponential,
    retry_if_exception_type
)
from app.core.logging import logger


class RetryableJavaClient:
    """å¸¦é‡è¯•æœºåˆ¶çš„JavaæœåŠ¡å®¢æˆ·ç«¯"""

    def __init__(self, base_client: httpx.AsyncClient):
        self.client = base_client

    @retry(
        stop=stop_after_attempt(3),
        wait=wait_exponential(multiplier=1, min=2, max=10),
        retry=retry_if_exception_type((httpx.ConnectError, httpx.TimeoutException)),
        before_sleep=lambda retry_state: logger.warning(
            f"é‡è¯•JavaæœåŠ¡è°ƒç”¨ï¼Œç¬¬ {retry_state.attempt_number} æ¬¡å°è¯•"
        )
    )
    async def get_with_retry(self, url: str, **kwargs) -> httpx.Response:
        """
        å¸¦é‡è¯•çš„GETè¯·æ±‚

        Args:
            url: è¯·æ±‚URL
            **kwargs: httpx.getå‚æ•°

        Returns:
            HTTPå“åº”

        Raises:
            httpx.HTTPError: è¯·æ±‚å¤±è´¥ä¸”é‡è¯•è€—å°½
        """
        response = await self.client.get(url, **kwargs)
        response.raise_for_status()
        return response

    @retry(
        stop=stop_after_attempt(3),
        wait=wait_exponential(multiplier=1, min=2, max=10),
        retry=retry_if_exception_type((httpx.ConnectError, httpx.TimeoutException))
    )
    async def post_with_retry(self, url: str, **kwargs) -> httpx.Response:
        """
        å¸¦é‡è¯•çš„POSTè¯·æ±‚

        Args:
            url: è¯·æ±‚URL
            **kwargs: httpx.postå‚æ•°

        Returns:
            HTTPå“åº”
        """
        response = await self.client.post(url, **kwargs)
        response.raise_for_status()
        return response
```

**7. é›†æˆæµ‹è¯•ç¤ºä¾‹**

```python
# tests/integration/test_java_client_integration.py
"""JavaæœåŠ¡å®¢æˆ·ç«¯é›†æˆæµ‹è¯•"""
import pytest
from httpx import AsyncClient
from app.clients.java_client import JavaServiceClient
from app.core.config import settings


@pytest.fixture
async def java_client():
    """åˆ›å»ºJavaæœåŠ¡å®¢æˆ·ç«¯fixture"""
    client = JavaServiceClient()
    yield client
    await client.close()


@pytest.fixture
def mock_jwt_token():
    """æ¨¡æ‹ŸJWTä»¤ç‰Œ"""
    return "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.test.signature"


@pytest.mark.asyncio
@pytest.mark.integration
async def test_get_project_by_id_success(java_client, mock_jwt_token):
    """æµ‹è¯•ï¼šæˆåŠŸè·å–é¡¹ç›®è¯¦æƒ…"""
    # Given
    project_id = "550e8400-e29b-41d4-a716-446655440000"

    # When
    project = await java_client.get_project_by_id(
        project_id=project_id,
        token=mock_jwt_token
    )

    # Then
    assert project is not None
    assert str(project.id) == project_id
    assert project.name is not None
    assert project.status is not None


@pytest.mark.asyncio
@pytest.mark.integration
async def test_get_project_not_found(java_client, mock_jwt_token):
    """æµ‹è¯•ï¼šé¡¹ç›®ä¸å­˜åœ¨"""
    # Given
    invalid_project_id = "00000000-0000-0000-0000-000000000000"

    # When
    project = await java_client.get_project_by_id(
        project_id=invalid_project_id,
        token=mock_jwt_token
    )

    # Then
    assert project is None


@pytest.mark.asyncio
@pytest.mark.integration
async def test_get_projects_with_filters(java_client, mock_jwt_token):
    """æµ‹è¯•ï¼šå¸¦è¿‡æ»¤æ¡ä»¶æŸ¥è¯¢é¡¹ç›®åˆ—è¡¨"""
    # Given
    organization_id = "550e8400-e29b-41d4-a716-446655440000"

    # When
    projects = await java_client.get_projects(
        organization_id=organization_id,
        token=mock_jwt_token,
        status="IN_PROGRESS",
        priority="HIGH",
        page=1,
        page_size=10
    )

    # Then
    assert projects is not None
    assert projects.total >= 0
    assert len(projects.items) <= 10
    assert all(p.status == "IN_PROGRESS" for p in projects.items)


@pytest.mark.asyncio
@pytest.mark.integration
async def test_unauthorized_request(java_client):
    """æµ‹è¯•ï¼šæœªæˆæƒè¯·æ±‚"""
    # Given
    project_id = "550e8400-e29b-41d4-a716-446655440000"
    invalid_token = "invalid_token"

    # When & Then
    with pytest.raises(Exception) as exc_info:
        await java_client.get_project_by_id(
            project_id=project_id,
            token=invalid_token
        )

    assert "401" in str(exc_info.value) or "Unauthorized" in str(exc_info.value)
```

**8. Docker Composeé…ç½®æ›´æ–°**

```yaml
# docker-compose.ymlï¼ˆå¢é‡æ›´æ–°ï¼‰
services:
  backend-python:
    environment:
      # æ·»åŠ JavaæœåŠ¡URLé…ç½®
      - JAVA_SERVICE_URL=http://backend-java:8080
      - JAVA_SERVICE_TIMEOUT=30
    depends_on:
      - backend-java  # ç¡®ä¿JavaæœåŠ¡å…ˆå¯åŠ¨
```

**9. Kubernetesé…ç½®æ›´æ–°**

```yaml
# k8s/deployments/backend-python-deployment.yamlï¼ˆå¢é‡æ›´æ–°ï¼‰
spec:
  template:
    spec:
      containers:
      - name: backend-python
        env:
        - name: JAVA_SERVICE_URL
          value: "http://backend-java-service:8080"
        - name: JAVA_SERVICE_TIMEOUT
          value: "30"
```

##### å…³é”®æŠ€æœ¯ç‚¹

**1. æœåŠ¡é—´é€šä¿¡æ¨¡å¼**
- PythonæœåŠ¡ä¸ç›´æ¥è®¿é—®PostgreSQLæ•°æ®åº“
- é€šè¿‡HTTP REST APIè°ƒç”¨JavaæœåŠ¡è·å–ä¸šåŠ¡æ•°æ®
- ä½¿ç”¨JWTä»¤ç‰Œè¿›è¡Œèº«ä»½ä¼ é€’ï¼ˆé€ä¼ ï¼‰

**2. JWTä»¤ç‰Œå¤„ç†**
- PythonæœåŠ¡ä¸éªŒè¯JWTç­¾åï¼ˆç”±JavaæœåŠ¡éªŒè¯ï¼‰
- åªè´Ÿè´£ä»è¯·æ±‚å¤´æå–tokenå¹¶ä¼ é€’ç»™JavaæœåŠ¡
- ç®€åŒ–äº†PythonæœåŠ¡çš„å®‰å…¨é€»è¾‘

**3. é”™è¯¯å¤„ç†ç­–ç•¥**
- ç½‘ç»œé”™è¯¯ï¼ˆè¿æ¥è¶…æ—¶ã€DNSå¤±è´¥ï¼‰ï¼šä½¿ç”¨é‡è¯•æœºåˆ¶
- HTTPé”™è¯¯ï¼ˆ4xxã€5xxï¼‰ï¼šè®°å½•æ—¥å¿—å¹¶å‘ä¸Šä¼ é€’å¼‚å¸¸
- ä¸šåŠ¡é”™è¯¯ï¼ˆé¡¹ç›®ä¸å­˜åœ¨ï¼‰ï¼šè¿”å›Noneæˆ–æŠ›å‡ºHTTPException

**4. æ€§èƒ½ä¼˜åŒ–**
- ä½¿ç”¨httpxæŒä¹…åŒ–è¿æ¥ï¼ˆè¿æ¥æ± ï¼‰
- é…ç½®åˆç†çš„è¶…æ—¶æ—¶é—´ï¼ˆè¿æ¥5ç§’ï¼Œæ€»å…±30ç§’ï¼‰
- é™åˆ¶æœ€å¤§è¿æ¥æ•°ï¼ˆé˜²æ­¢èµ„æºè€—å°½ï¼‰

**5. ä¾èµ–æ³¨å…¥**
- FastAPIçš„Dependsæœºåˆ¶æ³¨å…¥Javaå®¢æˆ·ç«¯
- å…¨å±€å•ä¾‹å®¢æˆ·ç«¯å®ä¾‹ï¼ˆé¿å…é‡å¤åˆ›å»ºï¼‰
- åº”ç”¨ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼ˆstartup/shutdownäº‹ä»¶ï¼‰

##### éƒ¨ç½²æ³¨æ„äº‹é¡¹

**1. æœåŠ¡å‘ç°**
- å¼€å‘ç¯å¢ƒï¼šä½¿ç”¨Docker ComposeæœåŠ¡åï¼ˆbackend-javaï¼‰
- Kubernetesï¼šä½¿ç”¨Service DNSåï¼ˆbackend-java-service.aibidcomposer.svc.cluster.localï¼‰

**2. å¥åº·æ£€æŸ¥**
- PythonæœåŠ¡å¯åŠ¨å‰éœ€ç¡®ä¿JavaæœåŠ¡å·²å°±ç»ª
- Kubernetesæ¢é’ˆé…ç½®initialDelaySecondsç•™å‡ºè¶³å¤Ÿå¯åŠ¨æ—¶é—´

**3. ç¯å¢ƒå˜é‡é…ç½®**
```bash
# .envæ–‡ä»¶ç¤ºä¾‹
JAVA_SERVICE_URL=http://backend-java-service:8080
JAVA_SERVICE_TIMEOUT=30
```

---

#### 2.2.5 éƒ¨ç½²

> **ç›®æ ‡**: ç¡®ä¿é¡¹ç›®ç®¡ç†åŠŸèƒ½åœ¨Dockerå’ŒKubernetesç¯å¢ƒä¸­æ­£ç¡®éƒ¨ç½²å’Œè¿è¡Œ

##### éªŒè¯æ¸…å•

**éªŒè¯æ¸…å•**:
- [ ] Docker Composeé…ç½®æ›´æ–°å®Œæˆ
- [ ] Kubernetesèµ„æºæ¸…å•æ›´æ–°å®Œæˆ
- [ ] æœåŠ¡é—´ç½‘ç»œé€šä¿¡é…ç½®å®Œæˆ
- [ ] ç¯å¢ƒå˜é‡é…ç½®å®Œæˆ
- [ ] å¥åº·æ£€æŸ¥é…ç½®å®Œæˆ
- [ ] éƒ¨ç½²è„šæœ¬æ›´æ–°å®Œæˆ
- [ ] æœ¬åœ°ç¯å¢ƒæµ‹è¯•é€šè¿‡
- [ ] Kubernetesç¯å¢ƒæµ‹è¯•é€šè¿‡

##### Docker Composeé…ç½®

**1. å®Œæ•´çš„docker-compose.ymlæ›´æ–°**

```yaml
# docker-compose.yml
version: '3.8'

services:
  # PostgreSQLæ•°æ®åº“
  postgres:
    image: postgres:14-alpine
    container_name: aibidcomposer-postgres
    environment:
      POSTGRES_DB: aibidcomposer
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-postgres}
      TZ: Asia/Shanghai
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data
      - ./docker/postgres/init.sql:/docker-entrypoint-initdb.d/init.sql
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U postgres"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - aibidcomposer-network

  # Redisç¼“å­˜
  redis:
    image: redis:7-alpine
    container_name: aibidcomposer-redis
    command: redis-server --appendonly yes --requirepass ${REDIS_PASSWORD:-redis}
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 3s
      retries: 5
    networks:
      - aibidcomposer-network

  # Elasticsearchï¼ˆå‘é‡å­˜å‚¨ï¼‰
  elasticsearch:
    image: docker.elastic.co/elasticsearch/elasticsearch:8.11.0
    container_name: aibidcomposer-elasticsearch
    environment:
      - discovery.type=single-node
      - xpack.security.enabled=true
      - ELASTIC_PASSWORD=${ELASTICSEARCH_PASSWORD:-elastic}
      - "ES_JAVA_OPTS=-Xms2g -Xmx2g"
    ports:
      - "9200:9200"
    volumes:
      - elasticsearch_data:/usr/share/elasticsearch/data
    healthcheck:
      test: ["CMD-SHELL", "curl -u elastic:${ELASTICSEARCH_PASSWORD:-elastic} -f http://localhost:9200/_cluster/health || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 5
    networks:
      - aibidcomposer-network

  # RabbitMQæ¶ˆæ¯é˜Ÿåˆ—
  rabbitmq:
    image: rabbitmq:3-management-alpine
    container_name: aibidcomposer-rabbitmq
    environment:
      RABBITMQ_DEFAULT_USER: ${RABBITMQ_USER:-rabbitmq}
      RABBITMQ_DEFAULT_PASS: ${RABBITMQ_PASSWORD:-rabbitmq}
    ports:
      - "5672:5672"
      - "15672:15672"
    volumes:
      - rabbitmq_data:/var/lib/rabbitmq
    healthcheck:
      test: ["CMD", "rabbitmq-diagnostics", "ping"]
      interval: 30s
      timeout: 10s
      retries: 5
    networks:
      - aibidcomposer-network

  # MinIOå¯¹è±¡å­˜å‚¨
  minio:
    image: minio/minio:latest
    container_name: aibidcomposer-minio
    command: server /data --console-address ":9001"
    environment:
      MINIO_ROOT_USER: ${MINIO_ROOT_USER:-minioadmin}
      MINIO_ROOT_PASSWORD: ${MINIO_ROOT_PASSWORD:-minioadmin}
    ports:
      - "9000:9000"
      - "9001:9001"
    volumes:
      - minio_data:/data
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9000/minio/health/live"]
      interval: 30s
      timeout: 20s
      retries: 3
    networks:
      - aibidcomposer-network

  # Java Spring BootæœåŠ¡ï¼ˆæ ¸å¿ƒä¸šåŠ¡ï¼‰
  backend-java:
    build:
      context: ./apps/backend-java
      dockerfile: Dockerfile.dev
    container_name: aibidcomposer-backend-java
    environment:
      # Springé…ç½®
      SPRING_PROFILES_ACTIVE: dev
      SPRING_DATASOURCE_URL: jdbc:postgresql://postgres:5432/aibidcomposer
      SPRING_DATASOURCE_USERNAME: postgres
      SPRING_DATASOURCE_PASSWORD: ${POSTGRES_PASSWORD:-postgres}

      # Redisé…ç½®
      SPRING_REDIS_HOST: redis
      SPRING_REDIS_PASSWORD: ${REDIS_PASSWORD:-redis}

      # RabbitMQé…ç½®
      SPRING_RABBITMQ_HOST: rabbitmq
      SPRING_RABBITMQ_USERNAME: ${RABBITMQ_USER:-rabbitmq}
      SPRING_RABBITMQ_PASSWORD: ${RABBITMQ_PASSWORD:-rabbitmq}

      # MinIOé…ç½®
      MINIO_ENDPOINT: http://minio:9000
      MINIO_ACCESS_KEY: ${MINIO_ROOT_USER:-minioadmin}
      MINIO_SECRET_KEY: ${MINIO_ROOT_PASSWORD:-minioadmin}

      # Python AIæœåŠ¡URL
      AI_SERVICE_URL: http://backend-python:8001

      # JWTå¯†é’¥
      JWT_SECRET: ${SECRET_KEY}
      JWT_EXPIRATION: 3600000
    ports:
      - "8080:8080"
    depends_on:
      postgres:
        condition: service_healthy
      redis:
        condition: service_healthy
      rabbitmq:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/actuator/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s
    volumes:
      - ./apps/backend-java/src:/app/src
      - ./apps/backend-java/target:/app/target
    networks:
      - aibidcomposer-network

  # Python FastAPI AIæœåŠ¡
  backend-python:
    build:
      context: ./apps/backend-python
      dockerfile: Dockerfile
    container_name: aibidcomposer-backend-python
    environment:
      # Redisé…ç½®
      REDIS_URL: redis://:${REDIS_PASSWORD:-redis}@redis:6379/0

      # RabbitMQé…ç½®
      RABBITMQ_URL: amqp://${RABBITMQ_USER:-rabbitmq}:${RABBITMQ_PASSWORD:-rabbitmq}@rabbitmq:5672/

      # Elasticsearché…ç½®
      ELASTICSEARCH_URL: http://elasticsearch:9200
      ELASTICSEARCH_USER: elastic
      ELASTICSEARCH_PASSWORD: ${ELASTICSEARCH_PASSWORD:-elastic}

      # JavaæœåŠ¡URLï¼ˆæ–°å¢ï¼‰
      JAVA_SERVICE_URL: http://backend-java:8080
      JAVA_SERVICE_TIMEOUT: 30

      # AI APIå¯†é’¥
      OPENAI_API_KEY: ${OPENAI_API_KEY}
      ANTHROPIC_API_KEY: ${ANTHROPIC_API_KEY}
    ports:
      - "8001:8001"
    depends_on:
      - redis
      - rabbitmq
      - elasticsearch
      - backend-java  # ç¡®ä¿JavaæœåŠ¡å…ˆå¯åŠ¨
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8001/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s
    volumes:
      - ./apps/backend-python/app:/app/app
    networks:
      - aibidcomposer-network
    command: uvicorn app.main:app --host 0.0.0.0 --port 8001 --reload

  # Python AI Worker (Celery)
  ai-worker:
    build:
      context: ./apps/backend-python
      dockerfile: Dockerfile
    container_name: aibidcomposer-ai-worker
    environment:
      REDIS_URL: redis://:${REDIS_PASSWORD:-redis}@redis:6379/0
      RABBITMQ_URL: amqp://${RABBITMQ_USER:-rabbitmq}:${RABBITMQ_PASSWORD:-rabbitmq}@rabbitmq:5672/
      ELASTICSEARCH_URL: http://elasticsearch:9200
      ELASTICSEARCH_PASSWORD: ${ELASTICSEARCH_PASSWORD:-elastic}
      JAVA_SERVICE_URL: http://backend-java:8080
      OPENAI_API_KEY: ${OPENAI_API_KEY}
    depends_on:
      - redis
      - rabbitmq
      - elasticsearch
      - backend-java
    networks:
      - aibidcomposer-network
    command: celery -A app.tasks.celery_app worker --loglevel=info -Q ai_tasks

  # å‰ç«¯åº”ç”¨
  frontend:
    build:
      context: ./apps/frontend
      dockerfile: Dockerfile.dev
    container_name: aibidcomposer-frontend
    ports:
      - "5173:5173"
    volumes:
      - ./apps/frontend/src:/app/src
      - ./apps/frontend/public:/app/public
    environment:
      VITE_API_BASE_URL: http://localhost:8080
      VITE_AI_API_BASE_URL: http://localhost:8001
      VITE_WS_BASE_URL: ws://localhost:8080
    networks:
      - aibidcomposer-network
    command: npm run dev

volumes:
  postgres_data:
  redis_data:
  elasticsearch_data:
  rabbitmq_data:
  minio_data:

networks:
  aibidcomposer-network:
    driver: bridge
```

##### Kubernetesé…ç½®

**1. JavaæœåŠ¡Deploymentæ›´æ–°**

```yaml
# k8s/deployments/backend-java-deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: backend-java
  namespace: aibidcomposer
  labels:
    app: backend-java
    version: v1
spec:
  replicas: 3
  selector:
    matchLabels:
      app: backend-java
  template:
    metadata:
      labels:
        app: backend-java
        version: v1
    spec:
      containers:
      - name: backend-java
        image: aibidcomposer/backend-java:latest
        imagePullPolicy: Always
        ports:
        - containerPort: 8080
          name: http
        env:
        - name: SPRING_PROFILES_ACTIVE
          value: "prod"
        - name: SPRING_DATASOURCE_URL
          value: "jdbc:postgresql://postgres-service:5432/aibidcomposer"
        - name: SPRING_DATASOURCE_USERNAME
          value: "postgres"
        - name: SPRING_DATASOURCE_PASSWORD
          valueFrom:
            secretKeyRef:
              name: database-secret
              key: POSTGRES_PASSWORD
        - name: SPRING_REDIS_HOST
          value: "redis-service"
        - name: SPRING_REDIS_PASSWORD
          valueFrom:
            secretKeyRef:
              name: redis-secret
              key: REDIS_PASSWORD
        - name: SPRING_RABBITMQ_HOST
          value: "rabbitmq-service"
        - name: SPRING_RABBITMQ_USERNAME
          valueFrom:
            secretKeyRef:
              name: rabbitmq-secret
              key: RABBITMQ_USER
        - name: SPRING_RABBITMQ_PASSWORD
          valueFrom:
            secretKeyRef:
              name: rabbitmq-secret
              key: RABBITMQ_PASSWORD
        - name: AI_SERVICE_URL
          value: "http://backend-python-service:8001"
        - name: JWT_SECRET
          valueFrom:
            secretKeyRef:
              name: jwt-secret
              key: JWT_SECRET
        resources:
          requests:
            memory: "1Gi"
            cpu: "500m"
          limits:
            memory: "2Gi"
            cpu: "1000m"
        livenessProbe:
          httpGet:
            path: /actuator/health/liveness
            port: 8080
          initialDelaySeconds: 60
          periodSeconds: 10
          timeoutSeconds: 5
          failureThreshold: 3
        readinessProbe:
          httpGet:
            path: /actuator/health/readiness
            port: 8080
          initialDelaySeconds: 30
          periodSeconds: 5
          timeoutSeconds: 3
          failureThreshold: 3
---
apiVersion: v1
kind: Service
metadata:
  name: backend-java-service
  namespace: aibidcomposer
spec:
  selector:
    app: backend-java
  ports:
  - protocol: TCP
    port: 8080
    targetPort: 8080
  type: ClusterIP
```

**2. PythonæœåŠ¡Deploymentæ›´æ–°**

```yaml
# k8s/deployments/backend-python-deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: backend-python
  namespace: aibidcomposer
  labels:
    app: backend-python
    version: v1
spec:
  replicas: 2
  selector:
    matchLabels:
      app: backend-python
  template:
    metadata:
      labels:
        app: backend-python
        version: v1
    spec:
      containers:
      - name: backend-python
        image: aibidcomposer/backend-python:latest
        imagePullPolicy: Always
        ports:
        - containerPort: 8001
          name: http
        env:
        - name: REDIS_URL
          valueFrom:
            secretKeyRef:
              name: redis-secret
              key: REDIS_URL
        - name: RABBITMQ_URL
          valueFrom:
            secretKeyRef:
              name: rabbitmq-secret
              key: RABBITMQ_URL
        - name: ELASTICSEARCH_URL
          value: "http://elasticsearch-service:9200"
        - name: ELASTICSEARCH_USER
          value: "elastic"
        - name: ELASTICSEARCH_PASSWORD
          valueFrom:
            secretKeyRef:
              name: elasticsearch-secret
              key: ELASTIC_PASSWORD
        - name: JAVA_SERVICE_URL
          value: "http://backend-java-service:8080"
        - name: JAVA_SERVICE_TIMEOUT
          value: "30"
        - name: OPENAI_API_KEY
          valueFrom:
            secretKeyRef:
              name: api-keys-secret
              key: OPENAI_API_KEY
        - name: ANTHROPIC_API_KEY
          valueFrom:
            secretKeyRef:
              name: api-keys-secret
              key: ANTHROPIC_API_KEY
        resources:
          requests:
            memory: "2Gi"
            cpu: "1000m"
          limits:
            memory: "4Gi"
            cpu: "2000m"
        livenessProbe:
          httpGet:
            path: /health
            port: 8001
          initialDelaySeconds: 30
          periodSeconds: 10
          timeoutSeconds: 5
        readinessProbe:
          httpGet:
            path: /health
            port: 8001
          initialDelaySeconds: 10
          periodSeconds: 5
          timeoutSeconds: 3
---
apiVersion: v1
kind: Service
metadata:
  name: backend-python-service
  namespace: aibidcomposer
spec:
  selector:
    app: backend-python
  ports:
  - protocol: TCP
    port: 8001
    targetPort: 8001
  type: ClusterIP
```

**3. Secretsé…ç½®**

```yaml
# k8s/secrets/jwt-secret.yaml
apiVersion: v1
kind: Secret
metadata:
  name: jwt-secret
  namespace: aibidcomposer
type: Opaque
stringData:
  JWT_SECRET: "your-jwt-secret-key-min-32-characters"
```

**4. NetworkPolicyï¼ˆæœåŠ¡é—´é€šä¿¡é™åˆ¶ï¼‰**

```yaml
# k8s/network-policies/backend-network-policy.yaml
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: backend-network-policy
  namespace: aibidcomposer
spec:
  podSelector:
    matchLabels:
      app: backend-python
  policyTypes:
  - Egress
  egress:
  # å…è®¸è®¿é—®JavaæœåŠ¡
  - to:
    - podSelector:
        matchLabels:
          app: backend-java
    ports:
    - protocol: TCP
      port: 8080
  # å…è®¸è®¿é—®Elasticsearch
  - to:
    - podSelector:
        matchLabels:
          app: elasticsearch
    ports:
    - protocol: TCP
      port: 9200
  # å…è®¸è®¿é—®Redis
  - to:
    - podSelector:
        matchLabels:
          app: redis
    ports:
    - protocol: TCP
      port: 6379
  # å…è®¸è®¿é—®RabbitMQ
  - to:
    - podSelector:
        matchLabels:
          app: rabbitmq
    ports:
    - protocol: TCP
      port: 5672
  # å…è®¸DNSæŸ¥è¯¢
  - to:
    - namespaceSelector:
        matchLabels:
          name: kube-system
    ports:
    - protocol: UDP
      port: 53
```

##### éƒ¨ç½²è„šæœ¬

**1. æœ¬åœ°ç¯å¢ƒå¯åŠ¨è„šæœ¬**

```bash
#!/bin/bash
# scripts/start-dev.sh
# æœ¬åœ°å¼€å‘ç¯å¢ƒå¯åŠ¨è„šæœ¬

set -e

echo "========================================="
echo "å¯åŠ¨ AIBidComposer æœ¬åœ°å¼€å‘ç¯å¢ƒ"
echo "========================================="

# æ£€æŸ¥Dockeræ˜¯å¦è¿è¡Œ
if ! docker info > /dev/null 2>&1; then
  echo "âŒ Dockeræœªè¿è¡Œï¼Œè¯·å…ˆå¯åŠ¨Docker"
  exit 1
fi

# æ£€æŸ¥.envæ–‡ä»¶
if [ ! -f .env ]; then
  echo "âš ï¸  .envæ–‡ä»¶ä¸å­˜åœ¨ï¼Œä».env.exampleåˆ›å»º"
  cp .env.example .env
  echo "âœ… è¯·ç¼–è¾‘.envæ–‡ä»¶ï¼Œå¡«å†™å¿…è¦çš„é…ç½®é¡¹ï¼ˆå¦‚APIå¯†é’¥ï¼‰"
  exit 1
fi

# å¯åŠ¨æ‰€æœ‰æœåŠ¡
echo "ğŸš€ å¯åŠ¨æ‰€æœ‰æœåŠ¡..."
docker-compose up -d

# ç­‰å¾…æœåŠ¡å°±ç»ª
echo "â³ ç­‰å¾…æœåŠ¡å°±ç»ª..."

# ç­‰å¾…PostgreSQL
echo "   - ç­‰å¾…PostgreSQL..."
until docker-compose exec -T postgres pg_isready -U postgres > /dev/null 2>&1; do
  sleep 1
done
echo "   âœ… PostgreSQLå°±ç»ª"

# ç­‰å¾…JavaæœåŠ¡
echo "   - ç­‰å¾…JavaæœåŠ¡..."
until curl -f http://localhost:8080/actuator/health > /dev/null 2>&1; do
  sleep 2
done
echo "   âœ… JavaæœåŠ¡å°±ç»ª"

# ç­‰å¾…PythonæœåŠ¡
echo "   - ç­‰å¾…PythonæœåŠ¡..."
until curl -f http://localhost:8001/health > /dev/null 2>&1; do
  sleep 2
done
echo "   âœ… PythonæœåŠ¡å°±ç»ª"

echo ""
echo "========================================="
echo "âœ… æ‰€æœ‰æœåŠ¡å¯åŠ¨å®Œæˆï¼"
echo "========================================="
echo ""
echo "æœåŠ¡è®¿é—®åœ°å€ï¼š"
echo "  - å‰ç«¯: http://localhost:5173"
echo "  - Java API: http://localhost:8080"
echo "  - Python AI API: http://localhost:8001"
echo "  - APIæ–‡æ¡£(Java): http://localhost:8080/swagger-ui.html"
echo "  - APIæ–‡æ¡£(Python): http://localhost:8001/docs"
echo "  - RabbitMQç®¡ç†: http://localhost:15672 (rabbitmq/rabbitmq)"
echo "  - MinIOæ§åˆ¶å°: http://localhost:9001 (minioadmin/minioadmin)"
echo ""
echo "æŸ¥çœ‹æ—¥å¿—: docker-compose logs -f [service-name]"
echo "åœæ­¢æœåŠ¡: docker-compose down"
echo "========================================="
```

**2. Kuberneteséƒ¨ç½²è„šæœ¬**

```bash
#!/bin/bash
# scripts/deploy-k8s.sh
# Kuberneteséƒ¨ç½²è„šæœ¬

set -e

NAMESPACE="aibidcomposer"
ENVIRONMENT=${1:-production}

echo "========================================="
echo "éƒ¨ç½² AIBidComposer åˆ° Kubernetes"
echo "ç¯å¢ƒ: $ENVIRONMENT"
echo "========================================="

# åˆ›å»ºå‘½åç©ºé—´
echo "ğŸ“¦ åˆ›å»ºå‘½åç©ºé—´..."
kubectl create namespace $NAMESPACE --dry-run=client -o yaml | kubectl apply -f -

# åº”ç”¨Secrets
echo "ğŸ” åº”ç”¨Secrets..."
kubectl apply -f k8s/secrets/ -n $NAMESPACE

# åº”ç”¨ConfigMaps
echo "âš™ï¸  åº”ç”¨ConfigMaps..."
kubectl apply -f k8s/configmaps/ -n $NAMESPACE

# éƒ¨ç½²æ•°æ®æœåŠ¡ï¼ˆStatefulSetsï¼‰
echo "ğŸ’¾ éƒ¨ç½²æ•°æ®æœåŠ¡..."
kubectl apply -f k8s/statefulsets/postgres-statefulset.yaml -n $NAMESPACE
kubectl apply -f k8s/statefulsets/redis-statefulset.yaml -n $NAMESPACE
kubectl apply -f k8s/statefulsets/elasticsearch-statefulset.yaml -n $NAMESPACE
kubectl apply -f k8s/statefulsets/rabbitmq-statefulset.yaml -n $NAMESPACE

# ç­‰å¾…æ•°æ®æœåŠ¡å°±ç»ª
echo "â³ ç­‰å¾…æ•°æ®æœåŠ¡å°±ç»ª..."
kubectl wait --for=condition=ready pod -l app=postgres -n $NAMESPACE --timeout=300s
kubectl wait --for=condition=ready pod -l app=redis -n $NAMESPACE --timeout=300s
kubectl wait --for=condition=ready pod -l app=elasticsearch -n $NAMESPACE --timeout=300s
kubectl wait --for=condition=ready pod -l app=rabbitmq -n $NAMESPACE --timeout=300s

# éƒ¨ç½²åº”ç”¨æœåŠ¡ï¼ˆå…ˆJavaï¼ŒåPythonï¼‰
echo "ğŸš€ éƒ¨ç½²åº”ç”¨æœåŠ¡..."
kubectl apply -f k8s/deployments/backend-java-deployment.yaml -n $NAMESPACE

echo "â³ ç­‰å¾…JavaæœåŠ¡å°±ç»ª..."
kubectl wait --for=condition=available deployment/backend-java -n $NAMESPACE --timeout=300s

kubectl apply -f k8s/deployments/backend-python-deployment.yaml -n $NAMESPACE
kubectl apply -f k8s/deployments/frontend-deployment.yaml -n $NAMESPACE

# åº”ç”¨HPA
echo "ğŸ“Š åº”ç”¨HPA..."
kubectl apply -f k8s/hpa/ -n $NAMESPACE

# åº”ç”¨NetworkPolicy
echo "ğŸ”’ åº”ç”¨NetworkPolicy..."
kubectl apply -f k8s/network-policies/ -n $NAMESPACE

# åº”ç”¨Ingress
echo "ğŸŒ åº”ç”¨Ingress..."
kubectl apply -f k8s/ingress/ingress.yaml -n $NAMESPACE

# æ£€æŸ¥éƒ¨ç½²çŠ¶æ€
echo ""
echo "========================================="
echo "éƒ¨ç½²çŠ¶æ€æ£€æŸ¥"
echo "========================================="
kubectl get pods -n $NAMESPACE
kubectl get svc -n $NAMESPACE
kubectl get ingress -n $NAMESPACE

echo ""
echo "âœ… éƒ¨ç½²å®Œæˆï¼"
echo "========================================="
```

##### ç¯å¢ƒå˜é‡é…ç½®æ–‡ä»¶

```bash
# .env.example
# å¤åˆ¶æ­¤æ–‡ä»¶ä¸º.envå¹¶å¡«å†™å®é™…å€¼

# ====================
# æ•°æ®åº“é…ç½®
# ====================
POSTGRES_PASSWORD=your_secure_password
DATABASE_URL=postgresql://postgres:your_secure_password@postgres:5432/aibidcomposer

# ====================
# Redisé…ç½®
# ====================
REDIS_PASSWORD=your_redis_password
REDIS_URL=redis://:your_redis_password@redis:6379/0

# ====================
# Elasticsearché…ç½®
# ====================
ELASTICSEARCH_PASSWORD=your_elasticsearch_password
ELASTICSEARCH_URL=http://elasticsearch:9200

# ====================
# RabbitMQé…ç½®
# ====================
RABBITMQ_USER=rabbitmq
RABBITMQ_PASSWORD=your_rabbitmq_password
RABBITMQ_URL=amqp://rabbitmq:your_rabbitmq_password@rabbitmq:5672/

# ====================
# MinIOé…ç½®
# ====================
MINIO_ROOT_USER=minioadmin
MINIO_ROOT_PASSWORD=your_minio_password

# ====================
# åº”ç”¨é…ç½®
# ====================
SECRET_KEY=your_jwt_secret_key_min_32_characters_long
JWT_EXPIRATION=3600000

# ====================
# AIæœåŠ¡é…ç½®
# ====================
OPENAI_API_KEY=sk-your-openai-api-key
ANTHROPIC_API_KEY=your-anthropic-api-key

# ====================
# æœåŠ¡URLé…ç½®
# ====================
JAVA_SERVICE_URL=http://backend-java:8080
AI_SERVICE_URL=http://backend-python:8001

# ====================
# å‰ç«¯é…ç½®
# ====================
VITE_API_BASE_URL=http://localhost:8080
VITE_AI_API_BASE_URL=http://localhost:8001
VITE_WS_BASE_URL=ws://localhost:8080
```

##### æµ‹è¯•éªŒè¯æ­¥éª¤

**æœ¬åœ°ç¯å¢ƒæµ‹è¯•**:

```bash
# 1. å¯åŠ¨æ‰€æœ‰æœåŠ¡
./scripts/start-dev.sh

# 2. æµ‹è¯•JavaæœåŠ¡å¥åº·æ£€æŸ¥
curl http://localhost:8080/actuator/health

# 3. æµ‹è¯•PythonæœåŠ¡å¥åº·æ£€æŸ¥
curl http://localhost:8001/health

# 4. æµ‹è¯•JavaæœåŠ¡APIï¼ˆéœ€è¦å…ˆè·å–JWT tokenï¼‰
curl -X POST http://localhost:8080/api/v1/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"test@example.com","password":"password"}'

# 5. ä½¿ç”¨tokenè®¿é—®é¡¹ç›®API
curl http://localhost:8080/api/v1/projects \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -H "Content-Type: application/json"

# 6. æµ‹è¯•PythonæœåŠ¡è°ƒç”¨JavaæœåŠ¡
curl -X POST http://localhost:8001/api/v1/ai/analyze-requirements \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"project_id":"uuid","input_data":{}}'

# 7. æ£€æŸ¥æœåŠ¡æ—¥å¿—
docker-compose logs -f backend-java
docker-compose logs -f backend-python
```

**Kubernetesç¯å¢ƒæµ‹è¯•**:

```bash
# 1. éƒ¨ç½²åˆ°Kubernetes
./scripts/deploy-k8s.sh production

# 2. ç«¯å£è½¬å‘æµ‹è¯•
kubectl port-forward -n aibidcomposer svc/backend-java-service 8080:8080
kubectl port-forward -n aibidcomposer svc/backend-python-service 8001:8001

# 3. æµ‹è¯•å¥åº·æ£€æŸ¥
curl http://localhost:8080/actuator/health
curl http://localhost:8001/health

# 4. æ£€æŸ¥æœåŠ¡é—´é€šä¿¡ï¼ˆåœ¨Python Podå†…æ‰§è¡Œï¼‰
kubectl exec -it -n aibidcomposer deployment/backend-python -- \
  curl http://backend-java-service:8080/actuator/health

# 5. æŸ¥çœ‹æ—¥å¿—
kubectl logs -n aibidcomposer -l app=backend-java --tail=100
kubectl logs -n aibidcomposer -l app=backend-python --tail=100

# 6. æ£€æŸ¥æœåŠ¡å‘ç°
kubectl get svc -n aibidcomposer
kubectl get endpoints -n aibidcomposer
```

---

### ä»»åŠ¡2.2å®Œæˆæ€»ç»“

**ä»»åŠ¡åç§°**: JAVA-002 Task 2.2 - é¡¹ç›®ç®¡ç†åŠŸèƒ½

**å®ŒæˆçŠ¶æ€**: âœ… 100% å®Œæˆ (5/5 å­éƒ¨åˆ†)

**å®Œæˆçš„å­éƒ¨åˆ†**:
1. âœ… 2.2.1: æ•°æ®å®šä¹‰ - Entityã€æšä¸¾ã€DTOè®¾è®¡
2. âœ… 2.2.2: å‰ç«¯ - Reactç»„ä»¶ã€APIè°ƒç”¨ã€çŠ¶æ€ç®¡ç†
3. âœ… 2.2.3: Javaåç«¯ - Repositoryã€Serviceã€Controllerã€å•å…ƒæµ‹è¯•
4. âœ… 2.2.4: Pythonåç«¯ - HTTPå®¢æˆ·ç«¯ã€JWTä¼ é€’ã€é›†æˆæµ‹è¯•
5. âœ… 2.2.5: éƒ¨ç½² - Docker Composeã€Kubernetesé…ç½®

**å…³é”®æˆæœ**:
- å®Œæ•´çš„é¡¹ç›®ç®¡ç†CRUDåŠŸèƒ½å®ç°
- è‡ªåŠ¨æ‰€æœ‰è€…æœºåˆ¶
- ä¸¤å±‚æƒé™éªŒè¯ï¼ˆç»„ç»‡çº§+é¡¹ç›®çº§ï¼‰
- é¡¹ç›®çŠ¶æ€æµè½¬éªŒè¯
- é¡¹ç›®æˆå‘˜ç®¡ç†
- æœåŠ¡é—´HTTPé€šä¿¡é›†æˆ
- å®Œæ•´çš„éƒ¨ç½²é…ç½®

**ä»£ç é‡ç»Ÿè®¡**:
- 2.2.1: ~1,027è¡Œï¼ˆæ•°æ®å®šä¹‰ï¼‰
- 2.2.2: ~873è¡Œï¼ˆå‰ç«¯ï¼‰
- 2.2.3: ~1,018è¡Œï¼ˆJavaåç«¯ï¼‰
- 2.2.4: ~875è¡Œï¼ˆPythonåç«¯ï¼‰
- 2.2.5: ~560è¡Œï¼ˆéƒ¨ç½²é…ç½®ï¼‰
- **æ€»è®¡**: ~4,353è¡Œ

---

**è¿”å›**: [ä»»åŠ¡è®¡åˆ’æ€»è§ˆ](./task-plan.md)
