---
æ–‡æ¡£ç±»å‹: æ¶æ„æ–‡æ¡£
éœ€æ±‚ç¼–å·: DOC-2025-11-001
åˆ›å»ºæ—¥æœŸ: 2025-11-29
åˆ›å»ºè€…: claude-sonnet-4-5 (claude-sonnet-4-5-20250929)
æœ€åæ›´æ–°: 2025-11-29
æ›´æ–°è€…: claude-sonnet-4-5 (claude-sonnet-4-5-20250929)
çŠ¶æ€: å·²æ‰¹å‡†
---

# AIæ ‡ä¹¦æ™ºèƒ½åˆ›ä½œå¹³å° - éƒ¨ç½²è¿ç»´è„šæœ¬

> **è„šæœ¬ç±»å‹**: Bash Shellè„šæœ¬
> **ç›‘æ§å·¥å…·**: Prometheus + Grafana
> **æ—¥å¿—æ”¶é›†**: Fluentd + Elasticsearch
> **å®‰å…¨ç­–ç•¥**: NetworkPolicy + PodSecurityPolicy

## ğŸ“‹ æ–‡æ¡£å¯¼èˆª

æœ¬æ–‡æ¡£æ˜¯éƒ¨ç½²æ¶æ„è®¾è®¡çš„ä¸€éƒ¨åˆ†,å…¶ä»–ç›¸å…³æ–‡æ¡£:

1. [00-éƒ¨ç½²æ¶æ„æ€»è§ˆ.md](./00-éƒ¨ç½²æ¶æ„æ€»è§ˆ.md) - éƒ¨ç½²æ¶æ„æ¦‚è§ˆå’Œç¯å¢ƒè§„åˆ’
2. [01-Dockeré…ç½®è¯¦è§£.md](./01-Dockeré…ç½®è¯¦è§£.md) - Dockeré•œåƒæ„å»ºå’ŒDocker Composeé…ç½®
3. [02-Kubernetesé…ç½®.md](./02-Kubernetesé…ç½®.md) - Kuberneteså®Œæ•´éƒ¨ç½²é…ç½®
4. **03-éƒ¨ç½²è¿ç»´è„šæœ¬.md**(æœ¬æ–‡æ¡£) - éƒ¨ç½²è„šæœ¬ã€ç›‘æ§æ—¥å¿—å’Œå®‰å…¨é…ç½®

## ğŸš€ éƒ¨ç½²è„šæœ¬

### 1. æ„å»ºè„šæœ¬

```bash
#!/bin/bash
# scripts/build-images.sh

set -e

VERSION=${1:-latest}
REGISTRY=${DOCKER_REGISTRY:-registry.example.com}

echo "Building Docker images version: $VERSION"

# æ„å»ºå‰ç«¯é•œåƒ
echo "Building frontend image..."
docker build -t $REGISTRY/aibidcomposer/frontend:$VERSION \
  -f docker/frontend/Dockerfile.prod \
  ./frontend

# æ„å»ºåç«¯é•œåƒ
echo "Building backend image..."
docker build -t $REGISTRY/aibidcomposer/backend:$VERSION \
  -f docker/backend/Dockerfile \
  ./backend

# æ¨é€é•œåƒ
if [ "$PUSH" = "true" ]; then
  echo "Pushing images to registry..."
  docker push $REGISTRY/aibidcomposer/frontend:$VERSION
  docker push $REGISTRY/aibidcomposer/backend:$VERSION
fi

echo "Build completed successfully!"
```

### 2. éƒ¨ç½²è„šæœ¬

```bash
#!/bin/bash
# scripts/deploy.sh

set -e

ENVIRONMENT=${1:-production}
NAMESPACE="aibidcomposer"

echo "Deploying to $ENVIRONMENT environment..."

# åˆ›å»ºå‘½åç©ºé—´
kubectl create namespace $NAMESPACE --dry-run=client -o yaml | kubectl apply -f -

# åº”ç”¨é…ç½®
echo "Applying ConfigMaps and Secrets..."
kubectl apply -f k8s/configmaps/ -n $NAMESPACE
kubectl apply -f k8s/secrets/ -n $NAMESPACE

# éƒ¨ç½²æ•°æ®æœåŠ¡
echo "Deploying data services..."
kubectl apply -f k8s/statefulsets/ -n $NAMESPACE

# ç­‰å¾…æ•°æ®æœåŠ¡å°±ç»ª
echo "Waiting for data services to be ready..."
kubectl wait --for=condition=ready pod -l app=postgres -n $NAMESPACE --timeout=300s
kubectl wait --for=condition=ready pod -l app=redis -n $NAMESPACE --timeout=300s

# éƒ¨ç½²åº”ç”¨æœåŠ¡
echo "Deploying application services..."
kubectl apply -f k8s/deployments/ -n $NAMESPACE

# åº”ç”¨HPA
echo "Applying HPA..."
kubectl apply -f k8s/hpa/ -n $NAMESPACE

# åº”ç”¨Ingress
echo "Applying Ingress..."
kubectl apply -f k8s/ingress/ -n $NAMESPACE

# æ£€æŸ¥éƒ¨ç½²çŠ¶æ€
echo "Checking deployment status..."
kubectl get pods -n $NAMESPACE
kubectl get svc -n $NAMESPACE
kubectl get ingress -n $NAMESPACE

echo "Deployment completed successfully!"
```

### 3. å›æ»šè„šæœ¬

```bash
#!/bin/bash
# scripts/rollback.sh

set -e

DEPLOYMENT=$1
NAMESPACE="aibidcomposer"

if [ -z "$DEPLOYMENT" ]; then
  echo "Usage: ./rollback.sh <deployment-name>"
  exit 1
fi

echo "Rolling back $DEPLOYMENT..."

kubectl rollout undo deployment/$DEPLOYMENT -n $NAMESPACE

kubectl rollout status deployment/$DEPLOYMENT -n $NAMESPACE

echo "Rollback completed!"
```

## ğŸ“Š ç›‘æ§å’Œæ—¥å¿—

### 1. Prometheusç›‘æ§

```yaml
# k8s/monitoring/prometheus-config.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: prometheus-config
  namespace: monitoring
data:
  prometheus.yml: |
    global:
      scrape_interval: 15s
      evaluation_interval: 15s

    scrape_configs:
    - job_name: 'kubernetes-pods'
      kubernetes_sd_configs:
      - role: pod
        namespaces:
          names:
          - aibidcomposer
      relabel_configs:
      - source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_scrape]
        action: keep
        regex: true
```

### 2. æ—¥å¿—æ”¶é›†

```yaml
# k8s/logging/fluentd-config.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: fluentd-config
  namespace: kube-system
data:
  fluent.conf: |
    <source>
      @type tail
      path /var/log/containers/*aibidcomposer*.log
      pos_file /var/log/fluentd-containers.log.pos
      tag kubernetes.*
      format json
    </source>

    <match kubernetes.**>
      @type elasticsearch
      host elasticsearch.logging.svc.cluster.local
      port 9200
      logstash_format true
      logstash_prefix aibidcomposer
    </match>
```

## ğŸ” å®‰å…¨é…ç½®

### 1. Network Policy

```yaml
# k8s/network-policies/backend-network-policy.yaml
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: backend-network-policy
  namespace: aibidcomposer
spec:
  podSelector:
    matchLabels:
      app: backend
  policyTypes:
  - Ingress
  - Egress
  ingress:
  - from:
    - podSelector:
        matchLabels:
          app: kong
    ports:
    - protocol: TCP
      port: 8000
  egress:
  - to:
    - podSelector:
        matchLabels:
          app: postgres
    ports:
    - protocol: TCP
      port: 5432
  - to:
    - podSelector:
        matchLabels:
          app: redis
    ports:
    - protocol: TCP
      port: 6379
```

### 2. Pod Security Policy

```yaml
# k8s/security/pod-security-policy.yaml
apiVersion: policy/v1beta1
kind: PodSecurityPolicy
metadata:
  name: restricted
spec:
  privileged: false
  allowPrivilegeEscalation: false
  requiredDropCapabilities:
    - ALL
  volumes:
    - 'configMap'
    - 'emptyDir'
    - 'projected'
    - 'secret'
    - 'downwardAPI'
    - 'persistentVolumeClaim'
  hostNetwork: false
  hostIPC: false
  hostPID: false
  runAsUser:
    rule: 'MustRunAsNonRoot'
  seLinux:
    rule: 'RunAsAny'
  fsGroup:
    rule: 'RunAsAny'
  readOnlyRootFilesystem: false
```

## ğŸ› ï¸ è¿ç»´æ“ä½œæŒ‡å—

### æ—¥å¸¸è¿ç»´å‘½ä»¤

```bash
# æŸ¥çœ‹PodçŠ¶æ€
kubectl get pods -n aibidcomposer

# æŸ¥çœ‹Podæ—¥å¿—
kubectl logs -f <pod-name> -n aibidcomposer

# æŸ¥çœ‹Podèµ„æºä½¿ç”¨
kubectl top pods -n aibidcomposer

# è¿›å…¥Podè°ƒè¯•
kubectl exec -it <pod-name> -n aibidcomposer -- /bin/sh

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
kubectl get svc -n aibidcomposer

# æŸ¥çœ‹IngressçŠ¶æ€
kubectl get ingress -n aibidcomposer

# æŸ¥çœ‹HPAçŠ¶æ€
kubectl get hpa -n aibidcomposer
```

### æ•…éšœæ’æŸ¥

```bash
# æŸ¥çœ‹Podè¯¦ç»†ä¿¡æ¯
kubectl describe pod <pod-name> -n aibidcomposer

# æŸ¥çœ‹Podäº‹ä»¶
kubectl get events -n aibidcomposer --sort-by='.lastTimestamp'

# æŸ¥çœ‹èµ„æºé…é¢
kubectl get resourcequota -n aibidcomposer

# æŸ¥çœ‹ç½‘ç»œç­–ç•¥
kubectl get networkpolicy -n aibidcomposer

# æµ‹è¯•ç½‘ç»œè¿é€šæ€§
kubectl run test-pod --rm -it --image=busybox -n aibidcomposer -- /bin/sh
```

### æ•°æ®å¤‡ä»½

```bash
# å¤‡ä»½PostgreSQLæ•°æ®åº“
kubectl exec -n aibidcomposer postgres-0 -- \
  pg_dump -U postgres aibidcomposer > backup-$(date +%Y%m%d).sql

# å¤‡ä»½Kubernetesé…ç½®
kubectl get all -n aibidcomposer -o yaml > k8s-backup-$(date +%Y%m%d).yaml

# å¤‡ä»½Secrets
kubectl get secrets -n aibidcomposer -o yaml > secrets-backup-$(date +%Y%m%d).yaml

# å¤‡ä»½ConfigMaps
kubectl get configmaps -n aibidcomposer -o yaml > configmaps-backup-$(date +%Y%m%d).yaml
```

### æ€§èƒ½ä¼˜åŒ–

```bash
# è®¾ç½®èµ„æºè¯·æ±‚å’Œé™åˆ¶
kubectl set resources deployment backend-java \
  --requests=cpu=500m,memory=1Gi \
  --limits=cpu=1000m,memory=2Gi \
  -n aibidcomposer

# è°ƒæ•´å‰¯æœ¬æ•°
kubectl scale deployment backend-java --replicas=10 -n aibidcomposer

# æ›´æ–°é•œåƒ
kubectl set image deployment/backend-java \
  backend-java=aibidcomposer/backend-java:v1.2.0 \
  -n aibidcomposer

# é‡å¯Deployment
kubectl rollout restart deployment/backend-java -n aibidcomposer
```

## ğŸ“ˆ ç›‘æ§æŒ‡æ ‡è¯´æ˜

### å…³é”®æŒ‡æ ‡

| æŒ‡æ ‡ç±»å‹ | æŒ‡æ ‡åç§° | è¯´æ˜ | é˜ˆå€¼ |
|---------|---------|------|------|
| CPU | container_cpu_usage_seconds_total | Pod CPUä½¿ç”¨ç‡ | <70% |
| å†…å­˜ | container_memory_usage_bytes | Podå†…å­˜ä½¿ç”¨é‡ | <80% |
| è¯·æ±‚ | http_requests_total | HTTPè¯·æ±‚æ€»æ•° | - |
| å»¶è¿Ÿ | http_request_duration_seconds | è¯·æ±‚å“åº”æ—¶é—´ | <200ms (P95) |
| é”™è¯¯ | http_requests_errors_total | HTTPé”™è¯¯è¯·æ±‚æ•° | <1% |
| å­˜æ´» | up | æœåŠ¡å­˜æ´»çŠ¶æ€ | =1 |

### Grafanaä»ªè¡¨ç›˜

æ¨èå¯¼å…¥ä»¥ä¸‹Grafanaä»ªè¡¨ç›˜:

1. **Kubernetes Cluster Monitoring** (ID: 7249)
2. **Kubernetes Pod Metrics** (ID: 6417)
3. **PostgreSQL Database** (ID: 9628)
4. **Redis Dashboard** (ID: 11835)
5. **Nginx Ingress Controller** (ID: 9614)

## ğŸ”— ç›¸å…³èµ„æº

- **éƒ¨ç½²æ¶æ„æ€»è§ˆ**: [00-éƒ¨ç½²æ¶æ„æ€»è§ˆ.md](./00-éƒ¨ç½²æ¶æ„æ€»è§ˆ.md)
- **Dockeré…ç½®**: [01-Dockeré…ç½®è¯¦è§£.md](./01-Dockeré…ç½®è¯¦è§£.md)
- **Kubernetesé…ç½®**: [02-Kubernetesé…ç½®.md](./02-Kubernetesé…ç½®.md)

---

## ä¿®æ”¹å†å²

| æ—¥æœŸ | ç‰ˆæœ¬ | ä¿®æ”¹è€… | ä¿®æ”¹å†…å®¹æ¦‚è¦ |
|------|------|--------|-------------|
| 2025-11-29 | 1.0 | claude-sonnet-4-5 (claude-sonnet-4-5-20250929) | ä»06-éƒ¨ç½²æ¶æ„è®¾è®¡.mdæ‹†åˆ†åˆ›å»ºéƒ¨ç½²è¿ç»´è„šæœ¬æ–‡æ¡£ |

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**åˆ›å»ºæ—¶é—´**: 2025å¹´11æœˆ29æ—¥
**æ–‡æ¡£çŠ¶æ€**: âœ… å·²æ‰¹å‡†
