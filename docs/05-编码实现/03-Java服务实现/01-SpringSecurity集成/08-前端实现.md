# Java Spring Boot 服务任务详细计划 - JAVA-001 Part1 - 1.1 用户管理基础功能 - 1.2.2 前端

#### Token 存储和请求拦截器

```typescript
// frontend/src/utils/auth.ts
import axios, { AxiosError, AxiosRequestConfig } from 'axios';

/**
 * Token 存储服务
 */
export class TokenStorage {
  private static ACCESS_TOKEN_KEY = 'access_token';
  private static REFRESH_TOKEN_KEY = 'refresh_token';
  private static TOKEN_EXPIRY_KEY = 'token_expiry';

  /**
   * 保存Token
   */
  static saveTokens(accessToken: string, refreshToken: string, expiresIn: number): void {
    localStorage.setItem(this.ACCESS_TOKEN_KEY, accessToken);
    localStorage.setItem(this.REFRESH_TOKEN_KEY, refreshToken);

    const expiryTime = new Date().getTime() + expiresIn * 1000;
    localStorage.setItem(this.TOKEN_EXPIRY_KEY, expiryTime.toString());
  }

  /**
   * 获取Access Token
   */
  static getAccessToken(): string | null {
    return localStorage.getItem(this.ACCESS_TOKEN_KEY);
  }

  /**
   * 获取Refresh Token
   */
  static getRefreshToken(): string | null {
    return localStorage.getItem(this.REFRESH_TOKEN_KEY);
  }

  /**
   * 检查Token是否即将过期（剩余时间<5分钟）
   */
  static isTokenExpiring(): boolean {
    const expiryTime = localStorage.getItem(this.TOKEN_EXPIRY_KEY);
    if (!expiryTime) return true;

    const now = new Date().getTime();
    const timeLeft = parseInt(expiryTime) - now;
    return timeLeft < 5 * 60 * 1000; // 5分钟
  }

  /**
   * 清除所有Token
   */
  static clearTokens(): void {
    localStorage.removeItem(this.ACCESS_TOKEN_KEY);
    localStorage.removeItem(this.REFRESH_TOKEN_KEY);
    localStorage.removeItem(this.TOKEN_EXPIRY_KEY);
  }
}

/**
 * 配置Axios请求拦截器（自动添加Token）
 */
axios.interceptors.request.use(
  async (config: AxiosRequestConfig) => {
    // 检查Token是否即将过期
    if (TokenStorage.isTokenExpiring()) {
      const refreshToken = TokenStorage.getRefreshToken();
      if (refreshToken) {
        try {
          // 刷新Token
          const response = await axios.post('http://localhost:8080/api/v1/auth/refresh', {
            refreshToken,
          });

          const { accessToken, refreshToken: newRefreshToken, expiresIn } = response.data.data;
          TokenStorage.saveTokens(accessToken, newRefreshToken, expiresIn);
        } catch (error) {
          // 刷新失败，清除Token并跳转到登录页
          TokenStorage.clearTokens();
          window.location.href = '/login';
          return Promise.reject(error);
        }
      }
    }

    // 添加Authorization header
    const token = TokenStorage.getAccessToken();
    if (token && config.headers) {
      config.headers.Authorization = `Bearer ${token}`;
    }

    return config;
  },
  (error: AxiosError) => {
    return Promise.reject(error);
  }
);

/**
 * 配置Axios响应拦截器（处理401错误）
 */
axios.interceptors.response.use(
  (response) => response,
  async (error: AxiosError) => {
    if (error.response?.status === 401) {
      // Token无效或过期
      TokenStorage.clearTokens();
      window.location.href = '/login';
    }

    return Promise.reject(error);
  }
);
```

**验证标准**:
- [ ] Token 自动添加到请求头
- [ ] Token 即将过期时自动刷新
- [ ] 401 错误自动跳转登录页
- [ ] 刷新Token失败正确处理
- [ ] Token 存储安全（使用 localStorage）
