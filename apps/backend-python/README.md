# AI Backend Service - Python FastAPI

**AIBidComposer AIæœåŠ¡** - åŸºäºPython FastAPIçš„AIèƒ½åŠ›æœåŠ¡ï¼Œå¤„ç†æ‰€æœ‰AIç›¸å…³åŠŸèƒ½ã€‚

## ğŸ“‹ æœåŠ¡æ¦‚è¿°

æœ¬æœåŠ¡æ˜¯AIBidComposeré¡¹ç›®çš„**AIèƒ½åŠ›å±‚**ï¼Œè´Ÿè´£ï¼š

- ğŸ“„ **æ–‡æ¡£è§£æ** - æ‹›æ ‡æ–‡ä»¶æ™ºèƒ½è§£æï¼ˆPDFã€Wordã€Excelï¼‰
- ğŸ¤– **LLMé›†æˆ** - GPT-4ã€Claudeç­‰å¤§è¯­è¨€æ¨¡å‹è°ƒç”¨
- ğŸ” **å‘é‡æ£€ç´¢** - åŸºäºElasticsearchçš„å‘é‡æœç´¢
- ğŸ“š **RAGç³»ç»Ÿ** - LlamaIndexå®ç°çš„æ£€ç´¢å¢å¼ºç”Ÿæˆ
- âœï¸ **å†…å®¹ç”Ÿæˆ** - AIé©±åŠ¨çš„æ ‡ä¹¦å†…å®¹ç”Ÿæˆ
- ğŸ¯ **æ™ºèƒ½åŒ¹é…** - éœ€æ±‚ä¸èƒ½åŠ›æ™ºèƒ½åŒ¹é…åˆ†æ

**æœåŠ¡ç«¯å£**: 8001
**æŠ€æœ¯æ ˆ**: Python 3.11 + FastAPI + LlamaIndex + Elasticsearch

## ğŸ—ï¸ æ¶æ„è¯´æ˜

### ä¸JavaæœåŠ¡çš„å…³ç³»

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Frontend (React + Ant Design)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                    â”‚
           â–¼                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Java Service    â”‚   â”‚  Python Service  â”‚
â”‚  (Port 8080)     â”‚â—„â”€â–ºâ”‚  (Port 8001)     â”‚
â”‚                  â”‚   â”‚                  â”‚
â”‚  - æ•°æ®CRUD      â”‚   â”‚  - AIæ–‡æ¡£è§£æ    â”‚
â”‚  - ä¸šåŠ¡é€»è¾‘      â”‚   â”‚  - LLMè°ƒç”¨       â”‚
â”‚  - ç”¨æˆ·è®¤è¯      â”‚   â”‚  - å‘é‡æ£€ç´¢      â”‚
â”‚  - æ–‡æ¡£ç®¡ç†      â”‚   â”‚  - å†…å®¹ç”Ÿæˆ      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                      â”‚
           â–¼                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Data Layer (PostgreSQL + Elasticsearch + Redis) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æœåŠ¡é€šä¿¡æ–¹å¼**:
- HTTP REST API - åŒæ­¥è°ƒç”¨
- RabbitMQ - å¼‚æ­¥ä»»åŠ¡é˜Ÿåˆ—

## ğŸ“¦ é¡¹ç›®ç»“æ„

```
backend-python/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ main.py              # FastAPIåº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ config.py            # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ api/                 # APIè·¯ç”±
â”‚   â”‚   â”œâ”€â”€ v1/
â”‚   â”‚   â”‚   â”œâ”€â”€ health.py    # å¥åº·æ£€æŸ¥
â”‚   â”‚   â”‚   â””â”€â”€ ai.py        # AIæœåŠ¡API (å¾…å®ç°)
â”‚   â”œâ”€â”€ core/                # æ ¸å¿ƒåŠŸèƒ½
â”‚   â”‚   â”œâ”€â”€ security.py      # å®‰å…¨è®¤è¯
â”‚   â”‚   â”œâ”€â”€ logging.py       # æ—¥å¿—é…ç½®
â”‚   â”‚   â””â”€â”€ exceptions.py    # å¼‚å¸¸å¤„ç†
â”‚   â”œâ”€â”€ services/            # ä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ ai/
â”‚   â”‚   â”‚   â”œâ”€â”€ llm_client.py        # LLMå®¢æˆ·ç«¯
â”‚   â”‚   â”‚   â”œâ”€â”€ embedding_service.py # å‘é‡åµŒå…¥
â”‚   â”‚   â”‚   â”œâ”€â”€ rag_service.py       # RAGæœåŠ¡
â”‚   â”‚   â”‚   â””â”€â”€ vector_store.py      # å‘é‡å­˜å‚¨
â”‚   â”œâ”€â”€ models/              # Pydanticæ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ request.py       # è¯·æ±‚æ¨¡å‹
â”‚   â”‚   â””â”€â”€ response.py      # å“åº”æ¨¡å‹
â”‚   â””â”€â”€ utils/               # å·¥å…·å‡½æ•°
â”‚       â””â”€â”€ helpers.py
â”œâ”€â”€ tests/                   # æµ‹è¯•æ–‡ä»¶
â”œâ”€â”€ requirements/            # ä¾èµ–ç®¡ç†
â”‚   â”œâ”€â”€ base.txt
â”‚   â”œâ”€â”€ dev.txt
â”‚   â””â”€â”€ prod.txt
â”œâ”€â”€ .env.example             # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”œâ”€â”€ .gitignore
â”œâ”€â”€ Dockerfile               # ç”Ÿäº§ç¯å¢ƒé•œåƒ
â”œâ”€â”€ pyproject.toml          # Pythoné¡¹ç›®é…ç½®
â””â”€â”€ README.md               # æœ¬æ–‡æ¡£
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å‰ç½®æ¡ä»¶

- Python 3.11+
- pip æˆ– poetry
- Redis 7+
- Elasticsearch 8+
- RabbitMQ (å¯é€‰ï¼Œç”¨äºå¼‚æ­¥ä»»åŠ¡)

### æœ¬åœ°å¼€å‘ç¯å¢ƒ

1. **å®‰è£…ä¾èµ–**

```bash
cd apps/backend-python

# ä½¿ç”¨pip
pip install -r requirements/dev.txt

# æˆ–ä½¿ç”¨poetry
poetry install
```

2. **é…ç½®ç¯å¢ƒå˜é‡**

```bash
# å¤åˆ¶ç¯å¢ƒå˜é‡ç¤ºä¾‹æ–‡ä»¶
cp .env.example .env

# ç¼–è¾‘.envæ–‡ä»¶ï¼Œå¡«å†™å¿…è¦çš„é…ç½®
vim .env
```

**å¿…é¡»é…ç½®çš„ç¯å¢ƒå˜é‡**:
- `SECRET_KEY` - åº”ç”¨å¯†é’¥
- `OPENAI_API_KEY` - OpenAI APIå¯†é’¥
- `ELASTICSEARCH_PASSWORD` - Elasticsearchå¯†ç 

3. **å¯åŠ¨æœåŠ¡**

```bash
# å¼€å‘æ¨¡å¼ï¼ˆæ”¯æŒçƒ­é‡è½½ï¼‰
uvicorn app.main:app --reload --host 0.0.0.0 --port 8001

# æˆ–ä½¿ç”¨Pythonç›´æ¥è¿è¡Œ
python -m app.main
```

4. **è®¿é—®APIæ–‡æ¡£**

- Swagger UI: http://localhost:8001/api/v1/docs
- ReDoc: http://localhost:8001/api/v1/redoc
- OpenAPI JSON: http://localhost:8001/api/v1/openapi.json

### Dockeréƒ¨ç½²

```bash
# æ„å»ºé•œåƒ
docker build -t aibidcomposer/backend-python:latest .

# è¿è¡Œå®¹å™¨
docker run -d \
  -p 8001:8001 \
  -e OPENAI_API_KEY=your-key \
  -e ELASTICSEARCH_PASSWORD=your-password \
  --name backend-python \
  aibidcomposer/backend-python:latest
```

## ğŸ”§ æ ¸å¿ƒåŠŸèƒ½

### 1. æ–‡æ¡£è§£æ

**APIç«¯ç‚¹**: `POST /api/v1/ai/parse-document`

æ”¯æŒæ ¼å¼:
- PDF (.pdf)
- Word (.docx, .doc)
- Excel (.xlsx, .xls)
- çº¯æ–‡æœ¬ (.txt)

åŠŸèƒ½:
- æå–æ–‡æ¡£ç»“æ„
- è¯†åˆ«å…³é”®ä¿¡æ¯
- éœ€æ±‚åˆ†ç±»å’Œæå–
- é£é™©è¯†åˆ«

### 2. æ™ºèƒ½å†…å®¹ç”Ÿæˆ

**APIç«¯ç‚¹**: `POST /api/v1/ai/generate-content`

åŸºäºRAGçš„å†…å®¹ç”Ÿæˆ:
- æŠ€æœ¯æ–¹æ¡ˆç”Ÿæˆ
- é¡¹ç›®å®æ–½æ–¹æ¡ˆ
- å›¢é˜Ÿä»‹ç»ç”Ÿæˆ
- æ¡ˆä¾‹å¼•ç”¨

### 3. å‘é‡æ£€ç´¢

**æŠ€æœ¯æ ˆ**: Elasticsearch kNN + OpenAI Embeddings

åŠŸèƒ½:
- è¯­ä¹‰æœç´¢
- ç›¸ä¼¼æ–‡æ¡£æ¨è
- æ™ºèƒ½æ¡ˆä¾‹åŒ¹é…
- çŸ¥è¯†åº“æ£€ç´¢

### 4. æ™ºèƒ½åŒ¹é…

**APIç«¯ç‚¹**: `POST /api/v1/ai/match-capabilities`

åŠŸèƒ½:
- éœ€æ±‚-èƒ½åŠ›åŒ¹é…
- åŒ¹é…åº¦è¯„åˆ†
- å·®è·åˆ†æ
- æ”¹è¿›å»ºè®®

## ğŸ“š æŠ€æœ¯æ ˆè¯¦è§£

### æ ¸å¿ƒä¾èµ–

| ä¾èµ– | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| FastAPI | 0.104+ | Webæ¡†æ¶ |
| LlamaIndex | 0.9.14+ | RAGæ¡†æ¶ï¼ˆä¸»åŠ›ï¼‰ |
| OpenAI SDK | 1.0+ | GPT-4é›†æˆ |
| Anthropic SDK | 0.7+ | Claudeé›†æˆï¼ˆå¤‡ç”¨ï¼‰ |
| Elasticsearch | 8.11+ | å‘é‡å­˜å‚¨+å…¨æ–‡æ£€ç´¢ |
| Redis | 5.0+ | ç¼“å­˜+ä¼šè¯ |
| Celery | 5.3+ | å¼‚æ­¥ä»»åŠ¡é˜Ÿåˆ— |

### LlamaIndex vs LangChain

æœ¬é¡¹ç›®**ä¸»è¦ä½¿ç”¨LlamaIndex**:
- âœ… ä¸“æ³¨RAGåœºæ™¯ï¼ŒAPIç®€æ´
- âœ… å†…ç½®å‘é‡ç´¢å¼•ç®¡ç†
- âœ… æ›´å¥½çš„æ–‡æ¡£å¤„ç†èƒ½åŠ›
- âœ… æ€§èƒ½ä¼˜åŒ–æ›´å¥½

LangChainä½œä¸ºå¤‡ç”¨:
- å¤æ‚Agentåœºæ™¯
- å¤šæ­¥éª¤å·¥ä½œæµ
- ç‰¹æ®Šé“¾å¼è°ƒç”¨

### Elasticsearch vs Pinecone

**ä¸»åŠ›æ–¹æ¡ˆ**: Elasticsearch
- âœ… æœ¬åœ°éƒ¨ç½²ï¼Œæ•°æ®å¯æ§
- âœ… åŒæ—¶æ”¯æŒå…¨æ–‡æ£€ç´¢+å‘é‡æ£€ç´¢
- âœ… æˆæœ¬ä½ï¼Œæ— é™é¢é™åˆ¶
- âœ… åŠŸèƒ½å¼ºå¤§ï¼ˆèšåˆã€åˆ†æï¼‰

**å¤‡é€‰æ–¹æ¡ˆ**: Pinecone
- äº‘ç«¯æ‰˜ç®¡
- å¼€ç®±å³ç”¨
- é€‚åˆå¿«é€ŸåŸå‹

## ğŸ§ª æµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
pytest

# è¿è¡Œç‰¹å®šæµ‹è¯•
pytest tests/test_api.py

# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
pytest --cov=app --cov-report=html

# æŸ¥çœ‹è¦†ç›–ç‡
open htmlcov/index.html
```

## ğŸ“Š ç›‘æ§å’Œæ—¥å¿—

### å¥åº·æ£€æŸ¥ç«¯ç‚¹

```bash
# åŸºç¡€å¥åº·æ£€æŸ¥
curl http://localhost:8001/api/v1/health

# å°±ç»ªæ£€æŸ¥ï¼ˆä¾èµ–æœåŠ¡æ£€æŸ¥ï¼‰
curl http://localhost:8001/api/v1/health/ready

# å­˜æ´»æ£€æŸ¥ï¼ˆKubernetesæ¢é’ˆï¼‰
curl http://localhost:8001/api/v1/health/live
```

### æ—¥å¿—

ä½¿ç”¨ `structlog` ç»“æ„åŒ–æ—¥å¿—:

```python
import structlog

logger = structlog.get_logger()
logger.info("Processing document", document_id=doc_id, user_id=user_id)
```

### PrometheusæŒ‡æ ‡

æŒ‡æ ‡ç«¯ç‚¹: `http://localhost:9090/metrics`

å¯ç”¨æŒ‡æ ‡:
- è¯·æ±‚è®¡æ•°
- å“åº”æ—¶é—´
- é”™è¯¯ç‡
- LLMè°ƒç”¨æ¬¡æ•°å’ŒTokenä½¿ç”¨

## ğŸ” å®‰å…¨

### JWTè®¤è¯

æœåŠ¡é—´è°ƒç”¨éœ€è¦JWTä»¤ç‰Œ:

```python
headers = {
    "Authorization": f"Bearer {jwt_token}"
}
```

### APIå¯†é’¥

è°ƒç”¨å¤–éƒ¨æœåŠ¡éœ€è¦é…ç½®APIå¯†é’¥:
- `OPENAI_API_KEY` - OpenAI
- `ANTHROPIC_API_KEY` - Claude
- `PINECONE_API_KEY` - Pinecone (å¯é€‰)

### é€Ÿç‡é™åˆ¶

é»˜è®¤é™åˆ¶:
- æ¯åˆ†é’Ÿ60æ¬¡è¯·æ±‚
- çªå‘10æ¬¡

## ğŸ› ï¸ å¼€å‘æŒ‡å—

### ä»£ç è§„èŒƒ

ä½¿ç”¨ä»¥ä¸‹å·¥å…·ä¿è¯ä»£ç è´¨é‡:

```bash
# ä»£ç æ ¼å¼åŒ– (Black)
black app tests

# ä»£ç æ£€æŸ¥ (Ruff)
ruff check app tests

# ç±»å‹æ£€æŸ¥ (MyPy)
mypy app
```

### æ·»åŠ æ–°çš„APIç«¯ç‚¹

1. åœ¨ `app/api/v1/` åˆ›å»ºæ–°çš„è·¯ç”±æ–‡ä»¶
2. åœ¨ `app/main.py` æ³¨å†Œè·¯ç”±
3. åœ¨ `app/services/` å®ç°ä¸šåŠ¡é€»è¾‘
4. åœ¨ `app/models/` å®šä¹‰è¯·æ±‚/å“åº”æ¨¡å‹
5. ç¼–å†™æµ‹è¯•

### è´¡çŒ®æŒ‡å—

1. Forké¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. å¼€å¯Pull Request

## ğŸ“ APIæ–‡æ¡£

å®Œæ•´çš„APIæ–‡æ¡£åœ¨è¿è¡ŒæœåŠ¡åè®¿é—®:
- http://localhost:8001/api/v1/docs

## ğŸ¤ ç›¸å…³æ–‡æ¡£

- [é¡¹ç›®æ€»è§ˆ](../../README.md)
- [JavaæœåŠ¡æ–‡æ¡£](../backend-java/README.md)
- [å‰ç«¯æ–‡æ¡£](../frontend/README.md)
- [æ¶æ„è®¾è®¡](../../docs/03-æ¶æ„/00-æ¶æ„è®¾è®¡æ€»è§ˆ.md)
- [APIæ¥å£è®¾è®¡](../../docs/03-æ¶æ„/03-APIæ¥å£è®¾è®¡.md)
- [AIèƒ½åŠ›å±‚è®¾è®¡](../../docs/03-æ¶æ„/05-AIèƒ½åŠ›å±‚è®¾è®¡.md)

## ğŸ“„ è®¸å¯è¯

MIT

---

**éœ€æ±‚ç¼–å·**: REQ-PYTHON-AI-001
**åˆ›å»ºæ—¶é—´**: 2025-11-26
**åˆ›å»ºè€…**: claude-sonnet-4-5 (claude-sonnet-4-5-20250929)
**ç»´æŠ¤å›¢é˜Ÿ**: AIBidComposer Team
