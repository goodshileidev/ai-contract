---
文档类型: 知识库文档
需求编号: DOC-2025-11-005
创建日期: 2025-11-26
创建者: claude-sonnet-4-5 (claude-sonnet-4-5-20250929)
最后更新: 2025-11-26
更新者: claude-sonnet-4-5 (claude-sonnet-4-5-20250929)
状态: 已批准
---

# TypeScript 代码规范 - 7. API 调用规范

### 7.1 使用 axios 或 umi-request

```typescript
import { request } from 'umi';

// ✅ 定义 API 响应类型
interface ApiResponse<T> {
  code: number;
  message: string;
  data: T;
}

// ✅ 定义服务函数
export async function getUserById(id: string): Promise<User> {
  const response = await request<ApiResponse<User>>(`/api/users/${id}`, {
    method: 'GET',
  });

  if (response.code !== 200) {
    throw new Error(response.message);
  }

  return response.data;
}

export async function createUser(user: Omit<User, 'id'>): Promise<User> {
  const response = await request<ApiResponse<User>>('/api/users', {
    method: 'POST',
    data: user,
  });

  if (response.code !== 200) {
    throw new Error(response.message);
  }

  return response.data;
}

export async function updateUser(
  id: string,
  updates: Partial<User>,
): Promise<User> {
  const response = await request<ApiResponse<User>>(`/api/users/${id}`, {
    method: 'PUT',
    data: updates,
  });

  if (response.code !== 200) {
    throw new Error(response.message);
  }

  return response.data;
}

export async function deleteUser(id: string): Promise<void> {
  const response = await request<ApiResponse<void>>(`/api/users/${id}`, {
    method: 'DELETE',
  });

  if (response.code !== 200) {
    throw new Error(response.message);
  }
}
```

### 7.2 错误处理

```typescript
import { message } from 'antd';

// ✅ 统一错误处理
const UserList: React.FC = () => {
  const [users, setUsers] = useState<User[]>([]);
  const [loading, setLoading] = useState(false);

  const fetchUsers = async () => {
    setLoading(true);
    try {
      const data = await getUserList();
      setUsers(data);
    } catch (error) {
      if (error instanceof Error) {
        message.error(`加载失败: ${error.message}`);
      } else {
        message.error('加载失败');
      }
    } finally {
      setLoading(false);
    }
  };

  useEffect(() => {
    fetchUsers();
  }, []);

  // ...
};
```

---
