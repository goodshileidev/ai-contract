---
文档类型: 实现文档
需求编号: IMP-2025-11-010
创建日期: 2025-11-30 10:15
创建者: claude-opus-4-1-20250805
最后更新: 2025-11-30 10:15
更新者: claude-opus-4-1-20250805
状态: 已批准
---

# aidev3 功能移植实施指南

## 概述

本文档提供将 aidev3 功能移植到 AIBidComposer 的具体实施步骤和代码示例。

## 一、环境准备（第1-2天）

### 1.1 获取 aidev3 源代码

```bash
# 克隆 aidev3 仓库
git clone https://github.com/aidev3/business-designer-frontend.git aidev3-source

# 创建 AIBidComposer 前端项目
cd /path/to/ai-contract
mkdir -p frontend/react-app
cd frontend/react-app
```

### 1.2 初始化项目结构

```bash
# 使用 Vite 创建 React + TypeScript 项目
npm create vite@latest . -- --template react-ts

# 安装核心依赖
npm install react@18.2.0 react-dom@18.2.0
npm install antd@5.0.0 @ant-design/icons @ant-design/pro-components
npm install @tanstack/react-query zustand
npm install axios date-fns lodash-es
npm install react-router-dom@6

# 安装开发依赖
npm install -D @types/react @types/react-dom
npm install -D @types/lodash-es
npm install -D eslint prettier
npm install -D vitest @testing-library/react
```

### 1.3 复制基础配置

```bash
# 从 aidev3 复制配置文件
cp aidev3-source/tsconfig.json ./
cp aidev3-source/vite.config.ts ./
cp aidev3-source/.eslintrc.js ./
cp aidev3-source/.prettierrc ./

# 调整配置以适配 Ant Design
```

## 二、核心模块移植（第3-7天）

### 2.1 项目结构移植

```typescript
// 创建标准目录结构
mkdir -p src/{features,services,components,hooks,types,utils,styles,i18n,config}

// 复制通用工具和类型
cp -r aidev3-source/src/utils/* src/utils/
cp -r aidev3-source/src/types/* src/types/
cp -r aidev3-source/src/hooks/* src/hooks/

// 调整导入路径
find src -name "*.ts" -o -name "*.tsx" | xargs sed -i 's/@mui/material/antd/g'
```

### 2.2 编辑器集成（Blacknode）

```typescript
// src/features/documents/components/BidDocumentEditor.tsx
import React, { useCallback, useEffect, useRef } from 'react';
import { BlacknodeEditor } from 'blacknode-editor';
import { useVariableContext } from '@/features/variables/hooks/useVariableContext';
import { useAI } from '@/features/ai/hooks/useAI';
import { useDraftStorage } from '@/hooks/useDraftStorage';

interface BidDocumentEditorProps {
  documentId: string;
  initialContent?: any;
  onChange?: (content: any) => void;
  onSave?: (content: any) => Promise<void>;
}

export const BidDocumentEditor: React.FC<BidDocumentEditorProps> = ({
  documentId,
  initialContent,
  onChange,
  onSave,
}) => {
  const editorRef = useRef<BlacknodeEditor>(null);
  const { variables, resolveVariable } = useVariableContext();
  const { process: processAI } = useAI();
  const { saveDraft, loadDraft, clearDraft } = useDraftStorage(documentId);

  // 初始化编辑器
  useEffect(() => {
    if (editorRef.current) {
      // 加载草稿或初始内容
      const draft = loadDraft();
      editorRef.current.setContent(draft || initialContent);

      // 配置变量插件
      editorRef.current.registerPlugin('variables', {
        variables,
        onInsert: (variableName: string) => {
          const value = resolveVariable(variableName);
          return `{{${variableName}:${value}}}`;
        },
      });

      // 配置 AI 插件
      editorRef.current.registerPlugin('ai', {
        commands: [
          {
            id: 'expand',
            label: '扩展内容',
            handler: async (selection: string) => {
              const result = await processAI('textExpansion', { text: selection });
              return result.text;
            },
          },
          {
            id: 'summarize',
            label: '生成摘要',
            handler: async (selection: string) => {
              const result = await processAI('textSummary', { text: selection });
              return result.text;
            },
          },
        ],
      });
    }
  }, []);

  // 自动保存
  useEffect(() => {
    const interval = setInterval(() => {
      if (editorRef.current) {
        const content = editorRef.current.getContent();
        saveDraft(content);
      }
    }, 30000); // 30秒

    return () => clearInterval(interval);
  }, [saveDraft]);

  // 键盘快捷键
  const handleKeyDown = useCallback((e: KeyboardEvent) => {
    if ((e.ctrlKey || e.metaKey) && e.key === 's') {
      e.preventDefault();
      handleSave();
    }
  }, []);

  const handleSave = async () => {
    if (editorRef.current && onSave) {
      const content = editorRef.current.getContent();
      await onSave(content);
      clearDraft();
    }
  };

  return (
    <div className="bid-document-editor">
      <BlacknodeEditor
        ref={editorRef}
        onChange={onChange}
        onKeyDown={handleKeyDown}
        toolbar={{
          items: [
            'bold', 'italic', 'underline', 'strikethrough', '|',
            'heading', 'bulletList', 'orderedList', '|',
            'link', 'image', 'table', '|',
            'variable', 'ai', '|',
            'undo', 'redo'
          ],
        }}
        placeholder="开始编写标书内容..."
      />
    </div>
  );
};
```

### 2.3 变量系统实现

```typescript
// src/features/variables/context/VariableContext.tsx
import React, { createContext, useContext, useState, useCallback } from 'react';

interface Variable {
  id: string;
  name: string;
  value: any;
  type: 'text' | 'number' | 'date' | 'select' | 'object';
  scope: 'global' | 'project' | 'document' | 'section';
}

interface VariableContextValue {
  variables: Map<string, Variable>;
  getVariable: (name: string) => Variable | undefined;
  setVariable: (name: string, value: any) => void;
  resolveVariable: (name: string) => any;
  batchUpdate: (updates: Record<string, any>) => void;
}

const VariableContext = createContext<VariableContextValue | null>(null);

export const VariableProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {
  const [variables, setVariables] = useState<Map<string, Variable>>(new Map());

  // 获取变量
  const getVariable = useCallback((name: string) => {
    return variables.get(name);
  }, [variables]);

  // 设置变量
  const setVariable = useCallback((name: string, value: any) => {
    setVariables(prev => {
      const next = new Map(prev);
      const variable = next.get(name);
      if (variable) {
        next.set(name, { ...variable, value });
      }
      return next;
    });
  }, []);

  // 解析变量（支持嵌套和继承）
  const resolveVariable = useCallback((name: string): any => {
    // 按作用域优先级查找：section > document > project > global
    const variable = variables.get(name);
    if (!variable) return `{{${name}}}`;

    // 如果是对象类型，递归解析
    if (variable.type === 'object' && typeof variable.value === 'object') {
      return Object.entries(variable.value).reduce((acc, [key, val]) => {
        acc[key] = typeof val === 'string' && val.startsWith('{{')
          ? resolveVariable(val.slice(2, -2))
          : val;
        return acc;
      }, {} as any);
    }

    return variable.value;
  }, [variables]);

  // 批量更新
  const batchUpdate = useCallback((updates: Record<string, any>) => {
    setVariables(prev => {
      const next = new Map(prev);
      Object.entries(updates).forEach(([name, value]) => {
        const variable = next.get(name);
        if (variable) {
          next.set(name, { ...variable, value });
        }
      });
      return next;
    });
  }, []);

  return (
    <VariableContext.Provider value={{
      variables,
      getVariable,
      setVariable,
      resolveVariable,
      batchUpdate,
    }}>
      {children}
    </VariableContext.Provider>
  );
};

export const useVariableContext = () => {
  const context = useContext(VariableContext);
  if (!context) {
    throw new Error('useVariableContext must be used within VariableProvider');
  }
  return context;
};
```

### 2.4 AI 服务集成

```typescript
// src/features/ai/services/AIService.ts
import axios from 'axios';

export enum AIProcessingType {
  VariableExtraction = 'variableExtraction',
  TextExpansion = 'textExpansion',
  TextSummary = 'textSummary',
  TextTransformation = 'textTransformation',
  ComplianceReview = 'complianceReview',
  RequirementAnalysis = 'requirementAnalysis',
  ScorePointGeneration = 'scorePointGeneration',
}

interface AIRequest {
  type: AIProcessingType;
  input: {
    text?: string;
    context?: any;
    requirements?: string[];
    template?: string;
  };
  config?: {
    model?: 'gpt-4' | 'claude' | 'wenxin';
    temperature?: number;
    maxTokens?: number;
  };
}

interface AIResponse {
  success: boolean;
  data: {
    text?: string;
    variables?: Record<string, any>;
    analysis?: any;
    suggestions?: string[];
  };
  usage: {
    promptTokens: number;
    completionTokens: number;
    totalTokens: number;
  };
}

class AIService {
  private baseURL: string;
  private abortControllers: Map<string, AbortController> = new Map();

  constructor() {
    this.baseURL = import.meta.env.VITE_AI_SERVICE_URL || 'http://localhost:8001';
  }

  async process(request: AIRequest): Promise<AIResponse> {
    const taskId = `${request.type}-${Date.now()}`;
    const abortController = new AbortController();
    this.abortControllers.set(taskId, abortController);

    try {
      const response = await axios.post<AIResponse>(
        `${this.baseURL}/api/v1/ai/process`,
        request,
        {
          signal: abortController.signal,
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${localStorage.getItem('token')}`,
          },
        }
      );

      return response.data;
    } catch (error) {
      if (axios.isCancel(error)) {
        throw new Error('AI 处理已取消');
      }
      throw error;
    } finally {
      this.abortControllers.delete(taskId);
    }
  }

  cancel(taskId: string) {
    const controller = this.abortControllers.get(taskId);
    if (controller) {
      controller.abort();
      this.abortControllers.delete(taskId);
    }
  }

  // 招标文件解析
  async analyzeRequirements(file: File): Promise<any> {
    const formData = new FormData();
    formData.append('file', file);

    const response = await axios.post(
      `${this.baseURL}/api/v1/ai/analyze-requirements`,
      formData,
      {
        headers: {
          'Content-Type': 'multipart/form-data',
        },
      }
    );

    return response.data;
  }

  // 能力匹配
  async matchCapabilities(requirements: string[], capabilities: string[]): Promise<any> {
    return this.process({
      type: AIProcessingType.RequirementAnalysis,
      input: {
        requirements,
        context: { capabilities },
      },
    });
  }
}

export default new AIService();
```

### 2.5 草稿存储系统

```typescript
// src/hooks/useDraftStorage.ts
import { useState, useCallback, useEffect } from 'react';

interface DraftData {
  content: any;
  timestamp: number;
  version: number;
}

export const useDraftStorage = (documentId: string) => {
  const storageKey = `draft_${documentId}`;
  const [hasUnsavedChanges, setHasUnsavedChanges] = useState(false);

  // 保存草稿
  const saveDraft = useCallback((content: any) => {
    const draft: DraftData = {
      content,
      timestamp: Date.now(),
      version: 1,
    };

    // 本地存储
    localStorage.setItem(storageKey, JSON.stringify(draft));

    // 云端备份（异步）
    if (navigator.onLine) {
      fetch('/api/v1/drafts', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ documentId, draft }),
      }).catch(console.error);
    }

    setHasUnsavedChanges(false);
  }, [documentId, storageKey]);

  // 加载草稿
  const loadDraft = useCallback((): any => {
    const stored = localStorage.getItem(storageKey);
    if (stored) {
      try {
        const draft: DraftData = JSON.parse(stored);
        // 检查是否过期（7天）
        if (Date.now() - draft.timestamp < 7 * 24 * 60 * 60 * 1000) {
          return draft.content;
        }
      } catch (e) {
        console.error('Failed to load draft:', e);
      }
    }
    return null;
  }, [storageKey]);

  // 清除草稿
  const clearDraft = useCallback(() => {
    localStorage.removeItem(storageKey);
    setHasUnsavedChanges(false);
  }, [storageKey]);

  // 检查是否有草稿
  const hasDraft = useCallback((): boolean => {
    return localStorage.getItem(storageKey) !== null;
  }, [storageKey]);

  // 自动恢复提示
  useEffect(() => {
    if (hasDraft()) {
      const shouldRestore = window.confirm('检测到未保存的草稿，是否恢复？');
      if (!shouldRestore) {
        clearDraft();
      }
    }
  }, []);

  // 页面退出提醒
  useEffect(() => {
    const handleBeforeUnload = (e: BeforeUnloadEvent) => {
      if (hasUnsavedChanges) {
        e.preventDefault();
        e.returnValue = '有未保存的更改，确定要离开吗？';
      }
    };

    window.addEventListener('beforeunload', handleBeforeUnload);
    return () => window.removeEventListener('beforeunload', handleBeforeUnload);
  }, [hasUnsavedChanges]);

  return {
    saveDraft,
    loadDraft,
    clearDraft,
    hasDraft,
    hasUnsavedChanges,
    setHasUnsavedChanges,
  };
};
```

## 三、UI 组件迁移（第8-10天）

### 3.1 Material-UI 到 Ant Design 映射

```typescript
// src/utils/uiMigration.ts

// 组件映射表
export const ComponentMap = {
  // Material-UI -> Ant Design
  'Button': 'Button',
  'TextField': 'Input',
  'Select': 'Select',
  'Checkbox': 'Checkbox',
  'Radio': 'Radio',
  'Switch': 'Switch',
  'Dialog': 'Modal',
  'Snackbar': 'message',
  'CircularProgress': 'Spin',
  'LinearProgress': 'Progress',
  'Tabs': 'Tabs',
  'Card': 'Card',
  'List': 'List',
  'Table': 'Table',
  'Tooltip': 'Tooltip',
  'Menu': 'Menu',
  'Drawer': 'Drawer',
};

// 样式迁移
export const migrateStyles = (muiStyles: any): any => {
  // 转换 Material-UI 样式到 Ant Design
  return {
    // 示例转换
    primary: 'primary',
    secondary: 'default',
    error: 'danger',
    warning: 'warning',
    info: 'info',
    success: 'success',
  };
};

// Hook 迁移示例
export const useMigratedTheme = () => {
  // 将 Material-UI 的 useTheme 迁移到 Ant Design 的 theme
  const { token } = theme.useToken();
  return {
    palette: {
      primary: { main: token.colorPrimary },
      secondary: { main: token.colorInfo },
    },
    spacing: (n: number) => n * 8,
  };
};
```

### 3.2 页面组件迁移示例

```typescript
// src/features/projects/pages/ProjectListPage.tsx
import React, { useState } from 'react';
import { Table, Button, Space, Card, Input, Tag } from 'antd';
import { PlusOutlined, SearchOutlined } from '@ant-design/icons';
import { useQuery } from '@tanstack/react-query';
import { useNavigate } from 'react-router-dom';

export const ProjectListPage: React.FC = () => {
  const navigate = useNavigate();
  const [searchText, setSearchText] = useState('');

  // 使用 TanStack Query 获取数据
  const { data: projects, isLoading } = useQuery({
    queryKey: ['projects', searchText],
    queryFn: () => fetchProjects({ search: searchText }),
  });

  const columns = [
    {
      title: '项目名称',
      dataIndex: 'name',
      key: 'name',
      render: (text: string, record: any) => (
        <a onClick={() => navigate(`/projects/${record.id}`)}>{text}</a>
      ),
    },
    {
      title: '状态',
      dataIndex: 'status',
      key: 'status',
      render: (status: string) => {
        const color = {
          planning: 'blue',
          active: 'green',
          review: 'orange',
          closed: 'gray',
        }[status];
        return <Tag color={color}>{status}</Tag>;
      },
    },
    {
      title: '进度',
      dataIndex: 'progress',
      key: 'progress',
      render: (progress: number) => `${progress}%`,
    },
    {
      title: '截止日期',
      dataIndex: 'deadline',
      key: 'deadline',
    },
    {
      title: '操作',
      key: 'action',
      render: (_: any, record: any) => (
        <Space size="middle">
          <a>编辑</a>
          <a>查看</a>
        </Space>
      ),
    },
  ];

  return (
    <Card
      title="项目列表"
      extra={
        <Button
          type="primary"
          icon={<PlusOutlined />}
          onClick={() => navigate('/projects/new')}
        >
          新建项目
        </Button>
      }
    >
      <Space direction="vertical" style={{ width: '100%' }}>
        <Input
          placeholder="搜索项目"
          prefix={<SearchOutlined />}
          value={searchText}
          onChange={(e) => setSearchText(e.target.value)}
          style={{ width: 300 }}
        />

        <Table
          columns={columns}
          dataSource={projects}
          loading={isLoading}
          rowKey="id"
          pagination={{
            pageSize: 10,
            showSizeChanger: true,
            showTotal: (total) => `共 ${total} 个项目`,
          }}
        />
      </Space>
    </Card>
  );
};
```

## 四、后端接口适配（第11-12天）

### 4.1 API 客户端配置

```typescript
// src/services/api/client.ts
import axios, { AxiosInstance, AxiosRequestConfig } from 'axios';
import { message } from 'antd';

class APIClient {
  private javaClient: AxiosInstance;
  private pythonClient: AxiosInstance;

  constructor() {
    // Java Spring Boot 服务
    this.javaClient = axios.create({
      baseURL: import.meta.env.VITE_JAVA_API_URL || 'http://localhost:8080',
      timeout: 30000,
    });

    // Python FastAPI 服务
    this.pythonClient = axios.create({
      baseURL: import.meta.env.VITE_PYTHON_API_URL || 'http://localhost:8001',
      timeout: 60000, // AI 请求需要更长超时
    });

    this.setupInterceptors();
  }

  private setupInterceptors() {
    // 请求拦截器
    const requestInterceptor = (config: AxiosRequestConfig) => {
      const token = localStorage.getItem('token');
      if (token) {
        config.headers = {
          ...config.headers,
          Authorization: `Bearer ${token}`,
        };
      }
      return config;
    };

    // 响应拦截器
    const responseInterceptor = (response: any) => response;
    const errorInterceptor = (error: any) => {
      if (error.response?.status === 401) {
        // 认证失败
        localStorage.removeItem('token');
        window.location.href = '/login';
      } else if (error.response?.status === 403) {
        message.error('没有权限执行此操作');
      } else if (error.response?.status >= 500) {
        message.error('服务器错误，请稍后重试');
      }
      return Promise.reject(error);
    };

    // 应用到两个客户端
    [this.javaClient, this.pythonClient].forEach(client => {
      client.interceptors.request.use(requestInterceptor);
      client.interceptors.response.use(responseInterceptor, errorInterceptor);
    });
  }

  // Java API 方法
  get java() {
    return {
      get: (url: string, config?: AxiosRequestConfig) =>
        this.javaClient.get(url, config),
      post: (url: string, data?: any, config?: AxiosRequestConfig) =>
        this.javaClient.post(url, data, config),
      put: (url: string, data?: any, config?: AxiosRequestConfig) =>
        this.javaClient.put(url, data, config),
      delete: (url: string, config?: AxiosRequestConfig) =>
        this.javaClient.delete(url, config),
    };
  }

  // Python API 方法
  get python() {
    return {
      get: (url: string, config?: AxiosRequestConfig) =>
        this.pythonClient.get(url, config),
      post: (url: string, data?: any, config?: AxiosRequestConfig) =>
        this.pythonClient.post(url, data, config),
      put: (url: string, data?: any, config?: AxiosRequestConfig) =>
        this.pythonClient.put(url, data, config),
      delete: (url: string, config?: AxiosRequestConfig) =>
        this.pythonClient.delete(url, config),
    };
  }
}

export default new APIClient();
```

### 4.2 服务层实现

```typescript
// src/services/documentService.ts
import apiClient from './api/client';

interface Document {
  id: string;
  title: string;
  content: any;
  projectId: string;
  status: string;
  createdAt: string;
  updatedAt: string;
}

class DocumentService {
  // 获取文档列表
  async getDocuments(projectId: string): Promise<Document[]> {
    const response = await apiClient.java.get(`/api/v1/projects/${projectId}/documents`);
    return response.data.data;
  }

  // 获取单个文档
  async getDocument(id: string): Promise<Document> {
    const response = await apiClient.java.get(`/api/v1/documents/${id}`);
    return response.data.data;
  }

  // 创建文档
  async createDocument(data: Partial<Document>): Promise<Document> {
    const response = await apiClient.java.post('/api/v1/documents', data);
    return response.data.data;
  }

  // 更新文档
  async updateDocument(id: string, data: Partial<Document>): Promise<Document> {
    const response = await apiClient.java.put(`/api/v1/documents/${id}`, data);
    return response.data.data;
  }

  // AI 生成内容
  async generateContent(documentId: string, prompt: string): Promise<string> {
    const response = await apiClient.python.post('/api/v1/ai/generate', {
      documentId,
      prompt,
    });
    return response.data.data.content;
  }

  // 分析需求
  async analyzeRequirements(file: File): Promise<any> {
    const formData = new FormData();
    formData.append('file', file);

    const response = await apiClient.python.post(
      '/api/v1/ai/analyze-requirements',
      formData,
      {
        headers: { 'Content-Type': 'multipart/form-data' },
      }
    );
    return response.data.data;
  }
}

export default new DocumentService();
```

## 五、测试与优化（第13-15天）

### 5.1 单元测试示例

```typescript
// src/features/documents/__tests__/DocumentEditor.test.tsx
import { render, screen, fireEvent, waitFor } from '@testing-library/react';
import { vi } from 'vitest';
import { BidDocumentEditor } from '../components/BidDocumentEditor';

describe('BidDocumentEditor', () => {
  it('should render editor', () => {
    render(<BidDocumentEditor documentId="test-doc" />);
    expect(screen.getByPlaceholderText('开始编写标书内容...')).toBeInTheDocument();
  });

  it('should auto-save draft', async () => {
    const saveDraft = vi.fn();
    vi.spyOn(Storage.prototype, 'setItem');

    render(<BidDocumentEditor documentId="test-doc" />);

    // 等待自动保存
    await waitFor(() => {
      expect(localStorage.setItem).toHaveBeenCalledWith(
        'draft_test-doc',
        expect.any(String)
      );
    }, { timeout: 31000 });
  });

  it('should handle keyboard shortcuts', async () => {
    const onSave = vi.fn();
    render(<BidDocumentEditor documentId="test-doc" onSave={onSave} />);

    // 触发 Ctrl+S
    fireEvent.keyDown(document, { key: 'S', ctrlKey: true });

    await waitFor(() => {
      expect(onSave).toHaveBeenCalled();
    });
  });
});
```

### 5.2 性能优化配置

```typescript
// vite.config.ts
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';
import { visualizer } from 'rollup-plugin-visualizer';

export default defineConfig({
  plugins: [
    react(),
    visualizer({
      open: true,
      gzipSize: true,
      brotliSize: true,
    }),
  ],
  build: {
    rollupOptions: {
      output: {
        manualChunks: {
          'react-vendor': ['react', 'react-dom', 'react-router-dom'],
          'antd-vendor': ['antd', '@ant-design/icons', '@ant-design/pro-components'],
          'editor': ['blacknode-editor'],
          'query': ['@tanstack/react-query'],
          'utils': ['lodash-es', 'date-fns', 'axios'],
        },
      },
    },
    chunkSizeWarningLimit: 1500,
    sourcemap: false,
    minify: 'terser',
    terserOptions: {
      compress: {
        drop_console: true,
        drop_debugger: true,
      },
    },
  },
  optimizeDeps: {
    include: [
      'react',
      'react-dom',
      'antd',
      '@ant-design/icons',
      'blacknode-editor',
    ],
  },
});
```

## 六、部署配置

### 6.1 Docker 配置

```dockerfile
# Dockerfile
FROM node:18-alpine as builder

WORKDIR /app

# 复制依赖文件
COPY package*.json ./
RUN npm ci --only=production

# 复制源代码
COPY . .

# 构建
RUN npm run build

# 生产镜像
FROM nginx:alpine

# 复制构建产物
COPY --from=builder /app/dist /usr/share/nginx/html

# 复制 nginx 配置
COPY nginx.conf /etc/nginx/nginx.conf

EXPOSE 80

CMD ["nginx", "-g", "daemon off;"]
```

### 6.2 Nginx 配置

```nginx
# nginx.conf
server {
    listen 80;
    server_name localhost;

    root /usr/share/nginx/html;
    index index.html;

    # 开启 gzip
    gzip on;
    gzip_types text/plain text/css text/javascript application/javascript application/json;
    gzip_min_length 1000;

    # 缓存策略
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }

    # SPA 路由
    location / {
        try_files $uri $uri/ /index.html;
    }

    # API 代理
    location /api/v1 {
        proxy_pass http://backend:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }

    # AI 服务代理
    location /ai/v1 {
        proxy_pass http://ai-service:8001;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_read_timeout 300s;
    }
}
```

## 检查清单

### 第一阶段完成标准
- [ ] 项目环境搭建完成
- [ ] 基础依赖安装完成
- [ ] 目录结构创建完成
- [ ] 配置文件调整完成

### 第二阶段完成标准
- [ ] 编辑器集成完成
- [ ] 变量系统实现完成
- [ ] AI 服务集成完成
- [ ] 草稿存储实现完成
- [ ] 核心 Hook 移植完成

### 第三阶段完成标准
- [ ] UI 组件迁移完成
- [ ] 页面组件迁移完成
- [ ] 路由配置完成
- [ ] 状态管理集成完成

### 第四阶段完成标准
- [ ] API 客户端配置完成
- [ ] 服务层实现完成
- [ ] 认证授权集成完成
- [ ] 错误处理完成

### 第五阶段完成标准
- [ ] 单元测试编写完成
- [ ] E2E 测试配置完成
- [ ] 性能优化完成
- [ ] 构建配置优化完成

## 风险与对策

| 风险 | 影响 | 对策 |
|------|------|------|
| Blacknode 编辑器兼容性 | 高 | 提前测试，准备备选方案 |
| API 接口不匹配 | 中 | 建立适配层，统一接口 |
| 性能问题 | 中 | 逐步优化，监控关键指标 |
| 团队学习成本 | 低 | 提供详细文档和培训 |

---

## 修改历史

| 日期 | 版本 | 修改者 | 修改内容概要 |
|------|------|--------|-------------|
| 2025-11-30 10:15 | 1.0 | claude-opus-4-1-20250805 | 创建 aidev3 功能移植实施指南 |

---

**文档状态**: ✅ 已完成
**预计工时**: 15个工作日
**执行团队**: 前端开发团队