---
æ–‡æ¡£ç±»åž‹: æž¶æž„æ–‡æ¡£
éœ€æ±‚ç¼–å·: DOC-2025-11-001
åˆ›å»ºæ—¥æœŸ: 2025-11-15
åˆ›å»ºè€…: claude-sonnet-4-5 (claude-sonnet-4-5-20250929)
æœ€åŽæ›´æ–°: 2025-11-26
æ›´æ–°è€…: claude-sonnet-4-5 (claude-sonnet-4-5-20250929)
çŠ¶æ€: å·²æ‰¹å‡†
---

# AIæ ‡ä¹¦æ™ºèƒ½åˆ›ä½œå¹³å° - æ•°æ®åº“è®¾è®¡ - ðŸ“ é¡¹ç›®åŸŸ

### 7. projects (é¡¹ç›®è¡¨)

```sql
CREATE TABLE projects (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    name VARCHAR(200) NOT NULL,
    code VARCHAR(50) UNIQUE NOT NULL,
    description TEXT,
    organization_id UUID NOT NULL,
    bidding_type VARCHAR(50) CHECK (bidding_type IN ('government', 'enterprise', 'international', 'other')),
    industry VARCHAR(100),
    budget_amount DECIMAL(15, 2),
    currency VARCHAR(10) DEFAULT 'CNY',
    start_date DATE,
    end_date DATE,
    submission_deadline TIMESTAMP WITH TIME ZONE,
    status VARCHAR(20) DEFAULT 'draft' CHECK (status IN ('draft', 'in_progress', 'review', 'submitted', 'won', 'lost', 'archived')),
    priority VARCHAR(20) DEFAULT 'medium' CHECK (priority IN ('low', 'medium', 'high', 'urgent')),
    win_probability INTEGER CHECK (win_probability >= 0 AND win_probability <= 100),
    tags TEXT[] DEFAULT ARRAY[]::TEXT[],
    settings JSONB DEFAULT '{}'::jsonb,
    metadata JSONB DEFAULT '{}'::jsonb,
    created_by UUID NOT NULL,
    updated_by UUID,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    deleted_at TIMESTAMP WITH TIME ZONE,
    FOREIGN KEY (organization_id) REFERENCES organizations(id) ON DELETE CASCADE,
    FOREIGN KEY (created_by) REFERENCES users(id) ON DELETE RESTRICT,
    FOREIGN KEY (updated_by) REFERENCES users(id) ON DELETE SET NULL
);

-- ç´¢å¼•
CREATE INDEX idx_projects_organization_id ON projects(organization_id) WHERE deleted_at IS NULL;
CREATE INDEX idx_projects_status ON projects(status) WHERE deleted_at IS NULL;
CREATE INDEX idx_projects_created_by ON projects(created_by);
CREATE INDEX idx_projects_submission_deadline ON projects(submission_deadline) WHERE deleted_at IS NULL;
CREATE INDEX idx_projects_tags ON projects USING gin(tags);
CREATE INDEX idx_projects_created_at ON projects(created_at DESC);

-- æ³¨é‡Š
COMMENT ON TABLE projects IS 'é¡¹ç›®è¡¨';
COMMENT ON COLUMN projects.bidding_type IS 'æ‹›æ ‡ç±»åž‹';
COMMENT ON COLUMN projects.status IS 'é¡¹ç›®çŠ¶æ€';
COMMENT ON COLUMN projects.priority IS 'ä¼˜å…ˆçº§';
COMMENT ON COLUMN projects.win_probability IS 'ä¸­æ ‡æ¦‚çŽ‡(0-100)';
```

### 8. project_members (é¡¹ç›®æˆå‘˜è¡¨)

```sql
CREATE TABLE project_members (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    project_id UUID NOT NULL,
    user_id UUID NOT NULL,
    role VARCHAR(50) DEFAULT 'member' CHECK (role IN ('owner', 'manager', 'member', 'viewer')),
    permissions TEXT[] DEFAULT ARRAY[]::TEXT[],
    joined_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    created_by UUID,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (project_id) REFERENCES projects(id) ON DELETE CASCADE,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (created_by) REFERENCES users(id) ON DELETE SET NULL,
    UNIQUE (project_id, user_id)
);

-- ç´¢å¼•
CREATE INDEX idx_project_members_project_id ON project_members(project_id);
CREATE INDEX idx_project_members_user_id ON project_members(user_id);
CREATE INDEX idx_project_members_role ON project_members(role);

-- æ³¨é‡Š
COMMENT ON TABLE project_members IS 'é¡¹ç›®æˆå‘˜è¡¨';
COMMENT ON COLUMN project_members.role IS 'é¡¹ç›®è§’è‰²: owner-æ‰€æœ‰è€…, manager-ç®¡ç†å‘˜, member-æˆå‘˜, viewer-æŸ¥çœ‹è€…';
```

### 9. bidding_documents (æ‹›æ ‡æ–‡ä»¶è¡¨)

```sql
CREATE TABLE bidding_documents (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    project_id UUID NOT NULL,
    file_name VARCHAR(255) NOT NULL,
    file_path TEXT NOT NULL,
    file_size BIGINT NOT NULL,
    file_type VARCHAR(50) NOT NULL,
    mime_type VARCHAR(100),
    storage_key VARCHAR(500) NOT NULL,
    parsed_status VARCHAR(20) DEFAULT 'pending' CHECK (parsed_status IN ('pending', 'processing', 'success', 'failed')),
    parsed_content JSONB,
    parsed_at TIMESTAMP WITH TIME ZONE,
    parse_error TEXT,
    document_hash VARCHAR(64),
    uploaded_by UUID NOT NULL,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    deleted_at TIMESTAMP WITH TIME ZONE,
    FOREIGN KEY (project_id) REFERENCES projects(id) ON DELETE CASCADE,
    FOREIGN KEY (uploaded_by) REFERENCES users(id) ON DELETE RESTRICT
);

-- ç´¢å¼•
CREATE INDEX idx_bidding_documents_project_id ON bidding_documents(project_id) WHERE deleted_at IS NULL;
CREATE INDEX idx_bidding_documents_parsed_status ON bidding_documents(parsed_status);
CREATE INDEX idx_bidding_documents_document_hash ON bidding_documents(document_hash);
CREATE INDEX idx_bidding_documents_created_at ON bidding_documents(created_at DESC);

-- æ³¨é‡Š
COMMENT ON TABLE bidding_documents IS 'æ‹›æ ‡æ–‡ä»¶è¡¨';
COMMENT ON COLUMN bidding_documents.parsed_status IS 'è§£æžçŠ¶æ€';
COMMENT ON COLUMN bidding_documents.parsed_content IS 'è§£æžåŽçš„å†…å®¹(JSON)';
COMMENT ON COLUMN bidding_documents.document_hash IS 'æ–‡ä»¶å“ˆå¸Œ(ç”¨äºŽåŽ»é‡)';
```

### 10. project_requirements (é¡¹ç›®éœ€æ±‚è¡¨)

```sql
CREATE TABLE project_requirements (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    project_id UUID NOT NULL,
    requirement_type VARCHAR(50) CHECK (requirement_type IN ('technical', 'business', 'compliance', 'resource', 'other')),
    category VARCHAR(100),
    title VARCHAR(200) NOT NULL,
    description TEXT,
    priority VARCHAR(20) DEFAULT 'medium' CHECK (priority IN ('low', 'medium', 'high', 'critical')),
    is_mandatory BOOLEAN DEFAULT TRUE,
    score_weight DECIMAL(5, 2),
    match_status VARCHAR(20) DEFAULT 'pending' CHECK (match_status IN ('pending', 'matched', 'partial', 'unmatched')),
    match_score DECIMAL(5, 2),
    match_details JSONB,
    source VARCHAR(50),
    source_page INTEGER,
    extracted_by VARCHAR(20) DEFAULT 'ai' CHECK (extracted_by IN ('ai', 'manual')),
    metadata JSONB DEFAULT '{}'::jsonb,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (project_id) REFERENCES projects(id) ON DELETE CASCADE
);

-- ç´¢å¼•
CREATE INDEX idx_project_requirements_project_id ON project_requirements(project_id);
CREATE INDEX idx_project_requirements_type ON project_requirements(requirement_type);
CREATE INDEX idx_project_requirements_match_status ON project_requirements(match_status);

-- æ³¨é‡Š
COMMENT ON TABLE project_requirements IS 'é¡¹ç›®éœ€æ±‚è¡¨';
COMMENT ON COLUMN project_requirements.match_status IS 'åŒ¹é…çŠ¶æ€';
COMMENT ON COLUMN project_requirements.match_score IS 'åŒ¹é…åˆ†æ•°(0-100)';
```
