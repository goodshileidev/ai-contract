# Python FastAPI AI 服务任务详细计划 - AI-002 - AI-002: 智能内容生成引擎 - 二级任务 2.4: 内容优化

**预计工作量**: 3 人天
**完成进度**: 0% (0/5 类别)

#### 2.4.1 数据定义

**待完成任务**:
- [ ] 定义优化请求模型
  ```python
  # apps/backend-python/app/models/optimization.py
  class OptimizationType(str, Enum):
      POLISH = "polish"  # 润色
      SIMPLIFY = "simplify"  # 简化
      EXPAND = "expand"  # 扩展
      FORMALIZE = "formalize"  # 正式化
      TERMINOLOGY_CHECK = "terminology_check"  # 术语检查

  class OptimizationRequest(BaseModel):
      content: str
      optimization_type: OptimizationType
      context: Optional[Dict[str, Any]]

  class OptimizationResponse(BaseModel):
      original_content: str
      optimized_content: str
      changes: List[Dict[str, Any]]  # 修改说明
      suggestions: List[str]
  ```

#### 2.4.2 前端实现

**待完成任务**:
- [ ] 创建内容优化按钮组
  ```typescript
  // apps/frontend/src/components/ai/OptimizationTools.tsx
  import { Button, Dropdown, Menu, message } from 'antd';
  import { ThunderboltOutlined } from '@ant-design/icons';

  interface Props {
      selectedText: string;
      onOptimized: (optimizedText: string) => void;
  }

  export function OptimizationTools({ selectedText, onOptimized }: Props) {
      const handleOptimize = async (type: string) => {
          if (!selectedText) {
              message.warning('请先选中要优化的文本');
              return;
          }

          try {
              const response = await fetch('http://localhost:8001/api/v1/ai/optimize-content', {
                  method: 'POST',
                  headers: { 'Content-Type': 'application/json' },
                  body: JSON.stringify({
                      content: selectedText,
                      optimization_type: type
                  })
              });

              const result = await response.json();
              onOptimized(result.optimized_content);
              message.success('优化完成');
          } catch (error) {
              message.error('优化失败');
          }
      };

      const menu = (
          <Menu onClick={({ key }) => handleOptimize(key)}>
              <Menu.Item key="polish">润色</Menu.Item>
              <Menu.Item key="simplify">简化</Menu.Item>
              <Menu.Item key="expand">扩展</Menu.Item>
              <Menu.Item key="formalize">正式化</Menu.Item>
              <Menu.Item key="terminology_check">术语检查</Menu.Item>
          </Menu>
      );

      return (
          <Dropdown overlay={menu}>
              <Button icon={<ThunderboltOutlined />}>
                  AI优化
              </Button>
          </Dropdown>
      );
  }
  ```

#### 2.4.3 Java后端实现

**待完成任务**:
- [ ] 无需Java后端支持（纯Python实现）

#### 2.4.4 Python后端实现

**待完成任务**:
- [ ] 实现内容优化服务
  ```python
  # apps/backend-python/app/services/ai/optimization_service.py
  class OptimizationService:
      """内容优化服务"""

      def __init__(self):
          self.llm = OpenAI(model="gpt-4-turbo-preview", api_key=settings.OPENAI_API_KEY)

      async def optimize(
          self,
          content: str,
          optimization_type: OptimizationType
      ) -> OptimizationResponse:
          """
          优化内容
          需求编号: REQ-AI-002
          """
          prompts = {
              OptimizationType.POLISH: f"""
请对以下内容进行润色，提升文字的流畅性和专业性，保持原意不变：

{content}

请直接输出润色后的内容：
""",
              OptimizationType.SIMPLIFY: f"""
请将以下内容简化，使其更简洁明了，去除冗余表述：

{content}

请直接输出简化后的内容：
""",
              OptimizationType.EXPAND: f"""
请对以下内容进行扩展，增加细节和说明，使其更加充实：

{content}

请直接输出扩展后的内容：
""",
              OptimizationType.FORMALIZE: f"""
请将以下内容正式化，使用更正式的表述和专业术语：

{content}

请直接输出正式化后的内容：
""",
              OptimizationType.TERMINOLOGY_CHECK: f"""
请检查以下内容中的专业术语使用是否准确，如有错误请指出并修正：

{content}

请列出发现的术语问题和修正建议：
"""
          }

          prompt = prompts[optimization_type]

          # 调用LLM优化
          response = await self.llm.acomplete(prompt)
          optimized_content = response.text.strip()

          # 分析修改
          changes = await self._analyze_changes(content, optimized_content)

          return OptimizationResponse(
              original_content=content,
              optimized_content=optimized_content,
              changes=changes,
              suggestions=[]
          )

      async def _analyze_changes(
          self,
          original: str,
          optimized: str
      ) -> List[Dict[str, Any]]:
          """分析修改点"""
          # 简单的差异分析（可以用difflib更精细）
          import difflib

          changes = []
          diff = difflib.unified_diff(
              original.splitlines(),
              optimized.splitlines(),
              lineterm=''
          )

          for line in diff:
              if line.startswith('+'):
                  changes.append({
                      'type': 'add',
                      'content': line[1:]
                  })
              elif line.startswith('-'):
                  changes.append({
                      'type': 'remove',
                      'content': line[1:]
                  })

          return changes
  ```

- [ ] 创建API端点
  ```python
  @router.post("/optimize-content")
  async def optimize_content(request: OptimizationRequest):
      """
      优化内容
      需求编号: REQ-AI-002
      """
      optimization_service = OptimizationService()

      result = await optimization_service.optimize(
          content=request.content,
          optimization_type=request.optimization_type
      )

      return result
  ```

#### 2.4.5 部署配置

**待完成任务**:
- [ ] 无需额外部署配置

**验收标准**:
- [ ] 各类优化功能正常
- [ ] 优化结果质量高
- [ ] 修改分析准确

---
