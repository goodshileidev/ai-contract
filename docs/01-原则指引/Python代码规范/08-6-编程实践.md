---
文档类型: 知识库文档
需求编号: DOC-2025-11-004
创建日期: 2025-11-26
创建者: claude-sonnet-4-5 (claude-sonnet-4-5-20250929)
最后更新: 2025-11-26
更新者: claude-sonnet-4-5 (claude-sonnet-4-5-20250929)
状态: 已批准
---

# Python 代码规范 - 6. 编程实践

### 6.1 使用生成器

```python
# ✅ 推荐：使用生成器处理大数据
def read_large_file(file_path: str):
    """逐行读取大文件"""
    with open(file_path, 'r', encoding='utf-8') as f:
        for line in f:
            yield line.strip()

# ✅ 使用生成器表达式
total = sum(len(line) for line in read_large_file("large.txt"))

# ❌ 不推荐：一次性加载到内存
with open(file_path) as f:
    lines = f.readlines()  # ❌ 大文件会占用大量内存
```

### 6.2 上下文管理器

```python
# ✅ 推荐：使用 with 语句
with open("file.txt", "r") as f:
    content = f.read()

# ✅ 推荐：多个上下文管理器
with open("input.txt") as input_file, \
     open("output.txt", "w") as output_file:
    output_file.write(input_file.read())

# ✅ 自定义上下文管理器
from contextlib import contextmanager

@contextmanager
def timer(name: str):
    """计时上下文管理器"""
    import time
    start = time.time()
    try:
        yield
    finally:
        end = time.time()
        print(f"{name} 耗时: {end - start:.2f}秒")

# 使用
with timer("文档解析"):
    parse_document("document.pdf")
```

### 6.3 异常处理

```python
# ✅ 正确：捕获特定异常
try:
    result = parse_document(doc_id)
except FileNotFoundError:
    logger.error(f"文档不存在: {doc_id}")
    raise DocumentNotFoundError(f"文档 {doc_id} 不存在")
except ParseError as e:
    logger.error(f"解析失败: {e}")
    raise
except Exception as e:
    logger.error(f"未预期的错误: {e}")
    raise AIServiceError("文档处理失败") from e

# ✅ 正确：使用 finally
try:
    file = open("file.txt")
    process_file(file)
finally:
    file.close()

# ❌ 错误：捕获所有异常但不处理
try:
    do_something()
except:  # ❌ 不要使用裸 except
    pass

# ❌ 错误：过于宽泛的异常捕获
try:
    do_something()
except Exception:  # ❌ 太宽泛，应该捕获具体异常
    pass
```

### 6.4 列表推导式和字典推导式

```python
# ✅ 推荐：列表推导式（简洁清晰）
squares = [x ** 2 for x in range(10)]
even_squares = [x ** 2 for x in range(10) if x % 2 == 0]

# ✅ 推荐：字典推导式
word_lengths = {word: len(word) for word in words}

# ✅ 推荐：集合推导式
unique_lengths = {len(word) for word in words}

# ❌ 不推荐：复杂的推导式（影响可读性）
result = [
    process(item)
    for sublist in nested_list
    for item in sublist
    if item.is_valid() and item.score > 0.5
]  # ❌ 太复杂，应该用普通循环

# ✅ 复杂逻辑用普通循环
result = []
for sublist in nested_list:
    for item in sublist:
        if item.is_valid() and item.score > 0.5:
            result.append(process(item))
```

### 6.5 字符串格式化

```python
# ✅ 推荐：f-string（Python 3.6+）
name = "John"
age = 30
message = f"用户 {name} 的年龄是 {age} 岁"

# ✅ 推荐：f-string 支持表达式
message = f"明年 {name} 将 {age + 1} 岁"

# ✅ 推荐：f-string 支持格式化
pi = 3.14159
message = f"圆周率约等于 {pi:.2f}"

# ⚠️ 可以但不推荐：str.format()
message = "用户 {} 的年龄是 {} 岁".format(name, age)

# ❌ 不推荐：% 格式化（旧式）
message = "用户 %s 的年龄是 %d 岁" % (name, age)

# ✅ 多行字符串
query = f"""
SELECT *
FROM users
WHERE name = '{name}'
AND age > {age}
"""
```

---
