#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
ç”Ÿæˆä¸šåŠ¡æµç¨‹å®šä¹‰JSONæ–‡ä»¶

åŠŸèƒ½è¯´æ˜ï¼š
- ä¸ºAIBidComposeré¡¹ç›®åˆ›å»ºæ ¸å¿ƒä¸šåŠ¡æµç¨‹å®šä¹‰
- æ¯ä¸ªæµç¨‹åŒ…å«éœ€æ±‚ã€åŸºæœ¬è®¾è®¡å’Œè¯¦ç»†è®¾è®¡å±‚é¢çš„æµç¨‹å›¾æè¿°
- ä½¿ç”¨Mermaidè¯­æ³•å®šä¹‰æµç¨‹å›¾
- ç¬¦åˆgenerator-springcrudçš„biz_flow schemaè§„èŒƒ

åˆ›å»ºæ—¥æœŸ: 2025-11-28
"""

import json
from pathlib import Path
from typing import Dict, List, Any
from datetime import datetime


class BizFlowGenerator:
    """ä¸šåŠ¡æµç¨‹ç”Ÿæˆå™¨"""

    def __init__(self):
        self.project_root = Path(__file__).parent.parent
        self.output_dir = self.project_root / "structured-requirements" / "individual-jsons" / "17-ä¸šåŠ¡æµç¨‹"
        self.flow_id_counter = 1

        # ç¡®ä¿è¾“å‡ºç›®å½•å­˜åœ¨
        self.output_dir.mkdir(parents=True, exist_ok=True)

        # æ¨¡å—IDæ˜ å°„
        self.module_map = {
            "ç”¨æˆ·è®¤è¯": 1,
            "é¡¹ç›®ç®¡ç†": 2,
            "æ ‡ä¹¦æ–‡æ¡£": 3,
            "æ¨¡æ¿ç®¡ç†": 4,
            "ä¼ä¸šèƒ½åŠ›": 5,
            "AIæœåŠ¡": 6,
            "åä½œ": 7,
            "å®¡æ‰¹": 8,
            "ç³»ç»Ÿç®¡ç†": 9,
            "æŠ¥è¡¨ç»Ÿè®¡": 10,
            "æœç´¢": 11
        }

    def generate_all_flows(self):
        """ç”Ÿæˆæ‰€æœ‰ä¸šåŠ¡æµç¨‹å®šä¹‰"""

        flows = [
            # 1. ç”¨æˆ·æ³¨å†Œç™»å½•æµç¨‹
            {
                "module": "ç”¨æˆ·è®¤è¯",
                "name": "ç”¨æˆ·æ³¨å†Œç™»å½•æµç¨‹",
                "key": "USER_REGISTER_LOGIN_FLOW",
                "demand_description": "ç”¨æˆ·é€šè¿‡é‚®ç®±æ³¨å†Œè´¦å·ï¼Œå®Œæˆé‚®ç®±éªŒè¯åå¯ä»¥ç™»å½•ç³»ç»Ÿä½¿ç”¨å„é¡¹åŠŸèƒ½",
                "basic_description": "æ³¨å†Œæµç¨‹åŒ…æ‹¬ä¿¡æ¯å¡«å†™ã€é‚®ç®±éªŒè¯ã€è´¦å·æ¿€æ´»ä¸‰ä¸ªç¯èŠ‚ã€‚ç™»å½•æ”¯æŒè´¦å·å¯†ç å’Œç¬¬ä¸‰æ–¹OAuth2.0è®¤è¯",
                "mermaid": """
                graph TD
                    A[ç”¨æˆ·è®¿é—®æ³¨å†Œé¡µé¢] --> B[å¡«å†™æ³¨å†Œä¿¡æ¯]
                    B --> C[æäº¤æ³¨å†Œè¯·æ±‚]
                    C --> D{ä¿¡æ¯éªŒè¯}
                    D -->|éªŒè¯å¤±è´¥| E[æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯]
                    E --> B
                    D -->|éªŒè¯æˆåŠŸ| F[å‘é€éªŒè¯é‚®ä»¶]
                    F --> G[ç”¨æˆ·æ”¶åˆ°é‚®ä»¶]
                    G --> H[ç‚¹å‡»éªŒè¯é“¾æ¥]
                    H --> I[è´¦å·æ¿€æ´»æˆåŠŸ]
                    I --> J[è·³è½¬ç™»å½•é¡µé¢]
                    J --> K[è¾“å…¥è´¦å·å¯†ç ]
                    K --> L{è®¤è¯éªŒè¯}
                    L -->|å¤±è´¥| M[æ˜¾ç¤ºç™»å½•å¤±è´¥]
                    M --> K
                    L -->|æˆåŠŸ| N[ç”ŸæˆJWT Token]
                    N --> O[è·³è½¬é¦–é¡µ]
                """
            },

            # 2. æ‹›æ ‡æ–‡ä»¶è§£ææµç¨‹
            {
                "module": "æ ‡ä¹¦æ–‡æ¡£",
                "name": "æ‹›æ ‡æ–‡ä»¶æ™ºèƒ½è§£ææµç¨‹",
                "key": "BIDDING_DOC_PARSE_FLOW",
                "demand_description": "ç”¨æˆ·ä¸Šä¼ æ‹›æ ‡æ–‡ä»¶åï¼Œç³»ç»Ÿè‡ªåŠ¨è§£ææ–‡ä»¶å†…å®¹ï¼Œæå–é¡¹ç›®ä¿¡æ¯ã€æŠ€æœ¯éœ€æ±‚ã€å•†åŠ¡éœ€æ±‚å’Œè¯„åˆ†æ ‡å‡†",
                "basic_description": "ä½¿ç”¨AIæœåŠ¡è§£æPDF/Wordæ–‡æ¡£ï¼Œè¯†åˆ«æ–‡æ¡£ç»“æ„ï¼Œæå–å…³é”®ä¿¡æ¯ï¼Œç”Ÿæˆç»“æ„åŒ–éœ€æ±‚æ•°æ®",
                "mermaid": """
                graph TD
                    A[ç”¨æˆ·ä¸Šä¼ æ‹›æ ‡æ–‡ä»¶] --> B[æ–‡ä»¶æ ¼å¼éªŒè¯]
                    B --> C{æ ¼å¼æ˜¯å¦æ”¯æŒ}
                    C -->|ä¸æ”¯æŒ| D[æç¤ºæ ¼å¼é”™è¯¯]
                    C -->|æ”¯æŒ| E[æ–‡ä»¶ä¸Šä¼ åˆ°MinIO]
                    E --> F[åˆ›å»ºè§£æä»»åŠ¡]
                    F --> G[AIæœåŠ¡æ¥æ”¶ä»»åŠ¡]
                    G --> H[æ–‡æœ¬æå–]
                    H --> I[ç»“æ„è¯†åˆ«]
                    I --> J[ä¿¡æ¯æŠ½å–]
                    J --> K[éœ€æ±‚åˆ†ç±»]
                    K --> L[ç”Ÿæˆç»“æ„åŒ–æ•°æ®]
                    L --> M[ä¿å­˜åˆ°æ•°æ®åº“]
                    M --> N[é€šçŸ¥ç”¨æˆ·è§£æå®Œæˆ]
                """
            },

            # 3. æ™ºèƒ½å†…å®¹ç”Ÿæˆæµç¨‹
            {
                "module": "AIæœåŠ¡",
                "name": "AIæ™ºèƒ½å†…å®¹ç”Ÿæˆæµç¨‹",
                "key": "AI_CONTENT_GENERATION_FLOW",
                "demand_description": "æ ¹æ®æ‹›æ ‡éœ€æ±‚å’Œä¼ä¸šèƒ½åŠ›ï¼ŒAIè‡ªåŠ¨ç”Ÿæˆæ ‡ä¹¦å†…å®¹ï¼ŒåŒ…æ‹¬æŠ€æœ¯æ–¹æ¡ˆã€å•†åŠ¡æ–¹æ¡ˆã€é¡¹ç›®è®¡åˆ’ç­‰",
                "basic_description": "é€šè¿‡RAGæŠ€æœ¯æ£€ç´¢ç›¸å…³æ¡ˆä¾‹å’Œèƒ½åŠ›ï¼Œä½¿ç”¨å¤§è¯­è¨€æ¨¡å‹ç”Ÿæˆä¸“ä¸šæ ‡ä¹¦å†…å®¹ï¼Œæ”¯æŒäººå·¥å®¡æ ¸å’Œä¿®æ”¹",
                "mermaid": """
                graph TD
                    A[ç”¨æˆ·é€‰æ‹©ç« èŠ‚] --> B[ç‚¹å‡»æ™ºèƒ½ç”Ÿæˆ]
                    B --> C[åˆ†ææ‹›æ ‡éœ€æ±‚]
                    C --> D[å‘é‡æ£€ç´¢ç›¸å…³æ¡ˆä¾‹]
                    D --> E[åŒ¹é…ä¼ä¸šèƒ½åŠ›]
                    E --> F[æ„å»ºç”ŸæˆPrompt]
                    F --> G[è°ƒç”¨LLMç”Ÿæˆå†…å®¹]
                    G --> H[å†…å®¹åå¤„ç†]
                    H --> I[æ ¼å¼åŒ–è¾“å‡º]
                    I --> J[æ’å…¥æ–‡æ¡£è‰ç¨¿]
                    J --> K{ç”¨æˆ·æ“ä½œ}
                    K -->|æ¥å—| L[ä¿å­˜åˆ°æ­£å¼ç‰ˆæœ¬]
                    K -->|ä¿®æ”¹| M[äººå·¥ç¼–è¾‘]
                    M --> L
                    K -->|é‡æ–°ç”Ÿæˆ| C
                """
            },

            # 4. æ¨¡æ¿åº”ç”¨æµç¨‹
            {
                "module": "æ¨¡æ¿ç®¡ç†",
                "name": "æ ‡ä¹¦æ¨¡æ¿åº”ç”¨æµç¨‹",
                "key": "TEMPLATE_APPLY_FLOW",
                "demand_description": "ç”¨æˆ·ä»æ¨¡æ¿åº“é€‰æ‹©åˆé€‚çš„æ ‡ä¹¦æ¨¡æ¿ï¼Œç³»ç»Ÿæ ¹æ®æ¨¡æ¿ç»“æ„åˆ›å»ºæ–°çš„æ ‡ä¹¦æ–‡æ¡£",
                "basic_description": "æ¨¡æ¿åŒ…å«ç« èŠ‚ç»“æ„ã€å˜é‡å®šä¹‰å’Œæ ·å¼è®¾ç½®ï¼Œåº”ç”¨æ—¶å¯ä»¥å¡«å…¥é¡¹ç›®ç‰¹å®šä¿¡æ¯ï¼Œç”Ÿæˆå®šåˆ¶åŒ–æ–‡æ¡£",
                "mermaid": """
                graph TD
                    A[æµè§ˆæ¨¡æ¿åº“] --> B[ç­›é€‰æ¨¡æ¿]
                    B --> C[é¢„è§ˆæ¨¡æ¿]
                    C --> D{é€‰æ‹©æ¨¡æ¿}
                    D -->|ç»§ç»­æµè§ˆ| B
                    D -->|åº”ç”¨æ¨¡æ¿| E[å¡«å†™æ¨¡æ¿å˜é‡]
                    E --> F[é¡¹ç›®ä¿¡æ¯]
                    F --> G[å®¢æˆ·ä¿¡æ¯]
                    G --> H[å…¶ä»–å˜é‡]
                    H --> I[æäº¤åº”ç”¨]
                    I --> J[åˆ›å»ºæ–‡æ¡£å®ä¾‹]
                    J --> K[å¤åˆ¶ç« èŠ‚ç»“æ„]
                    K --> L[å¡«å……å˜é‡å€¼]
                    L --> M[ç”Ÿæˆåˆå§‹æ–‡æ¡£]
                    M --> N[è·³è½¬åˆ°æ–‡æ¡£ç¼–è¾‘]
                """
            },

            # 5. å®æ—¶åä½œç¼–è¾‘æµç¨‹
            {
                "module": "åä½œ",
                "name": "å¤šäººå®æ—¶åä½œç¼–è¾‘æµç¨‹",
                "key": "REALTIME_COLLAB_FLOW",
                "demand_description": "å¤šä¸ªç”¨æˆ·å¯ä»¥åŒæ—¶ç¼–è¾‘åŒä¸€ä»½æ ‡ä¹¦æ–‡æ¡£ï¼Œå®æ—¶çœ‹åˆ°å…¶ä»–äººçš„ä¿®æ”¹ï¼Œæ”¯æŒè¯„è®ºå’Œè®¨è®º",
                "basic_description": "åŸºäºCRDTç®—æ³•å®ç°å†²çªè‡ªåŠ¨è§£å†³ï¼Œé€šè¿‡WebSocketæ¨é€ç¼–è¾‘æ“ä½œï¼Œæ˜¾ç¤ºåœ¨çº¿ç”¨æˆ·å’Œå…‰æ ‡ä½ç½®",
                "mermaid": """
                graph TD
                    A[ç”¨æˆ·æ‰“å¼€æ–‡æ¡£] --> B[å»ºç«‹WebSocketè¿æ¥]
                    B --> C[åŠ å…¥åä½œä¼šè¯]
                    C --> D[åŒæ­¥æ–‡æ¡£çŠ¶æ€]
                    D --> E[æ˜¾ç¤ºåœ¨çº¿ç”¨æˆ·]
                    E --> F{ç”¨æˆ·æ“ä½œ}
                    F -->|ç¼–è¾‘æ–‡æœ¬| G[è§¦å‘æœ¬åœ°ç¼–è¾‘]
                    G --> H[ç”Ÿæˆæ“ä½œäº‹ä»¶]
                    H --> I[å¹¿æ’­åˆ°å…¶ä»–ç”¨æˆ·]
                    I --> J[CRDTåˆå¹¶æ“ä½œ]
                    J --> K[æ›´æ–°æ–‡æ¡£çŠ¶æ€]
                    K --> F
                    F -->|æ·»åŠ è¯„è®º| L[åˆ›å»ºè¯„è®ºå¯¹è±¡]
                    L --> M[å…³è”æ–‡æœ¬ä½ç½®]
                    M --> I
                    F -->|é€€å‡ºæ–‡æ¡£| N[æ–­å¼€è¿æ¥]
                    N --> O[æ¸…ç†ä¼šè¯çŠ¶æ€]
                """
            },

            # 6. æ–‡æ¡£å®¡æ‰¹æµç¨‹
            {
                "module": "å®¡æ‰¹",
                "name": "æ ‡ä¹¦æ–‡æ¡£å®¡æ‰¹æµç¨‹",
                "key": "DOCUMENT_APPROVAL_FLOW",
                "demand_description": "æ ‡ä¹¦å®Œæˆåéœ€è¦ç»è¿‡æŠ€æœ¯å®¡æ ¸ã€å•†åŠ¡å®¡æ ¸ã€æ³•åŠ¡å®¡æ ¸ç­‰å¤šçº§å®¡æ‰¹ï¼Œæœ€ç»ˆç”±è´Ÿè´£äººæ‰¹å‡†æäº¤",
                "basic_description": "æ”¯æŒä¸²è¡Œå’Œå¹¶è¡Œå®¡æ‰¹èŠ‚ç‚¹ï¼Œæ¯ä¸ªå®¡æ‰¹äººå¯ä»¥é€šè¿‡ã€é©³å›æˆ–é€€å›ä¿®æ”¹ï¼Œè®°å½•å®Œæ•´å®¡æ‰¹å†å²",
                "mermaid": """
                graph TD
                    A[æäº¤å®¡æ‰¹] --> B[åˆ›å»ºå®¡æ‰¹æµç¨‹]
                    B --> C[æŠ€æœ¯å®¡æ ¸]
                    C --> D{æŠ€æœ¯å®¡æ ¸ç»“æœ}
                    D -->|é©³å›| E[è¿”å›ä¿®æ”¹]
                    D -->|é€šè¿‡| F[å•†åŠ¡å®¡æ ¸]
                    F --> G{å•†åŠ¡å®¡æ ¸ç»“æœ}
                    G -->|é©³å›| E
                    G -->|é€šè¿‡| H[æ³•åŠ¡å®¡æ ¸]
                    H --> I{æ³•åŠ¡å®¡æ ¸ç»“æœ}
                    I -->|é©³å›| E
                    I -->|é€šè¿‡| J[æœ€ç»ˆå®¡æ‰¹]
                    J --> K{æœ€ç»ˆå®¡æ‰¹ç»“æœ}
                    K -->|é©³å›| E
                    K -->|é€šè¿‡| L[å®¡æ‰¹å®Œæˆ]
                    E --> M[æ’°å†™äººä¿®æ”¹]
                    M --> A
                """
            },

            # 7. æ–‡æ¡£å¯¼å‡ºæµç¨‹
            {
                "module": "æ ‡ä¹¦æ–‡æ¡£",
                "name": "æ ‡ä¹¦æ–‡æ¡£å¯¼å‡ºæµç¨‹",
                "key": "DOCUMENT_EXPORT_FLOW",
                "demand_description": "ç”¨æˆ·å¯ä»¥å°†æ ‡ä¹¦å¯¼å‡ºä¸ºPDFæˆ–Wordæ ¼å¼ï¼Œä¿ç•™æ ¼å¼å’Œæ ·å¼ï¼Œæ”¯æŒæ‰¹é‡å¯¼å‡ºå’Œè‡ªå®šä¹‰å°é¢",
                "basic_description": "ä½¿ç”¨æ–‡æ¡£è½¬æ¢æœåŠ¡å°†HTMLå†…å®¹è½¬æ¢ä¸ºç›®æ ‡æ ¼å¼ï¼Œåº”ç”¨æ¨¡æ¿æ ·å¼ï¼Œæ·»åŠ é¡µçœ‰é¡µè„šå’Œæ°´å°",
                "mermaid": """
                graph TD
                    A[é€‰æ‹©å¯¼å‡ºæ–‡æ¡£] --> B[é€‰æ‹©å¯¼å‡ºæ ¼å¼]
                    B --> C{PDFæˆ–Word}
                    C -->|PDF| D[é€‰æ‹©PDFé€‰é¡¹]
                    C -->|Word| E[é€‰æ‹©Wordé€‰é¡¹]
                    D --> F[æ·»åŠ æ°´å°]
                    E --> F
                    F --> G[é€‰æ‹©å°é¢æ¨¡æ¿]
                    G --> H[æäº¤å¯¼å‡ºè¯·æ±‚]
                    H --> I[åˆ›å»ºå¯¼å‡ºä»»åŠ¡]
                    I --> J[è·å–æ–‡æ¡£å†…å®¹]
                    J --> K[åº”ç”¨æ ·å¼æ¨¡æ¿]
                    K --> L[å†…å®¹æ ¼å¼è½¬æ¢]
                    L --> M[ç”Ÿæˆç›®æ ‡æ–‡ä»¶]
                    M --> N[ä¸Šä¼ åˆ°MinIO]
                    N --> O[ç”Ÿæˆä¸‹è½½é“¾æ¥]
                    O --> P[é€šçŸ¥ç”¨æˆ·ä¸‹è½½]
                """
            },

            # 8. éœ€æ±‚èƒ½åŠ›åŒ¹é…æµç¨‹
            {
                "module": "ä¼ä¸šèƒ½åŠ›",
                "name": "éœ€æ±‚èƒ½åŠ›æ™ºèƒ½åŒ¹é…æµç¨‹",
                "key": "REQUIREMENT_CAPABILITY_MATCH_FLOW",
                "demand_description": "åˆ†ææ‹›æ ‡éœ€æ±‚åï¼Œè‡ªåŠ¨ä»ä¼ä¸šèƒ½åŠ›åº“ä¸­åŒ¹é…æœ€ç›¸å…³çš„äº§å“ã€æ¡ˆä¾‹ã€äººå‘˜å’Œèµ„è´¨",
                "basic_description": "ä½¿ç”¨å‘é‡æ£€ç´¢å’ŒçŸ¥è¯†å›¾è°±æ¨ç†ï¼Œè®¡ç®—éœ€æ±‚ä¸èƒ½åŠ›çš„ç›¸ä¼¼åº¦ï¼Œæ¨èæœ€ä½³åŒ¹é…ç»“æœ",
                "mermaid": """
                graph TD
                    A[è§£æéœ€æ±‚å®Œæˆ] --> B[æå–éœ€æ±‚å…³é”®è¯]
                    B --> C[ç”Ÿæˆéœ€æ±‚å‘é‡]
                    C --> D[å¹¶è¡ŒåŒ¹é…ä»»åŠ¡]
                    D --> E[äº§å“æœåŠ¡åŒ¹é…]
                    D --> F[æ¡ˆä¾‹åŒ¹é…]
                    D --> G[äººå‘˜åŒ¹é…]
                    D --> H[èµ„è´¨åŒ¹é…]
                    E --> I[è®¡ç®—ç›¸ä¼¼åº¦]
                    F --> I
                    G --> I
                    H --> I
                    I --> J[çŸ¥è¯†å›¾è°±æ¨ç†]
                    J --> K[ç»¼åˆè¯„åˆ†æ’åº]
                    K --> L[ç”ŸæˆåŒ¹é…æŠ¥å‘Š]
                    L --> M[å±•ç¤ºæ¨èç»“æœ]
                    M --> N{ç”¨æˆ·æ“ä½œ}
                    N -->|é€‰æ‹©èƒ½åŠ›| O[æ·»åŠ åˆ°æ ‡ä¹¦]
                    N -->|è°ƒæ•´åŒ¹é…| P[ä¿®æ”¹åŒ¹é…å‚æ•°]
                    P --> D
                """
            },

            # 9. AIè´¨é‡å®¡æŸ¥æµç¨‹
            {
                "module": "AIæœåŠ¡",
                "name": "AIæ™ºèƒ½è´¨é‡å®¡æŸ¥æµç¨‹",
                "key": "AI_QUALITY_REVIEW_FLOW",
                "demand_description": "AIè‡ªåŠ¨æ£€æŸ¥æ ‡ä¹¦å†…å®¹çš„å®Œæ•´æ€§ã€åˆè§„æ€§å’Œè´¨é‡ï¼Œè¯†åˆ«æ½œåœ¨é—®é¢˜å¹¶ç»™å‡ºæ”¹è¿›å»ºè®®",
                "basic_description": "æ£€æŸ¥å¿…å¡«é¡¹ã€æ ¼å¼è§„èŒƒã€å†…å®¹ç›¸å…³æ€§ã€é€»è¾‘ä¸€è‡´æ€§ï¼Œç”Ÿæˆè´¨é‡è¯„åˆ†å’Œæ”¹è¿›å»ºè®®åˆ—è¡¨",
                "mermaid": """
                graph TD
                    A[è§¦å‘è´¨é‡å®¡æŸ¥] --> B[å®Œæ•´æ€§æ£€æŸ¥]
                    B --> C{å¿…å¡«é¡¹æ£€æŸ¥}
                    C -->|ç¼ºå¤±| D[è®°å½•ç¼ºå¤±é¡¹]
                    C -->|å®Œæ•´| E[åˆè§„æ€§æ£€æŸ¥]
                    D --> E
                    E --> F{æ ¼å¼è§„èŒƒæ£€æŸ¥}
                    F -->|ä¸åˆè§„| G[è®°å½•è§„èŒƒé—®é¢˜]
                    F -->|åˆè§„| H[å†…å®¹è´¨é‡æ£€æŸ¥]
                    G --> H
                    H --> I[ç›¸å…³æ€§åˆ†æ]
                    I --> J[é€»è¾‘ä¸€è‡´æ€§æ£€æŸ¥]
                    J --> K[AIè¯„åˆ†]
                    K --> L[ç”Ÿæˆæ”¹è¿›å»ºè®®]
                    L --> M[ç”Ÿæˆè´¨é‡æŠ¥å‘Š]
                    M --> N[å±•ç¤ºç»™ç”¨æˆ·]
                    N --> O{ç”¨æˆ·æ“ä½œ}
                    O -->|é‡‡çº³å»ºè®®| P[è‡ªåŠ¨ä¿®å¤]
                    O -->|å¿½ç•¥| Q[ç»§ç»­ç¼–è¾‘]
                """
            },

            # 10. é¡¹ç›®åä½œé‚€è¯·æµç¨‹
            {
                "module": "é¡¹ç›®ç®¡ç†",
                "name": "é¡¹ç›®æˆå‘˜é‚€è¯·æµç¨‹",
                "key": "PROJECT_MEMBER_INVITE_FLOW",
                "demand_description": "é¡¹ç›®ç»ç†å¯ä»¥é‚€è¯·å…¶ä»–ç”¨æˆ·åŠ å…¥é¡¹ç›®ï¼Œè¢«é‚€è¯·äººæ¥å—åè·å¾—ç›¸åº”æƒé™å‚ä¸åä½œ",
                "basic_description": "æ”¯æŒé‚®ç®±é‚€è¯·å’Œç«™å†…é‚€è¯·ï¼Œå¯ä»¥æŒ‡å®šè§’è‰²å’Œæƒé™ï¼Œé‚€è¯·æœ‰æ•ˆæœŸç®¡ç†",
                "mermaid": """
                graph TD
                    A[é¡¹ç›®ç»ç†å‘èµ·é‚€è¯·] --> B[å¡«å†™é‚€è¯·ä¿¡æ¯]
                    B --> C[é€‰æ‹©é‚€è¯·æ–¹å¼]
                    C --> D{é‚®ç®±æˆ–ç«™å†…}
                    D -->|é‚®ç®±| E[å‘é€é‚€è¯·é‚®ä»¶]
                    D -->|ç«™å†…| F[åˆ›å»ºç«™å†…é€šçŸ¥]
                    E --> G[è¢«é‚€è¯·äººæ”¶åˆ°]
                    F --> G
                    G --> H[æŸ¥çœ‹é‚€è¯·è¯¦æƒ…]
                    H --> I{æ¥å—æˆ–æ‹’ç»}
                    I -->|æ‹’ç»| J[è®°å½•æ‹’ç»]
                    I -->|æ¥å—| K[éªŒè¯é‚€è¯·æœ‰æ•ˆæ€§]
                    K --> L{æ˜¯å¦è¿‡æœŸ}
                    L -->|å·²è¿‡æœŸ| M[æç¤ºé‚€è¯·å¤±æ•ˆ]
                    L -->|æœ‰æ•ˆ| N[æ·»åŠ ä¸ºé¡¹ç›®æˆå‘˜]
                    N --> O[åˆ†é…è§’è‰²æƒé™]
                    O --> P[å‘é€åŠ å…¥é€šçŸ¥]
                    P --> Q[è·³è½¬åˆ°é¡¹ç›®ç©ºé—´]
                """
            }
        ]

        print(f"å¼€å§‹ç”Ÿæˆ {len(flows)} ä¸ªä¸šåŠ¡æµç¨‹å®šä¹‰...")
        for flow in flows:
            self._create_flow_file(flow)
            print(f"  âœ… å·²ç”Ÿæˆ: {flow['name']}")

        print(f"\nâœ… å…¨éƒ¨å®Œæˆ! å…±ç”Ÿæˆ {len(flows)} ä¸ªä¸šåŠ¡æµç¨‹å®šä¹‰")
        print(f"ğŸ“ è¾“å‡ºç›®å½•: {self.output_dir.relative_to(self.project_root)}")

    def _create_flow_file(self, flow_def: Dict[str, Any]):
        """åˆ›å»ºå•ä¸ªä¸šåŠ¡æµç¨‹å®šä¹‰æ–‡ä»¶"""

        module_name = flow_def["module"]
        module_id = self.module_map.get(module_name, 0)

        # è§£æMermaidæµç¨‹å›¾
        mermaid_text = flow_def["mermaid"].strip()

        biz_flow = {
            "biz_flow_id": self.flow_id_counter,
            "biz_flow_name": flow_def["name"],
            "project_id": 1,  # AIBidComposeré¡¹ç›®
            "module_id": module_id,
            "demand_description": flow_def["demand_description"],
            "basic_description": flow_def["basic_description"],
            "detail_description": "",
            "demand_flow_json": {},
            "basic_flow_json": {},
            "detail_flow_json": {},
            "content": {
                "description": flow_def["demand_description"],
                "participants": [],
                "steps": []
            },
            "flow_json": {
                "type": "flowchart",
                "direction": "TD",
                "mermaid": mermaid_text
            },
            "user_requirement_id": 0,
            "user_requirement_piece_id": 0,
            "flow_generate_step_list": [
                {
                    "demand_content": flow_def["demand_description"],
                    "mermaid_flow_text": mermaid_text,
                    "mermaid_flow_json": "",
                    "flow_json_autolayout": "",
                    "flow_json_final": ""
                }
            ],
            "demand_function_point_list": [],
            "is_locked": "N"
        }

        # ä¿å­˜æ–‡ä»¶
        filename = f"{flow_def['key']}-{flow_def['name']}.json"
        file_path = self.output_dir / filename

        with open(file_path, 'w', encoding='utf-8') as f:
            json.dump(biz_flow, f, ensure_ascii=False, indent=2)

        self.flow_id_counter += 1


def main():
    """ä¸»å‡½æ•°"""
    generator = BizFlowGenerator()
    generator.generate_all_flows()


if __name__ == "__main__":
    main()
