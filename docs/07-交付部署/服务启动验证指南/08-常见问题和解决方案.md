# AIBidComposer - 服务启动验证指南 - 常见问题和解决方案

### 1. 服务启动失败

**问题**: 容器一直重启或无法启动

**解决方案**:
```bash
# 查看具体错误
docker-compose logs [service-name]

# 检查端口占用
lsof -i :[port]

# 删除并重建容器
docker-compose down
docker-compose up -d --force-recreate
```

### 2. PostgreSQL连接失败

**问题**: `could not connect to server`

**解决方案**:
```bash
# 检查PostgreSQL容器状态
docker-compose ps postgres

# 检查日志
docker-compose logs postgres

# 重启PostgreSQL
docker-compose restart postgres

# 等待健康检查
docker-compose ps | grep postgres
```

### 3. Elasticsearch内存不足

**问题**: `max virtual memory areas vm.max_map_count is too low`

**解决方案**:
```bash
# 临时解决
sudo sysctl -w vm.max_map_count=262144

# 永久解决（Linux）
echo "vm.max_map_count=262144" | sudo tee -a /etc/sysctl.conf
sudo sysctl -p

# Mac（Docker Desktop）
# 进入Docker Desktop设置 → Resources → Advanced
# 增加内存到至少4GB
```

### 4. Redis连接被拒绝

**问题**: `Connection refused`

**解决方案**:
```bash
# 检查Redis密码
docker-compose exec redis redis-cli -a ${REDIS_PASSWORD} PING

# 检查环境变量
echo $REDIS_PASSWORD

# 重启Redis
docker-compose restart redis
```

### 5. Java服务启动慢

**问题**: Java服务启动需要很长时间

**解决方案**:
```bash
# 查看启动日志
docker-compose logs -f backend-java

# 检查JVM配置
docker-compose exec backend-java java -version
docker-compose exec backend-java env | grep JAVA_OPTS

# 增加启动超时（在docker-compose.yml中）
# healthcheck:
#   start_period: 120s  # 增加到120秒
```

### 6. Python AI服务依赖安装失败

**问题**: 模块导入错误

**解决方案**:
```bash
# 重建Python镜像
docker-compose build --no-cache backend-python

# 检查requirements.txt
cat apps/backend-python/requirements.txt

# 手动安装依赖
docker-compose exec backend-python pip install -r requirements.txt
```

### 7. 前端HMR不工作

**问题**: 修改代码后浏览器不自动刷新

**解决方案**:
```bash
# 检查volume挂载
docker-compose exec frontend ls -la /app/src

# 重启前端服务
docker-compose restart frontend

# 检查Vite配置
cat apps/frontend/vite.config.ts
```

### 8. 数据卷权限问题

**问题**: `Permission denied`

**解决方案**:
```bash
# 检查卷权限
docker volume inspect aibidcomposer_postgres_data

# 更改所有权（Linux）
sudo chown -R $USER:$USER ./data

# 重建卷（警告：会丢失数据）
docker-compose down -v
docker-compose up -d
```

---
