# Python FastAPI AI 服务任务详细计划 - AI-004 - AI-004: 智能匹配分析 - 二级任务 4.3: 智能推荐

**工作量估算**: 4 人天
**优先级**: P2 - 中优先级
**技术难点**:
- 推荐算法设计
- 多维度综合排序
- 个性化推荐

#### 1) 数据定义

```python
# app/models/recommendation.py
class RecommendationItem(BaseModel):
    """推荐项模型"""
    item_id: str
    item_type: str = Field(..., description="case|template|person")
    title: str
    description: str
    relevance_score: Decimal = Field(..., ge=0, le=1)
    reason: str = Field(..., description="推荐理由")
    metadata: Dict[str, Any] = Field(default_factory=dict)

class RecommendationResult(BaseModel):
    """推荐结果"""
    project_id: str

    # 推荐的案例
    recommended_cases: List[RecommendationItem] = Field(default_factory=list)

    # 推荐的模板
    recommended_templates: List[RecommendationItem] = Field(default_factory=list)

    # 推荐的团队成员
    recommended_persons: List[RecommendationItem] = Field(default_factory=list)

    generated_at: datetime = Field(default_factory=datetime.utcnow)
```

**验证标准**:
- [ ] 模型验证通过

#### 2) 前端

```typescript
// src/components/Matching/Recommendations.tsx
export default function Recommendations({ projectId }: Props) {
  const [recommendations, setRecommendations] = useState<RecommendationResult | null>(null);

  return (
    <Tabs>
      <TabPane tab="推荐案例" key="cases">
        <List
          dataSource={recommendations?.recommendedCases}
          renderItem={(item) => (
            <List.Item
              actions={[<Button type="link">引用</Button>]}
            >
              <List.Item.Meta
                title={<Space><Tag color="blue">相关度: {(item.relevanceScore * 100).toFixed(0)}%</Tag>{item.title}</Space>}
                description={
                  <>
                    <p>{item.description}</p>
                    <Tag color="green">推荐理由: {item.reason}</Tag>
                  </>
                }
              />
            </List.Item>
          )}
        />
      </TabPane>

      <TabPane tab="推荐模板" key="templates">
        {/* 类似结构 */}
      </TabPane>

      <TabPane tab="推荐团队" key="persons">
        {/* 类似结构 */}
      </TabPane>
    </Tabs>
  );
}
```

**验证标准**:
- [ ] 推荐列表正常展示
- [ ] 引用功能正常

#### 3) Java后端

```java
// 类似前面的服务调用模式
```

#### 4) Python后端

```python
# app/services/ai/recommendation_service.py
class RecommendationService:
    """智能推荐服务"""

    async def generate_recommendations(
        self,
        project_id: str,
        organization_id: str
    ) -> RecommendationResult:
        """生成推荐"""

        # 1. 获取项目需求
        requirements = await self._fetch_requirements(project_id)

        # 2. 推荐相似案例
        recommended_cases = await self._recommend_cases(
            requirements, organization_id
        )

        # 3. 推荐合适模板
        recommended_templates = await self._recommend_templates(
            requirements
        )

        # 4. 推荐团队成员
        recommended_persons = await self._recommend_persons(
            requirements, organization_id
        )

        return RecommendationResult(
            project_id=project_id,
            recommended_cases=recommended_cases,
            recommended_templates=recommended_templates,
            recommended_persons=recommended_persons
        )

    async def _recommend_cases(
        self,
        requirements: List[Dict[str, Any]],
        organization_id: str
    ) -> List[RecommendationItem]:
        """推荐相似案例（基于向量检索）"""
        # 将需求合并为查询文本
        query_text = "\n".join([
            f"{req['title']}: {req['description']}"
            for req in requirements
        ])

        # 向量检索
        from app.models.search import SearchRequest, SearchMode
        search_request = SearchRequest(
            query=query_text,
            organization_id=organization_id,
            capability_types=['case'],
            search_mode=SearchMode.HYBRID,
            top_k=5
        )

        search_response = await self.search_service.search(search_request)

        # 转换为推荐项
        recommendations = []
        for result in search_response.results:
            recommendations.append(RecommendationItem(
                item_id=result.capability_id,
                item_type="case",
                title=result.name,
                description=result.description,
                relevance_score=Decimal(result.relevance_score),
                reason=f"与项目需求相似度 {(result.relevance_score * 100):.0f}%",
                metadata=result.metadata
            ))

        return recommendations
```

**验证标准**:
- [ ] 案例推荐准确
- [ ] 模板推荐合理
- [ ] 人员推荐匹配需求

#### 5) 部署

```yaml
# 无特殊部署要求
```

---
