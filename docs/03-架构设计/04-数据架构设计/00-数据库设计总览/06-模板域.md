---
æ–‡æ¡£ç±»å‹: æ¶æ„æ–‡æ¡£
éœ€æ±‚ç¼–å·: DOC-2025-11-001
åˆ›å»ºæ—¥æœŸ: 2025-11-15
åˆ›å»ºè€…: claude-sonnet-4-5 (claude-sonnet-4-5-20250929)
æœ€åæ›´æ–°: 2025-11-26
æ›´æ–°è€…: claude-sonnet-4-5 (claude-sonnet-4-5-20250929)
çŠ¶æ€: å·²æ‰¹å‡†
---

# AIæ ‡ä¹¦æ™ºèƒ½åˆ›ä½œå¹³å° - æ•°æ®åº“è®¾è®¡ - ğŸ“‹ æ¨¡æ¿åŸŸ

### 15. templates (æ¨¡æ¿è¡¨)

```sql
CREATE TABLE templates (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    name VARCHAR(200) NOT NULL,
    code VARCHAR(50) UNIQUE NOT NULL,
    description TEXT,
    category VARCHAR(100),
    industry VARCHAR(100),
    template_type VARCHAR(50) DEFAULT 'standard' CHECK (template_type IN ('standard', 'industry', 'custom')),
    scope VARCHAR(20) DEFAULT 'public' CHECK (scope IN ('public', 'organization', 'private')),
    organization_id UUID,
    version VARCHAR(20) DEFAULT '1.0',
    language VARCHAR(10) DEFAULT 'zh-CN',
    content JSONB NOT NULL,
    structure JSONB,
    variables JSONB DEFAULT '[]'::jsonb,
    placeholders JSONB DEFAULT '[]'::jsonb,
    tags TEXT[] DEFAULT ARRAY[]::TEXT[],
    is_active BOOLEAN DEFAULT TRUE,
    usage_count INTEGER DEFAULT 0,
    rating DECIMAL(3, 2) DEFAULT 0,
    rating_count INTEGER DEFAULT 0,
    thumbnail_url TEXT,
    preview_url TEXT,
    metadata JSONB DEFAULT '{}'::jsonb,
    created_by UUID NOT NULL,
    updated_by UUID,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    deleted_at TIMESTAMP WITH TIME ZONE,
    FOREIGN KEY (organization_id) REFERENCES organizations(id) ON DELETE CASCADE,
    FOREIGN KEY (created_by) REFERENCES users(id) ON DELETE RESTRICT,
    FOREIGN KEY (updated_by) REFERENCES users(id) ON DELETE SET NULL
);

-- ç´¢å¼•
CREATE INDEX idx_templates_code ON templates(code) WHERE deleted_at IS NULL;
CREATE INDEX idx_templates_category ON templates(category) WHERE deleted_at IS NULL;
CREATE INDEX idx_templates_industry ON templates(industry) WHERE deleted_at IS NULL;
CREATE INDEX idx_templates_scope ON templates(scope) WHERE deleted_at IS NULL;
CREATE INDEX idx_templates_organization_id ON templates(organization_id) WHERE deleted_at IS NULL;
CREATE INDEX idx_templates_tags ON templates USING gin(tags);
CREATE INDEX idx_templates_rating ON templates(rating DESC) WHERE is_active = TRUE;
CREATE INDEX idx_templates_usage_count ON templates(usage_count DESC);

-- æ³¨é‡Š
COMMENT ON TABLE templates IS 'æ¨¡æ¿è¡¨';
COMMENT ON COLUMN templates.scope IS 'ä½œç”¨åŸŸ: public-å…¬å¼€, organization-ç»„ç»‡, private-ç§æœ‰';
COMMENT ON COLUMN templates.variables IS 'æ¨¡æ¿å˜é‡å®šä¹‰(JSON)';
COMMENT ON COLUMN templates.placeholders IS 'å ä½ç¬¦å®šä¹‰(JSON)';
```

### 16. template_sections (æ¨¡æ¿ç« èŠ‚è¡¨)

```sql
CREATE TABLE template_sections (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    template_id UUID NOT NULL,
    parent_id UUID,
    title VARCHAR(200) NOT NULL,
    section_number VARCHAR(50),
    level INTEGER DEFAULT 1,
    content_template TEXT,
    content_type VARCHAR(20) DEFAULT 'text',
    order_index INTEGER NOT NULL,
    is_required BOOLEAN DEFAULT FALSE,
    is_editable BOOLEAN DEFAULT TRUE,
    variables TEXT[] DEFAULT ARRAY[]::TEXT[],
    hints TEXT,
    metadata JSONB DEFAULT '{}'::jsonb,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (template_id) REFERENCES templates(id) ON DELETE CASCADE,
    FOREIGN KEY (parent_id) REFERENCES template_sections(id) ON DELETE CASCADE
);

-- ç´¢å¼•
CREATE INDEX idx_template_sections_template_id ON template_sections(template_id);
CREATE INDEX idx_template_sections_parent_id ON template_sections(parent_id);
CREATE INDEX idx_template_sections_order_index ON template_sections(template_id, order_index);

-- æ³¨é‡Š
COMMENT ON TABLE template_sections IS 'æ¨¡æ¿ç« èŠ‚è¡¨';
COMMENT ON COLUMN template_sections.content_template IS 'å†…å®¹æ¨¡æ¿(åŒ…å«å˜é‡å ä½ç¬¦)';
COMMENT ON COLUMN template_sections.hints IS 'å¡«å†™æç¤º';
```

### 17. template_usage_logs (æ¨¡æ¿ä½¿ç”¨æ—¥å¿—è¡¨)

```sql
CREATE TABLE template_usage_logs (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    template_id UUID NOT NULL,
    document_id UUID,
    project_id UUID,
    user_id UUID NOT NULL,
    organization_id UUID,
    used_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (template_id) REFERENCES templates(id) ON DELETE CASCADE,
    FOREIGN KEY (document_id) REFERENCES bid_documents(id) ON DELETE SET NULL,
    FOREIGN KEY (project_id) REFERENCES projects(id) ON DELETE SET NULL,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (organization_id) REFERENCES organizations(id) ON DELETE CASCADE
);

-- ç´¢å¼•
CREATE INDEX idx_template_usage_logs_template_id ON template_usage_logs(template_id);
CREATE INDEX idx_template_usage_logs_user_id ON template_usage_logs(user_id);
CREATE INDEX idx_template_usage_logs_used_at ON template_usage_logs(used_at DESC);

-- æ³¨é‡Š
COMMENT ON TABLE template_usage_logs IS 'æ¨¡æ¿ä½¿ç”¨æ—¥å¿—è¡¨';
```
