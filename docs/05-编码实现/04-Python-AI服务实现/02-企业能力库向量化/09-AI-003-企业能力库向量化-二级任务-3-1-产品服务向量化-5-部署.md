# Python FastAPI AI 服务任务详细计划 - AI-003 - AI-003: 企业能力库向量化 - 二级任务 3.1: 产品服务向量化 - 5) 部署

##### Docker配置
```dockerfile
# Dockerfile中添加向量化相关依赖
RUN pip install \
    pika==1.3.2 \
    celery==5.3.4 \
    redis==5.0.1
```

##### docker-compose.yml
```yaml
services:
  # Python AI服务
  backend-python:
    build: ./backend-python
    environment:
      - RABBITMQ_HOST=rabbitmq
      - RABBITMQ_PORT=5672
      - RABBITMQ_USER=rabbitmq
      - RABBITMQ_PASSWORD=${RABBITMQ_PASSWORD}
      - ELASTICSEARCH_URL=http://elasticsearch:9200
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - JAVA_SERVICE_URL=http://backend-java:8080
    depends_on:
      - rabbitmq
      - elasticsearch
    networks:
      - app-network

  # Celery Worker（向量化任务）
  ai-worker:
    build: ./backend-python
    command: celery -A app.tasks.celery_app worker --loglevel=info -Q vectorization
    environment:
      - RABBITMQ_HOST=rabbitmq
      - ELASTICSEARCH_URL=http://elasticsearch:9200
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - JAVA_SERVICE_URL=http://backend-java:8080
    depends_on:
      - rabbitmq
      - elasticsearch
    networks:
      - app-network

  # RabbitMQ消费者（独立进程）
  vectorization-consumer:
    build: ./backend-python
    command: python -m app.consumers.vectorization_consumer
    environment:
      - RABBITMQ_HOST=rabbitmq
      - RABBITMQ_PORT=5672
      - RABBITMQ_USER=rabbitmq
      - RABBITMQ_PASSWORD=${RABBITMQ_PASSWORD}
    depends_on:
      - rabbitmq
    networks:
      - app-network

networks:
  app-network:
    driver: bridge
```

##### 环境变量配置
```bash
# .env
RABBITMQ_HOST=rabbitmq
RABBITMQ_PORT=5672
RABBITMQ_USER=rabbitmq
RABBITMQ_PASSWORD=your_password

ELASTICSEARCH_URL=http://elasticsearch:9200
ELASTICSEARCH_USER=elastic
ELASTICSEARCH_PASSWORD=your_password

OPENAI_API_KEY=sk-your-openai-api-key
JAVA_SERVICE_URL=http://backend-java:8080
```

**验证标准**:
- [ ] 所有容器能正常启动
- [ ] RabbitMQ连接成功
- [ ] Elasticsearch连接成功
- [ ] Celery Worker能接收并处理任务
- [ ] 容器间网络通信正常

---
