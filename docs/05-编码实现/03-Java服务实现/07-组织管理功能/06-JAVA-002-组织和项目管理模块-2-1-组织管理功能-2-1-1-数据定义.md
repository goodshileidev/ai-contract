# Java Spring Boot - JAVA-002 Part1 (组织管理: 数据+前端) - JAVA-002: 组织和项目管理模块 - 2.1: 组织管理功能 - 2.1.1: 数据定义

**验证清单**:
- [ ] Organization 实体类设计完成
- [ ] OrganizationMember 实体类设计完成
- [ ] DTO 类设计完成（CreateOrganizationDTO, UpdateOrganizationDTO, OrganizationResponseDTO）
- [ ] 数据表字段符合数据库设计文档
- [ ] 实体关系映射正确（@OneToMany, @ManyToOne）
- [ ] 软删除字段配置完成
- [ ] 审计字段配置完成

**Organization 实体类**:

```java
package com.aibidcomposer.entity;

import jakarta.persistence.*;
import lombok.*;
import org.hibernate.annotations.SQLDelete;
import org.hibernate.annotations.Where;
import org.springframework.data.annotation.CreatedDate;
import org.springframework.data.annotation.LastModifiedDate;
import org.springframework.data.jpa.domain.support.AuditingEntityListener;

import java.time.LocalDate;
import java.time.LocalDateTime;
import java.util.HashSet;
import java.util.Set;
import java.util.UUID;

/**
 * 组织实体
 * 需求编号: REQ-JAVA-002
 *
 * 支持多层级组织结构（总公司-分公司-部门）
 * 软删除设计，使用 deleted_at 字段
 */
@Entity
@Table(name = "organizations")
@Getter
@Setter
@NoArgsConstructor
@AllArgsConstructor
@Builder
@EntityListeners(AuditingEntityListener.class)
@SQLDelete(sql = "UPDATE organizations SET deleted_at = CURRENT_TIMESTAMP WHERE id = ?")
@Where(clause = "deleted_at IS NULL")
public class Organization {

    @Id
    @GeneratedValue(strategy = GenerationType.UUID)
    @Column(name = "id", updatable = false, nullable = false)
    private UUID id;

    /**
     * 组织名称（必填，最大200字符）
     */
    @Column(name = "name", nullable = false, length = 200)
    private String name;

    /**
     * 组织简称（可选，最大100字符）
     */
    @Column(name = "short_name", length = 100)
    private String shortName;

    /**
     * 组织类型
     * company - 公司
     * government - 政府机构
     * institution - 事业单位
     * individual - 个人
     */
    @Column(name = "organization_type", length = 50)
    @Enumerated(EnumType.STRING)
    private OrganizationType organizationType;

    /**
     * 统一社会信用代码/税号
     */
    @Column(name = "tax_id", length = 50)
    private String taxId;

    /**
     * 法定代表人
     */
    @Column(name = "legal_person", length = 100)
    private String legalPerson;

    /**
     * 联系电话
     */
    @Column(name = "contact_phone", length = 20)
    private String contactPhone;

    /**
     * 联系邮箱
     */
    @Column(name = "contact_email", length = 255)
    private String contactEmail;

    /**
     * 详细地址
     */
    @Column(name = "address", columnDefinition = "TEXT")
    private String address;

    /**
     * 省份
     */
    @Column(name = "province", length = 50)
    private String province;

    /**
     * 城市
     */
    @Column(name = "city", length = 50)
    private String city;

    /**
     * 区县
     */
    @Column(name = "district", length = 50)
    private String district;

    /**
     * 组织Logo URL
     */
    @Column(name = "logo_url", columnDefinition = "TEXT")
    private String logoUrl;

    /**
     * 官方网站
     */
    @Column(name = "website", columnDefinition = "TEXT")
    private String website;

    /**
     * 所属行业
     */
    @Column(name = "industry", length = 100)
    private String industry;

    /**
     * 企业规模
     * small - 小型
     * medium - 中型
     * large - 大型
     * xlarge - 超大型
     */
    @Column(name = "scale", length = 50)
    @Enumerated(EnumType.STRING)
    private OrganizationScale scale;

    /**
     * 成立日期
     */
    @Column(name = "established_date")
    private LocalDate establishedDate;

    /**
     * 组织状态
     * active - 活跃
     * inactive - 未激活
     * suspended - 已暂停
     */
    @Column(name = "status", length = 20, nullable = false)
    @Enumerated(EnumType.STRING)
    @Builder.Default
    private OrganizationStatus status = OrganizationStatus.ACTIVE;

    /**
     * 父组织ID（支持组织层级）
     */
    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "parent_id")
    private Organization parent;

    /**
     * 子组织列表
     */
    @OneToMany(mappedBy = "parent", cascade = CascadeType.ALL)
    @Builder.Default
    private Set<Organization> children = new HashSet<>();

    /**
     * 组织成员列表
     */
    @OneToMany(mappedBy = "organization", cascade = CascadeType.ALL, orphanRemoval = true)
    @Builder.Default
    private Set<OrganizationMember> members = new HashSet<>();

    /**
     * 组织设置（JSONB格式）
     * 存储组织偏好设置、配置参数等
     */
    @Column(name = "settings", columnDefinition = "jsonb DEFAULT '{}'::jsonb")
    private String settings;

    /**
     * 元数据（JSONB格式）
     * 存储扩展信息
     */
    @Column(name = "metadata", columnDefinition = "jsonb DEFAULT '{}'::jsonb")
    private String metadata;

    /**
     * 创建时间（自动填充）
     */
    @CreatedDate
    @Column(name = "created_at", nullable = false, updatable = false)
    private LocalDateTime createdAt;

    /**
     * 更新时间（自动更新）
     */
    @LastModifiedDate
    @Column(name = "updated_at", nullable = false)
    private LocalDateTime updatedAt;

    /**
     * 软删除时间
     */
    @Column(name = "deleted_at")
    private LocalDateTime deletedAt;

    // ==================== 业务方法 ====================

    /**
     * 添加子组织
     */
    public void addChild(Organization child) {
        children.add(child);
        child.setParent(this);
    }

    /**
     * 移除子组织
     */
    public void removeChild(Organization child) {
        children.remove(child);
        child.setParent(null);
    }

    /**
     * 添加成员
     */
    public void addMember(OrganizationMember member) {
        members.add(member);
        member.setOrganization(this);
    }

    /**
     * 移除成员
     */
    public void removeMember(OrganizationMember member) {
        members.remove(member);
        member.setOrganization(null);
    }

    /**
     * 检查是否为根组织
     */
    public boolean isRoot() {
        return parent == null;
    }

    /**
     * 获取组织层级深度
     */
    public int getDepth() {
        int depth = 0;
        Organization current = this;
        while (current.getParent() != null) {
            depth++;
            current = current.getParent();
        }
        return depth;
    }
}

/**
 * 组织类型枚举
 */
enum OrganizationType {
    COMPANY,      // 公司
    GOVERNMENT,   // 政府机构
    INSTITUTION,  // 事业单位
    INDIVIDUAL    // 个人
}

/**
 * 组织规模枚举
 */
enum OrganizationScale {
    SMALL,    // 小型（<100人）
    MEDIUM,   // 中型（100-500人）
    LARGE,    // 大型（500-5000人）
    XLARGE    // 超大型（>5000人）
}

/**
 * 组织状态枚举
 */
enum OrganizationStatus {
    ACTIVE,     // 活跃
    INACTIVE,   // 未激活
    SUSPENDED   // 已暂停
}
```

**OrganizationMember 实体类**:

```java
package com.aibidcomposer.entity;

import jakarta.persistence.*;
import lombok.*;
import org.springframework.data.annotation.CreatedDate;
import org.springframework.data.jpa.domain.support.AuditingEntityListener;

import java.time.LocalDateTime;
import java.util.UUID;

/**
 * 组织成员实体
 * 需求编号: REQ-JAVA-002
 *
 * 管理组织成员关系、角色和权限
 */
@Entity
@Table(name = "organization_members",
    uniqueConstraints = @UniqueConstraint(columnNames = {"organization_id", "user_id"}))
@Getter
@Setter
@NoArgsConstructor
@AllArgsConstructor
@Builder
@EntityListeners(AuditingEntityListener.class)
public class OrganizationMember {

    @Id
    @GeneratedValue(strategy = GenerationType.UUID)
    @Column(name = "id", updatable = false, nullable = false)
    private UUID id;

    /**
     * 所属组织
     */
    @ManyToOne(fetch = FetchType.LAZY, optional = false)
    @JoinColumn(name = "organization_id", nullable = false)
    private Organization organization;

    /**
     * 用户ID
     */
    @Column(name = "user_id", nullable = false)
    private UUID userId;

    /**
     * 组织角色
     * OWNER - 所有者（创建者，最高权限）
     * ADMIN - 管理员（管理权限）
     * MEMBER - 普通成员（基础权限）
     * GUEST - 访客（只读权限）
     */
    @Column(name = "role", length = 20, nullable = false)
    @Enumerated(EnumType.STRING)
    @Builder.Default
    private OrganizationRole role = OrganizationRole.MEMBER;

    /**
     * 加入时间
     */
    @CreatedDate
    @Column(name = "joined_at", nullable = false, updatable = false)
    private LocalDateTime joinedAt;

    /**
     * 添加人ID
     */
    @Column(name = "created_by")
    private UUID createdBy;

    /**
     * 创建时间
     */
    @CreatedDate
    @Column(name = "created_at", nullable = false, updatable = false)
    private LocalDateTime createdAt;

    /**
     * 检查是否为所有者
     */
    public boolean isOwner() {
        return role == OrganizationRole.OWNER;
    }

    /**
     * 检查是否为管理员或所有者
     */
    public boolean isAdminOrOwner() {
        return role == OrganizationRole.OWNER || role == OrganizationRole.ADMIN;
    }
}

/**
 * 组织角色枚举
 */
enum OrganizationRole {
    OWNER,   // 所有者
    ADMIN,   // 管理员
    MEMBER,  // 普通成员
    GUEST    // 访客
}
```

**CreateOrganizationDTO**:

```java
package com.aibidcomposer.dto.organization;

import com.aibidcomposer.entity.OrganizationScale;
import com.aibidcomposer.entity.OrganizationType;
import jakarta.validation.constraints.Email;
import jakarta.validation.constraints.NotBlank;
import jakarta.validation.constraints.Pattern;
import jakarta.validation.constraints.Size;
import lombok.Data;

import java.time.LocalDate;
import java.util.UUID;

/**
 * 创建组织DTO
 * 需求编号: REQ-JAVA-002
 */
@Data
public class CreateOrganizationDTO {

    @NotBlank(message = "组织名称不能为空")
    @Size(max = 200, message = "组织名称最多200个字符")
    private String name;

    @Size(max = 100, message = "组织简称最多100个字符")
    private String shortName;

    private OrganizationType organizationType;

    @Pattern(regexp = "^[A-Z0-9]{18}$", message = "统一社会信用代码格式不正确")
    private String taxId;

    @Size(max = 100, message = "法定代表人最多100个字符")
    private String legalPerson;

    @Pattern(regexp = "^1[3-9]\\d{9}$", message = "联系电话格式不正确")
    private String contactPhone;

    @Email(message = "联系邮箱格式不正确")
    @Size(max = 255, message = "联系邮箱最多255个字符")
    private String contactEmail;

    private String address;

    @Size(max = 50, message = "省份最多50个字符")
    private String province;

    @Size(max = 50, message = "城市最多50个字符")
    private String city;

    @Size(max = 50, message = "区县最多50个字符")
    private String district;

    private String logoUrl;

    private String website;

    @Size(max = 100, message = "行业最多100个字符")
    private String industry;

    private OrganizationScale scale;

    private LocalDate establishedDate;

    /**
     * 父组织ID（创建子组织时使用）
     */
    private UUID parentId;
}
```

**UpdateOrganizationDTO**:

```java
package com.aibidcomposer.dto.organization;

import com.aibidcomposer.entity.OrganizationScale;
import com.aibidcomposer.entity.OrganizationStatus;
import com.aibidcomposer.entity.OrganizationType;
import jakarta.validation.constraints.Email;
import jakarta.validation.constraints.Pattern;
import jakarta.validation.constraints.Size;
import lombok.Data;

import java.time.LocalDate;

/**
 * 更新组织DTO
 * 需求编号: REQ-JAVA-002
 */
@Data
public class UpdateOrganizationDTO {

    @Size(max = 200, message = "组织名称最多200个字符")
    private String name;

    @Size(max = 100, message = "组织简称最多100个字符")
    private String shortName;

    private OrganizationType organizationType;

    @Pattern(regexp = "^[A-Z0-9]{18}$", message = "统一社会信用代码格式不正确")
    private String taxId;

    @Size(max = 100, message = "法定代表人最多100个字符")
    private String legalPerson;

    @Pattern(regexp = "^1[3-9]\\d{9}$", message = "联系电话格式不正确")
    private String contactPhone;

    @Email(message = "联系邮箱格式不正确")
    @Size(max = 255, message = "联系邮箱最多255个字符")
    private String contactEmail;

    private String address;

    @Size(max = 50, message = "省份最多50个字符")
    private String province;

    @Size(max = 50, message = "城市最多50个字符")
    private String city;

    @Size(max = 50, message = "区县最多50个字符")
    private String district;

    private String logoUrl;

    private String website;

    @Size(max = 100, message = "行业最多100个字符")
    private String industry;

    private OrganizationScale scale;

    private LocalDate establishedDate;

    private OrganizationStatus status;
}
```

**OrganizationResponseDTO**:

```java
package com.aibidcomposer.dto.organization;

import com.aibidcomposer.entity.Organization;
import com.aibidcomposer.entity.OrganizationScale;
import com.aibidcomposer.entity.OrganizationStatus;
import com.aibidcomposer.entity.OrganizationType;
import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.time.LocalDate;
import java.time.LocalDateTime;
import java.util.List;
import java.util.UUID;
import java.util.stream.Collectors;

/**
 * 组织响应DTO
 * 需求编号: REQ-JAVA-002
 */
@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class OrganizationResponseDTO {

    private UUID id;
    private String name;
    private String shortName;
    private OrganizationType organizationType;
    private String taxId;
    private String legalPerson;
    private String contactPhone;
    private String contactEmail;
    private String address;
    private String province;
    private String city;
    private String district;
    private String logoUrl;
    private String website;
    private String industry;
    private OrganizationScale scale;
    private LocalDate establishedDate;
    private OrganizationStatus status;

    /**
     * 父组织信息（简化）
     */
    private OrganizationSimpleDTO parent;

    /**
     * 子组织列表（简化）
     */
    private List<OrganizationSimpleDTO> children;

    /**
     * 组织层级深度
     */
    private Integer depth;

    /**
     * 成员数量
     */
    private Integer memberCount;

    private LocalDateTime createdAt;
    private LocalDateTime updatedAt;

    /**
     * 从实体转换为DTO
     */
    public static OrganizationResponseDTO fromEntity(Organization org) {
        if (org == null) return null;

        return OrganizationResponseDTO.builder()
            .id(org.getId())
            .name(org.getName())
            .shortName(org.getShortName())
            .organizationType(org.getOrganizationType())
            .taxId(org.getTaxId())
            .legalPerson(org.getLegalPerson())
            .contactPhone(org.getContactPhone())
            .contactEmail(org.getContactEmail())
            .address(org.getAddress())
            .province(org.getProvince())
            .city(org.getCity())
            .district(org.getDistrict())
            .logoUrl(org.getLogoUrl())
            .website(org.getWebsite())
            .industry(org.getIndustry())
            .scale(org.getScale())
            .establishedDate(org.getEstablishedDate())
            .status(org.getStatus())
            .parent(org.getParent() != null ? OrganizationSimpleDTO.fromEntity(org.getParent()) : null)
            .children(org.getChildren().stream()
                .map(OrganizationSimpleDTO::fromEntity)
                .collect(Collectors.toList()))
            .depth(org.getDepth())
            .memberCount(org.getMembers().size())
            .createdAt(org.getCreatedAt())
            .updatedAt(org.getUpdatedAt())
            .build();
    }
}
```

**OrganizationSimpleDTO**:

```java
package com.aibidcomposer.dto.organization;

import com.aibidcomposer.entity.Organization;
import com.aibidcomposer.entity.OrganizationStatus;
import com.aibidcomposer.entity.OrganizationType;
import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.util.UUID;

/**
 * 组织简化DTO（用于列表和关联展示）
 * 需求编号: REQ-JAVA-002
 */
@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class OrganizationSimpleDTO {

    private UUID id;
    private String name;
    private String shortName;
    private OrganizationType organizationType;
    private OrganizationStatus status;
    private String logoUrl;

    public static OrganizationSimpleDTO fromEntity(Organization org) {
        if (org == null) return null;

        return OrganizationSimpleDTO.builder()
            .id(org.getId())
            .name(org.getName())
            .shortName(org.getShortName())
            .organizationType(org.getOrganizationType())
            .status(org.getStatus())
            .logoUrl(org.getLogoUrl())
            .build();
    }
}
```

**AddMemberDTO**:

```java
package com.aibidcomposer.dto.organization;

import com.aibidcomposer.entity.OrganizationRole;
import jakarta.validation.constraints.NotNull;
import lombok.Data;

import java.util.UUID;

/**
 * 添加组织成员DTO
 * 需求编号: REQ-JAVA-002
 */
@Data
public class AddMemberDTO {

    @NotNull(message = "用户ID不能为空")
    private UUID userId;

    @NotNull(message = "角色不能为空")
    private OrganizationRole role;
}
```

**OrganizationMemberResponseDTO**:

```java
package com.aibidcomposer.dto.organization;

import com.aibidcomposer.entity.OrganizationMember;
import com.aibidcomposer.entity.OrganizationRole;
import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.time.LocalDateTime;
import java.util.UUID;

/**
 * 组织成员响应DTO
 * 需求编号: REQ-JAVA-002
 */
@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class OrganizationMemberResponseDTO {

    private UUID id;
    private UUID userId;
    private String username;
    private String fullName;
    private String email;
    private String avatarUrl;
    private OrganizationRole role;
    private LocalDateTime joinedAt;

    public static OrganizationMemberResponseDTO fromEntity(OrganizationMember member) {
        if (member == null) return null;

        return OrganizationMemberResponseDTO.builder()
            .id(member.getId())
            .userId(member.getUserId())
            .role(member.getRole())
            .joinedAt(member.getJoinedAt())
            // 注意：用户详细信息需要从 User 服务获取
            .build();
    }
}
```
