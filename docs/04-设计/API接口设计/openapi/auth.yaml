openapi: 3.0.3
info:
  title: 认证授权API
  version: 1.0.0
  description: 用户认证和授权相关API

paths:
  /auth/register:
    post:
      tags:
        - 认证授权
      summary: 用户注册
      description: 创建新用户账号
      operationId: register
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - username
                - password
              properties:
                email:
                  type: string
                  format: email
                  description: 邮箱地址
                  example: user@example.com
                username:
                  type: string
                  minLength: 3
                  maxLength: 50
                  description: 用户名
                  example: john_doe
                password:
                  type: string
                  minLength: 8
                  format: password
                  description: 密码（至少8位）
                  example: SecurePass123!
                full_name:
                  type: string
                  description: 全名
                  example: John Doe
                organization_name:
                  type: string
                  description: 组织名称
                  example: ACME Corporation
      responses:
        '201':
          description: 注册成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      user_id:
                        type: string
                        format: uuid
                      email:
                        type: string
                      username:
                        type: string
                      full_name:
                        type: string
                      organization_id:
                        type: string
                        format: uuid
                      created_at:
                        type: string
                        format: date-time
                  message:
                    type: string
                    example: 注册成功
        '400':
          description: 请求参数错误
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                emailExists:
                  value:
                    success: false
                    error:
                      code: EMAIL_ALREADY_EXISTS
                      message: 邮箱已存在
                usernameExists:
                  value:
                    success: false
                    error:
                      code: USERNAME_ALREADY_EXISTS
                      message: 用户名已存在
                invalidPassword:
                  value:
                    success: false
                    error:
                      code: INVALID_PASSWORD
                      message: 密码强度不足

  /auth/login:
    post:
      tags:
        - 认证授权
      summary: 用户登录
      description: 使用邮箱和密码登录
      operationId: login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
              properties:
                email:
                  type: string
                  format: email
                  example: user@example.com
                password:
                  type: string
                  format: password
                  example: SecurePass123!
      responses:
        '200':
          description: 登录成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      access_token:
                        type: string
                        description: 访问令牌
                        example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
                      refresh_token:
                        type: string
                        description: 刷新令牌
                        example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
                      token_type:
                        type: string
                        example: Bearer
                      expires_in:
                        type: integer
                        description: 令牌过期时间（秒）
                        example: 3600
                      user:
                        type: object
                        properties:
                          id:
                            type: string
                            format: uuid
                          email:
                            type: string
                          username:
                            type: string
                          full_name:
                            type: string
                          organization_id:
                            type: string
                            format: uuid
                          roles:
                            type: array
                            items:
                              type: string
                  message:
                    type: string
                    example: 登录成功
        '401':
          description: 认证失败
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: INVALID_CREDENTIALS
                  message: 用户名或密码错误
        '403':
          description: 账号被禁用
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: ACCOUNT_SUSPENDED
                  message: 账号已被暂停
        '429':
          description: 请求过于频繁
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: TOO_MANY_ATTEMPTS
                  message: 登录尝试次数过多

  /auth/refresh-token:
    post:
      tags:
        - 认证授权
      summary: 刷新访问令牌
      description: 使用刷新令牌获取新的访问令牌
      operationId: refreshToken
      security:
        - BearerAuth: []
      responses:
        '200':
          description: 刷新成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      access_token:
                        type: string
                        example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
                      expires_in:
                        type: integer
                        example: 3600
        '401':
          description: 刷新令牌无效或过期
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /auth/logout:
    post:
      tags:
        - 认证授权
      summary: 用户登出
      description: 使当前访问令牌失效
      operationId: logout
      security:
        - BearerAuth: []
      responses:
        '200':
          description: 登出成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: 登出成功

  /auth/me:
    get:
      tags:
        - 认证授权
      summary: 获取当前用户信息
      description: 获取当前登录用户的详细信息
      operationId: getCurrentUser
      security:
        - BearerAuth: []
      responses:
        '200':
          description: 成功获取用户信息
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      id:
                        type: string
                        format: uuid
                      email:
                        type: string
                      username:
                        type: string
                      full_name:
                        type: string
                      avatar_url:
                        type: string
                      organization:
                        type: object
                        properties:
                          id:
                            type: string
                            format: uuid
                          name:
                            type: string
                      roles:
                        type: array
                        items:
                          type: string
                      permissions:
                        type: array
                        items:
                          type: string
                      settings:
                        type: object
        '401':
          description: 未认证
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    ErrorResponse:
      type: object
      properties:
        success:
          type: boolean
          example: false
        error:
          type: object
          properties:
            code:
              type: string
            message:
              type: string
            details:
              type: object
        timestamp:
          type: string
          format: date-time
