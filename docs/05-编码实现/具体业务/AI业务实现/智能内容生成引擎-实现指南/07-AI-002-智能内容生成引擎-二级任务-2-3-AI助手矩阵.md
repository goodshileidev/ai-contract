# Python FastAPI AI 服务任务详细计划 - AI-002 - AI-002: 智能内容生成引擎 - 二级任务 2.3: AI助手矩阵

**预计工作量**: 4 人天
**完成进度**: 0% (0/5 类别)

#### 2.3.1 数据定义

**待完成任务**:
- [ ] 定义AI助手类型枚举
  ```python
  # apps/backend-python/app/models/assistant.py
  from enum import Enum

  class AssistantType(str, Enum):
      """AI助手类型"""
      TECHNICAL_EXPERT = "technical_expert"  # 技术专家
      BUSINESS_EXPERT = "business_expert"    # 商务专家
      COMPLIANCE_EXPERT = "compliance_expert"  # 合规专家
      QUALITY_ASSURER = "quality_assurer"    # 质量审查

  class AssistantConfig(BaseModel):
      """助手配置"""
      assistant_type: AssistantType
      model: str = "gpt-4-turbo-preview"
      temperature: float = 0.7
      system_prompt: str
      max_tokens: int = 2000

  class AssistantMessage(BaseModel):
      """助手消息"""
      role: str  # 'user'|'assistant'
      content: str
      timestamp: datetime
  ```

#### 2.3.2 前端实现

**待完成任务**:
- [ ] 创建AI助手对话界面
  ```typescript
  // apps/frontend/src/components/ai/AssistantChat.tsx
  import { Card, Input, Button, Avatar, List } from 'antd';
  import { RobotOutlined, UserOutlined, SendOutlined } from '@ant-design/icons';

  interface Message {
      role: 'user' | 'assistant';
      content: string;
      timestamp: string;
  }

  interface Props {
      assistantType: string;  // 'technical_expert' | 'business_expert' ...
  }

  export function AssistantChat({ assistantType }: Props) {
      const [messages, setMessages] = useState<Message[]>([]);
      const [inputValue, setInputValue] = useState('');
      const [loading, setLoading] = useState(false);

      const assistantNames = {
          technical_expert: '技术专家助手',
          business_expert: '商务专家助手',
          compliance_expert: '合规专家助手',
          quality_assurer: '质量审查助手',
      };

      const handleSend = async () => {
          if (!inputValue.trim()) return;

          const userMessage: Message = {
              role: 'user',
              content: inputValue,
              timestamp: new Date().toISOString()
          };

          setMessages([...messages, userMessage]);
          setInputValue('');
          setLoading(true);

          try {
              const response = await fetch('http://localhost:8001/api/v1/ai/assistant-chat', {
                  method: 'POST',
                  headers: { 'Content-Type': 'application/json' },
                  body: JSON.stringify({
                      assistant_type: assistantType,
                      message: inputValue,
                      conversation_history: messages
                  })
              });

              const result = await response.json();

              const assistantMessage: Message = {
                  role: 'assistant',
                  content: result.response,
                  timestamp: new Date().toISOString()
              };

              setMessages([...messages, userMessage, assistantMessage]);
          } catch (error) {
              message.error('助手响应失败');
          } finally {
              setLoading(false);
          }
      };

      return (
          <Card title={assistantNames[assistantType]} style={{ height: '600px', display: 'flex', flexDirection: 'column' }}>
              <div style={{ flex: 1, overflowY: 'auto', marginBottom: 16 }}>
                  <List
                      dataSource={messages}
                      renderItem={(msg) => (
                          <List.Item style={{ border: 'none' }}>
                              <List.Item.Meta
                                  avatar={
                                      msg.role === 'user' ?
                                          <Avatar icon={<UserOutlined />} /> :
                                          <Avatar icon={<RobotOutlined />} style={{ backgroundColor: '#1890ff' }} />
                                  }
                                  description={
                                      <div style={{ whiteSpace: 'pre-wrap' }}>
                                          {msg.content}
                                      </div>
                                  }
                              />
                          </List.Item>
                      )}
                  />
              </div>

              <div style={{ display: 'flex', gap: 8 }}>
                  <Input.TextArea
                      value={inputValue}
                      onChange={(e) => setInputValue(e.target.value)}
                      onPressEnter={(e) => {
                          if (!e.shiftKey) {
                              e.preventDefault();
                              handleSend();
                          }
                      }}
                      placeholder="输入您的问题... (Enter发送, Shift+Enter换行)"
                      autoSize={{ minRows: 1, maxRows: 4 }}
                  />
                  <Button
                      type="primary"
                      icon={<SendOutlined />}
                      onClick={handleSend}
                      loading={loading}
                  >
                      发送
                  </Button>
              </div>
          </Card>
      );
  }
  ```

- [ ] 创建助手选择面板
  ```typescript
  // apps/frontend/src/pages/ai/AssistantPanel.tsx
  import { Tabs } from 'antd';

  export default function AssistantPanel() {
      return (
          <Tabs defaultActiveKey="technical_expert">
              <Tabs.TabPane tab="技术专家" key="technical_expert">
                  <AssistantChat assistantType="technical_expert" />
              </Tabs.TabPane>
              <Tabs.TabPane tab="商务专家" key="business_expert">
                  <AssistantChat assistantType="business_expert" />
              </Tabs.TabPane>
              <Tabs.TabPane tab="合规专家" key="compliance_expert">
                  <AssistantChat assistantType="compliance_expert" />
              </Tabs.TabPane>
              <Tabs.TabPane tab="质量审查" key="quality_assurer">
                  <AssistantChat assistantType="quality_assurer" />
              </Tabs.TabPane>
          </Tabs>
      );
  }
  ```

#### 2.3.3 Java后端实现

**待完成任务**:
- [ ] 无需Java后端支持（纯Python实现）

#### 2.3.4 Python后端实现

**待完成任务**:
- [ ] 实现AI助手矩阵服务
  ```python
  # apps/backend-python/app/services/ai/assistant_matrix.py
  from llama_index.llms import OpenAI
  from typing import List, Dict

  class AIAssistantMatrix:
      """AI助手矩阵"""

      def __init__(self):
          self.assistants = {
              AssistantType.TECHNICAL_EXPERT: AssistantConfig(
                  assistant_type=AssistantType.TECHNICAL_EXPERT,
                  model="gpt-4-turbo-preview",
                  temperature=0.2,
                  system_prompt="""你是一位资深的技术专家，擅长：
- 分析技术需求和技术难点
- 设计技术方案和架构
- 评估技术可行性
- 识别技术风险

请以专业、严谨的态度回答用户的技术问题。"""
              ),
              AssistantType.BUSINESS_EXPERT: AssistantConfig(
                  assistant_type=AssistantType.BUSINESS_EXPERT,
                  model="gpt-3.5-turbo",
                  temperature=0.5,
                  system_prompt="""你是一位资深的商务专家，擅长：
- 商务条款分析
- 报价策略制定
- 商务风险评估
- 合同谈判建议

请以专业、务实的态度回答用户的商务问题。"""
              ),
              AssistantType.COMPLIANCE_EXPERT: AssistantConfig(
                  assistant_type=AssistantType.COMPLIANCE_EXPERT,
                  model="gpt-4-turbo-preview",
                  temperature=0.1,
                  system_prompt="""你是一位资深的合规专家，擅长：
- 标书合规性审查
- 法律法规解读
- 资质要求核查
- 合规风险识别

请以严谨、细致的态度审查合规问题。"""
              ),
              AssistantType.QUALITY_ASSURER: AssistantConfig(
                  assistant_type=AssistantType.QUALITY_ASSURER,
                  model="gpt-4-turbo-preview",
                  temperature=0.3,
                  system_prompt="""你是一位资深的质量保证专家，擅长：
- 内容质量评估
- 完整性检查
- 格式规范审查
- 改进建议提供

请以专业、客观的态度评估内容质量。"""
              ),
          }

      async def chat(
          self,
          assistant_type: AssistantType,
          message: str,
          conversation_history: List[Dict[str, str]] = None
      ) -> str:
          """
          与AI助手对话
          需求编号: REQ-AI-002
          """
          config = self.assistants[assistant_type]

          # 初始化LLM
          llm = OpenAI(
              model=config.model,
              api_key=settings.OPENAI_API_KEY,
              temperature=config.temperature
          )

          # 构建消息历史
          messages = [{"role": "system", "content": config.system_prompt}]

          if conversation_history:
              messages.extend(conversation_history)

          messages.append({"role": "user", "content": message})

          # 调用LLM
          response = await llm.achat(messages)

          return response.message.content
  ```

- [ ] 创建API端点
  ```python
  # apps/backend-python/app/api/v1/assistant.py
  @router.post("/assistant-chat")
  async def assistant_chat(
      assistant_type: AssistantType,
      message: str,
      conversation_history: List[Dict[str, str]] = None
  ):
      """
      AI助手对话
      需求编号: REQ-AI-002
      """
      assistant_matrix = AIAssistantMatrix()

      response = await assistant_matrix.chat(
          assistant_type=assistant_type,
          message=message,
          conversation_history=conversation_history or []
      )

      return {
          "assistant_type": assistant_type,
          "response": response,
          "timestamp": datetime.now().isoformat()
      }
  ```

#### 2.3.5 部署配置

**待完成任务**:
- [ ] 配置OPENAI_API_KEY环境变量 ✅
- [ ] 无需额外部署配置

**验收标准**:
- [ ] 4种助手都能正常响应
- [ ] 助手回答符合角色定位
- [ ] 对话历史保持连贯

---
