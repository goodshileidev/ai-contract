# Java Spring Boot 服务任务详细计划 - JAVA-001 Part2 - 1.4: 权限控制 - 1.4.5 部署

**验证清单**:
- [ ] 数据库迁移脚本执行成功
- [ ] 初始权限数据导入完成
- [ ] 环境变量配置正确
- [ ] 权限验证正常工作

#### 初始权限数据

```sql
-- Flyway 迁移脚本: V3__insert_initial_permissions.sql
-- 需求编号: REQ-JAVA-001

-- 插入系统权限
INSERT INTO permissions (id, name, code, description, category, resource, action, is_system) VALUES
-- 用户管理权限
(uuid_generate_v4(), '用户查看', 'user:read', '查看用户信息', '用户管理', 'user', 'read', true),
(uuid_generate_v4(), '用户创建', 'user:create', '创建新用户', '用户管理', 'user', 'create', true),
(uuid_generate_v4(), '用户更新', 'user:update', '更新用户信息', '用户管理', 'user', 'update', true),
(uuid_generate_v4(), '用户删除', 'user:delete', '删除用户', '用户管理', 'user', 'delete', true),

-- 角色管理权限
(uuid_generate_v4(), '角色查看', 'role:read', '查看角色信息', '角色管理', 'role', 'read', true),
(uuid_generate_v4(), '角色创建', 'role:create', '创建新角色', '角色管理', 'role', 'create', true),
(uuid_generate_v4(), '角色更新', 'role:update', '更新角色信息', '角色管理', 'role', 'update', true),
(uuid_generate_v4(), '角色删除', 'role:delete', '删除角色', '角色管理', 'role', 'delete', true),
(uuid_generate_v4(), '角色分配', 'role:assign', '分配角色给用户', '角色管理', 'role', 'assign', true),

-- 项目管理权限
(uuid_generate_v4(), '项目查看', 'project:read', '查看项目信息', '项目管理', 'project', 'read', true),
(uuid_generate_v4(), '项目创建', 'project:create', '创建新项目', '项目管理', 'project', 'create', true),
(uuid_generate_v4(), '项目更新', 'project:update', '更新项目信息', '项目管理', 'project', 'update', true),
(uuid_generate_v4(), '项目删除', 'project:delete', '删除项目', '项目管理', 'project', 'delete', true),

-- 文档管理权限
(uuid_generate_v4(), '文档查看', 'document:read', '查看文档内容', '文档管理', 'document', 'read', true),
(uuid_generate_v4(), '文档创建', 'document:create', '创建新文档', '文档管理', 'document', 'create', true),
(uuid_generate_v4(), '文档更新', 'document:update', '更新文档内容', '文档管理', 'document', 'update', true),
(uuid_generate_v4(), '文档删除', 'document:delete', '删除文档', '文档管理', 'document', 'delete', true),
(uuid_generate_v4(), '文档解析', 'document:parse', '解析招标文档', '文档管理', 'document', 'parse', true),
(uuid_generate_v4(), '文档生成', 'document:generate', 'AI生成文档内容', '文档管理', 'document', 'generate', true),

-- 模板管理权限
(uuid_generate_v4(), '模板查看', 'template:read', '查看模板内容', '模板管理', 'template', 'read', true),
(uuid_generate_v4(), '模板创建', 'template:create', '创建新模板', '模板管理', 'template', 'create', true),
(uuid_generate_v4(), '模板更新', 'template:update', '更新模板内容', '模板管理', 'template', 'update', true),
(uuid_generate_v4(), '模板删除', 'template:delete', '删除模板', '模板管理', 'template', 'delete', true);
```

```sql
-- Flyway 迁移脚本: V4__insert_initial_roles.sql
-- 需求编号: REQ-JAVA-001

-- 插入系统角色
INSERT INTO roles (id, name, code, description, is_system, level) VALUES
(uuid_generate_v4(), '超级管理员', 'SUPER_ADMIN', '拥有所有权限的超级管理员', true, 100),
(uuid_generate_v4(), '管理员', 'ADMIN', '组织管理员，拥有大部分权限', true, 80),
(uuid_generate_v4(), '项目经理', 'PROJECT_MANAGER', '项目经理，负责项目管理', true, 60),
(uuid_generate_v4(), '普通成员', 'MEMBER', '普通成员，基础权限', true, 40),
(uuid_generate_v4(), '访客', 'GUEST', '访客，只读权限', true, 20);

-- 为超级管理员分配所有权限
INSERT INTO role_permissions (role_id, permission_id)
SELECT r.id, p.id
FROM roles r
CROSS JOIN permissions p
WHERE r.code = 'SUPER_ADMIN';

-- 为管理员分配权限（除角色删除外）
INSERT INTO role_permissions (role_id, permission_id)
SELECT r.id, p.id
FROM roles r
CROSS JOIN permissions p
WHERE r.code = 'ADMIN'
AND p.code NOT IN ('role:delete');

-- 为项目经理分配权限
INSERT INTO role_permissions (role_id, permission_id)
SELECT r.id, p.id
FROM roles r
CROSS JOIN permissions p
WHERE r.code = 'PROJECT_MANAGER'
AND p.code IN (
    'project:read', 'project:create', 'project:update',
    'document:read', 'document:create', 'document:update',
    'document:parse', 'document:generate',
    'template:read', 'template:create'
);

-- 为普通成员分配权限
INSERT INTO role_permissions (role_id, permission_id)
SELECT r.id, p.id
FROM roles r
CROSS JOIN permissions p
WHERE r.code = 'MEMBER'
AND p.code IN (
    'project:read',
    'document:read', 'document:create', 'document:update',
    'template:read'
);

-- 为访客分配权限
INSERT INTO role_permissions (role_id, permission_id)
SELECT r.id, p.id
FROM roles r
CROSS JOIN permissions p
WHERE r.code = 'GUEST'
AND p.code IN (
    'project:read',
    'document:read',
    'template:read'
);
```

#### Docker环境变量

```yaml
# docker-compose.yml - 权限相关环境变量
services:
  backend-java:
    environment:
      # RBAC配置
      - RBAC_ENABLED=true
      - RBAC_DEFAULT_ROLE=MEMBER

      # 超级管理员初始化
      - SUPER_ADMIN_EMAIL=admin@aibidcomposer.com
      - SUPER_ADMIN_PASSWORD=${SUPER_ADMIN_PASSWORD}

  backend-python:
    environment:
      # JWT验证配置
      - JWT_SECRET_KEY=${JWT_SECRET}
      - JWT_ALGORITHM=HS256
```
