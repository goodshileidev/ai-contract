---
文档类型: 架构文档
需求编号: DOC-2025-11-001
创建日期: 2025-11-15
创建者: claude-sonnet-4-5 (claude-sonnet-4-5-20250929)
最后更新: 2025-11-26
更新者: claude-sonnet-4-5 (claude-sonnet-4-5-20250929)
状态: 已批准
---

# AI标书智能创作平台 - 架构设计总览

## 📋 文档目的

本架构设计文档提供AI标书智能创作平台（AIBidComposer）的完整技术实施方案，包含：
- 可直接使用的项目结构
- 详细的数据库Schema（SQL DDL）
- 完整的API接口规范（OpenAPI 3.0）
- Docker和Kubernetes部署配置
- 开发环境配置指南

## 🗂️ 架构设计文档结构

```
架构设计/
├── 00-架构设计总览.md                    # 本文档
├── 01-项目结构设计.md                    # 完整项目目录结构
├── 02-数据库设计.md                      # PostgreSQL Schema设计
├── 03-API接口设计.md                     # RESTful API规范
├── 04-微服务架构设计.md                  # 微服务拆分和通信
├── 05-AI能力层设计.md                    # AI服务架构设计
├── 06-部署架构设计.md                    # Docker/K8s部署方案
├── 07-安全架构设计.md                    # 安全和权限设计
├── 08-监控运维设计.md                    # 监控、日志、告警
└── 09-开发环境配置.md                    # 本地开发环境搭建

代码模板/
├── frontend/                             # 前端项目模板
├── backend/                              # 后端项目模板
├── docker/                               # Docker配置
└── k8s/                                  # Kubernetes配置
```

## 🏗️ 系统整体架构

### 架构分层

```
┌─────────────────────────────────────────────────────────────────┐
│                         客户端层 (Client Layer)                │
├─────────────────────────────────────────────────────────────────┤
│  Web应用      │  移动端      │  桌面端      │  第三方集成        │
│  (React 18)   │  (React Native) │  (Electron)  │  (REST/GraphQL API) │
└─────────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────────┐
│                      接入层 (Gateway Layer)                     │
├─────────────────────────────────────────────────────────────────┤
│  Kong API Gateway                                                │
│  ├── 认证鉴权 (JWT + OAuth2)                                    │
│  ├── 请求路由                                                    │
│  ├── 限流熔断                                                    │
│  ├── 负载均衡                                                    │
│  └── 监控日志                                                    │
└─────────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────────┐
│                     应用服务层 (Application Layer)              │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌─────────── Java Spring Boot 服务（数据维护）──────────┐      │
│  │  用户服务    │  项目服务    │  模板服务    │  文档服务  │      │
│  │  (Spring)    │  (Spring)    │  (Spring)    │  (Spring)   │      │
│  │                                                          │      │
│  │  协作服务    │  审批服务    │  导出服务    │  权限服务  │      │
│  │  (Spring)    │  (Spring)    │  (Spring)    │  (Spring)   │      │
│  └──────────────────────────────────────────────────────────┘      │
│                                                                  │
│  ┌─────────── Python FastAPI 服务（AI能力）───────────────┐      │
│  │  AI服务      │  向量化服务  │  语义搜索服务 │  RAG服务   │      │
│  │  (FastAPI)   │  (FastAPI)   │  (FastAPI)    │  (FastAPI)  │      │
│  └──────────────────────────────────────────────────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────────┐
│                      AI能力层 (AI Capability Layer)             │
├─────────────────────────────────────────────────────────────────┤
│  LLM服务集群          │  向量检索服务     │  RAG框架           │
│  (GPT-4/Claude)      │  (Elasticsearch)  │  (LlamaIndex)      │
│                                                                  │
│  工作流编排引擎        │  模型管理服务     │  Prompt工程服务    │
│  (LangChain备用)     │  (MLflow)        │  (自研)            │
└─────────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────────┐
│                     数据层 (Data Layer)                         │
├─────────────────────────────────────────────────────────────────┤
│  关系数据库          │  缓存              │  对象存储            │
│  (PostgreSQL 18.1)  │  (Redis 7+)       │  (MinIO)            │
│                                                                  │
│  搜索与向量检索      │  消息队列          │  时序数据库          │
│  (Elasticsearch 9.2.1) │  (RabbitMQ)       │  (TimescaleDB)      │
└─────────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────────┐
│                   基础设施层 (Infrastructure Layer)              │
├─────────────────────────────────────────────────────────────────┤
│  容器编排            │  服务网格          │  配置中心            │
│  (Kubernetes)       │  (Istio)          │  (Consul)           │
│                                                                  │
│  监控系统            │  日志系统          │  追踪系统            │
│  (Prometheus+Grafana)│ (ELK Stack)      │  (Jaeger)           │
│                                                                  │
│  CI/CD              │  镜像仓库          │  密钥管理            │
│  (GitLab CI)        │  (Harbor)         │  (Vault)            │
└─────────────────────────────────────────────────────────────────┘
```

## 🎯 核心技术栈

### 前端技术栈

```yaml
核心框架:
  框架: React 18.2+
  语言: TypeScript 5.0+
  构建工具: Vite 4.0+

UI组件:
  组件库: Ant Design Pro 6.x
  基础组件: Ant Design 6.0.0 (2025年11月)
  Pro组件: ProComponents 2.8.10 (2025年11月)
  ProForm: @ant-design/pro-form 2.32.0
  图标: Ant Design Icons
  富文本编辑: BlockNote + TipTap
  代码编辑: Monaco Editor

状态管理:
  服务端状态: TanStack Query (React Query) v4
  客户端状态: Zustand
  表单状态: ProForm (Ant Design Pro)

路由:
  路由: React Router 6

数据可视化:
  图表: Recharts + D3.js
  图谱可视化: Cytoscape.js

实时协作:
  CRDT: Yjs
  WebSocket: y-websocket

工具库:
  日期: date-fns
  工具函数: lodash-es
  HTTP客户端: axios
  文件上传: react-dropzone
  拖拽: @dnd-kit/core

测试:
  单元测试: Vitest + React Testing Library
  E2E测试: Playwright
  组件文档: Storybook
```

### 后端技术栈（混合架构）

#### Java Spring Boot 服务（数据维护）

```yaml
核心框架:
  框架: Spring Boot 3.2.x
  语言: Java 17 LTS
  构建工具: Maven 3.9+

Web服务器:
  嵌入式服务器: Tomcat / Undertow

数据访问:
  ORM: Spring Data JPA 3.2.x
  数据库: PostgreSQL 18.1 (2025年11月最新稳定版)
  连接池: HikariCP
  缓存: Spring Cache + Redis 7+

安全:
  框架: Spring Security 6.x
  认证: JWT
  授权: RBAC

服务职责:
  - 用户认证和授权
  - 组织和项目管理
  - 文档CRUD操作
  - 模板管理和版本控制
  - 协作和审批流程
  - 权限和角色管理
  - 系统配置管理
  - 操作日志记录
```

#### Python FastAPI 服务（AI能力）

```yaml
核心框架:
  框架: FastAPI 0.104+
  语言: Python 3.11+
  异步: asyncio + uvloop

Web服务器:
  ASGI服务器: Uvicorn
  进程管理: Gunicorn

数据访问:
  关系数据库: PostgreSQL 18.1 (通过Java服务REST API查询)
  缓存: Redis 7+ (redis-py)
  对象存储: MinIO (minio-py)
  搜索与向量: Elasticsearch 9.2.1 (2025年11月，向量检索 + 全文搜索)

AI/ML:
  RAG框架: LlamaIndex 0.14.8 (2025年11月，主力)
  LLM框架: LangChain 1.1.0 (2025年11月，备用，处理高级Agent场景)
  向量嵌入: OpenAI Embeddings API
  大模型服务:
    - OpenAI SDK 1.0+ (GPT-4)
    - Anthropic SDK 0.7+ (Claude 3)
  文档处理:
    - PDF: PyPDF2 / PDFPlumber
    - Word: python-docx
    - Excel: openpyxl

服务职责:
  - 调用大模型（GPT-4、Claude等）
  - 文档智能解析和向量化
  - 需求分析和智能提取
  - 智能内容生成和优化
  - 语义搜索和相似度匹配
  - 知识图谱构建和推理
  - AI质量审查和评分

任务队列:
  消息队列: RabbitMQ
  任务调度: Celery + Celery Beat

服务间通信:
  HTTP客户端: httpx (调用Java服务API)
  认证: 服务间JWT令牌

API文档:
  文档生成: FastAPI自动生成OpenAPI
  交互文档: Swagger UI + ReDoc

监控日志:
  日志: structlog
  追踪: OpenTelemetry
  APM: Sentry

测试:
  测试框架: pytest + pytest-asyncio
  HTTP测试: httpx
  覆盖率: pytest-cov
```

### DevOps技术栈

```yaml
容器化:
  容器: Docker 24+
  编排: Kubernetes 1.28+
  服务网格: Istio 1.19+

CI/CD:
  版本控制: Git + GitLab
  CI/CD: GitLab CI/CD
  镜像仓库: Harbor

监控:
  指标监控: Prometheus + Grafana
  日志聚合: ELK Stack (Elasticsearch + Logstash + Kibana)
  追踪: Jaeger
  告警: Alertmanager

配置管理:
  配置中心: Consul
  密钥管理: HashiCorp Vault

网关:
  API网关: Kong Gateway
  服务发现: Consul
```

## 📊 数据架构概览

### 数据库设计原则

1. **规范化设计**: 遵循第三范式，减少数据冗余
2. **性能优化**: 合理使用索引，优化查询性能
3. **扩展性**: 预留扩展字段，支持业务扩展
4. **安全性**: 敏感数据加密存储，访问控制
5. **审计追踪**: 记录所有关键操作的审计日志

### 核心数据模型

```
用户与权限域:
  ├── users (用户表)
  ├── organizations (组织表)
  ├── roles (角色表)
  ├── permissions (权限表)
  └── user_role_mapping (用户角色映射)

项目域:
  ├── projects (项目表)
  ├── project_members (项目成员表)
  ├── bidding_documents (招标文件表)
  └── project_milestones (项目里程碑)

标书域:
  ├── bid_documents (标书文档表)
  ├── document_sections (文档章节表)
  ├── document_versions (文档版本表)
  └── document_comments (文档评论表)

模板域:
  ├── templates (模板表)
  ├── template_sections (模板章节表)
  ├── template_variables (模板变量表)
  └── template_usage_logs (模板使用日志)

企业能力域:
  ├── company_profile (企业档案表)
  ├── products_services (产品服务表)
  ├── project_cases (项目案例表)
  ├── personnel (人员资质表)
  ├── certifications (资质证书表)
  └── historical_bids (历史标书表)

知识图谱域 (Neo4j):
  ├── Requirement (需求节点)
  ├── Capability (能力节点)
  ├── Project (项目节点)
  ├── Person (人员节点)
  ├── Case (案例节点)
  └── Relationships (各种关系)

AI服务域:
  ├── ai_tasks (AI任务表)
  ├── ai_prompts (Prompt模板表)
  ├── ai_responses (AI响应表)
  └── ai_usage_logs (AI使用日志)

协作域:
  ├── collaboration_sessions (协作会话表)
  ├── real_time_edits (实时编辑记录)
  └── collaboration_events (协作事件表)

审批域:
  ├── approval_workflows (审批流程表)
  ├── approval_tasks (审批任务表)
  └── approval_logs (审批日志表)
```

## 🔌 API架构概览

### API设计原则

1. **RESTful风格**: 遵循REST架构风格
2. **版本控制**: API版本化管理 (v1, v2)
3. **统一响应**: 统一的响应格式
4. **错误处理**: 标准化的错误码和错误信息
5. **文档完善**: OpenAPI 3.0规范，自动生成文档

### API分类

```
认证授权API (/api/v1/auth):
  POST   /register          # 用户注册
  POST   /login             # 用户登录
  POST   /logout            # 用户登出
  POST   /refresh-token     # 刷新Token
  GET    /me                # 获取当前用户信息

项目管理API (/api/v1/projects):
  GET    /projects                    # 获取项目列表
  POST   /projects                    # 创建项目
  GET    /projects/{id}               # 获取项目详情
  PUT    /projects/{id}               # 更新项目
  DELETE /projects/{id}               # 删除项目
  POST   /projects/{id}/members       # 添加项目成员

文档管理API (/api/v1/documents):
  POST   /documents/parse             # 解析招标文件
  GET    /documents/{id}              # 获取文档
  PUT    /documents/{id}              # 更新文档
  POST   /documents/{id}/versions     # 创建版本
  GET    /documents/{id}/versions     # 获取版本列表

AI服务API (/api/v1/ai):
  POST   /ai/analyze-requirements     # 分析需求
  POST   /ai/match-capabilities       # 匹配能力
  POST   /ai/generate-content         # 生成内容
  POST   /ai/review-quality           # 质量审核
  GET    /ai/tasks/{id}               # 获取AI任务状态

模板管理API (/api/v1/templates):
  GET    /templates                   # 获取模板列表
  POST   /templates                   # 创建模板
  GET    /templates/{id}              # 获取模板详情
  PUT    /templates/{id}              # 更新模板

企业能力API (/api/v1/capabilities):
  GET    /capabilities/products       # 获取产品列表
  POST   /capabilities/products       # 添加产品
  GET    /capabilities/cases          # 获取案例列表
  POST   /capabilities/cases          # 添加案例

协作API (/api/v1/collaboration):
  WS     /collaboration/connect       # WebSocket连接
  POST   /collaboration/sessions      # 创建协作会话
  GET    /collaboration/sessions/{id} # 获取会话信息

导出API (/api/v1/export):
  POST   /export/pdf                  # 导出PDF
  POST   /export/word                 # 导出Word
  GET    /export/tasks/{id}           # 获取导出任务状态
```

### 统一响应格式

```typescript
// 成功响应
{
  "success": true,
  "data": any,
  "message": "操作成功",
  "timestamp": "2025-11-14T10:00:00Z"
}

// 错误响应
{
  "success": false,
  "error": {
    "code": "ERROR_CODE",
    "message": "错误描述",
    "details": {}
  },
  "timestamp": "2025-11-14T10:00:00Z"
}

// 分页响应
{
  "success": true,
  "data": {
    "items": [],
    "total": 100,
    "page": 1,
    "pageSize": 20,
    "totalPages": 5
  },
  "message": "获取成功",
  "timestamp": "2025-11-14T10:00:00Z"
}
```

## 🔐 安全架构概览

### 安全层次

```
应用层安全:
  ├── 认证: JWT + OAuth2.0
  ├── 授权: RBAC (Role-Based Access Control)
  ├── 加密: HTTPS + TLS 1.3
  └── 防护: CSRF + XSS + SQL注入防护

数据层安全:
  ├── 敏感数据加密 (AES-256)
  ├── 密码加密 (bcrypt)
  ├── 数据脱敏
  └── 备份加密

网络层安全:
  ├── VPC隔离
  ├── 安全组
  ├── WAF (Web Application Firewall)
  └── DDoS防护

审计与合规:
  ├── 操作审计日志
  ├── 访问日志
  ├── 合规性报告
  └── 数据隐私保护 (符合GDPR/个人信息保护法)
```

## 📈 性能与扩展性

### 性能指标

```yaml
响应时间:
  API响应: < 200ms (P95)
  页面加载: < 2s (首次加载)
  页面切换: < 500ms
  AI生成: < 10s (单次)

并发能力:
  同时在线: 10,000+ 用户
  并发请求: 1,000 req/s
  WebSocket连接: 5,000+ 连接

可用性:
  系统可用性: 99.9%
  数据持久性: 99.999%
  RTO: < 1小时
  RPO: < 5分钟
```

### 扩展策略

```yaml
水平扩展:
  应用服务: 无状态设计，支持横向扩展
  数据库: 读写分离，分库分表
  缓存: Redis集群
  文件存储: MinIO分布式集群

垂直扩展:
  数据库: 升级配置
  缓存: 增加内存
  计算: 增加CPU/内存

弹性伸缩:
  基于负载: HPA (Horizontal Pod Autoscaler)
  基于时间: 定时扩缩容
  基于事件: 事件驱动扩缩容
```

## 🚀 部署架构概览

### 环境规划

```yaml
开发环境 (Development):
  目的: 本地开发和调试
  部署: Docker Compose
  规模: 单机部署

测试环境 (Testing):
  目的: 功能测试、集成测试
  部署: Kubernetes (单节点)
  规模: 小规模

预发环境 (Staging):
  目的: 性能测试、UAT测试
  部署: Kubernetes (多节点)
  规模: 生产同等配置

生产环境 (Production):
  目的: 正式服务
  部署: Kubernetes (高可用集群)
  规模: 根据负载动态扩展
```

### 部署拓扑

```
生产环境拓扑:

┌─────────────────────────────────────────────────┐
│            负载均衡层 (Load Balancer)           │
│         Nginx / AWS ALB / Aliyun SLB           │
└─────────────────────────────────────────────────┘
                      ↓
┌─────────────────────────────────────────────────┐
│              Kubernetes集群                     │
│  ┌──────────────────────────────────────────┐  │
│  │  Ingress Controller (Nginx/Traefik)     │  │
│  └──────────────────────────────────────────┘  │
│                      ↓                          │
│  ┌──────────────────────────────────────────┐  │
│  │  API Gateway (Kong)                      │  │
│  │  - Namespace: gateway                    │  │
│  │  - Replicas: 3+                          │  │
│  └──────────────────────────────────────────┘  │
│                      ↓                          │
│  ┌──────────────────────────────────────────┐  │
│  │  Microservices Pods                      │  │
│  │  - Namespace: application                │  │
│  │  - 用户服务 (Replicas: 3+)                │  │
│  │  - 项目服务 (Replicas: 3+)                │  │
│  │  - AI服务 (Replicas: 5+)                 │  │
│  │  - ... 其他服务                           │  │
│  └──────────────────────────────────────────┘  │
│                      ↓                          │
│  ┌──────────────────────────────────────────┐  │
│  │  Data Services                           │  │
│  │  - Namespace: data                       │  │
│  │  - PostgreSQL (StatefulSet)             │  │
│  │  - Redis (StatefulSet)                   │  │
│  │  - RabbitMQ (StatefulSet)                │  │
│  └──────────────────────────────────────────┘  │
└─────────────────────────────────────────────────┘
                      ↓
┌─────────────────────────────────────────────────┐
│           外部服务 (External Services)          │
│  - MinIO / AWS S3 (对象存储)                    │
│  - Pinecone (向量数据库)                        │
│  - OpenAI API (LLM服务)                        │
│  - Monitoring (Prometheus + Grafana)          │
└─────────────────────────────────────────────────┘
```

## 📚 后续文档

本总览文档提供了系统的整体架构视图。详细的设计和实现请参考以下文档：

1. **01-项目结构设计.md**: 前端和后端的完整项目目录结构
2. **02-数据库设计.md**: 所有数据表的详细Schema定义
3. **03-API接口设计.md**: 完整的API接口规范(OpenAPI 3.0)
4. **04-微服务架构设计.md**: 微服务的拆分、通信和治理
5. **05-AI能力层设计.md**: AI服务的架构和实现细节
6. **06-部署架构设计.md**: Docker和Kubernetes的具体配置
7. **07-安全架构设计.md**: 全面的安全设计和实施方案
8. **08-监控运维设计.md**: 监控、日志、告警的完整方案
9. **09-开发环境配置.md**: 本地开发环境的搭建指南

## 🎯 快速开始

### 开发环境快速启动

```bash
# 1. 克隆代码
git clone https://github.com/your-org/aibidcomposer.git
cd aibidcomposer

# 2. 启动后端服务 (Docker Compose)
cd backend
docker-compose up -d

# 3. 启动前端开发服务器
cd ../frontend
npm install
npm run dev

# 4. 访问应用
# 前端: http://localhost:5173
# API文档: http://localhost:8000/docs
```

### 生产环境部署

```bash
# 1. 构建Docker镜像
./scripts/build-images.sh

# 2. 部署到Kubernetes
kubectl apply -f k8s/

# 3. 检查部署状态
kubectl get pods -n application
```

---

## 修改历史

| 日期 | 版本 | 修改者 | 修改内容概要 |
|------|------|--------|-------------|
| 2025-11-26 | 2.0 | claude-sonnet-4-5 (claude-sonnet-4-5-20250929) | 重大更新：架构调整为混合后端（Java Spring Boot + Python FastAPI），更新所有技术栈描述，添加元信息头部 |
| 2025-11-15 | 1.0 | claude-sonnet-4-5 (claude-sonnet-4-5-20250929) | 创建架构设计总览文档 |

---

**文档状态**: ✅ 已批准
**文档版本**: v2.0
**最后更新**: 2025-11-26
**维护团队**: AIBidComposer技术团队
**更新策略**: 每个Sprint更新一次，重大架构变更立即更新
